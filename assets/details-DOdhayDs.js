import{j as e,B as W,aj as O,ak as ce,av as _,t as N,aw as de,x as ue,D as pe,G as Z,M as K,H as Y,J as ee,L as te,O as ne,N as B}from"./chakra-BSDUEdZw.js";import{c as P,e as A,aO as he,X as ge,aP as me,aH as fe,x as v,y as w,q as I,aD as z,L as se,p as xe,V as U,aQ as F,w as T,S as ye,a3 as be,a4 as Se,k as H,o as ae,D,aI as J,aM as je,aR as we,aS as Ae,aT as Ne,aU as Ce,aJ as Ee,n as $}from"./index-62JQVL9H.js";import{u as R,b as c}from"./react-BsdiJPLR.js";import{u as q,e as ve}from"./clipboard-PKtiM75v.js";import{s as V}from"./master-manager-hx7azJm7.js";import{C as Te,c as Le,a as Pe,b as Re}from"./change-type-modal-Dqlb3Tjs.js";import{l as ke,L as ze}from"./tools-BfseWEj2.js";import{m as Oe}from"./misc-nodes-D6Y0vgNo.js";function We(){const{t:n}=R(),r=P(),{selected:o}=A(a=>a.runtime),d=c.useRef(window.graph),u=a=>{if(d.current.hasNode(a)){const l=d.current.getNodeAttributes(a),f=l.type;return a.startsWith("stn")?l[f].names.join("/"):f}else if(d.current.hasEdge(a)){const[l,f]=d.current.extremities(a),p=d.current.getSourceAttributes(a),x=d.current.getTargetAttributes(a),S=p.type,m=x.type;return(l.startsWith("stn")?p[S].names[0]:S)+" - "+(f.startsWith("stn")?x[m].names[0]:m)}},[t,s]=c.useState([]);c.useEffect(()=>{s(["station","misc-node","line"])},[o]);const[i,g]=c.useState(!1);return e.jsxs(W,{children:[e.jsxs(O,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(ce,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(O,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(he,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:t,multiSelect:!0,onChange:a=>s(a)})]}),t.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{width:"100%",size:"sm",onClick:()=>g(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(de,{label:n("header.settings.pro"),children:e.jsx(ue,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(pe,{})]}),[...o].filter(a=>t.includes("station")||!a.startsWith("stn")).filter(a=>t.includes("misc-node")||!a.startsWith("misc")).filter(a=>t.includes("line")||!a.startsWith("line")).map(a=>{var l;return e.jsxs(_,{width:"100%",children:[e.jsx(N,{width:"100%",size:"sm",variant:"solid",onClick:()=>r(ge(new Set([a]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=u(a))==null?void 0:l.replaceAll("\n","⏎")}),e.jsx(N,{size:"sm",onClick:()=>r(fe(a)),children:e.jsx(me,{})})]},a)})]}),e.jsx(Te,{isOpen:i,onClose:()=>g(!1),isSelect:!0,filter:t})]})}function Ie(){var X,G;const{i18n:n,t:r}=R(),o=P(),d=c.useCallback(()=>{o(v()),o(w(g.current.export()))},[o,v,w]),{preference:{autoParallel:u}}=A(j=>j.app),{selected:t,theme:s}=A(j=>j.runtime),[i]=t,g=c.useRef(window.graph),[a,l]=c.useState(!1),f=c.useRef(null),p=Object.fromEntries(Object.entries(I).map(([j,oe])=>[j,r(oe.metadata.displayName).toString()])),[x,S]=c.useState(g.current.getEdgeAttribute(i,"type")),[m,h]=c.useState(void 0),y=Object.fromEntries((G=(X=ke[n.language])==null?void 0:X.map(j=>[j,r(z[j].metadata.displayName).toString()]))!=null?G:[]),[b,C]=c.useState(g.current.getEdgeAttribute(i,"style")),[E,L]=c.useState(void 0);c.useEffect(()=>{S(g.current.getEdgeAttribute(i,"type")),C(g.current.getEdgeAttribute(i,"style"))},[i]);const k=Object.values(se).filter(j=>!z[b].metadata.supportLinePathType.includes(j)),ie=Object.values(xe).filter(j=>!z[j].metadata.supportLinePathType.includes(x)),re=()=>{m&&(Le(g.current,i,m,u),S(g.current.getEdgeAttribute(i,"type")),d())},le=()=>{E&&(Pe(g.current,i,E,s),C(g.current.getEdgeAttribute(i,"style")),d())},M=j=>{j&&(m?(re(),h(void 0)):E&&(le(),L(void 0))),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{label:r("panel.details.info.linePathType"),minW:"276",children:e.jsx(F,{options:p,disabledOptions:k,defaultValue:x,value:x,onChange:({target:{value:j}})=>{h(j),l(!0)}})}),e.jsx(U,{label:r("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(F,{options:y,disabledOptions:ie,defaultValue:b,value:b,onChange:({target:{value:j}})=>{L(j),l(!0)}})}),e.jsx(ze,{type:"line",expand:!0}),e.jsx(Z,{isOpen:a,leastDestructiveRef:f,onClose:()=>M(!1),children:e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(ee,{children:r("warning")}),e.jsx(te,{children:r("panel.details.changeLineTypeContent")}),e.jsxs(ne,{children:[e.jsx(N,{ref:f,onClick:()=>M(!1),children:r("cancel")}),e.jsx(N,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:r("panel.details.changeType")})]})]})})})]})}function De(){const{t:n}=R(),r=P(),o=c.useCallback(()=>{r(T()),r(w(s.current.export()))},[r,T,w]),{selected:d,refresh:{nodes:u}}=A(y=>y.runtime),[t]=d,s=c.useRef(window.graph),[i,g]=c.useState(!1),a=c.useRef(null),[l,f]=c.useState(void 0),[p,x]=c.useState(ye.ShmetroBasic);c.useEffect(()=>{if(t!=null&&t.startsWith("stn")){const y=s.current.getNodeAttribute(t,"type");x(y)}},[u,d]);const S=Object.fromEntries(Object.entries(V).map(([y,b])=>[y,n(b.metadata.displayName).toString()])),m=()=>{l&&(Re(s.current,t,l),o())},h=y=>{y&&m(),f(void 0),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(F,{options:S,disabledOptions:[p],value:p,onChange:({target:{value:y}})=>{f(y),g(!0)}})}),e.jsx(Z,{isOpen:i,leastDestructiveRef:a,onClose:()=>h(!1),children:e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(ee,{children:n("warning")}),e.jsx(te,{children:n("panel.details.changeStationTypeContent")}),e.jsxs(ne,{children:[e.jsx(N,{ref:a,onClick:()=>h(!1),children:n("cancel")}),e.jsx(N,{ml:"2",colorScheme:"red",onClick:()=>h(!0),children:n("panel.details.changeType")})]})]})})})]})}function Me(){const{t:n}=R(),r=P(),o=c.useCallback(()=>{r(T()),r(v()),r(w(i.current.export()))},[r,T,v,w]),{activeSubscriptions:d}=A(p=>p.account),{selected:u,count:{parallel:t}}=A(p=>p.runtime),[s]=u,i=c.useRef(window.graph),g=p=>{const x=Math.min(Math.max(p,-10),10);i.current.hasNode(s)&&i.current.setNodeAttribute(s,"zIndex",x),i.current.hasEdge(s)&&i.current.setEdgeAttribute(s,"zIndex",x),o()},a=(p,x)=>{let S=-1;if(p){const m=i.current.getEdgeAttributes(s),[h,y]=i.current.extremities(s);S=ae(i.current,m.type,h,y,x)}l(S)},l=p=>{i.current.setEdgeAttribute(s,"parallelIndex",p),r(v()),r(w(i.current.export()))},f=[];if(u.size!==0)if(u.size===1){if(f.push({type:"input",label:n("panel.details.info.id"),value:s,minW:276}),f.push({type:"select",label:n("panel.details.info.zIndex"),value:s?i.current.hasNode(s)?i.current.getNodeAttribute(s,"zIndex"):i.current.hasEdge(s)?i.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(p,x)=>[x-10,(x-10).toString()])),onChange:p=>g(Number(p))}),i.current.hasEdge(s)){const p=i.current.getEdgeAttributes(s),{parallelIndex:x,type:S}=p,m=d.RMP_CLOUD?be:Se,h=t>m&&x<0||S===se.Simple,y=t>m&&x>=0;f.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:h,isChecked:x>=0,onChange:b=>a(b,p[p.type].startFrom),oneLine:!0,minW:276}),x>=0&&f.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:y,value:p.parallelIndex.toString(),onChange:b=>l(Number(b)),minW:276})}}else u.size>1&&f.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(H,{fields:f,minW:130}),u.size===1&&s.startsWith("stn")&&i.current.hasNode(s)&&i.current.getNodeAttribute(s,"type")in V&&e.jsx(De,{}),u.size===1&&s.startsWith("line")&&i.current.hasEdge(s)&&i.current.getEdgeAttribute(s,"type")in I&&i.current.getEdgeAttribute(s,"style")in z&&e.jsx(Ie,{}),u.size>1&&e.jsx(We,{})]})}function _e(){const{t:n}=R(),r=P(),{selected:o}=A(h=>h.runtime),[d]=o,u=c.useRef(window.graph),[t,s]=c.useState("undefined"),[i,g]=c.useState("undefined"),[a,l]=c.useState("undefined"),[f,p]=c.useState("undefined");c.useEffect(()=>{var h,y,b,C;if(d!=null&&d.startsWith("line")){const[E,L]=u.current.extremities(d);if(s(E),g(L),E.startsWith("stn")){const k=u.current.getNodeAttribute(E,"type");l((y=(h=u.current.getNodeAttribute(E,k))==null?void 0:h.names.at(0))!=null?y:"undefined")}if(L.startsWith("stn")){const k=u.current.getNodeAttribute(L,"type");p((C=(b=u.current.getNodeAttribute(L,k))==null?void 0:b.names.at(0))!=null?C:"undefined")}}},[o]);const x=q(()=>{r(D()),r(J(t))}),S=q(()=>{r(D()),r(J(i))}),m=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(N,{ml:"auto",size:"sm",variant:"link",onClick:x,children:t}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:a,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(N,{ml:"auto",size:"sm",variant:"link",onClick:S,children:i}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:f,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(H,{fields:m,minW:130})]})}function Be(){const{t:n}=R(),r=P(),o=c.useCallback(()=>{r(T()),r(v()),r(w(s.current.export()))},[r,T,v,w]),{selected:d,refresh:{nodes:u}}=A(l=>l.runtime),[t]=d,s=c.useRef(window.graph),[i,g]=c.useState({x:0,y:0});c.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const l=s.current.getNodeAttribute(t,"x"),f=s.current.getNodeAttribute(t,"y");g({x:l,y:f})}},[u,d]);const a=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:i.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{s.current.mergeNodeAttributes(t,{x:Number(l)}),o()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:i.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{s.current.mergeNodeAttributes(t,{y:Number(l)}),o()}}];return e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(H,{fields:a,minW:130})]})}const Q={...V,...Oe},Ue=()=>{var g;const n=P(),{selected:r}=A(a=>a.runtime),{t:o}=R(),[d]=r,u=window.graph.getNodeAttribute(d,"type"),t=u in Q&&Q[u].attrsComponent,s=(g=window.graph.getNodeAttribute(d,u))!=null?g:{},i=(a,l)=>{const f=window.graph.getNodeAttribute(a,"type");window.graph.mergeNodeAttributes(a,{[f]:l}),n(T()),n(w(window.graph.export()))};return t?e.jsx(t,{id:d,attrs:s,handleAttrsUpdate:i}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Fe=()=>{var h,y;const n=P(),{preference:{autoParallel:r}}=A(b=>b.app),{selected:o}=A(b=>b.runtime),{t:d}=R(),[u]=o,{type:t,style:s,parallelIndex:i,reconcileId:g}=window.graph.getEdgeAttributes(u),a=(h=window.graph.getEdgeAttribute(u,t))!=null?h:{},l=t in I&&I[t].attrsComponent,f=(y=window.graph.getEdgeAttribute(u,s))!=null?y:{},p=s in z&&z[s].attrsComponent,x=(b,C)=>{let E=-1;if(r){const[L,k]=window.graph.extremities(b);E=ae(window.graph,t,L,k,C)}window.graph.setEdgeAttribute(b,"parallelIndex",E)},S=(b,C)=>{window.graph.mergeEdgeAttributes(b,{[t]:C}),n(v()),n(w(window.graph.export()))},m=(b,C)=>{window.graph.mergeEdgeAttributes(b,{[s]:C}),n(v()),n(w(window.graph.export()))};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:u,attrs:a,recalculateParallelIndex:x,handleAttrsUpdate:S,parallelIndex:i}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.linePath")})}),p?e.jsx(p,{id:u,attrs:f,handleAttrsUpdate:m,reconcileId:g}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.lineStyle")})})]})},Ze=()=>{const{t:n}=R(),r=P(),o=c.useRef(window.graph),d=c.useCallback(()=>{r(T()),r(v()),r(w(o.current.export()))},[r,T,v,w]),{activeSubscriptions:u}=A(m=>m.account),{selected:t,mode:s,active:i,count:{masters:g}}=A(m=>m.runtime),[a]=t,l=!u.RMP_CLOUD&&g+1>je,f=()=>r(D()),p=m=>{const h=structuredClone(o.current.getNodeAttributes(m));h.x+=50,h.y+=50;const y=m.startsWith("stn")?"stn_".concat($(10)):"misc_node_".concat($(10));o.current.addNode(y,h),r(T()),r(w(o.current.export()))},x=m=>{const h=ve(o.current,m);navigator.clipboard.writeText(h)},S=m=>{r(D()),m.forEach(h=>{o.current.hasNode(h)?o.current.dropNode(h):o.current.hasEdge(h)&&o.current.dropEdge(h)}),d()};return e.jsxs(we,{isOpen:t.size>0&&!s.startsWith("line")&&!i,width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(Ae,{onClose:f,children:n("panel.details.header")}),e.jsxs(Ne,{children:[e.jsx(Me,{}),t.size===1&&o.current.hasNode(a)&&e.jsx(Be,{}),t.size===1&&o.current.hasEdge(a)&&e.jsx(_e,{}),t.size===1&&e.jsxs(W,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(a)&&e.jsx(Ue,{}),window.graph.hasEdge(a)&&e.jsx(Fe,{})]})]}),e.jsx(Ce,{children:e.jsxs(_,{children:[t.size===1&&o.current.hasNode(a)&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>p(a),isDisabled:o.current.getNodeAttributes(a).type===Ee.Master&&l,children:n("panel.details.footer.duplicate")}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>x(t),children:n("panel.details.footer.copy")}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>S(t),children:n("panel.details.footer.remove")})]})})]})};export{Ze as default};
