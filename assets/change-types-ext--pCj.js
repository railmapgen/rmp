import{S as l,d as f,C as S,aK as g,q as v,L as O,F as x,t as B,p as z}from"./index-DUOwktfa.js";import{s as A}from"./misc-nodes-0jn6ok-G.js";const m=[l.ShmetroBasic2020,l.LondonTubeBasic,l.ShanghaiSuburbanRailway,l.OsakaMetro],C=(e,t)=>{const s=e.getNodeAttribute(t,"type"),r=e.getNodeAttribute(t,s);return!!(r&&"transfer"in r)},y=(e,t,s)=>{const r=e.getNodeAttribute(t,"type"),o=structuredClone(e.getNodeAttribute(t,r).names);for(let i=0;i<Math.abs(A[s].defaultAttrs.names.length-o.length);i++)A[s].defaultAttrs.names.length>o.length?o.push("Stn"):o.pop();const n={...A[s].defaultAttrs,names:o};(!Object.values(m).includes(r)||!Object.values(m).includes(s))&&(n.nameOffsetX=e.getNodeAttribute(t,r).nameOffsetX,n.nameOffsetY=e.getNodeAttribute(t,r).nameOffsetY),f.has(s)&&f.has(r)&&(n.color=structuredClone(e.getNodeAttribute(t,r).color)),e.removeNodeAttribute(t,r),e.mergeNodeAttributes(t,{type:s,[s]:n})},Y=(e,t,s,r)=>r.filter(o=>t==="any"||e.getNodeAttribute(o,"type")===t).forEach(o=>{y(e,o,s)}),j=(e,t,s,r)=>{const o=e.getEdgeAttribute(t,"type"),n=e.getEdgeAttribute(t,"style");if(g[n].metadata.supportLinePathType.includes(s)){const i=structuredClone(v[s].defaultAttrs);let c=-1;if(r&&s!==O.Simple){const[a,d]=e.extremities(t),b=i.startFrom;c=x(e,s,a,d,b)}e.setEdgeAttribute(t,"parallelIndex",c),e.removeEdgeAttribute(t,o),e.mergeEdgeAttributes(t,{type:s,[s]:i})}},$=(e,t,s,r,o)=>r.filter(n=>t==="any"||e.getEdgeAttribute(n,"type")===t).forEach(n=>{j(e,n,s,o)}),k=(e,t,s,r)=>{const o=e.getEdgeAttribute(t,"type"),n=e.getEdgeAttribute(t,"style");if(g[s].metadata.supportLinePathType.includes(o)){const i=e.getEdgeAttribute(t,"zIndex"),c=e.getEdgeAttribute(t,n);e.removeEdgeAttribute(t,n);const a=structuredClone(g[s].defaultAttrs);f.has(n)&&f.has(s)?a.color=c.color:f.has(s)&&r&&(a.color=r),e.mergeEdgeAttributes(t,{style:s,[s]:a}),s===B.River?e.setEdgeAttribute(t,"zIndex",-5):e.setEdgeAttribute(t,"zIndex",i!=null?i:0)}},q=(e,t,s,r,o)=>o.filter(n=>t==="any"||e.getEdgeAttribute(n,"style")===t).forEach(n=>{k(e,n,s,r)}),D=(e,t,s,r)=>r.filter(o=>f.has(e.getEdgeAttribute(o,"style"))).forEach(o=>{const n=e.getEdgeAttributes(o),i=n[n.style].color;(t==="any"||i[0]==t[0]&&i[1]==t[1]&&i[2]==t[2]&&i[3]==t[3])&&e.mergeEdgeAttributes(o,{[n.style]:{color:s}})}),P=(e,t,s,r,o)=>{[...r,...o].forEach(n=>{const i=e.getNodeAttributes(n).type,c=e.getNodeAttribute(n,i);if(c.color!==void 0)if(i!==z.Master){const a=c.color;(t==="any"||a[0]==t[0]&&a[1]==t[1]&&a[2]==t[2]&&a[3]==t[3])&&(c.color=s)}else{const a=c.color.value;(t==="any"||a===void 0||a[0]==t[0]&&a[1]==t[1]&&a[2]==t[2]&&a[3]==t[3])&&(c.color.value=s)}e.mergeNodeAttributes(n,{[i]:c})})},K=(e,t,s,r,o)=>{[...t,...s].forEach(n=>{e.setNodeAttribute(n,"zIndex",o)}),r.forEach(n=>{e.setEdgeAttribute(n,"zIndex",o)})},M=e=>e.map(t=>[t[0],t[1],t[2],t[3],"",""]),W=(e,t,s,r)=>{const o=e.getNodeAttribute(t,s);o&&(o.transfer=[r],e.mergeNodeAttributes(t,{[s]:o}))},N=(e,t,s)=>{const r=i=>{if(i.endsWith("-int")&&s==="basic")return i.replace(/-int$/,"-basic");if(i.endsWith("-basic")&&s==="int")return i.replace(/-basic$/,"-int")},o=e.getNodeAttribute(t,"type"),n=r(o);if(n&&Object.values(l).includes(n))return n},I=(e,t)=>{const s=e.directedEdges(t),r=new Set,o=[],n=i=>i[0]!==S.Other?i[0].toString()+"/"+i[1].toString():i[2].toString()+"/"+i[3].toString();for(const i of s){const c=e.getEdgeAttributes(i).style;if(!f.has(c))continue;const a=e.getEdgeAttributes(i)[c].color;r.has(n(a))||(r.add(n(a)),o.push(a))}return{lineColorStr:r,lineColor:o}},h=(e,t)=>{const{lineColorStr:s,lineColor:r}=I(e,t);if(s.size>1){const o=N(e,t,"int");if(o)return y(e,t,o),!0}else if(s.size===1){const o=N(e,t,"basic");if(o)return y(e,t,o),P(e,"any",r[0],[t],[]),!0}return!1},J=(e,t)=>{var b,E;if(!C(e,t))return!1;const{lineColorStr:s,lineColor:r}=I(e,t),o=e.getNodeAttribute(t,"type"),n=u=>u[0]!==S.Other?u[0].toString()+"/"+u[1].toString():u[2].toString()+"/"+u[3].toString(),i=(E=(b=e.getNodeAttribute(t,o).transfer)==null?void 0:b.at(0))!=null?E:[],c=i.filter(u=>s.has(n(u))),a=M(r.filter(u=>!i.find(T=>n(u)===n(T)))),d=[...c,...a];return JSON.stringify(i)!==JSON.stringify(d)?(W(e,t,o,d),!0):!1},U=(e,t)=>{h(e,t),J(e,t)};export{h as a,J as b,P as c,Y as d,U as e,j as f,k as g,y as h,q as i,$ as j,D as k,K as l};
