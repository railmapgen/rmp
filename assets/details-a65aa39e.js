import{j as e,A as q,M as J,m as Z,n as K,p as Q,r as U,s as E,_ as z,$ as I,ad as te}from"./chakra-c00f698a.js";import{b as c}from"./react-2c0b8364.js";import{c as R,i as L,v as T,y as S,j as P,ag as F,ah as B,x as v,q as X,J as W,p as ne,L as se,A as k,af as H,n as ae,ai as re,aj as ie,ak as oe,al as le,o as $}from"./index-8e2f728d.js";import{s as Y,R as D}from"./stations-0f81c795.js";import{m as ce}from"./misc-nodes-997c7329.js";import{b as de,d as ue,e as pe}from"./change-types-ae99551c.js";import{u as G}from"./useEvent-92f02ca1.js";function he(){const{t:r}=R(),n=L(),t=c.useCallback(()=>{n(T()),n(S(i.current.export()))},[n,T,S]),{selected:u}=P(a=>a.runtime),s=u.at(0),i=c.useRef(window.graph),[p,f]=c.useState(!1),g=c.useRef(null),[x,h]=c.useState(void 0),b=i.current.getNodeAttribute(s,"type"),m=Object.fromEntries(Object.entries(Y).map(([a,y])=>[a,r(y.metadata.displayName).toString()])),d=()=>{x&&(de(i.current,s,x),t())},o=a=>{a&&d(),h(void 0),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:r("panel.details.info.stationType"),minW:"276",children:e.jsx(B,{options:m,disabledOptions:[b],value:b,onChange:({target:{value:a}})=>{h(a),f(!0)}})}),e.jsx(q,{isOpen:p,leastDestructiveRef:g,onClose:()=>o(!1),children:e.jsx(J,{children:e.jsxs(Z,{children:[e.jsx(K,{children:r("warning")}),e.jsx(Q,{children:r("panel.details.changeStationTypeContent")}),e.jsxs(U,{children:[e.jsx(E,{ref:g,onClick:()=>o(!1),children:r("cancel")}),e.jsx(E,{ml:"2",colorScheme:"red",onClick:()=>o(!0),children:r("panel.details.changeType")})]})]})})})]})}function ge(){const{t:r}=R(),n=L(),t=c.useCallback(()=>{n(v()),n(S(p.current.export()))},[n,v,S]),{selected:u,theme:s}=P(j=>j.runtime),i=u.at(0),p=c.useRef(window.graph),[f,g]=c.useState(!1),x=c.useRef(null),h=Object.fromEntries(Object.entries(X).map(([j,_])=>[j,r(_.metadata.displayName).toString()])),[b,m]=c.useState(p.current.getEdgeAttribute(i,"type")),[d,o]=c.useState(void 0),a=Object.fromEntries(Object.entries(W).map(([j,_])=>[j,r(_.metadata.displayName).toString()])),[y,l]=c.useState(p.current.getEdgeAttribute(i,"style")),[N,O]=c.useState(void 0),C=Object.values(ne).filter(j=>!W[y].metadata.supportLinePathType.includes(j)),A=Object.values(se).filter(j=>!W[j].metadata.supportLinePathType.includes(b)),w=()=>{d&&(ue(p.current,i,d),m(p.current.getEdgeAttribute(i,"type")),t())},ee=()=>{N&&(pe(p.current,i,N,s),l(p.current.getEdgeAttribute(i,"style")),t())},M=j=>{j&&(d?(w(),o(void 0)):N&&(ee(),O(void 0))),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:r("panel.details.info.linePathType"),minW:"276",children:e.jsx(B,{options:h,disabledOptions:C,defaultValue:b,value:b,onChange:({target:{value:j}})=>{o(j),g(!0)}})}),e.jsx(F,{label:r("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(B,{options:a,disabledOptions:A,defaultValue:y,value:y,onChange:({target:{value:j}})=>{O(j),g(!0)}})}),e.jsx(q,{isOpen:f,leastDestructiveRef:x,onClose:()=>M(!1),children:e.jsx(J,{children:e.jsxs(Z,{children:[e.jsx(K,{children:r("warning")}),e.jsx(Q,{children:r("panel.details.changeLineTypeContent")}),e.jsxs(U,{children:[e.jsx(E,{ref:x,onClick:()=>M(!1),children:r("cancel")}),e.jsx(E,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:r("panel.details.changeType")})]})]})})})]})}function me(){const{t:r}=R(),n=L(),t=c.useCallback(()=>{n(T()),n(v()),n(S(i.current.export()))},[n,v,S]),{selected:u}=P(g=>g.runtime),s=u.at(0),i=c.useRef(window.graph),p=g=>{const x=Math.min(Math.max(g,-5),5);i.current.hasNode(s)&&i.current.setNodeAttribute(s,"zIndex",x),i.current.hasEdge(s)&&i.current.setEdgeAttribute(s,"zIndex",x),t()},f=[{type:"input",label:r("panel.details.info.id"),value:u.length>0?u.join(", "):"undefined",minW:276},{type:"select",label:r("panel.details.info.zIndex"),value:s?i.current.hasNode(s)?i.current.getNodeAttribute(s,"zIndex"):i.current.hasEdge(s)?i.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(g,x)=>[x-5,(x-5).toString()])),onChange:g=>p(Number(g))}];return u.length===0||u.length>1&&f.push({type:"input",label:r("panel.details.info.type"),value:"multiple selection",minW:276}),e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:r("panel.details.info.title")}),e.jsx(D,{fields:f,minW:130}),u.length===1&&s.startsWith("stn")&&i.current.hasNode(s)&&e.jsx(he,{}),u.length===1&&s.startsWith("line")&&i.current.hasEdge(s)&&e.jsx(ge,{})]})}function ye(){const{t:r}=R(),n=L(),t=c.useCallback(()=>{n(T()),n(v()),n(S(p.current.export()))},[n,T,v,S]),{selected:u,refresh:{nodes:s}}=P(h=>h.runtime),i=u.at(0),p=c.useRef(window.graph),[f,g]=c.useState({x:0,y:0});c.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const h=p.current.getNodeAttribute(i,"x"),b=p.current.getNodeAttribute(i,"y");g({x:h,y:b})}},[s,u]);const x=[{type:"input",label:r("panel.details.nodePosition.pos.x"),value:f.x.toString(),validator:h=>!Number.isNaN(h),onChange:h=>{p.current.mergeNodeAttributes(i,{x:Number(h)}),t()}},{type:"input",label:r("panel.details.nodePosition.pos.y"),value:f.y.toString(),validator:h=>!Number.isNaN(h),onChange:h=>{p.current.mergeNodeAttributes(i,{y:Number(h)}),t()}}];return e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:r("panel.details.nodePosition.title")}),e.jsx(D,{fields:x,minW:130})]})}function xe(){const{t:r}=R(),n=L(),{selected:t}=P(y=>y.runtime),u=t.at(0),s=c.useRef(window.graph),[i,p]=c.useState("undefined"),[f,g]=c.useState("undefined"),[x,h]=c.useState("undefined"),[b,m]=c.useState("undefined");c.useEffect(()=>{var y,l,N,O;if(u!=null&&u.startsWith("line")){const[C,A]=s.current.extremities(u);if(p(C),g(A),C.startsWith("stn")){const w=s.current.getNodeAttribute(C,"type");h((l=(y=s.current.getNodeAttribute(C,w))==null?void 0:y.names.at(0))!=null?l:"undefined")}if(A.startsWith("stn")){const w=s.current.getNodeAttribute(A,"type");m((O=(N=s.current.getNodeAttribute(A,w))==null?void 0:N.names.at(0))!=null?O:"undefined")}}},[t]);const d=G(()=>{n(k()),n(H(i))}),o=G(()=>{n(k()),n(H(f))}),a=[{type:"custom",label:r("panel.details.lineExtremities.source"),component:e.jsx(E,{flex:1,size:"sm",variant:"link",onClick:d,children:i})},{type:"custom",label:r("panel.details.lineExtremities.target"),component:e.jsx(E,{flex:1,size:"sm",variant:"link",onClick:o,children:f})},{type:"input",label:r("panel.details.lineExtremities.sourceName"),value:x},{type:"input",label:r("panel.details.lineExtremities.targetName"),value:b}];return e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:r("panel.details.lineExtremities.title")}),e.jsx(D,{fields:a,minW:130})]})}const V={...Y,...ce},Te=()=>{const{t:r}=R(),n=L(),t=c.useRef(window.graph),u=c.useCallback(()=>{n(T()),n(v()),n(S(t.current.export()))},[n,T,v,S]),{selected:s,mode:i}=P(d=>d.runtime),p=()=>n(k()),f=d=>{const o=structuredClone(t.current.getNodeAttributes(d));o.x+=50,o.y+=50;const a=d.startsWith("stn")?`stn_${$(10)}`:`misc_node_${$(10)}`;t.current.addNode(a,o),n(T()),n(S(t.current.export()))},g=d=>{n(k()),d.forEach(o=>{t.current.hasNode(o)?(t.current.dropNode(o),u()):t.current.hasEdge(o)&&(t.current.dropEdge(o),n(v()),n(S(t.current.export())))})},[x,h]=c.useState("");c.useEffect(()=>{var o;const d=s.at(0);t.current.hasEdge(d)&&h((o=t.current.getEdgeAttribute(d,"reconcileId"))!=null?o:"undefined")},[s]);const b=[],m=s.at(0);if(s.length===1&&t.current.hasNode(m)){const d=t.current.getNodeAttribute(m,"type"),o=t.current.getNodeAttribute(m,d);b.push(...V[d].fields.filter(a=>a.type!=="custom").map(a=>{var y,l,N;return{type:a.type,label:r(a.label),value:(y=a.value)==null?void 0:y.call(a,o),isChecked:(l=a.isChecked)==null?void 0:l.call(a,o),hidden:(N=a.hidden)==null?void 0:N.call(a,o),options:a.options,disabledOptions:a.disabledOptions&&a.disabledOptions(o),validator:a.validator,oneLine:a.oneLine,onChange:O=>{let C;try{C=a.onChange(O,o)}catch(A){n(ae({status:"error",message:r(`err-code.${A}`)}));return}t.current.mergeNodeAttributes(m,{[d]:C}),n(T()),n(S(t.current.export()))}}}),...V[d].fields.filter(a=>a.type==="custom"))}if(s.length===1&&t.current.hasEdge(m)){const d=t.current.getEdgeAttribute(m,"type"),o=t.current.getEdgeAttribute(m,d);b.push(...X[d].fields.map(l=>({type:l.type,label:r(l.label),value:l.value(o),options:l.options,disabledOptions:l.disabledOptions&&l.disabledOptions(o),validator:l.validator,onChange:N=>{t.current.mergeEdgeAttributes(m,{[d]:l.onChange(N,o)}),n(v()),n(S(t.current.export()))}})));const a=t.current.getEdgeAttribute(m,"style"),y=t.current.getEdgeAttribute(m,a);b.push(...W[a].fields.filter(l=>l.type!=="custom").map(l=>({type:l.type,label:r(l.label),value:l.value(y),options:l.options,disabledOptions:l.disabledOptions&&l.disabledOptions(y),validator:l.validator,onChange:N=>{t.current.mergeEdgeAttributes(m,{[a]:l.onChange(N,y)}),n(v()),n(S(t.current.export()))}}))),b.push(...W[a].fields.filter(l=>l.type==="custom"))}return e.jsxs(re,{isOpen:s.length>0&&!i.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ie,{onClose:p,children:r("panel.details.header")}),e.jsxs(oe,{children:[e.jsx(me,{}),s.length===1&&t.current.hasNode(m)&&e.jsx(ye,{}),s.length===1&&t.current.hasEdge(m)&&e.jsx(xe,{}),s.length===1&&e.jsxs(z,{p:1,children:[e.jsx(I,{as:"h5",size:"sm",children:r("panel.details.specificAttrsTitle")}),e.jsx(D,{fields:b,minW:276})]})]}),e.jsx(le,{children:e.jsxs(te,{children:[s.length===1&&t.current.hasNode(s.at(0))&&e.jsx(E,{size:"sm",variant:"outline",onClick:()=>f(s.at(0)),children:r("panel.details.footer.duplicate")}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>g(s),children:r("panel.details.footer.remove")})]})})]})};export{Te as default};
