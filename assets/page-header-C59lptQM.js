import{j as e,ag as F,M as Y,ah as J,J as Z,K,L as X,h as Rs,ai as gt,N as f,B as C,aj as ze,ak as Le,T as re,al as ie,b as oe,q as rs,t as O,O as me,am as mt,an as ft,ao as ye,R as T,ap as H,Q as Js,aq as Cs,ar as zs,a2 as se,as as vs,at as de,x as ce,au as is,U as us,V as xs,X as Es,Y as Ns,av as jt,aw as Zs,a8 as Ks,e as Xs,w as qs,m as Qs,E as et,ax as ve,a7 as Ce,a1 as bt,ay as wt,az as St,aA as W,aB as Is,aC as yt,aD as _,aE as v,aF as Ct,k as zt,W as ae}from"./chakra-CHkbW1Nc.js";import{u as vt,r as A,C as kt,M as ks,L as st,n as gs,S as L,R as Hs,a as tt,b as E,c as B,d as D,e as _t,f as Mt,g as At,h as Tt,i as Ie,j as _e,E as Ae,s as Ot,k as Ze,l as os,m as Rt,o as Ls,p as Et,q as _s,t as Ms,v as V,w as $,x as te,y as nt,z as rt,A as ms,B as Me,D as Be,F as Ps,G as Ds,H as Nt,I as It,J as Ht,K as Lt,N as Pt,O as Bs,P as Dt,Q as Bt,T as Gt,U as Wt,V as Ut,W as $t,X as Vt,Y as Ft,Z as Yt,_ as Jt,$ as Zt,a0 as Kt,a1 as Xt,a2 as qt,a3 as Qt,a4 as en,a5 as Fe,a6 as sn,a7 as tn,a8 as fe,a9 as nn,aa as rn,ab as on,ac as an,ad as ue,ae as ln,af as cn,ag as Gs,ah as dn,ai as as,aj as hn,ak as pn,al as un,am as xn,an as gn,ao as mn,ap as fn,aq as jn,ar as bn,as as wn}from"./index-DaU9j8Vt.js";import{u as P,b,a as Ye,T as Ws}from"./react-3Z_4zUxA.js";import{d as fs,m as Sn,a as yn,i as Cn,s as zn,M as vn}from"./master-manager-D2fxSZWT.js";import{C as kn}from"./change-type-modal-CW4C_RQP.js";var Us=function(s){return vt(A.ready(),s)},_n={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Mn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=P(),o=A.getAppVersion();return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:n("header.about.title")}),e.jsx(K,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(Rs,{direction:"row",children:[e.jsx(gt,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(Rs,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(f,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),e.jsx(f,{children:o}),e.jsx(f,{}),e.jsx(f,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(C,{margin:5,children:e.jsx(f,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(ze,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(ze,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),e.jsxs(Le,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(f,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(f,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(f,{fontSize:"sm",children:n("header.about.langonginc")}),e.jsx(f,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(ze,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),e.jsxs(Le,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(f,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(f,{fontSize:"sm",mb:1,children:n("header.about.Swiftiecott")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(f,{fontSize:"sm",mb:1,children:n("header.about.Minwtraft")})]})]})]}),e.jsx(ze,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(Le,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(f,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(f,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(f,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(ze,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs(Le,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",pb:1,children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(f,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(oe,{display:"block",width:"100%",pb:1,children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(f,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Ge(s){const l=s.sizes.shift(),a=Math.max(Math.ceil(l[0]),1),n=Math.max(Math.ceil(l[1]),1),o=[a-1,n-1,1,1],i=performance.now(),t=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let h,u;t?(h=new OffscreenCanvas(1,1),u=new OffscreenCanvas(a,n)):(h=document.createElement("canvas"),h.width=1,h.height=1,u=document.createElement("canvas"),u.width=a,u.height=n);const g=h.getContext("2d"),w=u.getContext("2d");w&&(w.fillRect.apply(w,o),g.drawImage(u,a-1,n-1,1,1,0,0,1,1));const x=g&&g.getImageData(0,0,1,1).data[3]!==0,r=parseInt(performance.now()-i);return[h,u].forEach(p=>{p.height=0,p.width=0}),t?(postMessage({width:a,height:n,testTime:r,isTestPass:x}),!x&&s.sizes.length&&setTimeout(()=>{Ge(s)},0)):x?s.onSuccess({width:a,height:n,testTime:r}):(s.onError({width:a,height:n,testTime:r}),s.sizes.length&&setTimeout(()=>{Ge(s)},0)),x}const ls={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},ke={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},He={};function cs(s){const l=s.width===s.height,a=s.height===1,n=s.width===1,o=[];if(!s.width||!s.height)s.sizes.forEach(i=>{const t=l||a?i:1,h=l||n?i:1;o.push([t,h])});else{const i=s.min||ke.min,t=s.step||ke.step;let h=Math.max(s.width,s.height);for(;h>=i;){const u=l||a?h:1,g=l||n?h:1;o.push([u,g]),h-=t}}return o}function Je(s){const l=typeof window<"u",a=l&&"Promise"in window,n=l&&"HTMLCanvasElement"in window,o=l&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),t=performance.now(),{onError:h,onSuccess:u,...g}=s,w=()=>parseInt(performance.now()-t);let x=null;if(!n)return!1;if(s.useWorker&&o){const r="\n            var canvasTest = ".concat(Ge.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),p=new Blob([r],{type:"application/javascript"}),c=URL.createObjectURL(p);x=new Worker(c),URL.revokeObjectURL(c),x.onmessage=function(d){const{width:m,height:j,testTime:S,isTestPass:y}=d.data,R={width:m,height:j,testTime:S,totalTime:w()};y?(He[i].onSuccess(R),delete He[i]):He[i].onError(R)}}if(a)return new Promise(r=>{const p={...s,onError(c){let{width:d,height:m,testTime:j}=c;const S={width:d,height:m,testTime:j,totalTime:w()};let y;if(s.sizes.length===0)y=!0;else{const[[R,I]]=s.sizes.slice(-1);y=d===R&&m===I}h(S),y&&r({...S,success:!1})},onSuccess(c){let{width:d,height:m,testTime:j}=c;const S={width:d,height:m,testTime:j,totalTime:w()};u(S),r({...S,success:!0})}};if(x){const{onError:c,onSuccess:d}=p;He[i]={onError:c,onSuccess:d},x.postMessage(g)}else Ge(p)});if(x)He[i]={onError:h,onSuccess:u},x.postMessage(g);else return Ge(s)}const An={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=cs({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...ls.area]}),a={...ke,...s,sizes:l};return Je(a)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=cs({width:1,height:s.max,min:s.min,step:s.step,sizes:[...ls.height]}),a={...ke,...s,sizes:l};return Je(a)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=cs({width:s.max,height:1,min:s.min,step:s.step,sizes:[...ls.width]}),a={...ke,...s,sizes:l};return Je(a)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l={...ke,...s};return l.sizes=[...l.sizes],l.width&&l.height&&(l.sizes=[[l.width,l.height]]),Je(l)}};var We=(s=>(s.left="l",s.right="r",s))(We||{}),be=(s=>(s.through="through",s.nonThrough="nonthrough",s))(be||{}),Ke=(s=>(s.local="local",s.express="express",s.direct="direct",s))(Ke||{}),xe=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(xe||{}),As=(s=>(s.sh="sh",s.sh2020="sh2020",s))(As||{});const he=new Set,js=new Set,bs=new Set,ws=new Set,it=new Map,ge=new Map,ds=new Set,hs=new Map,U=new Map;let N=[],Pe=0;const De=new Map,ps=new Map,Ss=new Set,Tn={localisedName:{en:"LEFT END"},num:"00",services:[Ke.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:We.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},On={localisedName:{en:"RIGHT END"},num:"00",services:[Ke.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:We.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Rn={},ot={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:xe.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:We.right,platform_num:"1",theme:[kt.Shanghai,"sh1","#E3002B",ks.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Rn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:As.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},En={localisedName:{},num:"",services:[Ke.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:We.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},k=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),Ts=s=>st.has(s),Nn=s=>{if(Ts(s.style))return structuredClone(s[s.style].color)},In=(s,l)=>{const[a,n]=s.extremities(l),o=s.getEdgeAttributes(l),i=o.style;if(a!=n&&Ts(i)){const t=Nn(o);ws.has(k(t))||(bs.add(t),ws.add(k(t)),it.set(t,a),ge.set(k(t),new Set)),ge.get(k(t)).add(a),ge.get(k(t)).add(n),U.has(a)?N.push({target:n,next:U.get(a),color:t}):N.push({target:n,next:-1,color:t}),U.set(a,Pe),Pe++,U.has(n)?N.push({target:a,next:U.get(n),color:t}):N.push({target:a,next:-1,color:t}),U.set(n,Pe),Pe++}},at=(s,l,a)=>{if(ge.get(k(a)).has(s)){ge.get(k(a)).delete(s);for(let n=U.get(s);n!=-1;n=N[n].next){const o=N[n].target,i=N[n].color;k(i)==k(a)&&at(o,s,a)}}},lt=(s,l,a)=>{if(he.has(s))return;he.add(s);let n=0;const o=new Set;for(let i=U.get(s);i!=-1;i=N[i].next){const t=N[i].target,h=N[i].color;k(h)==k(a)&&(o.has(t)||(o.add(t),n++,t!=l&&lt(t,s,a)))}De.set(s,n)},$s=(s,l)=>{const a=s.stn_list.lineend.parents;a.push(l),s.stn_list.lineend.parents=structuredClone(a).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[be.through,a[1]]:void 0}},Hn=(s,l)=>{let a=0;for(let n=U.get(s);n!=-1;n=N[n].next){N[n].target;const o=N[n].color;k(o)==k(l)&&a++}return a},ct=(s,l,a)=>{if(Ss.has(s))return[];Ss.add(s);const n=[];for(let o=U.get(s);o!=-1;o=N[o].next){const i=N[o].target,t=N[o].color;i!=l&&k(t)==k(a)&&(i.startsWith("stn")?n.push(i):n.push(...ct(i,s,a)))}return n},ys=(s,l,a,n,o,i,t)=>{var r;if(he.has(s)&&(!s.startsWith("misc_node_")&&t.stn_list[s]==null||s.startsWith("misc_node_")&&!js.has(s)||t.loop))return[];if(he.has(s)&&t.stn_list[s]!=null&&Hn(s,i)-1>=2){const p=[...t.stn_list[s].parents,l];if(t.stn_list[p[1]]==null){const m=p[0];p[0]=p[1],p[1]=m}t.stn_list[s].parents=structuredClone(p).reverse(),t.stn_list[s].branch={...t.stn_list[s].branch,left:[be.through,p[1]]};const c=[];for(const m of t.stn_list[s].children)m!=l&&c.push(m);t.stn_list[s].children=structuredClone(c),(r=t.stn_list[s].branch)==null||delete r.right;const d=[];for(const m of t.stn_list.lineend.parents)m!=s&&d.push(m);return t.stn_list.lineend.parents=structuredClone(d).reverse(),t.stn_list.lineend.branch={...t.stn_list.lineend.branch,left:t.stn_list.lineend.parents.length==2?[be.through,d[1]]:void 0},c.length==0&&(t.stn_list[s].children=["lineend"],$s(t,s)),[s]}he.add(s);const h=[],u=[],g=[],w=new Set,x=new Set;for(let p=U.get(s);p!=-1;p=N[p].next){const c=N[p].target,d=N[p].color;if(c!=a){if(k(d)==k(i)){if(x.has(c))continue;if(x.add(c),s.startsWith("misc_node_")){const m=ys(c,l,s,n+1,o,i,t);m.length!=0&&h.push(...m)}else{const m=ys(c,s,s,n+1,o,i,t);m.length!=0&&h.push(...m)}}if(!w.has(k(d))&&k(d)!=k(i)){w.add(k(d));const m={theme:d,name:["ch_".concat(k(d)),"en_".concat(k(d))]};g.push(m)}}}if(h.length==2){for(let p=0;p<2;p++)h[p]=="lineend"&&h.splice(p,1);if(t.stn_list[h[1]].parents.length>=2){const p=h[0];h[0]=h[1],h[1]=p}}if(he.has(s)&&t.stn_list[s]!=null){const p=[];for(const c of t.stn_list.lineend.parents)c!=s&&p.push(c);t.stn_list.lineend.parents=structuredClone(p).reverse(),t.stn_list.lineend.branch={...t.stn_list.lineend.branch,left:t.stn_list.lineend.parents.length==2?[be.through,p[1]]:void 0},h.length==0&&(Ss.clear(),u.push(...ct(s,l,i)))}if(s.startsWith("misc_node_"))return js.add(s),h;{const p=o.getNodeAttributes(s).type,c=o.getNodeAttributes(s)[p];if(t.stn_list[s]=structuredClone(En),t.stn_list[s].localisedName={zh:c.names[0],en:c.names[1]},t.stn_list[s].num=String(n),o.getNodeAttributes(s).type==L.GzmtrBasic){const d=c;t.stn_list[s].num=d.stationCode,(d.secondaryNames[0]!==""||d.secondaryNames[1]!=="")&&(t.stn_list[s].localisedSecondaryName={zh:d.secondaryNames[0],en:d.secondaryNames[1]})}if(o.getNodeAttributes(s).type==L.GzmtrInt){const d=c,m=d.transfer[0];for(const j of m)if(k(j)==k(i)){t.stn_list[s].num=String(j[5]);break}(d.secondaryNames[0]!==""||d.secondaryNames[1]!=="")&&(t.stn_list[s].localisedSecondaryName={zh:d.secondaryNames[0],en:d.secondaryNames[1]})}return h.length!=0?(t.stn_list[s].children=structuredClone(h).reverse(),h.length==2&&(t.stn_list[s].branch={...t.stn_list[s].branch,right:[be.through,h[1]]})):(t.stn_list[s].children=["lineend"],$s(t,s)),u.push(l),t.stn_list[s].parents=structuredClone(u).reverse(),u.length==2&&(t.stn_list[s].branch={...t.stn_list[s].branch,left:[be.through,u[1]]}),g.length!=0&&(t.stn_list[s].transfer.groups[0].lines=structuredClone(g)),[s]}},Ln=(s,l,a,n)=>{const o=structuredClone(ot);n=="LOOP"&&(o.loop=!0);let i;switch(s.getNodeAttributes(a).type){case L.GzmtrBasic:case L.GzmtrInt:i=xe.GZMTR;break;case L.MTR:i=xe.MTR;break;default:i=xe.SHMetro;break}o.theme=structuredClone(l),o.style=i,o.stn_list.linestart=structuredClone(Tn),o.stn_list.lineend=structuredClone(On),he.clear(),js.clear();const t=ys(a,"linestart","linestart",1,s,l,o);if(o.current_stn_idx=t[0],o.stn_list.linestart.children=[t[0]],!(Object.keys(o.stn_list).length<=3||o.stn_list.lineend.parents.length>=3))return structuredClone(o)},Pn=s=>{var n,o;he.clear(),bs.clear(),ws.clear(),it.clear(),ge.clear(),ds.clear(),hs.clear(),U.clear(),N=[],Pe=0,De.clear(),ps.clear(),s.filterEdges(i=>i.startsWith("line")).forEach(i=>{Ts(s.getEdgeAttributes(i).style)&&In(s,i)});let l=0;s.forEachNode(i=>{ps.set(i,++l)}),ps.set("lineend",++l);const a=[];for(const i of bs){let t=0;for(;ge.get(k(i)).size!=0;){let h="line_root";ge.get(k(i)).forEach(g=>{h=="line_root"&&(h=g)}),at(h,"line_root",i);const u={theme:i,index:++t};ds.add(u),hs.set(u,h)}}for(const i of ds){const{theme:t}=i;he.clear(),De.clear(),lt(hs.get(i),"line_root",t);let h=!0,u="LINE";const g=[];for(const[x,r]of De)r==1&&g.push(x),r==3&&(u="BRANCH"),r>3&&(h=!1);if(!h)continue;g.length==0&&(u="LOOP",De.forEach((x,r)=>{g.push(r)}));const w=[];for(const x of g){const r=Ln(s,t,x,u);r!=null&&w.push([r,(n=r.stn_list[r.current_stn_idx].localisedName.zh)!=null?n:"",(o=r.stn_list[r.current_stn_idx].localisedName.en)!=null?o:""])}w.length!=0&&a.push({id:gs(10),theme:t,param:structuredClone(w),type:u})}return a},Dn=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),Bn=(s,l)=>{let a=s;return l.forEach((n,o)=>{const i=new RegExp("ch_".concat(o),"g"),t=new RegExp("en_".concat(o),"g");a=a.replace(i,n[0]),a=a.replace(t,n[1])}),a},Gn=(s,l,a,n)=>{s.line_name=l,s.line_num=String(a),fs("RMG_".concat(Dn(l),".json"),"application/json",Bn(JSON.stringify(s),n))},Wn={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Un=s=>{const{isOpen:l,onClose:a}=s,{t:n}=P(),o=b.useRef(window.graph),[i,t]=b.useState(!1),[h,u]=b.useState([[ot,"",""]]),[g,w]=b.useState(["","",""]),[x,r]=b.useState(new Map),[p,c]=b.useState(new Map),[d,m]=b.useState([]);b.useEffect(()=>{if(l){const S=Pn(o.current),y=new Map;S.forEach(({id:R,theme:I})=>{y.set(k(I),R)}),m(S),r(y)}},[l]);const j=(S,y)=>document.getElementById("2RMG_"+y+"_"+S).value.trim();return e.jsxs(F,{isOpen:l,onClose:a,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:e.jsx(f,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")})}),e.jsx(K,{}),e.jsxs(X,{children:[e.jsx(f,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info1")}),e.jsx(f,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info2")}),e.jsx("br",{}),d.length===0?e.jsx(f,{fontSize:"md",children:n("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:d.map(({id:S,theme:y,param:R,type:I})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Hs,{name:y[0]=="other"&&y[1]=="other"?y[2]:y[1],bg:y[2],fg:y[3]})}),e.jsx("td",{children:e.jsx(rs,{placeholder:n("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(rs,{placeholder:n("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(rs,{placeholder:n("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(Hs,{name:n("header.download.2rmg.type.".concat(I.toLowerCase())),bg:Wn[I],fg:ks.white})}),e.jsx("td",{children:e.jsx(O,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const G=j(S,"nameCh"),ne=j(S,"nameEn"),pe=j(S,"lineNum"),q=new Map;x.forEach((Q,ee)=>{q.set(ee,[j(Q,"nameCh"),j(Q,"nameEn")])}),u(R),w([G,ne,pe]),c(q),t(!0)},size:"sm",children:e.jsx(tt,{})})})]},S))})})]}),e.jsx(me,{children:e.jsx(O,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:n("close")})})]}),e.jsx($n,{isOpen:i,onClose:()=>t(!1),param:h,nameList:g,interchangeName:p})]})},$n=s=>{const{isOpen:l,onClose:a,param:n,nameList:o,interchangeName:i}=s,{t}=P(),[h,u]=b.useState("");return b.useEffect(()=>{o[0]!=""&&o[1]!=""?u(o[0]+"/"+o[1]):o[0]!=""?u(o[0]):o[1]!=""?u(o[1]):u("")},[...o]),e.jsxs(F,{isOpen:l,onClose:a,size:"md",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:e.jsxs(f,{as:"b",fontSize:"xl",children:[t("header.download.2rmg.download")," ",h]})}),e.jsx(K,{}),e.jsx(X,{children:e.jsxs(mt,{children:[e.jsx(f,{fontSize:"sm",mb:"2",lineHeight:"100%",children:t("header.download.2rmg.downloadInfo")}),n.map(([g,w,x])=>e.jsxs(O,{onClick:()=>{Gn(g,[o[0],o[1]],o[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[w.replaceAll("\n","⏎"),"/",x.replaceAll("\n","⏎")]},"".concat(w).concat(x)))]})}),e.jsx(me,{children:e.jsx(O,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:t("close")})})]})]})},Vn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=P();return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:n("header.download.termsAndConditions")}),e.jsx(K,{}),e.jsx(X,{children:e.jsxs(ft,{children:[e.jsxs(ye,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(T,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(H,{as:E})]}),", ",e.jsxs(T,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(H,{as:E})]})," or ",e.jsxs(T,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(H,{as:E})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(T,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(H,{as:E})]}),"，",e.jsxs(T,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(H,{as:E})]}),"或",e.jsxs(T,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(H,{as:E})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:E})]})," and ",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:E})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:E})]}),"及",e.jsxs(T,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:E})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(ye,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(T,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(H,{as:E})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(T,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(H,{as:E})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(ye,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(T,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:E})]})," ","– the open-source emoji and icon project. License:",e.jsxs(T,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:E})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(T,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:E})]}),"所设计。许可证：",e.jsxs(T,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:E})]})]}),e.jsxs(ye,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Fn(){const s=Js("white","var(--chakra-colors-gray-800)"),l=B(),{activeSubscriptions:{RMP_EXPORT:a}}=D(z=>z.account),{telemetry:{project:n}}=D(z=>z.app),o=D(z=>z.param),i=A.isAllowAnalytics(),{t}=P(),h=b.useRef(window.graph),[u,g]=b.useState("png"),w={png:t("header.download.png"),svg:t("header.download.svg")},[x,r]=b.useState(2),[p,c]=b.useState({width:1,height:1,benchmark:.001}),[d,m]=b.useState(200),j=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],S=Object.fromEntries(j.map(z=>[z,"".concat(z,"%")])),[y,R]=b.useState([]),[I,G]=b.useState(!1),ne=[{type:"select",label:t("header.download.format"),value:u,options:w,onChange:z=>g(z==="png"?"png":"svg")}],pe=[{type:"select",label:t("header.download.svgVersion"),value:x,options:{1.1:t("header.download.svg1.1"),2:t("header.download.svg2")},onChange:z=>{r(z),z===1.1&&$e(!0)}}],q=[{type:"select",label:t("header.download.scale"),value:d,options:S,onChange:z=>m(z)},{type:"switch",label:t("header.download.transparent"),isChecked:I,onChange:G}],[Q,ee]=b.useState(!1),[Xe,Ue]=b.useState(!1),[Te,$e]=b.useState(!1),[Oe,qe]=b.useState(!1),[M,dt]=b.useState(!1),[ht,Ve]=b.useState(!1),[pt,Os]=b.useState(!1);b.useEffect(()=>{(async()=>{const Re=await An.maxArea({usePromise:!0,useWorker:!0});c(Re)})()},[]),b.useEffect(()=>{if(Q){const{xMin:z,yMin:Re,xMax:Qe,yMax:Ee}=_t(h.current),[es,we]=[Qe-z,Ee-Re],Ne=j.filter(Se=>es*Se/100>p.width&&we*Se/100>p.height);R(Ne)}},[Q]);const ut=()=>{i&&A.event(Ae.DOWNLOAD_PARAM,n?{"#nodes":h.current.order,"#edges":h.current.size}:{}),fs("RMP_".concat(new Date().valueOf(),".json"),"application/json",Ot(o))},xt=async()=>{Ve(!0),i&&A.event(Ae.DOWNLOAD_IMAGES,n?{numberOfNodes:h.current.order,numberOfEdges:h.current.size}:{});const{elem:z,width:Re,height:Qe}=await Sn(h.current,Oe,Te,x),Ee=z.outerHTML.replace(/&nbsp;/g," ");if(u==="svg"){fs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Ee),Ve(!1);return}if(Ie){window.parent.__TAURI__.core.invoke("render_image",{svgString:Ee,scale:d,isTransparent:I,isSystemFontsOnly:Te}).then(ns=>Ve(!1));return}document.body.appendChild(z);const es="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Ee)));document.body.removeChild(z),z.remove();const we=document.createElement("canvas"),[Ne,Se]=[Re*d/100,Qe*d/100];we.width=Ne,we.height=Se;const ss=we.getContext("2d");I||(ss.fillStyle=s,ss.fillRect(0,0,Ne,Se));const ts=new Image;ts.onload=()=>{setTimeout(()=>{ss.drawImage(ts,0,0,Ne,Se),we.toBlob(ns=>{if(Ve(!1),!ns){l(Ze({status:"error",message:t("header.download.imageTooBig")}));return}yn("RMP_".concat(new Date().valueOf(),".png"),ns)},"image/png")},Cn()?2e3:0)},ts.src=es};return e.jsxs(Cs,{id:"download",children:[e.jsx(zs,{as:se,size:"sm",variant:"ghost",icon:e.jsx(tt,{})}),e.jsxs(vs,{children:[e.jsx(de,{icon:e.jsx(Mt,{}),onClick:ut,children:t("header.download.config")}),e.jsxs(de,{icon:e.jsx(At,{}),onClick:()=>Os(!0),children:[t("header.download.2rmg.title"),e.jsx(ce,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(de,{icon:e.jsx(Tt,{}),onClick:()=>ee(!0),children:t("header.download.image")})]}),e.jsxs(F,{size:"xl",isOpen:Q,onClose:()=>ee(!1),children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:t("header.download.image")}),e.jsx(K,{}),e.jsxs(X,{children:[e.jsx(_e,{fields:ne}),u==="svg"&&e.jsx(_e,{fields:pe}),u==="png"&&e.jsx(_e,{fields:q}),e.jsx("br",{}),e.jsx(is,{isChecked:Te,isDisabled:u==="svg"&&x===1.1,onChange:z=>$e(z.target.checked),children:e.jsx(f,{children:t("header.download.isSystemFontsOnly")})}),e.jsx(is,{isChecked:Oe,onChange:z=>qe(z.target.checked),children:e.jsxs(f,{children:[t("header.download.shareInfo1"),e.jsxs(T,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(H,{as:E})]}),t("header.download.shareInfo2")]})}),e.jsx(is,{isChecked:M,onChange:z=>dt(z.target.checked),children:e.jsxs(f,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(T,{color:"teal.500",onClick:()=>Ue(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(H,{as:E})]}),t("header.download.period")]})}),y.includes(d)&&!Ie&&e.jsxs(us,{status:"error",mt:"4",children:[e.jsx(xs,{}),e.jsxs(C,{children:[e.jsx(Es,{children:t("header.download.disabledScaleOptions")}),e.jsx(Ns,{children:t("header.download.disabledScaleOptionsSolution")})]})]}),y.includes(d)&&Ie&&!a&&e.jsxs(us,{status:"error",mt:"4",children:[e.jsx(xs,{}),e.jsxs(C,{children:[e.jsx(Es,{children:t("header.download.disabledScaleOptions")}),e.jsx(Ns,{children:t("header.settings.pro")})]})]})]}),e.jsx(me,{children:e.jsx(jt,{children:e.jsx(O,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!M||u==="png"&&y.includes(d)&&!Ie||u==="png"&&y.includes(d)&&Ie&&!a,isLoading:ht,onClick:xt,children:t("header.download.confirm")})})}),e.jsx(Vn,{isOpen:Xe,onClose:()=>Ue(!1)})]})]}),e.jsx(Un,{isOpen:pt,onClose:()=>Os(!1)})]})}const Yn=(s,{info_panel_type:l,line_num:a,stn_list:n,style:o,theme:i},t,h,u)=>{const g=Object.fromEntries(Object.keys(n).filter(r=>!["linestart","lineend"].includes(r)).map(r=>[r,"stn_".concat(gs(10))]));Object.entries(n).filter(([r,p])=>!["linestart","lineend"].includes(r)).forEach(([r,p])=>{const c=s.filterNodes((d,m)=>Object.values(L).includes(m.type)&&m[m.type].names[0]===p.localisedName.zh);c.length!==0&&(g[r]=c[0])});const w=[["linestart",-1,0]],x={};for(;w.length;){const[r,p,c]=w.shift();n[r].children.filter(m=>m!="lineend").forEach((m,j)=>{const S=Math.max(j,c+j);x[m]={x:p*150,y:S*75},w.push([m,p+1,S])})}Object.entries(n).filter(([r,p])=>!["linestart","lineend"].includes(r)).filter(([r,p])=>s.filterNodes((c,d)=>Object.values(L).includes(d.type)&&d[d.type].names[0]===p.localisedName.zh).length===0).map(([r,p])=>{var S,y,R;let c=L.ShmetroBasic;const d=p.transfer.groups,m=d.map(I=>{var G;return(G=I.lines)!=null?G:[]}).flat();o===xe.SHMetro?m.length>0?c=L.ShmetroInt:l===As.sh2020?c=L.ShmetroBasic2020:c=L.ShmetroBasic:o===xe.GZMTR?m.length>0?c=L.GzmtrInt:c=L.GzmtrBasic:o===xe.MTR&&(c=L.MTR);const j={...structuredClone(zn[c].defaultAttrs),names:[(S=p.localisedName.zh)!=null?S:"",(y=p.localisedName.en)!=null?y:""]};return c===L.ShmetroBasic2020?j.color=i:c===L.GzmtrBasic?(j.color=i,j.lineCode=a,j.stationCode=p.num):c===L.GzmtrInt?j.transfer=d.map((I,G)=>{var pe,q;const ne=(q=(pe=I.lines)==null?void 0:pe.map(Q=>{var ee;return[...(ee=Q.theme)!=null?ee:i,"1","01"]}))!=null?q:[];return G===0?[[...i,a,p.num],...ne]:ne}):c===L.MTR&&((R=d[0].lines)!=null&&R.length?j.transfer=[[[...i,"",""],...d[0].lines.map(I=>{var G;return[...(G=I.theme)!=null?G:i,"",""]})]]:j.transfer=[[]]),{node:g[r],attr:{visible:!0,zIndex:0,x:t+x[r].x,y:h+x[r].y,type:c,[c]:j}}}).forEach(({node:r,attr:p})=>s.addNode(r,p)),Object.entries(n).filter(([r,p])=>!["linestart","lineend"].includes(r)).forEach(([r,p])=>{p.children.filter(c=>!["linestart","lineend"].includes(c)).forEach(c=>{const d=os.Diagonal,[m,j]=[g[r],g[c]],S=u?Rt(s,d,m,j,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(gs(10)),m,j,{visible:!0,zIndex:0,type:d,[os.Diagonal]:structuredClone(Et[os.Diagonal].defaultAttrs),style:Ls.SingleColor,[Ls.SingleColor]:{color:i},reconcileId:"",parallelIndex:S})})})},Jn="rmg-bridge--",Zn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Kn(s){const{isOpen:l,onClose:a}=s,{t:n}=P(),{preference:{autoParallel:o}}=D(j=>j.app),{svgViewBoxZoom:i,svgViewBoxMin:t}=D(j=>j.param),h=B(),u=A.isAllowAnalytics(),g=_s(),{height:w,width:x}=Ms(g),r=Ye.useRef(window.graph),[p]=Ye.useState(crypto.randomUUID()),c="/rmg/#/import?"+new URLSearchParams({parentComponent:A.getAppName(),parentId:p}),d=Ye.useCallback(()=>{h(V()),h($()),h(te(r.current.export()))},[h,V,$,te,r]),m=j=>{try{u&&A.event(Ae.IMPORT_RMG_PARAM,{});const S=t.x+x*i/100/3,y=t.y+w*i/100/3;Yn(r.current,j,S,y,o),d()}catch(S){h(Ze({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",S)}finally{a()}};return Ye.useEffect(()=>{const j=new BroadcastChannel(Jn+p);return j.onmessage=S=>{const{event:y,data:R}=S.data;console.log("[rmp] Received event from RMG app clip:",y),y==="CLOSE"?a():y==="IMPORT"&&m(R)},()=>j.close()},[t.x,t.y,i,w,x,o]),e.jsx(nt,{isOpen:l,onClose:a,sx:Zn,children:e.jsx("iframe",{src:c,loading:"lazy"})})}const Xn="RMP_GALLERY_CHANNEL",qn="OPEN_TEMPLATE",Vs=new BroadcastChannel(Xn),Qn={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function er(s){const{isOpen:l,onClose:a}=s,n=Zs(),{t:o}=P(),i=B(),{telemetry:{project:t}}=D(r=>r.app),h=A.isAllowAnalytics(),u=b.useRef(window.graph),g=b.useCallback(()=>{i(V()),i($()),i(te(u.current.export()))},[i,V,$,te,u]),w=async r=>{const{version:p,...c}=JSON.parse(await rt(JSON.stringify(r)));i(ms()),u.current.clear(),u.current.import(c.graph),g();const{svgViewBoxZoom:d,svgViewBoxMin:m}=c;typeof d=="number"&&i(Me(d)),typeof m.x=="number"&&typeof m.y=="number"&&i(Be(m))},x=async(r,p)=>{var m;const c=p?"https://".concat(p):"",d=await((m=(await Promise.allSettled([fetch("".concat(c,"/rmp-gallery/resources/real_world/").concat(r,".json")),fetch("".concat(c,"/rmp-gallery/resources/fantasy/").concat(r,".json"))])).filter(j=>j.status==="fulfilled").find(j=>j.value.status===200))==null?void 0:m.value.json());if(d){if(h){const j={id:r};t&&p&&(j.host=p),A.event(Ae.IMPORT_WORK_FROM_GALLERY,j)}w(d),n({title:o("header.open.importFromRMPGallery",{id:r}),status:"success",duration:9e3,isClosable:!0})}else n({title:o("header.open.failToImportFromRMPGallery",{id:r}),status:"error",duration:9e3,isClosable:!0});A.updateAppMetadata({hash:""})};return b.useEffect(()=>{const p=new URL(window.location.href).searchParams;if(p.size>0){const c=p.keys().next().value,d=c.indexOf("."),m=c.substring(0,d===-1?void 0:d);let j;d!==-1&&(j=c.substring(d+1)),x(m,j)}},[]),b.useEffect(()=>(Vs.onmessage=r=>{const{event:p,data:c}=r.data;p===qn&&(x(c),a())},()=>Vs.close()),[]),e.jsxs(nt,{isOpen:l,onClose:a,size:"full",sx:Qn,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(Ks,{onClick:a,position:"fixed",top:"5px",right:"15px"})]})}function sr(){const s=B(),{t:l}=P(),a=_s(),{height:n}=Ms(a),o=b.useRef(window.graph),i=b.useRef(null),[t,h]=b.useState(!1),[u,g]=b.useState(!1),w=b.useCallback(()=>{s(V()),s($()),s(te(o.current.export()))},[s,V,$,te,o]),x=()=>{s(ms()),o.current.clear(),s(Me(100)),s(Be({x:0,y:0})),w()},r=async d=>{const{version:m,...j}=JSON.parse(await rt(d));s(ms()),o.current.clear(),o.current.import(j.graph),w();const{svgViewBoxZoom:S,svgViewBoxMin:y}=j;typeof S=="number"&&s(Me(S)),typeof y.x=="number"&&typeof y.y=="number"&&s(Be(y))},p=async d=>{var j;const m=(j=d.target.files)==null?void 0:j[0];if(console.log("OpenActions.handleUpload():: received file",m),(m==null?void 0:m.type)!=="application/json")s(Ze({status:"error",message:l("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const S=await tr(m);await r(S)}catch(S){s(Ze({status:"error",message:l("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",S)}d.target.value=""},c=async()=>{await r(await Lt()),s(Be({x:-10,y:-13}));const d=Math.max(0,Math.min(400,-.132*n+117.772));s(Me(d)),A.event(Ae.LOAD_TUTORIAL,{})};return b.useEffect(()=>{const d=async m=>{const{type:j,key:S,from:y}=m.data;if(j===Pt.SAVE_CHANGED&&S===Bs.PARAM&&y==="rmt"){Dt.debug("Received save changed event on key: ".concat(S));const R=localStorage.getItem(Bs.PARAM);if(!R)return;await r(R)}};return Ps.addEventListener("message",d),()=>Ps.removeEventListener("message",d)},[]),e.jsxs(Cs,{children:[e.jsx(zs,{as:se,size:"sm",variant:"ghost",icon:e.jsx(Ds,{})}),e.jsxs(vs,{children:[e.jsx(de,{icon:e.jsx(Nt,{}),onClick:x,children:l("header.open.new")}),e.jsx("input",{id:"upload_project",ref:i,type:"file",accept:".json",hidden:!0,onChange:p,"data-testid":"file-upload"}),e.jsx(de,{icon:e.jsx(Ds,{}),onClick:()=>{var d;return(d=i==null?void 0:i.current)==null?void 0:d.click()},children:l("header.open.config")}),e.jsx(de,{icon:e.jsx(It,{}),onClick:()=>h(!0),children:l("header.open.projectRMG")}),e.jsxs(de,{icon:e.jsx(E,{}),onClick:()=>g(!0),children:[l("header.open.gallery"),e.jsx(ce,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(de,{icon:e.jsx(Ht,{}),onClick:c,children:l("header.open.tutorial")})]}),e.jsx(Kn,{isOpen:t,onClose:()=>h(!1)}),e.jsx(er,{isOpen:u,onClose:()=>g(!1)})]})}const tr=s=>new Promise(l=>{const a=new FileReader;a.onloadend=()=>l(a.result),a.readAsText(s)}),nr=()=>{const[s,l]=b.useState(!1),{t:a}=P(),n=B(),o=b.useRef(window.graph),i=_s(),{width:t,height:h}=Ms(i),[u,g]=b.useState([]);b.useEffect(()=>{s&&g(o.current.nodes().filter(x=>x.startsWith("stn")).map(x=>{const r=o.current.getNodeAttributes(x),p=r.type,c=r[p].names.join("/");return{id:x,value:c}}))},[s]);const w=x=>{n(Ut(new Set([x])));const r=Math.max(0,Math.min(400,-.132*h+117.772)),{x:p,y:c}=$t((t-300)/2,h/2,r,{x:-o.current.getNodeAttribute(x,"x"),y:-o.current.getNodeAttribute(x,"y")});n(Me(r)),n(Be({x:-p,y:-c}))};return e.jsxs(Xs,{isOpen:s,onOpen:()=>l(!0),onClose:()=>l(!1),children:[e.jsx(qs,{children:e.jsx(se,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Bt,{}),onClick:()=>l(!s)})}),e.jsx(Qs,{children:e.jsx(et,{children:e.jsx(Gt,{label:a("header.search"),children:e.jsx(Wt,{data:u,displayHandler:x=>e.jsx(ce,{children:x.value}),filter:(x,r)=>r.value.toLowerCase().includes(x.toLowerCase())||Object.values(r.value).some(p=>p.toLowerCase().includes(x.toLowerCase())),value:"",onChange:x=>w(x.id)})})})})]})},rr=s=>{const{isOpen:l,onClose:a}=s,n=B(),{t:o}=P(),i=b.useRef(window.graph),{theme:t,requestThemeChange:h}=Vt(),u=()=>{i.current.filterEdges((g,w,x,r,p,c,d)=>st.has(w.style)&&JSON.stringify(w[w.style].color)===JSON.stringify(t)).forEach(g=>i.current.dropEdge(g)),n($()),n(te(i.current.export())),a()};return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:o("header.settings.procedures.removeLines.title")}),e.jsx(K,{}),e.jsxs(X,{children:[o("header.settings.procedures.removeLines.content"),e.jsx(Ft,{theme:t,onClick:h})]}),e.jsxs(me,{children:[e.jsx(O,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:o("cancel")}),e.jsx(O,{colorScheme:"red",onClick:u,children:o("remove")})]})]})]})},ir=s=>{const{isOpen:l,onClose:a}=s,n=B(),{t:o}=P(),i=b.useRef(window.graph),[t,h]=b.useState(1),u=[{type:"input",label:o("header.settings.procedures.scale.factor"),value:t.toString(),variant:"number",onChange:w=>h(Number(w)),minW:"full"}],g=()=>{i.current.forEachNode((w,x)=>{i.current.updateNodeAttribute(w,"x",r=>(r!=null?r:0)*t),i.current.updateNodeAttribute(w,"y",r=>(r!=null?r:0)*t)}),n(V()),n($()),n(te(i.current.export())),a()};return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:o("header.settings.procedures.scale.title")}),e.jsx(K,{}),e.jsxs(X,{children:[o("header.settings.procedures.scale.content"),e.jsx(_e,{fields:u})]}),e.jsxs(me,{children:[e.jsx(O,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:o("cancel")}),e.jsx(O,{colorScheme:"red",onClick:g,children:o("apply")})]})]})]})},or=s=>{const{isOpen:l,onClose:a}=s,n=B(),{t:o}=P(),i=b.useRef(window.graph),[t,h]=b.useState(0),[u,g]=b.useState(0),w=[{type:"input",label:o("header.settings.procedures.translate.x"),value:t.toString(),variant:"number",onChange:r=>h(Number(r)),minW:"full"},{type:"input",label:o("header.settings.procedures.translate.y"),value:u.toString(),variant:"number",onChange:r=>g(Number(r)),minW:"full"}],x=()=>{i.current.forEachNode((r,p)=>{i.current.updateNodeAttribute(r,"x",c=>(c!=null?c:0)+t),i.current.updateNodeAttribute(r,"y",c=>(c!=null?c:0)+u)}),n(V()),n($()),n(te(i.current.export())),a()};return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:o("header.settings.procedures.translate.title")}),e.jsx(K,{}),e.jsxs(X,{children:[o("header.settings.procedures.translate.content"),e.jsx(_e,{fields:w})]}),e.jsxs(me,{children:[e.jsx(O,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:o("cancel")}),e.jsx(O,{colorScheme:"red",onClick:x,children:o("apply")})]})]})]})},ar=s=>{const{isOpen:l,onClose:a}=s,n=B(),{preference:{unlockSimplePathAttempts:o}}=D(u=>u.app),{activeSubscriptions:i}=D(u=>u.account),{t}=P(),h=()=>{n(Yt(-1))};return e.jsxs(F,{isOpen:l,onClose:a,size:"5xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:t("header.settings.procedures.unlockSimplePath.title")}),e.jsx(K,{}),e.jsxs(X,{children:[e.jsx(f,{mb:"2",children:t("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(f,{mb:"2",children:t("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(f,{mb:"2",children:t("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(me,{children:e.jsx(ve,{label:t("header.settings.pro"),isOpen:!i.RMP_CLOUD&&o>=0,children:e.jsx(O,{onClick:h,isDisabled:!i.RMP_CLOUD||o<0,children:o>=0?t("header.settings.procedures.unlockSimplePath.check"):t("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},lr=s=>{const{isOpen:l,onClose:a}=s,n=B(),o=Zs(),{t:i}=P(),t=b.useRef(window.graph),[h,u]=b.useState(!1),g=async()=>{u(!0);const w=JSON.stringify(t.current.export());try{const x=await hr(w);t.current.clear(),t.current.import(x),n(V()),n($()),n(te(t.current.export())),o({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(x){console.error("[rmp] Error in updating all colors: ".concat(x)),o({title:i("header.settings.procedures.updateColor.error",{e:x}),status:"error",duration:9e3,isClosable:!0})}u(!1),a()};return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:i("header.settings.procedures.updateColor.title")}),e.jsx(K,{}),e.jsx(X,{children:e.jsx(f,{children:i("header.settings.procedures.updateColor.content")})}),e.jsxs(me,{children:[e.jsx(O,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:i("cancel")}),e.jsx(O,{colorScheme:"red",onClick:g,isLoading:h,children:i("apply")})]})]})]})},Fs=s=>s.length>=4&&s.every(l=>typeof l=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(ks).includes(s[3]),cr=s=>{const l=[],a=(n,o)=>{if(Array.isArray(n)&&Fs(n)){l.push({path:o||"",value:n});return}for(const i in n){const t=n[i],h=o?"".concat(o,".").concat(i):i;Array.isArray(t)?Fs(t)?l.push({path:h,value:t}):t.forEach((u,g)=>a(u,"".concat(h,".").concat(g))):t&&typeof t=="object"&&a(t,h)}};return a(s),l},dr=(s,l,a)=>{const n=l.split(".");let o=s;for(let i=0;i<n.length-1;i++)o=o[n[i]];o[n[n.length-1]]=a},hr=async s=>{const l=JSON.parse(s),a=new Date().getTime(),n=cr(l);console.log("[rmp] Found all themes pending for update",n);const o=1e4;let i,t=!1;const h=new Promise((u,g)=>{i=setTimeout(()=>{t=!0,g("Executing time exceeds ".concat(o,"ms"))},o),(async()=>{for(const{path:w,value:x}of n){if(t)throw new Error("Update aborted");const[r,p,c,d,...m]=x,j=await Jt([r,p,c,d]);dr(l,w,[...j,...m])}})().then(u).catch(g)});try{return await h,console.log("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-a)/1e3," sec")),l}finally{clearTimeout(i)}},Ys=1,pr=()=>{const s=B(),{state:l,token:a}=D(d=>d.account),{count:{stations:n,miscNodes:o,masters:i,lines:t,parallel:h}}=D(d=>d.runtime),{t:u}=P(),[g,w]=b.useState(!1),[x,r]=b.useState(Ys);b.useEffect(()=>{let d;return g&&x>0?d=window.setTimeout(()=>{r(x-1)},1e3):x===0&&w(!1),()=>clearTimeout(d)},[g,x]);const p=()=>{w(!0),r(Ys),a&&Kt(s,a)},c={"logged-out":u("header.settings.status.subscription.logged-out"),free:u("header.settings.status.subscription.free"),subscriber:u("header.settings.status.subscription.subscriber"),expired:u("header.settings.status.subscription.expired")};return e.jsxs(C,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:u("header.settings.status.title")}),e.jsxs(C,{mt:"3",children:[e.jsxs(C,{mb:"1",children:[e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.stations")}),e.jsx(f,{children:n})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.miscNodes")}),e.jsx(f,{children:o})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.masters")}),e.jsx(f,{children:i})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.lines")}),e.jsx(f,{children:t})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.parallel")}),e.jsx(f,{children:h})]})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsxs(f,{flex:"1",children:[u("header.settings.status.subscription.content")," ",c[l]]}),e.jsx(se,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(Zt,{}),isDisabled:g,onClick:()=>p()})]})]})]})},je={width:"100%",justifyContent:"space-between"},le={fontFamily:"-apple-system"},ur=s=>{const{isOpen:l,onClose:a}=s,{activeSubscriptions:n}=D(M=>M.account),{telemetry:{project:o},preference:{autoParallel:i,randomStationsNames:t,gridLines:h,snapLines:u}}=D(M=>M.app),{keepLastPath:g,count:{parallel:w}}=D(M=>M.runtime),x=B(),{t:r}=P(),p=Js("primary.500","primary.300"),[c,d]=b.useState(!1),[m,j]=b.useState(!1),[S,y]=b.useState(!1),[R,I]=b.useState(!1),[G,ne]=b.useState(!1),[pe,q]=b.useState(!1),[Q,ee]=b.useState(!1),Xe=A.isAllowAnalytics(),Ue=M=>{x(cn(M))},Te=n.RMP_CLOUD?Xt:qt,$e=w>=Te,Oe=!n.RMP_CLOUD,qe=M=>{x(ln(M.target.value))};return e.jsxs(F,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Y,{}),e.jsxs(J,{children:[e.jsx(Z,{children:r("header.settings.title")}),e.jsx(K,{}),e.jsx(X,{children:e.jsxs(Le,{divider:e.jsx(Ct,{borderColor:"gray.200"}),children:[e.jsx(pr,{}),e.jsxs(C,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:r("header.settings.preference.title")}),e.jsxs(C,{mt:"3",children:[e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:r("header.settings.preference.keepLastPath")}),e.jsx(Ce,{isChecked:g,onChange:({target:{checked:M}})=>x(Qt(M))})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{children:r("header.settings.preference.autoParallel")}),e.jsx(ce,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ve,{label:r("header.settings.proWithTrial"),children:e.jsx(ce,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(Ce,{ml:"1",isDisabled:$e,isChecked:i,onChange:({target:{checked:M}})=>x(en(M))})]}),e.jsxs(C,{mb:"1",display:"flex",children:[e.jsx(f,{flex:"1",children:r("header.settings.preference.randomStationNames.title")}),e.jsx(ce,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ve,{label:r("header.settings.pro"),children:e.jsx(ce,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(bt,{size:"xs",width:"auto",ml:"1",value:t,onChange:qe,children:[e.jsx("option",{value:"none",children:r("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:Fe.Shmetro,disabled:Oe,children:r("header.settings.preference.randomStationNames.".concat(Fe.Shmetro))}),e.jsx("option",{value:Fe.Bjsubway,disabled:Oe,children:r("header.settings.preference.randomStationNames.".concat(Fe.Bjsubway))})]})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:r("header.settings.preference.gridline")}),e.jsx(Ce,{isChecked:h,onChange:({target:{checked:M}})=>x(sn(M))})]}),e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:r("header.settings.preference.snapline")}),e.jsx(Ce,{isChecked:u,onChange:({target:{checked:M}})=>x(tn(M))})]})]})]}),e.jsxs(C,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:r("header.settings.procedures.title")}),e.jsxs(C,{mt:"3",children:[e.jsx(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>d(!0),children:r("header.settings.procedures.translate.title")}),e.jsx(or,{isOpen:c,onClose:()=>d(!1)}),e.jsx(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>j(!0),children:r("header.settings.procedures.scale.title")}),e.jsx(ir,{isOpen:m,onClose:()=>j(!1)}),e.jsxs(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>y(!0),children:[r("header.settings.procedures.changeType.title"),e.jsx(ve,{label:r("header.settings.pro"),children:e.jsx(ce,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(kn,{isOpen:S,onClose:()=>y(!1),isSelect:!1}),e.jsx(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>I(!0),children:r("header.settings.procedures.removeLines.title")}),e.jsx(rr,{isOpen:R,onClose:()=>I(!1)}),e.jsx(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>ne(!0),children:r("header.settings.procedures.updateColor.title")}),e.jsx(lr,{isOpen:G,onClose:()=>ne(!1)}),e.jsxs(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>q(!0),children:[r("header.settings.procedures.unlockSimplePath.title"),e.jsx(ve,{label:r("header.settings.pro"),children:e.jsx(ce,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(ar,{isOpen:pe,onClose:()=>q(!1)}),e.jsx(O,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>ee(!0),children:r("header.settings.procedures.masterManager.title")}),e.jsx(vn,{isOpen:Q,onClose:()=>ee(!1)})]})]}),e.jsxs(C,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:r("header.settings.shortcuts.title")}),e.jsx(C,{mt:"3",children:e.jsxs(wt,{children:[e.jsx(St,{children:e.jsxs(W,{children:[e.jsx(Is,{children:r("header.settings.shortcuts.keys")}),e.jsx(Is,{children:r("header.settings.shortcuts.description")})]})}),e.jsxs(yt,{children:[e.jsxs(W,{children:[e.jsx(_,{children:e.jsx(v,{children:"f"})}),e.jsx(_,{children:r("header.settings.shortcuts.f")})]}),e.jsxs(W,{children:[e.jsx(_,{children:e.jsx(v,{children:"s"})}),e.jsx(_,{children:r("header.settings.shortcuts.s")})]}),e.jsxs(W,{children:[e.jsx(_,{children:e.jsxs(C,{display:"flex",flexDirection:"row",children:[e.jsx(nn,{}),e.jsx(rn,{}),e.jsx(on,{}),e.jsx(an,{})]})}),e.jsx(_,{children:r("header.settings.shortcuts.arrows")})]}),e.jsxs(W,{children:[e.jsx(_,{children:e.jsxs(C,{display:"flex",flexDirection:"row",children:[e.jsx(v,{children:"i"}),e.jsx(v,{children:"j"}),e.jsx(v,{children:"k"}),e.jsx(v,{children:"l"})]})}),e.jsx(_,{children:r("header.settings.shortcuts.ijkl")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsx(v,{sx:le,children:"⇧"}):e.jsx(v,{children:"shift"})}),e.jsx(_,{children:r("header.settings.shortcuts.shift")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsx(v,{sx:le,children:"⌥"}):e.jsx(v,{children:"alt"})}),e.jsx(_,{children:r("header.settings.shortcuts.alt")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsx(v,{sx:le,children:"⌫"}):e.jsx(v,{children:"delete"})}),e.jsx(_,{children:r("header.settings.shortcuts.delete")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(v,{sx:le,children:"⌘"}):e.jsx(v,{children:"ctrl"})," + ",e.jsx(v,{children:"x"})]}),e.jsx(_,{children:r("header.settings.shortcuts.cut")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(v,{sx:le,children:"⌘"}):e.jsx(v,{children:"ctrl"})," + ",e.jsx(v,{children:"c"})]}),e.jsx(_,{children:r("header.settings.shortcuts.copy")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(v,{sx:le,children:"⌘"}):e.jsx(v,{children:"ctrl"})," + ",e.jsx(v,{children:"v"})]}),e.jsx(_,{children:r("header.settings.shortcuts.paste")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(v,{sx:le,children:"⌘"}):e.jsx(v,{children:"ctrl"})," + ",e.jsx(v,{children:"z"})]}),e.jsx(_,{children:r("header.settings.shortcuts.undo")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:le,children:"⇧"})," + ",e.jsx(v,{sx:le,children:"⌘"})," + ",e.jsx(v,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{children:"ctrl"})," + ",e.jsx(v,{children:"y"})]})}),e.jsx(_,{children:r("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(C,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:r("header.settings.telemetry.title")}),e.jsxs(C,{mt:"3",children:[e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:r("header.settings.telemetry.info")}),e.jsxs(C,{mt:"3",mb:"1",children:[e.jsxs(C,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:r("header.settings.telemetry.essential")}),e.jsx(ve,{label:r("header.settings.telemetry.essentialTooltip"),children:e.jsx(Ce,{isChecked:Xe,isDisabled:!0})})]}),e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:r("header.settings.telemetry.essentialInfo")}),e.jsxs(T,{color:p,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[r("header.settings.telemetry.essentialLink")," ",e.jsx(H,{as:E})]})]}),e.jsxs(C,{mt:"1",mb:"1",children:[e.jsxs(C,{display:"flex",children:[e.jsx(f,{flex:"1",children:r("header.settings.telemetry.additional")}),e.jsx(Ce,{isChecked:o,onChange:({target:{checked:M}})=>Ue(M)})]}),e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:r("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},xr=()=>{const[s,l]=b.useState(!1),{svgViewBoxZoom:a}=D(i=>i.param),n=B(),o=[{type:"slider",label:"",value:400-a,min:10,max:390,step:1,onChange:i=>n(Me(400-i)),leftIcon:e.jsx(dn,{}),rightIcon:e.jsx(Gs,{}),minW:160}];return e.jsxs(Xs,{isOpen:s,onOpen:()=>l(!0),onClose:()=>l(!1),children:[e.jsx(qs,{children:e.jsx(se,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Gs,{}),onClick:()=>l(!s)})}),e.jsx(Qs,{children:e.jsx(et,{children:e.jsx(_e,{fields:o,noLabel:!0})})})]})};function gr(){const{t:s}=P(),l=B(),{past:a,future:n}=D(c=>c.param),o=A.isAllowAnalytics(),[i,t]=b.useState(!1),[h,u]=b.useState(!1),g=Us(A.getEnv),w=Us(A.getAppVersion);b.useEffect(()=>{o&&g!==as.DEV&&A.event(Ae.APP_LOAD,{isStandaloneWindow:A.isStandaloneWindow()})},[g]);const x=c=>{A.getI18nInstance().changeLanguage(c)},r=()=>{l(jn()),l(V()),l($())},p=()=>{l(bn()),l(V()),l($())};return e.jsxs(hn,{children:[e.jsx(ze,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(pn,{environment:g,version:w,popoverHeader:g===as.PRD?void 0:e.jsxs(Ws,{i18nKey:"header.popoverHeader",environment:g,children:["You're on ",{environment:g}," environment!"]}),popoverBody:g===as.PRD?void 0:e.jsx(Ws,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(zt,{ml:"auto",children:[e.jsx(ae,{children:e.jsx(nr,{})}),e.jsx(ae,{children:e.jsx(se,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(un,{}),isDisabled:a.length===0,onClick:r})}),e.jsx(ae,{children:e.jsx(se,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(xn,{}),isDisabled:n.length===0,onClick:p})}),e.jsx(ae,{children:e.jsx(xr,{})}),e.jsx(ae,{children:e.jsx(sr,{})}),e.jsx(ae,{children:e.jsx(Fn,{})}),A.isStandaloneWindow()&&e.jsx(ae,{children:e.jsxs(Cs,{children:[e.jsx(zs,{as:se,icon:e.jsx(gn,{}),variant:"ghost",size:"sm"}),e.jsx(vs,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(c=>e.jsx(de,{onClick:()=>x(c),children:_n[c][c]},c))})]})}),e.jsx(ae,{children:e.jsx(se,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(mn,{}),onClick:()=>t(!0)})}),e.jsx(ae,{children:e.jsx(se,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(fn,{}),onClick:()=>u(!0)})})]}),e.jsx(ur,{isOpen:i,onClose:()=>t(!1)}),e.jsx(Mn,{isOpen:h,onClose:()=>u(!1)})]})}function mr(){const s=B(),l=D(n=>n.runtime.globalAlerts),a=n=>{A.isStandaloneWindow()?window.open("/".concat(n),"_blank"):A.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(l).map(([n,{message:o,url:i,linkedApp:t}])=>e.jsxs(us,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(xs,{}),t?e.jsx(T,{onClick:()=>a(t),children:o}):i?e.jsx(T,{href:i,target:"_blank",children:o}):o,e.jsx(Ks,{ml:"auto",onClick:()=>s(wn(n))})]},n))})}function yr(){return e.jsxs(e.Fragment,{children:[e.jsx(gr,{}),e.jsx(mr,{})]})}export{yr as default};
