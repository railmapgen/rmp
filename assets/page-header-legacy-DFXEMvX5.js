!function(){const e=["onError","onSuccess"],t=["version","images"],s=["version","images"];function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,n)}return s}function r(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach(function(t){i(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function i(e,t,s){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var n=s.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function o(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;s[n]=e[n]}return s}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)s=i[n],-1===t.indexOf(s)&&{}.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}System.register(["./chakra-legacy-nXMG1WKf.js","./index-legacy-0So5t4Kh.js","./react-legacy-n6CMfwan.js","./misc-nodes-legacy-Xdza9y9t.js","./change-types-legacy-C6BtvCDv.js","./change-type-modal-legacy-BBaPaBf6.js"],function(n,i){"use strict";var l,a,c,d,h,u,p,g,x,m,j,f,b,w,y,v,S,C,z,_,O,k,E,A,M,N,R,T,P,I,D,W,B,L,$,F,G,H,U,V,K,Y,J,Z,q,X,Q,ee,te,se,ne,re,ie,oe,le,ae,ce,de,he,ue,pe,ge,xe,me,je,fe,be,we,ye,ve,Se,Ce,ze,_e,Oe,ke,Ee,Ae,Me,Ne,Re,Te,Pe,Ie,De,We,Be,Le,$e,Fe,Ge,He,Ue,Ve,Ke,Ye,Je,Ze,qe,Xe,Qe,et,tt,st,nt,rt,it,ot,lt,at,ct,dt,ht,ut,pt,gt,xt,mt,jt,ft,bt,wt,yt,vt,St,Ct,zt,_t,Ot,kt,Et,At,Mt,Nt,Rt,Tt,Pt,It,Dt,Wt,Bt,Lt,$t,Ft,Gt,Ht,Ut,Vt,Kt,Yt,Jt,Zt,qt,Xt,Qt,es,ts,ss,ns,rs,is,os,ls,as,cs,ds,hs,us,ps,gs,xs;return{setters:[e=>{l=e.j,a=e.ah,c=e.M,d=e.ai,h=e.K,u=e.L,p=e.N,g=e.h,x=e.aj,m=e.O,j=e.B,f=e.ak,b=e.al,w=e.T,y=e.am,v=e.b,S=e.q,C=e.v,z=e.Q,_=e.an,O=e.ao,k=e.ap,E=e.U,A=e.aq,M=e.R,N=e.ar,R=e.as,T=e.a3,P=e.at,I=e.au,D=e.y,W=e.av,B=e.aw,L=e.V,$=e.X,F=e.Y,G=e.Z,H=e.H,U=e.J,V=e.ax,K=e.n,Y=e.a9,J=e.e,Z=e.x,q=e.m,X=e.G,Q=e.ay,ee=e.a8,te=e.az,se=e.a2,ne=e.aA,re=e.aB,ie=e.aC,oe=e.aD,le=e.aE,ae=e.aF,ce=e.aG,de=e.aH},e=>{he=e.u,ue=e.r,pe=e.C,ge=e.M,xe=e.n,me=e.d,je=e.S,fe=e.R,be=e.a,we=e.b,ye=e.c,ve=e.e,Se=e.f,Ce=e.g,ze=e.h,_e=e.i,Oe=e.j,ke=e.k,Ee=e.E,Ae=e.s,Me=e.l,Ne=e.m,Re=e.o,Te=e.p,Pe=e.L,Ie=e.q,De=e.t,We=e.T,Be=e.v,Le=e.w,$e=e.x,Fe=e.y,Ge=e.z,He=e.A,Ue=e.B,Ve=e.D,Ke=e.F,Ye=e.G,Je=e.H,Ze=e.I,qe=e.J,Xe=e.K,Qe=e.N,et=e.O,tt=e.P,st=e.Q,nt=e.U,rt=e.V,it=e.W,ot=e.X,lt=e.Y,at=e.Z,ct=e._,dt=e.$,ht=e.a0,ut=e.a1,pt=e.a2,gt=e.a3,xt=e.a4,mt=e.a5,jt=e.a6,ft=e.a7,bt=e.a8,wt=e.a9,yt=e.aa,vt=e.ab,St=e.ac,Ct=e.ad,zt=e.ae,_t=e.af,Ot=e.ag,kt=e.ah,Et=e.ai,At=e.aj,Mt=e.ak,Nt=e.al,Rt=e.am,Tt=e.an,Pt=e.ao,It=e.ap,Dt=e.aq,Wt=e.ar,Bt=e.as,Lt=e.at,$t=e.au,Ft=e.av,Gt=e.aw,Ht=e.ax,Ut=e.ay,Vt=e.az,Kt=e.aA,Yt=e.aB,Jt=e.aC,Zt=e.aD},e=>{qt=e.u,Xt=e.b,Qt=e.T,es=e.a},e=>{ts=e.d,ss=e.r,ns=e.i,rs=e.m,is=e.a,os=e.s,ls=e.b,as=e.c,cs=e.p,ds=e.M},e=>{hs=e.a,us=e.b,ps=e.c,gs=e.d},e=>{xs=e.C}],execute:function(){n("default",function(){return l.jsxs(l.Fragment,{children:[l.jsx(Zn,{}),l.jsx(qn,{})]})});var i=function(e){return he(ue.ready(),e)};const ms=e=>{const{isOpen:t,onClose:s}=e,{t:n}=qt(),r=ue.getAppVersion();return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:n("header.about.title")}),l.jsx(u,{}),l.jsxs(p,{paddingBottom:10,children:[l.jsxs(g,{direction:"row",children:[l.jsx(x,{boxSize:"128px",src:"/rmp//logo192.png"}),l.jsxs(g,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[l.jsx(m,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),l.jsx(m,{children:r}),l.jsx(m,{}),l.jsx(m,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),l.jsx(j,{margin:5,children:l.jsx(m,{fontSize:"xl",children:n("header.about.desc")})}),l.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),l.jsx(f,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),l.jsx(m,{fontSize:"sm",children:n("header.about.content1")}),l.jsx(m,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),l.jsx(m,{fontSize:"sm",children:n("header.about.langonginc")}),l.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),l.jsx(f,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),l.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),l.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.Swiftiecott")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),l.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.Minwtraft")})]})]})]}),l.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),l.jsx(m,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),l.jsx(m,{fontSize:"sm",children:n("header.about.slackContent")}),l.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),l.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",pb:1,children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),l.jsx(m,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",pb:1,children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),l.jsx(m,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function js(e){const t=e.sizes.shift(),s=Math.max(Math.ceil(t[0]),1),n=Math.max(Math.ceil(t[1]),1),r=[s-1,n-1,1,1],i=performance.now(),o="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let l,a;o?(l=new OffscreenCanvas(1,1),a=new OffscreenCanvas(s,n)):(l=document.createElement("canvas"),l.width=1,l.height=1,a=document.createElement("canvas"),a.width=s,a.height=n);const c=l.getContext("2d"),d=a.getContext("2d");d&&(d.fillRect.apply(d,r),c.drawImage(a,s-1,n-1,1,1,0,0,1,1));const h=c&&0!==c.getImageData(0,0,1,1).data[3],u=parseInt(performance.now()-i);return[l,a].forEach(e=>{e.height=0,e.width=0}),o?(postMessage({width:s,height:n,testTime:u,isTestPass:h}),!h&&e.sizes.length&&setTimeout(()=>{js(e)},0)):h?e.onSuccess({width:s,height:n,testTime:u}):(e.onError({width:s,height:n,testTime:u}),e.sizes.length&&setTimeout(()=>{js(e)},0)),h}const fs={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},bs={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},ws={};function ys(e){const t=e.width===e.height,s=1===e.height,n=1===e.width,r=[];if(e.width&&e.height){const i=e.min||bs.min,o=e.step||bs.step;let l=Math.max(e.width,e.height);for(;l>=i;){const e=t||s?l:1,i=t||n?l:1;r.push([e,i]),l-=o}}else e.sizes.forEach(e=>{const i=t||s?e:1,o=t||n?e:1;r.push([i,o])});return r}function vs(t){const s="undefined"!=typeof window,n=s&&"Promise"in window,i=s&&"HTMLCanvasElement"in window,l=s&&"OffscreenCanvas"in window,a=URL.createObjectURL(new Blob([])).slice(-36),c=performance.now(),{onError:d,onSuccess:h}=t,u=o(t,e),p=()=>parseInt(performance.now()-c);let g=null;if(!i)return!1;if(t.useWorker&&l){const e=`\n            var canvasTest = ${js.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,t=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(t);g=new Worker(s),URL.revokeObjectURL(s),g.onmessage=function(e){const{width:t,height:s,testTime:n,isTestPass:r}=e.data,i={width:t,height:s,testTime:n,totalTime:p()};r?(ws[a].onSuccess(i),delete ws[a]):ws[a].onError(i)}}return n?new Promise(e=>{const s=r(r({},t),{},{onError(s){let{width:n,height:i,testTime:o}=s;const l={width:n,height:i,testTime:o,totalTime:p()};let a;if(0===t.sizes.length)a=!0;else{const[[e,s]]=t.sizes.slice(-1);a=n===e&&i===s}d(l),a&&e(r(r({},l),{},{success:!1}))},onSuccess(t){let{width:s,height:n,testTime:i}=t;const o={width:s,height:n,testTime:i,totalTime:p()};h(o),e(r(r({},o),{},{success:!0}))}});if(g){const{onError:e,onSuccess:t}=s;ws[a]={onError:e,onSuccess:t},g.postMessage(u)}else js(s)}):g?(ws[a]={onError:d,onSuccess:h},void g.postMessage(u)):js(t)}const Ss={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=ys({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...fs.area]});return vs(r(r(r({},bs),e),{},{sizes:t}))},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=ys({width:1,height:e.max,min:e.min,step:e.step,sizes:[...fs.height]});return vs(r(r(r({},bs),e),{},{sizes:t}))},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=ys({width:e.max,height:1,min:e.min,step:e.step,sizes:[...fs.width]});return vs(r(r(r({},bs),e),{},{sizes:t}))},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=r(r({},bs),e);return t.sizes=[...t.sizes],t.width&&t.height&&(t.sizes=[[t.width,t.height]]),vs(t)}};var Cs=(e=>(e.left="l",e.right="r",e))(Cs||{}),zs=(e=>(e.through="through",e.nonThrough="nonthrough",e))(zs||{}),_s=(e=>(e.local="local",e.express="express",e.direct="direct",e))(_s||{}),Os=(e=>(e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro",e))(Os||{}),ks=(e=>(e.sh="sh",e.sh2020="sh2020",e))(ks||{});const Es=new Set,As=new Set,Ms=new Set,Ns=new Set,Rs=new Map,Ts=new Map,Ps=new Set,Is=new Map,Ds=new Map;let Ws=[],Bs=0;const Ls=new Map,$s=new Map,Fs=new Set,Gs={localisedName:{en:"LEFT END"},num:"00",services:[_s.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:Cs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Hs={localisedName:{en:"RIGHT END"},num:"00",services:[_s.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Cs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Us={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:Os.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Cs.right,platform_num:"1",theme:[pe.Shanghai,"sh1","#E3002B",ge.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:{},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:ks.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Vs={localisedName:{},num:"",services:[_s.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Cs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Ks=e=>`${e[0]}/${e[1]}=${e[2]}${e[3]}`,Ys=e=>me.has(e),Js=(e,t)=>{const[s,n]=e.extremities(t),r=e.getEdgeAttributes(t),i=r.style;if(s!=n&&Ys(i)){const e=(e=>{if(Ys(e.style))return structuredClone(e[e.style].color)})(r);Ns.has(Ks(e))||(Ms.add(e),Ns.add(Ks(e)),Rs.set(e,s),Ts.set(Ks(e),new Set)),Ts.get(Ks(e)).add(s),Ts.get(Ks(e)).add(n),Ds.has(s)?Ws.push({target:n,next:Ds.get(s),color:e}):Ws.push({target:n,next:-1,color:e}),Ds.set(s,Bs),Bs++,Ds.has(n)?Ws.push({target:s,next:Ds.get(n),color:e}):Ws.push({target:s,next:-1,color:e}),Ds.set(n,Bs),Bs++}},Zs=(e,t,s)=>{if(Ts.get(Ks(s)).has(e)){Ts.get(Ks(s)).delete(e);for(let t=Ds.get(e);-1!=t;t=Ws[t].next){const n=Ws[t].target,r=Ws[t].color;Ks(r)==Ks(s)&&Zs(n,e,s)}}},qs=(e,t,s)=>{if(Es.has(e))return;Es.add(e);let n=0;const r=new Set;for(let i=Ds.get(e);-1!=i;i=Ws[i].next){const o=Ws[i].target,l=Ws[i].color;Ks(l)==Ks(s)&&(r.has(o)||(r.add(o),n++,o!=t&&qs(o,e,s)))}Ls.set(e,n)},Xs=(e,t)=>{const s=e.stn_list.lineend.parents;s.push(t),e.stn_list.lineend.parents=structuredClone(s).reverse(),e.stn_list.lineend.branch=r(r({},e.stn_list.lineend.branch),{},{left:2==e.stn_list.lineend.parents.length?[zs.through,s[1]]:void 0})},Qs=(e,t,s)=>{if(Fs.has(e))return[];Fs.add(e);const n=[];for(let r=Ds.get(e);-1!=r;r=Ws[r].next){const i=Ws[r].target,o=Ws[r].color;i!=t&&(Ks(o)==Ks(s)&&(i.startsWith("stn")?n.push(i):n.push(...Qs(i,e,s))))}return n},en=(e,t,s,n,i,o,l)=>{if(Es.has(e)&&(!e.startsWith("misc_node_")&&null==l.stn_list[e]||e.startsWith("misc_node_")&&!As.has(e)||l.loop))return[];if(Es.has(e)&&null!=l.stn_list[e]&&((e,t)=>{let s=0;for(let n=Ds.get(e);-1!=n;n=Ws[n].next){Ws[n].target;const e=Ws[n].color;Ks(e)==Ks(t)&&s++}return s})(e,o)-1>=2){var a;const s=[...l.stn_list[e].parents,t];if(null==l.stn_list[s[1]]){const e=s[0];s[0]=s[1],s[1]=e}l.stn_list[e].parents=structuredClone(s).reverse(),l.stn_list[e].branch=r(r({},l.stn_list[e].branch),{},{left:[zs.through,s[1]]});const n=[];for(const r of l.stn_list[e].children)r!=t&&n.push(r);l.stn_list[e].children=structuredClone(n),null===(a=l.stn_list[e].branch)||void 0===a||delete a.right;const i=[];for(const t of l.stn_list.lineend.parents)t!=e&&i.push(t);return l.stn_list.lineend.parents=structuredClone(i).reverse(),l.stn_list.lineend.branch=r(r({},l.stn_list.lineend.branch),{},{left:2==l.stn_list.lineend.parents.length?[zs.through,i[1]]:void 0}),0==n.length&&(l.stn_list[e].children=["lineend"],Xs(l,e)),[e]}Es.add(e);const c=[],d=[],h=[],u=new Set,p=new Set;for(let r=Ds.get(e);-1!=r;r=Ws[r].next){const a=Ws[r].target,d=Ws[r].color;if(a!=s){if(Ks(d)==Ks(o)){if(p.has(a))continue;if(p.add(a),e.startsWith("misc_node_")){const s=en(a,t,e,n+1,i,o,l);0!=s.length&&c.push(...s)}else{const t=en(a,e,e,n+1,i,o,l);0!=t.length&&c.push(...t)}}if(!u.has(Ks(d))&&Ks(d)!=Ks(o)){u.add(Ks(d));const e={theme:d,name:[`ch_${Ks(d)}`,`en_${Ks(d)}`]};h.push(e)}}}if(2==c.length){for(let e=0;e<2;e++)"lineend"==c[e]&&c.splice(e,1);if(l.stn_list[c[1]].parents.length>=2){const e=c[0];c[0]=c[1],c[1]=e}}if(Es.has(e)&&null!=l.stn_list[e]){const s=[];for(const t of l.stn_list.lineend.parents)t!=e&&s.push(t);l.stn_list.lineend.parents=structuredClone(s).reverse(),l.stn_list.lineend.branch=r(r({},l.stn_list.lineend.branch),{},{left:2==l.stn_list.lineend.parents.length?[zs.through,s[1]]:void 0}),0==c.length&&(Fs.clear(),d.push(...Qs(e,t,o)))}if(e.startsWith("misc_node_"))return As.add(e),c;{const s=i.getNodeAttributes(e).type,a=i.getNodeAttributes(e)[s];if(l.stn_list[e]=structuredClone(Vs),l.stn_list[e].localisedName={zh:a.names[0],en:a.names[1]},l.stn_list[e].num=String(n),i.getNodeAttributes(e).type==je.GzmtrBasic){const t=a;l.stn_list[e].num=t.stationCode,""===t.secondaryNames[0]&&""===t.secondaryNames[1]||(l.stn_list[e].localisedSecondaryName={zh:t.secondaryNames[0],en:t.secondaryNames[1]})}if(i.getNodeAttributes(e).type==je.GzmtrInt){const t=a,s=t.transfer[0];for(const n of s)if(Ks(n)==Ks(o)){l.stn_list[e].num=String(n[5]);break}""===t.secondaryNames[0]&&""===t.secondaryNames[1]||(l.stn_list[e].localisedSecondaryName={zh:t.secondaryNames[0],en:t.secondaryNames[1]})}return 0!=c.length?(l.stn_list[e].children=structuredClone(c).reverse(),2==c.length&&(l.stn_list[e].branch=r(r({},l.stn_list[e].branch),{},{right:[zs.through,c[1]]}))):(l.stn_list[e].children=["lineend"],Xs(l,e)),d.push(t),l.stn_list[e].parents=structuredClone(d).reverse(),2==d.length&&(l.stn_list[e].branch=r(r({},l.stn_list[e].branch),{},{left:[zs.through,d[1]]})),0!=h.length&&(l.stn_list[e].transfer.groups[0].lines=structuredClone(h)),[e]}},tn=(e,t,s,n)=>{const r=structuredClone(Us);let i;switch("LOOP"==n&&(r.loop=!0),e.getNodeAttributes(s).type){case je.GzmtrBasic:case je.GzmtrInt:i=Os.GZMTR;break;case je.MTR:i=Os.MTR;break;default:i=Os.SHMetro}r.theme=structuredClone(t),r.style=i,r.stn_list.linestart=structuredClone(Gs),r.stn_list.lineend=structuredClone(Hs),Es.clear(),As.clear();const o=en(s,"linestart","linestart",1,e,t,r);return r.current_stn_idx=o[0],r.stn_list.linestart.children=[o[0]],Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3?void 0:structuredClone(r)},sn=(e,t,s,n)=>{var r;e.line_name=t,e.line_num=String(s),ts(`RMG_${r=t,""!=r[0]&&""!=r[1]?r[0]+"_"+r[1]:""!=r[0]?r[0]:""!=r[1]?r[1]:`${(new Date).valueOf()}`}.json`,"application/json",((e,t)=>{let s=e;return t.forEach((e,t)=>{const n=new RegExp(`ch_${t}`,"g"),r=new RegExp(`en_${t}`,"g");s=s.replace(n,e[0]),s=s.replace(r,e[1])}),s})(JSON.stringify(e),n))},nn={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},rn=e=>{const{isOpen:t,onClose:s}=e,{t:n}=qt(),r=Xt.useRef(window.graph),[i,o]=Xt.useState(!1),[g,x]=Xt.useState([[Us,"",""]]),[j,f]=Xt.useState(["","",""]),[b,w]=Xt.useState(new Map),[y,v]=Xt.useState(new Map),[_,O]=Xt.useState([]);Xt.useEffect(()=>{if(t){const e=(e=>{Es.clear(),Ms.clear(),Ns.clear(),Rs.clear(),Ts.clear(),Ps.clear(),Is.clear(),Ds.clear(),Ws=[],Bs=0,Ls.clear(),$s.clear(),e.filterEdges(e=>e.startsWith("line")).forEach(t=>{Ys(e.getEdgeAttributes(t).style)&&Js(e,t)});let t=0;e.forEachNode(e=>{$s.set(e,++t)}),$s.set("lineend",++t);const s=[];for(const i of Ms){let e=0;for(;0!=Ts.get(Ks(i)).size;){let t="line_root";Ts.get(Ks(i)).forEach(e=>{"line_root"==t&&(t=e)}),Zs(t,"line_root",i);const s={theme:i,index:++e};Ps.add(s),Is.set(s,t)}}for(const i of Ps){const{theme:t}=i;Es.clear(),Ls.clear(),qs(Is.get(i),"line_root",t);let o=!0,l="LINE";const a=[];for(const[e,s]of Ls)1==s&&a.push(e),3==s&&(l="BRANCH"),s>3&&(o=!1);if(!o)continue;0==a.length&&(l="LOOP",Ls.forEach((e,t)=>{a.push(t)}));const c=[];for(const s of a){const i=tn(e,t,s,l);var n,r;null!=i&&c.push([i,null!==(n=i.stn_list[i.current_stn_idx].localisedName.zh)&&void 0!==n?n:"",null!==(r=i.stn_list[i.current_stn_idx].localisedName.en)&&void 0!==r?r:""])}0!=c.length&&s.push({id:xe(10),theme:t,param:structuredClone(c),type:l})}return s})(r.current),t=new Map;e.forEach(({id:e,theme:s})=>{t.set(Ks(s),e)}),O(e),w(t)}},[t]);const k=(e,t)=>document.getElementById("2RMG_"+t+"_"+e).value.trim();return l.jsxs(a,{isOpen:t,onClose:s,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:l.jsx(m,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")})}),l.jsx(u,{}),l.jsxs(p,{children:[l.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info1")}),l.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info2")}),l.jsx("br",{}),0===_.length?l.jsx(m,{fontSize:"md",children:n("header.download.2rmg.noline")}):l.jsx("table",{children:l.jsx("tbody",{children:_.map(({id:e,theme:t,param:s,type:r})=>l.jsxs("tr",{children:[l.jsx("td",{children:l.jsx(fe,{name:"other"==t[0]&&"other"==t[1]?t[2]:t[1],bg:t[2],fg:t[3]})}),l.jsx("td",{children:l.jsx(S,{placeholder:n("header.download.2rmg.placeholder.chinese"),id:`2RMG_nameCh_${e}`,size:"sm"})}),l.jsx("td",{children:l.jsx(S,{placeholder:n("header.download.2rmg.placeholder.english"),id:`2RMG_nameEn_${e}`,size:"sm"})}),l.jsx("td",{children:l.jsx(S,{placeholder:n("header.download.2rmg.placeholder.lineCode"),id:`2RMG_lineNum_${e}`,size:"sm"})}),l.jsx("td",{children:l.jsx(fe,{name:n(`header.download.2rmg.type.${r.toLowerCase()}`),bg:nn[r],fg:ge.white})}),l.jsx("td",{children:l.jsx(C,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const t=k(e,"nameCh"),n=k(e,"nameEn"),r=k(e,"lineNum"),i=new Map;b.forEach((e,t)=>{i.set(t,[k(e,"nameCh"),k(e,"nameEn")])}),x(s),f([t,n,r]),v(i),o(!0)},size:"sm",children:l.jsx(be,{})})})]},e))})})]}),l.jsx(z,{children:l.jsx(C,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:n("close")})})]}),l.jsx(on,{isOpen:i,onClose:()=>o(!1),param:g,nameList:j,interchangeName:y})]})},on=e=>{const{isOpen:t,onClose:s,param:n,nameList:r,interchangeName:i}=e,{t:o}=qt(),[g,x]=Xt.useState("");return Xt.useEffect(()=>{""!=r[0]&&""!=r[1]?x(r[0]+"/"+r[1]):""!=r[0]?x(r[0]):""!=r[1]?x(r[1]):x("")},[...r]),l.jsxs(a,{isOpen:t,onClose:s,size:"md",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:l.jsxs(m,{as:"b",fontSize:"xl",children:[o("header.download.2rmg.download")," ",g]})}),l.jsx(u,{}),l.jsx(p,{children:l.jsxs(_,{children:[l.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:o("header.download.2rmg.downloadInfo")}),n.map(([e,t,s])=>l.jsxs(C,{onClick:()=>{sn(e,[r[0],r[1]],r[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[t.replaceAll("\n","⏎"),"/",s.replaceAll("\n","⏎")]},`${t}${s}`))]})}),l.jsx(z,{children:l.jsx(C,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:o("close")})})]})]})},ln=e=>{const{isOpen:t,onClose:s}=e,{t:n}=qt();return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:n("header.download.termsAndConditions")}),l.jsx(u,{}),l.jsx(p,{children:l.jsxs(O,{children:[l.jsxs(k,{children:["The layout of the elements on the signage or rail map, is designed by"," ",l.jsxs(E,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",l.jsx(A,{as:we})]}),", ",l.jsxs(E,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",l.jsx(A,{as:we})]})," or ",l.jsxs(E,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",l.jsx(A,{as:we})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",l.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",l.jsxs(E,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",l.jsx(A,{as:we})]}),"，",l.jsxs(E,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",l.jsx(A,{as:we})]}),"或",l.jsxs(E,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",l.jsx(A,{as:we})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),l.jsxs(k,{children:["The elements including shapes and lines on the image are drawn by"," ",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",l.jsx(A,{as:we})]})," and ",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",l.jsx(A,{as:we})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",l.jsx("br",{}),"图像的元素，包括图形及线条，均由",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",l.jsx(A,{as:we})]}),"及",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",l.jsx(A,{as:we})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),l.jsxs(k,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",l.jsxs(E,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",l.jsx(A,{as:we})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",l.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",l.jsxs(E,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",l.jsx(A,{as:we})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),l.jsxs(k,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",l.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),l.jsxs(k,{children:["All flag emojis shown on Windows platforms are designed by"," ",l.jsxs(E,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",l.jsx(A,{as:we})]})," ","– the open-source emoji and icon project. License:",l.jsxs(E,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",l.jsx(A,{as:we})]}),l.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",l.jsxs(E,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",l.jsx(A,{as:we})]}),"所设计。许可证：",l.jsxs(E,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",l.jsx(A,{as:we})]})]}),l.jsxs(k,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",l.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},an=()=>{const e=new Date,t=`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}01`,s=`${String(e.getFullYear()).slice(-2)}.${e.getMonth()+1}.1`,n=navigator.platform;return`https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download/tauri-${t}/Rail.Map.Toolkit_${s}_${n.includes("Linux")?"amd64.AppImage":n.includes("Mac")?"aarch64.dmg":"x64-setup.exe"}`};function cn(){const e=M("white","var(--chakra-colors-gray-800)"),t=ye(),{activeSubscriptions:{RMP_EXPORT:s}}=ve(e=>e.account),{telemetry:{project:n}}=ve(e=>e.app),{languages:i}=ve(e=>e.fonts),o=ve(e=>e.param),{existsNodeTypes:g}=ve(e=>e.runtime),x=ue.isAllowAnalytics(),{t:f}=qt(),b=Xt.useRef(window.graph),[w,y]=Xt.useState("png"),v={png:f("header.download.png"),svg:f("header.download.svg")},[S,_]=Xt.useState(2),[O,k]=Xt.useState({width:1,height:1,benchmark:.001}),[H,U]=Xt.useState(200),V=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],K=Object.fromEntries(V.map(e=>[e,`${e}%`])),[Y,J]=Xt.useState([]),[Z,q]=Xt.useState(!1),X=[{type:"select",label:f("header.download.format"),value:w,options:v,onChange:e=>y("png"===e?"png":"svg")}],Q=[{type:"select",label:f("header.download.svgVersion"),value:S,options:{1.1:f("header.download.svg1.1"),2:f("header.download.svg2")},onChange:e=>{_(e),1.1===e&&oe(!0)}}],ee=[{type:"select",label:f("header.download.scale"),value:H,options:K,onChange:e=>U(e)},{type:"switch",label:f("header.download.transparent"),isChecked:Z,onChange:q}],[te,se]=Xt.useState(!1),[ne,re]=Xt.useState(!1),[ie,oe]=Xt.useState(!1),[le,ae]=Xt.useState(!1),[ce,de]=Xt.useState(!1),[he,pe]=Xt.useState(!1),[ge,xe]=Xt.useState(!1),[me,je]=Xt.useState(!1);Xt.useEffect(()=>{(async()=>{const e=await Ss.maxArea({usePromise:!0,useWorker:!0});k(e)})()},[]),Xt.useEffect(()=>{if(te){const{xMin:e,yMin:t,xMax:s,yMax:n}=Se(b.current),[r,i]=[s-e,n-t],o=V.filter(e=>r*e/100>O.width&&i*e/100>O.height);J(o),ss(g)?(ae(!1),de(!0)):de(!1)}},[te]);return l.jsxs(N,{id:"download",children:[l.jsx(R,{as:T,size:"sm",variant:"ghost",icon:l.jsx(be,{})}),l.jsxs(P,{children:[l.jsx(I,{icon:l.jsx(Ce,{}),onClick:()=>(async()=>{x&&ue.event(Ee.DOWNLOAD_PARAM,n?{"#nodes":b.current.order,"#edges":b.current.size}:{});const e=[];for(const s of b.current.filterNodes((e,t)=>{var s;return e.startsWith("misc_node")&&"image"===t.type&&void 0!==(null===(s=t.image)||void 0===s?void 0:s.href)})){const t=b.current.getNodeAttributes(s).image;t.href&&t.href.startsWith("img-l")&&await ns.has(t.href)&&e.push({id:t.href,base64:await ns.get(t.href)})}const t=r(r({},o),{},{images:e});ts(`RMP_${(new Date).valueOf()}.json`,"application/json",Ae(t))})(),children:f("header.download.config")}),l.jsxs(I,{icon:l.jsx(ze,{}),onClick:()=>je(!0),children:[f("header.download.2rmg.title"),l.jsx(D,{ml:"1",colorScheme:"green",children:"New"})]}),l.jsx(I,{icon:l.jsx(_e,{}),onClick:()=>se(!0),children:f("header.download.image")})]}),l.jsxs(a,{size:"2xl",isOpen:te,onClose:()=>se(!1),children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:f("header.download.image")}),l.jsx(u,{}),l.jsxs(p,{children:[l.jsx(ke,{fields:X}),"svg"===w&&l.jsx(ke,{fields:Q}),"png"===w&&l.jsx(ke,{fields:ee}),l.jsx("br",{}),l.jsx(W,{isChecked:ie,isDisabled:"svg"===w&&1.1===S,onChange:e=>oe(e.target.checked),children:l.jsx(m,{children:f("header.download.isSystemFontsOnly")})}),l.jsxs(B,{children:[l.jsx(W,{id:"share_info",isChecked:le,isDisabled:ce&&!s,onChange:e=>ae(e.target.checked),children:l.jsxs(m,{children:[f("header.download.shareInfo1"),l.jsxs(E,{color:"teal.500",href:"https://railmapgen.org/rmp",children:[f("header.about.rmp")," ",l.jsx(A,{as:we})]}),f("header.download.shareInfo2")]})}),ce&&l.jsx(D,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})]}),l.jsx(W,{id:"agree_terms",isChecked:he,onChange:e=>pe(e.target.checked),children:l.jsxs(m,{children:[f("header.download.termsAndConditionsInfo"),l.jsxs(E,{color:"teal.500",onClick:()=>re(!0),children:[f("header.download.termsAndConditions")," ",l.jsx(A,{as:we})]}),f("header.download.period")]})}),ce&&l.jsxs(L,{status:"error",mt:"4",children:[l.jsx($,{}),l.jsx(j,{children:l.jsx(F,{children:f("header.download.rmpInfoSpecificNodeExists")})})]}),"png"===w&&Y.includes(H)&&!Oe&&l.jsxs(L,{status:"error",mt:"4",children:[l.jsx($,{}),l.jsxs(j,{children:[l.jsx(F,{children:f("header.download.disabledScaleOptions")}),l.jsx(G,{children:l.jsx(Qt,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:l.jsx(E,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:l.jsx(E,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:an()})}})})]})]}),"png"===w&&Y.includes(H)&&Oe&&!s&&l.jsxs(L,{status:"error",mt:"4",children:[l.jsx($,{}),l.jsxs(j,{children:[l.jsx(F,{children:f("header.download.disabledScaleOptions")}),l.jsx(G,{children:f("header.settings.pro")})]})]})]}),l.jsx(z,{children:l.jsx(B,{children:l.jsx(C,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!he||"png"===w&&Y.includes(H)&&!Oe||"png"===w&&Y.includes(H)&&Oe&&!s,isLoading:ge,onClick:async()=>{xe(!0),x&&ue.event(Ee.DOWNLOAD_IMAGES,n?{numberOfNodes:b.current.order,numberOfEdges:b.current.size}:{});const{elem:s,width:r,height:o}=await rs(b.current,le,ie,i,g,S),l=s.outerHTML.replace(/&nbsp;/g," ").replace(/[\0-\x1F\x7F-\x9F]/g,"");if("svg"===w)return ts(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",l),void xe(!1);if(Oe)return void window.parent.__TAURI__.core.invoke("render_image",{svgString:l,scale:H,isTransparent:Z,isSystemFontsOnly:ie}).then(()=>xe(!1));document.body.appendChild(s);const a="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)));document.body.removeChild(s),s.remove();const c=document.createElement("canvas"),[d,h]=[r*H/100,o*H/100];c.width=d,c.height=h;const u=c.getContext("2d");Z||(u.fillStyle=e,u.fillRect(0,0,d,h));const p=new Image;p.onload=()=>{setTimeout(()=>{u.drawImage(p,0,0,d,h),c.toBlob(e=>{xe(!1),e?is(`RMP_${(new Date).valueOf()}.png`,e):t(Me({status:"error",message:f("header.download.imageTooBig")}))},"image/png")},Ne()?2e3:0)},p.src=a},children:f("header.download.confirm")})})}),l.jsx(ln,{isOpen:ne,onClose:()=>re(!1)})]})]}),l.jsx(rn,{isOpen:me,onClose:()=>je(!1)})]})}function dn(e){const{isOpen:t,onClose:s,onConfirm:n,saveVersion:r}=e,{t:i}=qt(),o=Xt.useRef(null),a=r>Re;return l.jsx(H,{isOpen:t,leastDestructiveRef:o,onClose:s,children:l.jsx(c,{children:l.jsxs(U,{children:[l.jsx(h,{fontSize:"lg",fontWeight:"bold",children:i("header.open.confirmOverwrite.title")}),l.jsxs(p,{children:[i("header.open.confirmOverwrite.body"),a&&l.jsx(m,{mt:4,color:"orange.500",fontWeight:"semibold",children:i("header.open.confirmOverwrite.newerVersion",{saveVersion:r,currentVersion:Re})})]}),l.jsxs(z,{children:[l.jsx(C,{ref:o,onClick:s,children:i("cancel")}),l.jsx(C,{id:"confirm_overwrite",colorScheme:"red",onClick:n,ml:3,children:i("header.open.confirmOverwrite.overwrite")})]})]})})})}const hn=.3125,un=7.8125,pn={size:10,color:"#000000"};var gn=(e=>(e.Beijing="beijing",e.Changsha="changsha",e.Chengdu="chengdu",e.Hangzhou="hangzhou",e.Kunming="kunming",e.Shanghai="shanghai",e.Suzhou="suzhou",e.Wuhan="wuhan",e))(gn||{});const xn={suzhou:{basic:je.SuzhouRTBasic,int:je.SuzhouRTInt},beijing:{basic:je.BjsubwayBasic,int:je.BjsubwayInt},shanghai:{basic:je.ShmetroBasic,int:je.ShmetroInt},kunming:{basic:je.KunmingRTBasic,int:je.KunmingRTInt},changsha:{basic:je.CsmetroBasic,int:je.CsmetroInt},chengdu:{basic:je.ChengduRTBasic,int:je.ChengduRTInt},wuhan:{basic:je.WuhanRTBasic,int:je.WuhanRTInt},hangzhou:{basic:je.HzmetroBasic,int:je.HzmetroInt}},mn=new Map,jn=new Map,fn=new Map,bn=(e,t,s)=>{var n,i;const o=`stn_${xe(10)}`;mn.set(t.id,o);const l=r(r({},structuredClone(os[s].defaultAttrs)),{},{names:[null!==(n=t.name)&&void 0!==n?n:"",null!==(i=t.nameS)&&void 0!==i?i:""],nameOffsetX:t.nameP?t.nameP[0]>0?"right":0===t.nameP[0]?"middle":"left":"right",nameOffsetY:t.nameP?t.nameP[1]>0?"bottom":0===t.nameP[1]?"middle":"top":"top"});e.addNode(o,{visible:!0,zIndex:0,x:t.pos[0]*hn,y:t.pos[1]*hn,type:s,[s]:l})},wn=(e,t,s,n={},i=0)=>{const o=`misc_node_${xe(10)}`;mn.set(t.id,o);const l=r(r({},structuredClone(ls[s].defaultAttrs)),n);e.addNode(o,{visible:!0,zIndex:i,x:t.pos[0]*hn,y:t.pos[1]*hn,type:s,[s]:l})},yn=(e,t,s)=>0===e||0===t?{style:De.SingleColor,theme:[pe.Other,"other",s||"#000000",ge.white]}:1===t?{style:De.SingleColor,theme:[pe.Other,"other","#cccccc",ge.white]}:2===t?{style:De.River,theme:[pe.Other,"other","#c3e5eb",ge.white]}:3===t?{style:De.SingleColor,theme:[pe.Other,"other","#ceeda4",ge.white]}:4===t?{style:De.SingleColor,theme:[pe.Other,"other","#ffffff",ge.white]}:{style:De.SingleColor,theme:[pe.Other,"other","#000000",ge.white]},vn=(e,t,s,n)=>{let i=0,o=0,l="",a="";s.forEach(t=>{i+=e.getNodeAttribute(t,"x"),o+=e.getNodeAttribute(t,"y");const s=e.getNodeAttribute(t,"type"),n=e.getNodeAttributes(t)[s].names,r=n[0]?""!==l?`/${n[0]}`:n[0]:"",c=n[1]?""!==a?`/${n[1]}`:n[1]:"";l+=r,a+=c});const c=i/s.length,d=o/s.length;bn(e,{id:1e8+t,name:l,nameS:a,pos:[c/hn,d/hn]},xn[n].int);const h=mn.get(1e8+t);s.forEach(t=>{const s=e.getNodeAttribute(t,"x"),n=e.getNodeAttribute(t,"y"),i=Math.sqrt(Math.pow(s-c,2)+Math.pow(n-d,2));e.edges(t).forEach(s=>{((e,t,s,n,i)=>{const o=e.getEdgeAttribute(t,"type"),[l,a]=e.extremities(t),c=e.getEdgeAttributes(t);l===s?c[o].offsetFrom=i:c[o].offsetTo=i,e.dropEdge(t),e.addDirectedEdgeWithKey(t,l===s?n:l,a===s?n:a,r(r({},c),{},{type:o}))})(e,s,t,h,i)}),e.dropNode(t)})},Sn=(e,t,s,n,r,i,o,l)=>{const a={content:s,color:null!=l?l:[pe.Other,"other",n.color||"#000000",ge.white],fontSize:30*(n.size||1)*o*1.2*hn,lineHeight:30*(n.size||1)*o*1.2*hn,textAnchor:0===r?"middle":1===r?"start":"end",dominantBaseline:0===i?"central":1===i?"hanging":"text-before-edge",language:We.en,rotate:0,italic:n.i?"italic":"normal",bold:n.b?"bold":"normal",outline:0};wn(e,t,Te.Text,a)},Cn=(e,t,s,n)=>{var r,i;const o={id:t.id,pos:t.pos},l={id:t.id+1e9,pos:t.pos},a=null===(r=t.text)||void 0===r?void 0:r.trim(),c=null===(i=t.textS)||void 0===i?void 0:i.trim();var d,h,u,p,g,x,m,j;a&&Sn(e,o,null!==(d=t.text)&&void 0!==d?d:"",null!==(h=t.textOp)&&void 0!==h?h:pn,null!==(u=t.anchorX)&&void 0!==u?u:0,null!==(p=t.anchorY)&&void 0!==p?p:0,s.textTagPlain&&s.textTagPlain.fontSize?s.textTagPlain.fontSize:1,n);c&&Sn(e,l,null!==(g=t.textS)&&void 0!==g?g:"",null!==(x=t.textSOp)&&void 0!==x?x:pn,null!==(m=t.anchorX)&&void 0!==m?m:0,null!==(j=t.anchorY)&&void 0!==j?j:0,s.textTagPlain&&s.textTagPlain.subFontSize?s.textTagPlain.subFontSize:1,n)},zn=(e,t,s="suzhou")=>{mn.clear(),jn.clear(),fn.clear();const n=JSON.parse(e);if(!((i=n)&&"object"==typeof i&&"number"==typeof i.idIncre&&Array.isArray(i.points)&&Array.isArray(i.lines)&&Array.isArray(i.textTags)&&Array.isArray(i.cvsSize)&&i.config&&"object"==typeof i.config))throw new Error("Invalid AARC save data");var i;n.points.forEach(e=>{jn.set(e.id,e),1===e.sta?bn(t,e,xn[s].basic):wn(t,e,Te.Virtual)}),n.lines.forEach(e=>{((e,t)=>{var s;const{style:n,theme:i}=yn(t.type,null!==(s=t.colorPre)&&void 0!==s?s:0,t.color);t.isFilled&&(e.dropNode(mn.get(t.pts[0])),mn.delete(t.pts[0]),wn(e,jn.get(t.pts[0]),Te.Fill,{color:i,opacity:1},-1));let o=t.pts[0];for(let l=1;l<t.pts.length;l++){const s=t.pts[l],a=`line_${xe(10)}`,c=mn.get(o),d=mn.get(s),h=jn.get(o),u=jn.get(s);if(c!==d&&c&&d)if(ps(e,"any",i,[c,d].filter(e=>e.startsWith("stn")),[]),Math.abs(Math.abs(h.pos[0]-u.pos[0])-Math.abs(h.pos[1]-u.pos[1]))<.01)0===h.dir&&0===u.dir?e.addDirectedEdgeWithKey(a,c,d,{visible:!0,zIndex:0,type:Pe.Perpendicular,[Pe.Perpendicular]:structuredClone(Ie[Pe.Perpendicular].defaultAttrs),style:n,[n]:{color:i},reconcileId:"",parallelIndex:-1}):e.addDirectedEdgeWithKey(a,c,d,{visible:!0,zIndex:0,type:Pe.Diagonal,[Pe.Diagonal]:structuredClone(Ie[Pe.Diagonal].defaultAttrs),style:n,[n]:{color:i},reconcileId:"",parallelIndex:-1});else if((0===h.dir&&0===u.dir||1===h.dir&&1===u.dir)&&Math.abs(h.pos[0]-u.pos[0])>.01&&Math.abs(h.pos[1]-u.pos[1])>.01){wn(e,{id:1e9+s,pos:[(h.pos[0]+u.pos[0])/2,(h.pos[1]+u.pos[1])/2]},Te.Virtual);const t=mn.get(1e9+s),o=`line_${xe(10)}`;e.addDirectedEdgeWithKey(a,c,t,{visible:!0,zIndex:0,type:Pe.Diagonal,[Pe.Diagonal]:r(r({},structuredClone(Ie[Pe.Diagonal].defaultAttrs)),{},{startFrom:0===h.dir?"from":"to"}),style:n,[n]:{color:i},reconcileId:"",parallelIndex:-1}),e.addDirectedEdgeWithKey(o,t,d,{visible:!0,zIndex:0,type:Pe.Diagonal,[Pe.Diagonal]:r(r({},structuredClone(Ie[Pe.Diagonal].defaultAttrs)),{},{startFrom:0===h.dir?"to":"from"}),style:n,[n]:{color:i},reconcileId:"",parallelIndex:-1})}else e.addDirectedEdgeWithKey(a,c,d,{visible:!0,zIndex:0,type:Pe.Diagonal,[Pe.Diagonal]:r(r({},structuredClone(Ie[Pe.Diagonal].defaultAttrs)),{},{startFrom:0===h.dir?"from":"to"}),style:n,[n]:{color:i},reconcileId:"",parallelIndex:-1});o=s}t.isFilled&&e.addDirectedEdgeWithKey(`line_${xe(10)}`,mn.get(o),mn.get(t.pts[0]),{visible:!0,zIndex:0,type:Pe.Diagonal,[Pe.Diagonal]:structuredClone(Ie[Pe.Diagonal].defaultAttrs),style:n,[n]:{color:i},reconcileId:"",parallelIndex:-1})})(t,e)});const o=(e=>{const t=new Map,s=Array.from(mn.values()).filter(e=>e.startsWith("stn")),n=new Set,r=new Map;for(let i=0;i<s.length;i++){const t=s[i],n=e.getNodeAttribute(t,"x"),o=e.getNodeAttribute(t,"y");for(let l=i+1;l<s.length;l++){const i=s[l],a=e.getNodeAttribute(i,"x"),c=e.getNodeAttribute(i,"y");(Math.abs(n-a)===un&&o===c||Math.abs(o-c)===un&&a===n)&&(r.has(t)||r.set(t,[]),r.has(i)||r.set(i,[]),r.get(t).push(i),r.get(i).push(t))}}return s.forEach(e=>{if(!n.has(e)&&r.has(e)){const s=[],i=[e];for(n.add(e);i.length>0;){const e=i.shift();s.push(e),r.get(e).forEach(e=>{n.has(e)||(n.add(e),i.push(e))})}t.set(e,s)}}),t})(t),l=new Set;let a=0;o.forEach(e=>{vn(t,a,e,s),e.forEach(e=>l.add(e)),a++});for(const[r,c]of mn)l.has(c)&&mn.delete(r);n.textTags.forEach(e=>{if(void 0===e.forId)Cn(t,e,n.config);else{const o=e.forId,l=n.lines.find(e=>e.id===o);if(l){var s;const{theme:o}=yn(l.type,null!==(s=l.colorPre)&&void 0!==s?s:0,l.color);var r,i;if(1===l.type)Cn(t,e,n.config,o);else wn(t,{id:e.id,pos:e.pos},Te.GzmtrLineBadge,{names:[null!==(r=e.text)&&void 0!==r?r:l.name||"",null!==(i=e.textS)&&void 0!==i?i:l.nameSub||""],color:o})}}}),mn.forEach(e=>{t.hasNode(e)&&e.startsWith("stn")&&(hs(t,e),us(t,e))})};function _n({isOpen:e,onClose:t}){const s=ye(),{t:n}=qt(),[r,i]=Xt.useState(""),[o,g]=Xt.useState(1),[x,j]=Xt.useState(gn.Suzhou),f=Xt.useRef(window.graph),w=Xt.useRef(new Be),y=Xt.useCallback(()=>{s(Le(f.current.export())),s($e()),s(Fe())},[s]),[v,S]=Xt.useState(0),[_,O]=Xt.useState(0),k=()=>{i(""),g(1)},E=()=>{i(""),g(1),t()},A=Object.values(gn).reduce((e,t)=>(e[t]=n(`header.open.otherPlatform.mode.${t}`),e),{}),M=[{type:"select",label:n("header.open.otherPlatform.mode.desc"),value:x,options:A,onChange:e=>j(e)}];return l.jsxs(a,{isOpen:e,onClose:E,size:"lg",isCentered:!0,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:n("header.open.otherPlatform.title")}),l.jsx(u,{onClick:E}),l.jsx(p,{pb:0,children:l.jsxs(B,{justify:"center",spacing:8,mb:2,children:[l.jsxs(B,{children:[l.jsx(V,{size:"8",bg:1===o?"blue.500":"gray.300",color:"white",fontWeight:"bold",children:"1"}),l.jsx(m,{fontSize:"sm",color:1===o?"blue.500":"gray.500",children:n("header.open.otherPlatform.step1")})]}),l.jsxs(B,{children:[l.jsx(V,{size:"8",bg:2===o?"blue.500":"gray.300",color:"white",fontWeight:"bold",children:"2"}),l.jsx(m,{fontSize:"sm",color:2===o?"blue.500":"gray.500",children:n("header.open.otherPlatform.step2")})]})]})}),1===o&&l.jsxs(l.Fragment,{children:[l.jsx(p,{pt:2,children:l.jsxs(b,{align:"stretch",spacing:4,children:[l.jsx(m,{fontSize:"sm",color:"gray.500",children:n("header.open.otherPlatform.desc")}),l.jsx("input",{type:"file",accept:"application/json,.json",onChange:e=>{var t;const s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;const n=new FileReader;n.onload=()=>{const e=n.result;if(e)try{const t=JSON.parse(String(e));i(JSON.stringify(t,null,2))}catch(t){i(String(e))}},n.readAsText(s)},"aria-label":"Upload JSON file"})]})}),l.jsx(z,{children:l.jsx(C,{colorScheme:"blue",onClick:()=>{if(r.trim()){s(Ge());try{w.current.clear(),zn(r,w.current),S(w.current.nodes().length),O(w.current.edges().length)}catch(e){He.error("ImportFromAarc.handleImport():: Error occurred while importing data from other tools",e),S(0),O(0)}g(2)}},isDisabled:!r.trim(),children:n("header.open.otherPlatform.next")})})]}),2===o&&(v>0&&_>0?l.jsxs(l.Fragment,{children:[l.jsx(p,{pt:2,children:l.jsxs(b,{align:"stretch",spacing:4,children:[l.jsx(m,{fontSize:"md",children:n("header.open.otherPlatform.detected",{x:v,y:_})}),l.jsx(ke,{fields:M})]})}),l.jsxs(z,{children:[l.jsx(C,{variant:"outline",mr:3,onClick:k,children:n("header.open.otherPlatform.previous")}),l.jsx(C,{colorScheme:"red",onClick:()=>{gs(w.current,je.SuzhouRTBasic,xn[x].basic,w.current.nodes().filter(e=>e.startsWith("stn_"))),gs(w.current,je.SuzhouRTInt,xn[x].int,w.current.nodes().filter(e=>e.startsWith("stn_"))),w.current.nodes().filter(e=>e.startsWith("stn_")).forEach(e=>{us(w.current,e)}),f.current.clear(),f.current.import(w.current.export()),s(Ue(100)),s(Ve({x:0,y:0})),y(),i(""),g(1),t()},children:n("header.open.otherPlatform.confirm")})]})]}):l.jsxs(l.Fragment,{children:[l.jsx(p,{pt:2,children:l.jsx(b,{align:"stretch",spacing:4,children:l.jsx(m,{fontSize:"md",children:n("header.open.otherPlatform.error")})})}),l.jsx(z,{children:l.jsx(C,{variant:"outline",onClick:k,children:n("previous")})})]}))]})]})}const On=(e,{info_panel_type:t,line_num:s,stn_list:n,style:i,theme:o},l,a,c)=>{const d=Object.fromEntries(Object.keys(n).filter(e=>!["linestart","lineend"].includes(e)).map(e=>[e,`stn_${xe(10)}`]));Object.entries(n).filter(([e,t])=>!["linestart","lineend"].includes(e)).forEach(([t,s])=>{const n=e.filterNodes((e,t)=>Object.values(je).includes(t.type)&&t[t.type].names[0]===s.localisedName.zh);0!==n.length&&(d[t]=n[0])});const h=[["linestart",-1,0]],u={};for(;h.length;){const[e,t,s]=h.shift();n[e].children.filter(e=>"lineend"!=e).forEach((e,n)=>{const r=Math.max(n,s+n);u[e]={x:150*t,y:75*r},h.push([e,t+1,r])})}Object.entries(n).filter(([e,t])=>!["linestart","lineend"].includes(e)).filter(([t,s])=>0===e.filterNodes((e,t)=>Object.values(je).includes(t.type)&&t[t.type].names[0]===s.localisedName.zh).length).map(([e,n])=>{var c,h;let p=je.ShmetroBasic;const g=n.transfer.groups,x=g.map(e=>{var t;return null!==(t=e.lines)&&void 0!==t?t:[]}).flat();i===Os.SHMetro?p=x.length>0?je.ShmetroInt:t===ks.sh2020?je.ShmetroBasic2020:je.ShmetroBasic:i===Os.GZMTR?p=x.length>0?je.GzmtrInt:je.GzmtrBasic:i===Os.MTR&&(p=je.MTR);const m=r(r({},structuredClone(os[p].defaultAttrs)),{},{names:[null!==(c=n.localisedName.zh)&&void 0!==c?c:"",null!==(h=n.localisedName.en)&&void 0!==h?h:""]});if(p===je.ShmetroBasic2020)m.color=o;else if(p===je.GzmtrBasic)m.color=o,m.lineCode=s,m.stationCode=n.num;else if(p===je.GzmtrInt)m.transfer=g.map((e,t)=>{var r,i;const l=null!==(r=null===(i=e.lines)||void 0===i?void 0:i.map(e=>{var t;return[...null!==(t=e.theme)&&void 0!==t?t:o,"1","01"]}))&&void 0!==r?r:[];return 0===t?[[...o,s,n.num],...l]:l});else if(p===je.MTR){var j;null!==(j=g[0].lines)&&void 0!==j&&j.length?m.transfer=[[[...o,"",""],...g[0].lines.map(e=>{var t;return[...null!==(t=e.theme)&&void 0!==t?t:o,"",""]})]]:m.transfer=[[]]}return{node:d[e],attr:{visible:!0,zIndex:0,x:l+u[e].x,y:a+u[e].y,type:p,[p]:m}}}).forEach(({node:t,attr:s})=>e.addNode(t,s)),Object.entries(n).filter(([e,t])=>!["linestart","lineend"].includes(e)).forEach(([t,s])=>{s.children.filter(e=>!["linestart","lineend"].includes(e)).forEach(s=>{const n=Pe.Diagonal,[r,i]=[d[t],d[s]],l=c?Ke(e,n,r,i,"from"):-1;e.addDirectedEdgeWithKey(`line_${xe(10)}`,r,i,{visible:!0,zIndex:0,type:n,[Pe.Diagonal]:structuredClone(Ie[Pe.Diagonal].defaultAttrs),style:De.SingleColor,[De.SingleColor]:{color:o},reconcileId:"",parallelIndex:l})})})},kn="rmg-bridge--",En={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function An(e){const{isOpen:t,onClose:s}=e,{t:n}=qt(),{preference:{autoParallel:r}}=ve(e=>e.app),{svgViewBoxZoom:i,svgViewBoxMin:o}=ve(e=>e.param),a=ye(),c=ue.isAllowAnalytics(),d=Ye(),{height:h,width:u}=Je(d),p=es.useRef(window.graph),[g]=es.useState(crypto.randomUUID()),x="/rmg/#/import?"+new URLSearchParams({parentComponent:ue.getAppName(),parentId:g}),m=es.useCallback(()=>{a(Le(p.current.export())),a($e()),a(Fe())},[a,$e,Fe,Le,p]);return es.useEffect(()=>{const e=new BroadcastChannel(kn+g);return e.onmessage=e=>{const{event:t,data:l}=e.data;He.debug("[rmp] Received event from RMG app clip:",t),"CLOSE"===t?s():"IMPORT"===t&&(e=>{try{c&&ue.event(Ee.IMPORT_RMG_PARAM,{});const t=o.x+u*i/100/3,s=o.y+h*i/100/3;On(p.current,e,t,s,r),m()}catch(t){a(Me({status:"error",message:n("header.open.unknownError")})),He.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",t)}finally{s()}})(l)},()=>e.close()},[o.x,o.y,i,h,u,r]),l.jsx(Ze,{isOpen:t,onClose:s,sx:En,children:l.jsx("iframe",{src:x,loading:"lazy"})})}const Mn="OPEN_TEMPLATE",Nn=new BroadcastChannel("RMP_GALLERY_CHANNEL"),Rn={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function Tn(e){const{isOpen:s,onClose:n}=e,{t:r}=qt(),i=ye(),{isOpen:a,onOpen:c,onClose:d}=K(),[h,u]=Xt.useState(null),[p,g]=Xt.useState(0),{telemetry:{project:x}}=ve(e=>e.app),m=ue.isAllowAnalytics(),j=Xt.useRef(window.graph),f=Xt.useCallback(()=>{i(Le(j.current.export())),i($e()),i(Fe())},[i,$e,Fe,Le,j]),b=async(e,t)=>{var s;const n=t?`https://${t}`:"",i=await(null===(s=(await Promise.allSettled([fetch(`${n}/rmp-gallery/resources/real_world/${e}.json`),fetch(`${n}/rmp-gallery/resources/fantasy/${e}.json`)])).filter(e=>"fulfilled"===e.status).find(e=>200===e.value.status))||void 0===s?void 0:s.value.json());if(i){if(u(i),g(i.version),c(),m){const s={id:e};x&&t&&(s.host=t),ue.event(Ee.IMPORT_WORK_FROM_GALLERY,s)}ue.sendNotification({title:r("header.open.importOK",{id:e}),message:r("header.open.importOKContent"),type:"success",duration:9e3})}else ue.sendNotification({title:r("header.open.importFail",{id:e}),message:r("header.open.importFailContent"),type:"error",duration:9e3})};return Xt.useEffect(()=>{const e=new URL(window.location.href).searchParams;if(e.size>0){const t=e.keys().next().value,s=t.indexOf("."),n=t.substring(0,-1===s?void 0:s);let i;-1!==s&&(i=t.substring(s+1)),"org"===i?(async e=>{try{const t=await fetch(`${qe}/${e}`);if(200!==t.status)throw new Error(r("header.open.importFailContent"));const s=await t.json();u(s),g(s.version),c(),m&&ue.event(Ee.IMPORT_WORK_FROM_SHARE,{share:e}),ue.sendNotification({title:r("header.open.importOK",{id:e}),message:r("header.open.importOKContent"),type:"success",duration:9e3})}catch(t){ue.sendNotification({title:r("header.open.importFail",{id:e}),message:t.message,type:"error",duration:9e3})}})(n):b(n,i),ue.updateAppMetadata({search:""})}},[]),Xt.useEffect(()=>(Nn.onmessage=e=>{const{event:t,data:s}=e.data;t===Mn&&(b(s),n())},()=>Nn.close()),[]),l.jsxs(l.Fragment,{children:[l.jsxs(Ze,{isOpen:s,onClose:n,size:"full",sx:Rn,children:[l.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),l.jsx(Y,{onClick:n,position:"fixed",top:"5px",right:"15px"})]}),l.jsx(dn,{isOpen:a,onClose:d,onConfirm:async()=>{h&&await(async e=>{const s=JSON.parse(await Xe(JSON.stringify(e))),{version:n,images:r}=s,l=o(s,t);i(Ge()),j.current.clear(),j.current.import(l.graph),Array.isArray(r)&&r.length>0&&await as(j.current,r),i(cs()),f();const{svgViewBoxZoom:a,svgViewBoxMin:c}=l;"number"==typeof a&&i(Ue(a)),"number"==typeof c.x&&"number"==typeof c.y&&i(Ve(c))})(h),d(),u(null)},saveVersion:p})]})}function Pn(){const e=ye(),{t:t}=qt(),{isOpen:n,onOpen:r,onClose:i}=K(),[a,c]=Xt.useState(null),[d,h]=Xt.useState(0),u=Ye(),{height:p}=Je(u),g=Xt.useRef(window.graph),x=Xt.useRef(null),[m,j]=Xt.useState(!1),[f,b]=Xt.useState(!1),[w,y]=Xt.useState(!1),v=Xt.useCallback(()=>{e(Le(g.current.export())),e($e()),e(Fe())},[e,$e,Fe,Le,g]),S=async t=>{const n=JSON.parse(await Xe(t)),{version:r,images:i}=n,l=o(n,s);e(Ge()),g.current.clear(),g.current.import(l.graph),Array.isArray(i)&&i.length>0&&await as(g.current,i),e(cs()),v();const{svgViewBoxZoom:a,svgViewBoxMin:c}=l;"number"==typeof a&&e(Ue(a)),"number"==typeof c.x&&"number"==typeof c.y&&e(Ve(c))};return Xt.useEffect(()=>{const e=async e=>{const{type:t,key:s,from:n}=e.data;if(t===ot.SAVE_CHANGED&&s===lt.PARAM&&"rmt"===n){He.debug(`Received save changed event on key: ${s}`);const e=localStorage.getItem(lt.PARAM);if(!e)return;await S(e)}};return Qe.addEventListener("message",e),()=>Qe.removeEventListener("message",e)},[]),l.jsxs(l.Fragment,{children:[l.jsxs(N,{children:[l.jsx(R,{as:T,size:"sm",variant:"ghost",icon:l.jsx(et,{})}),l.jsxs(P,{children:[l.jsx(I,{icon:l.jsx(tt,{}),onClick:()=>{e(Ge()),g.current.clear(),e(Ue(100)),e(Ve({x:0,y:0})),v()},children:t("header.open.new")}),l.jsx("input",{id:"upload_project",ref:x,type:"file",accept:".json",hidden:!0,onChange:async s=>{var n;const i=null===(n=s.target.files)||void 0===n?void 0:n[0];if(He.debug("OpenActions.handleUpload():: received file",i),"application/json"!==(null==i?void 0:i.type))e(Me({status:"error",message:t("header.open.invalidType")})),He.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const e=await In(i);c(e);const t=it(e);h(t),r()}catch(o){e(Me({status:"error",message:t("header.open.unknownError")})),He.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",o)}s.target.value=""},"data-testid":"file-upload"}),l.jsx(I,{icon:l.jsx(et,{}),onClick:()=>{var e;return null==x||null===(e=x.current)||void 0===e?void 0:e.click()},children:t("header.open.config")}),l.jsx(I,{icon:l.jsx(st,{}),onClick:()=>j(!0),children:t("header.open.projectRMG")}),l.jsxs(I,{icon:l.jsx(we,{}),onClick:()=>b(!0),children:[t("header.open.gallery"),l.jsx(D,{ml:"1",colorScheme:"green",children:"New"})]}),l.jsxs(I,{icon:l.jsx(we,{}),onClick:()=>y(!0),children:[t("header.open.otherPlatform.title"),l.jsx(D,{ml:"1",colorScheme:"green",children:"New"})]}),l.jsx(I,{icon:l.jsx(nt,{}),onClick:async()=>{const e=await rt();c(e),h(it(e)),r()},children:t("header.open.tutorial")})]}),l.jsx(An,{isOpen:m,onClose:()=>j(!1)}),l.jsx(Tn,{isOpen:f,onClose:()=>b(!1)}),l.jsx(_n,{isOpen:w,onClose:()=>y(!1)})]}),l.jsx(dn,{isOpen:n,onClose:i,onConfirm:async()=>{if(a){await S(a);const t=await rt();if(a.length===t.length){e(Ve({x:-10,y:-13}));const t=Math.max(0,Math.min(400,-.132*p+117.772));e(Ue(t)),await e(cs()),ue.event(Ee.LOAD_TUTORIAL,{})}}i(),c(null)},saveVersion:d})]})}const In=e=>new Promise(t=>{const s=new FileReader;s.onloadend=()=>t(s.result),s.readAsText(e)}),Dn=()=>{const[e,t]=Xt.useState(!1),{t:s}=qt(),n=ye(),r=Xt.useRef(window.graph),i=Ye(),{width:o,height:a}=Je(i),[c,d]=Xt.useState([]);Xt.useEffect(()=>{e&&d(r.current.nodes().filter(e=>e.startsWith("stn")).map(e=>{const t=r.current.getNodeAttributes(e);return{id:e,value:t[t.type].names.join("/")}}))},[e]);return l.jsxs(J,{isOpen:e,onOpen:()=>t(!0),onClose:()=>t(!1),children:[l.jsx(Z,{children:l.jsx(T,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:l.jsx(at,{}),onClick:()=>t(!e)})}),l.jsx(q,{children:l.jsx(X,{children:l.jsx(ct,{label:s("header.search"),children:l.jsx(dt,{data:c,displayHandler:e=>l.jsx(D,{children:e.value}),filter:(e,t)=>t.value.toLowerCase().includes(e.toLowerCase())||Object.values(t.value).some(t=>t.toLowerCase().includes(e.toLowerCase())),value:"",onChange:e=>(e=>{n(ht(new Set([e])));const t=Math.max(0,Math.min(400,-.132*a+117.772)),{x:s,y:i}=ut((o-300)/2,a/2,t,{x:-r.current.getNodeAttribute(e,"x"),y:-r.current.getNodeAttribute(e,"y")});n(Ue(t)),n(Ve({x:-s,y:-i}))})(e.id)})})})})]})},Wn=e=>{const{isOpen:t,onClose:s}=e,n=ye(),{t:r}=qt(),i=Xt.useRef(window.graph),{theme:o,requestThemeChange:g}=pt();return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:r("header.settings.procedures.removeLines.title")}),l.jsx(u,{}),l.jsxs(p,{children:[r("header.settings.procedures.removeLines.content"),l.jsx(gt,{theme:o,onClick:g})]}),l.jsxs(z,{children:[l.jsx(C,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:r("cancel")}),l.jsx(C,{colorScheme:"red",onClick:()=>{i.current.filterEdges((e,t,s,n,r,i,l)=>me.has(t.style)&&JSON.stringify(t[t.style].color)===JSON.stringify(o)).forEach(e=>i.current.dropEdge(e)),n(Le(i.current.export())),n(Fe()),s()},children:r("remove")})]})]})]})},Bn=e=>{const{isOpen:t,onClose:s}=e,n=ye(),{t:r}=qt(),i=Xt.useRef(window.graph),[o,g]=Xt.useState(1),x=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:o.toString(),variant:"number",onChange:e=>g(Number(e)),minW:"full"}];return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:r("header.settings.procedures.scale.title")}),l.jsx(u,{}),l.jsxs(p,{children:[r("header.settings.procedures.scale.content"),l.jsx(ke,{fields:x})]}),l.jsxs(z,{children:[l.jsx(C,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:r("cancel")}),l.jsx(C,{colorScheme:"red",onClick:()=>{i.current.forEachNode((e,t)=>{i.current.updateNodeAttribute(e,"x",e=>(null!=e?e:0)*o),i.current.updateNodeAttribute(e,"y",e=>(null!=e?e:0)*o)}),n(Le(i.current.export())),n($e()),n(Fe()),s()},children:r("apply")})]})]})]})},Ln=e=>{const{isOpen:t,onClose:s}=e,n=ye(),{t:r}=qt(),i=Xt.useRef(window.graph),[o,g]=Xt.useState(0),[x,m]=Xt.useState(0),j=[{type:"input",label:r("header.settings.procedures.translate.x"),value:o.toString(),variant:"number",onChange:e=>g(Number(e)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:x.toString(),variant:"number",onChange:e=>m(Number(e)),minW:"full"}];return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:r("header.settings.procedures.translate.title")}),l.jsx(u,{}),l.jsxs(p,{children:[r("header.settings.procedures.translate.content"),l.jsx(ke,{fields:j})]}),l.jsxs(z,{children:[l.jsx(C,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:r("cancel")}),l.jsx(C,{colorScheme:"red",onClick:()=>{i.current.forEachNode((e,t)=>{i.current.updateNodeAttribute(e,"x",e=>(null!=e?e:0)+o),i.current.updateNodeAttribute(e,"y",e=>(null!=e?e:0)+x)}),n(Le(i.current.export())),n($e()),n(Fe()),s()},children:r("apply")})]})]})]})},$n=e=>{const{isOpen:t,onClose:s}=e,n=ye(),r=Q(),{t:i}=qt(),o=Xt.useRef(window.graph),[g,x]=Xt.useState(!1);return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:i("header.settings.procedures.updateColor.title")}),l.jsx(u,{}),l.jsx(p,{children:l.jsx(m,{children:i("header.settings.procedures.updateColor.content")})}),l.jsxs(z,{children:[l.jsx(C,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:i("cancel")}),l.jsx(C,{colorScheme:"red",onClick:async()=>{x(!0);const e=JSON.stringify(o.current.export());try{const t=await Hn(e);o.current.clear(),o.current.import(t),n(Le(o.current.export())),n($e()),n(Fe()),r({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(t){He.error(`[rmp] Error in updating all colors: ${t}`),r({title:i("header.settings.procedures.updateColor.error",{e:t}),status:"error",duration:9e3,isClosable:!0})}x(!1),s()},isLoading:g,children:i("apply")})]})]})]})},Fn=e=>e.length>=4&&e.every(e=>"string"==typeof e)&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(ge).includes(e[3]),Gn=(e,t,s)=>{const n=t.split(".");let r=e;for(let i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=s},Hn=async e=>{const t=JSON.parse(e),s=(new Date).getTime(),n=(e=>{const t=[],s=(e,n)=>{if(Array.isArray(e)&&Fn(e))t.push({path:n||"",value:e});else for(const r in e){const i=e[r],o=n?`${n}.${r}`:r;Array.isArray(i)?Fn(i)?t.push({path:o,value:i}):i.forEach((e,t)=>s(e,`${o}.${t}`)):i&&"object"==typeof i&&s(i,o)}};return s(e),t})(t);He.debug("[rmp] Found all themes pending for update",n);let r,i=!1;const o=new Promise((e,s)=>{r=setTimeout(()=>{i=!0,s("Executing time exceeds 10000ms")},1e4),(async()=>{for(const{path:e,value:s}of n){if(i)throw new Error("Update aborted");const[n,r,o,l,...a]=s,c=await xt([n,r,o,l]);Gn(t,e,[...c,...a])}})().then(e).catch(s)});try{return await o,He.debug(`[rmp] Themes update completed, elapsed time ${((new Date).getTime()-s)/1e3} sec`),t}finally{clearTimeout(r)}},Un=()=>{const e=ye(),{state:t,token:s}=ve(e=>e.account),{count:{stations:n,miscNodes:r,masters:i,lines:o,parallel:a}}=ve(e=>e.runtime),{t:c}=qt(),[d,h]=Xt.useState(!1),[u,p]=Xt.useState(1);Xt.useEffect(()=>{let e;return d&&u>0?e=window.setTimeout(()=>{p(u-1)},1e3):0===u&&h(!1),()=>clearTimeout(e)},[d,u]);const g={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),l.jsxs(j,{mt:"3",children:[l.jsxs(j,{mb:"1",children:[l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.stations")}),l.jsx(m,{children:n})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.miscNodes")}),l.jsx(m,{children:r})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.masters")}),l.jsx(m,{children:i})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.lines")}),l.jsx(m,{children:o})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.parallel")}),l.jsx(m,{children:a})]})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsxs(m,{flex:"1",children:[c("header.settings.status.subscription.content")," ",g[t]]}),l.jsx(T,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:l.jsx(mt,{}),isDisabled:d,onClick:()=>(h(!0),p(1),void(s&&jt(e,s)))})]})]})]})},Vn={width:"100%",justifyContent:"space-between"},Kn={fontFamily:"-apple-system"},Yn=e=>{const{isOpen:t,onClose:s}=e,{activeSubscriptions:n}=ve(e=>e.account),{telemetry:{project:r},preference:{autoParallel:i,randomStationsNames:o,gridLines:g,snapLines:x,predictNextNode:f,autoChangeStationType:w,disableWarning:{changeType:y}}}=ve(e=>e.app),{keepLastPath:v,count:{parallel:S}}=ve(e=>e.runtime),z=ye(),{t:_}=qt(),O=M("primary.500","primary.300"),[k,N]=Xt.useState(!1),[R,T]=Xt.useState(!1),[P,I]=Xt.useState(!1),[W,L]=Xt.useState(!1),[$,F]=Xt.useState(!1),[G,H]=Xt.useState(!1),U=ue.isAllowAnalytics(),V=S>=(n.RMP_CLOUD?ft:bt),K=!n.RMP_CLOUD;return l.jsxs(a,{isOpen:t,onClose:s,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:_("header.settings.title")}),l.jsx(u,{}),l.jsx(p,{children:l.jsxs(b,{divider:l.jsx(de,{borderColor:"gray.200"}),children:[l.jsx(Un,{}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.preference.title")}),l.jsxs(b,{spacing:"0",mt:"3",align:"stretch",children:[l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.keepLastPath")}),l.jsx(ee,{isChecked:v,onChange:({target:{checked:e}})=>z(wt(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{children:_("header.settings.preference.autoParallel")}),l.jsx(D,{ml:"auto",colorScheme:"green",children:"New"}),l.jsx(te,{label:_("header.settings.proWithTrial"),children:l.jsx(D,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),l.jsx(ee,{ml:"1",isDisabled:V,isChecked:i,onChange:({target:{checked:e}})=>z(yt(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.randomStationNames.title")}),l.jsx(D,{ml:"auto",colorScheme:"green",children:"New"}),l.jsx(te,{label:_("header.settings.pro"),children:l.jsx(D,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),l.jsxs(se,{size:"xs",width:"auto",ml:"1",value:o,onChange:e=>{z(Tt(e.target.value))},children:[l.jsx("option",{value:"none",children:_("header.settings.preference.randomStationNames.none")}),l.jsx("option",{value:vt.Shmetro,disabled:K,children:_(`header.settings.preference.randomStationNames.${vt.Shmetro}`)}),l.jsx("option",{value:vt.Bjsubway,disabled:K,children:_(`header.settings.preference.randomStationNames.${vt.Bjsubway}`)})]})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.gridline")}),l.jsx(ee,{isChecked:g,onChange:({target:{checked:e}})=>z(St(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.snapline")}),l.jsx(ee,{isChecked:x,onChange:({target:{checked:e}})=>z(Ct(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.predictNextNode")}),l.jsx(ee,{isChecked:f,onChange:({target:{checked:e}})=>z(zt(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.autoChangeStationType")}),l.jsx(ee,{isChecked:w,onChange:({target:{checked:e}})=>z(_t(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.disableWarningChangeType")}),l.jsx(ee,{isChecked:y,onChange:({target:{checked:e}})=>z(Ot(e))})]})]})]}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.procedures.title")}),l.jsxs(j,{mt:"3",children:[l.jsx(C,{sx:Vn,rightIcon:l.jsx(kt,{}),onClick:()=>N(!0),children:_("header.settings.procedures.translate.title")}),l.jsx(Ln,{isOpen:k,onClose:()=>N(!1)}),l.jsx(C,{sx:Vn,rightIcon:l.jsx(kt,{}),onClick:()=>T(!0),children:_("header.settings.procedures.scale.title")}),l.jsx(Bn,{isOpen:R,onClose:()=>T(!1)}),l.jsxs(C,{sx:Vn,rightIcon:l.jsx(kt,{}),onClick:()=>I(!0),children:[_("header.settings.procedures.changeType.title"),l.jsx(te,{label:_("header.settings.pro"),children:l.jsx(D,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),l.jsx(xs,{isOpen:P,onClose:()=>I(!1),isSelect:!1}),l.jsx(C,{sx:Vn,rightIcon:l.jsx(kt,{}),onClick:()=>L(!0),children:_("header.settings.procedures.removeLines.title")}),l.jsx(Wn,{isOpen:W,onClose:()=>L(!1)}),l.jsx(C,{sx:Vn,rightIcon:l.jsx(kt,{}),onClick:()=>F(!0),children:_("header.settings.procedures.updateColor.title")}),l.jsx($n,{isOpen:$,onClose:()=>F(!1)}),l.jsx(C,{sx:Vn,rightIcon:l.jsx(kt,{}),onClick:()=>H(!0),children:_("header.settings.procedures.masterManager.title")}),l.jsx(ds,{isOpen:G,onClose:()=>H(!1)})]})]}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.shortcuts.title")}),l.jsx(j,{mt:"3",children:l.jsxs(ne,{children:[l.jsx(re,{children:l.jsxs(ie,{children:[l.jsx(oe,{children:_("header.settings.shortcuts.keys")}),l.jsx(oe,{children:_("header.settings.shortcuts.description")})]})}),l.jsxs(le,{children:[l.jsxs(ie,{children:[l.jsx(ae,{children:l.jsx(ce,{children:"f"})}),l.jsx(ae,{children:_("header.settings.shortcuts.f")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:l.jsx(ce,{children:"s"})}),l.jsx(ae,{children:_("header.settings.shortcuts.s")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:l.jsx(ce,{children:"c"})}),l.jsx(ae,{children:_("header.settings.shortcuts.c")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:l.jsxs(j,{display:"flex",flexDirection:"row",children:[l.jsx(Et,{}),l.jsx(At,{}),l.jsx(Mt,{}),l.jsx(Nt,{})]})}),l.jsx(ae,{children:_("header.settings.shortcuts.arrows")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:l.jsxs(j,{display:"flex",flexDirection:"row",children:[l.jsx(ce,{children:"i"}),l.jsx(ce,{children:"j"}),l.jsx(ce,{children:"k"}),l.jsx(ce,{children:"l"})]})}),l.jsx(ae,{children:_("header.settings.shortcuts.ijkl")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:l.jsx(ce,{children:"r"})}),l.jsx(ae,{children:_("header.settings.shortcuts.rotate")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:Rt?l.jsx(ce,{sx:Kn,children:"⇧"}):l.jsx(ce,{children:"shift"})}),l.jsx(ae,{children:_("header.settings.shortcuts.shift")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:Rt?l.jsx(ce,{sx:Kn,children:"⌥"}):l.jsx(ce,{children:"alt"})}),l.jsx(ae,{children:_("header.settings.shortcuts.alt")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:Rt?l.jsx(ce,{sx:Kn,children:"⌫"}):l.jsx(ce,{children:"delete"})}),l.jsx(ae,{children:_("header.settings.shortcuts.delete")})]}),l.jsxs(ie,{children:[l.jsxs(ae,{children:[Rt?l.jsx(ce,{sx:Kn,children:"⌘"}):l.jsx(ce,{children:"ctrl"})," + ",l.jsx(ce,{children:"x"})]}),l.jsx(ae,{children:_("header.settings.shortcuts.cut")})]}),l.jsxs(ie,{children:[l.jsxs(ae,{children:[Rt?l.jsx(ce,{sx:Kn,children:"⌘"}):l.jsx(ce,{children:"ctrl"})," + ",l.jsx(ce,{children:"c"})]}),l.jsx(ae,{children:_("header.settings.shortcuts.copy")})]}),l.jsxs(ie,{children:[l.jsxs(ae,{children:[Rt?l.jsx(ce,{sx:Kn,children:"⌘"}):l.jsx(ce,{children:"ctrl"})," + ",l.jsx(ce,{children:"v"})]}),l.jsx(ae,{children:_("header.settings.shortcuts.paste")})]}),l.jsxs(ie,{children:[l.jsxs(ae,{children:[Rt?l.jsx(ce,{sx:Kn,children:"⌘"}):l.jsx(ce,{children:"ctrl"})," + ",l.jsx(ce,{children:"z"})]}),l.jsx(ae,{children:_("header.settings.shortcuts.undo")})]}),l.jsxs(ie,{children:[l.jsx(ae,{children:Rt?l.jsxs(l.Fragment,{children:[l.jsx(ce,{sx:Kn,children:"⇧"})," + ",l.jsx(ce,{sx:Kn,children:"⌘"})," + ",l.jsx(ce,{children:"z"})]}):l.jsxs(l.Fragment,{children:[l.jsx(ce,{children:"ctrl"})," + ",l.jsx(ce,{children:"y"})]})}),l.jsx(ae,{children:_("header.settings.shortcuts.redo")})]})]})]})})]}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.telemetry.title")}),l.jsxs(j,{mt:"3",children:[l.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:_("header.settings.telemetry.info")}),l.jsxs(j,{mt:"3",mb:"1",children:[l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.telemetry.essential")}),l.jsx(te,{label:_("header.settings.telemetry.essentialTooltip"),children:l.jsx(ee,{isChecked:U,isDisabled:!0})})]}),l.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:_("header.settings.telemetry.essentialInfo")}),l.jsxs(E,{color:O,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[_("header.settings.telemetry.essentialLink")," ",l.jsx(A,{as:we})]})]}),l.jsxs(j,{mt:"1",mb:"1",children:[l.jsxs(j,{display:"flex",children:[l.jsx(m,{flex:"1",children:_("header.settings.telemetry.additional")}),l.jsx(ee,{isChecked:r,onChange:({target:{checked:e}})=>{z(Pt(e))}})]}),l.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:_("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},Jn=()=>{const[e,t]=Xt.useState(!1),{svgViewBoxZoom:s}=ve(e=>e.param),n=ye(),r=[{type:"slider",label:"",value:400-s,min:10,max:390,step:1,onChange:e=>n(Ue(400-e)),leftIcon:l.jsx(Dt,{}),rightIcon:l.jsx(It,{}),minW:160}];return l.jsxs(J,{isOpen:e,onOpen:()=>t(!0),onClose:()=>t(!1),children:[l.jsx(Z,{children:l.jsx(T,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:l.jsx(It,{}),onClick:()=>t(!e)})}),l.jsx(q,{children:l.jsx(X,{children:l.jsx(ke,{fields:r,noLabel:!0})})})]})};function Zn(){const{t:e}=qt(),t=ye(),{past:s,future:n}=ve(e=>e.param),r=ue.isAllowAnalytics(),[o,a]=Xt.useState(!1),[c,d]=Xt.useState(!1),h=i(ue.getEnv),u=i(ue.getAppVersion),p=Wt();Xt.useEffect(()=>{r&&h!==Bt.DEV&&ue.event(Ee.APP_LOAD,{isStandaloneWindow:ue.isStandaloneWindow()})},[h]);return l.jsxs(Lt,{children:[l.jsxs(g,{direction:"landscape"===p?"row":"column",width:"100%",children:[l.jsxs(B,{height:"32px",children:[l.jsx(f,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rmp")}),l.jsx($t,{environment:h,version:u,popoverHeader:h===Bt.PRD?void 0:l.jsxs(Qt,{i18nKey:"header.popoverHeader",environment:h,children:["You're on ",{environment:h}," environment!"]}),popoverBody:h===Bt.PRD?void 0:l.jsx(Qt,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),l.jsxs(B,{overflowX:"auto",ml:"landscape"===p?"auto":void 0,children:[l.jsx(Dn,{}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Undo",icon:l.jsx(Ft,{}),isDisabled:0===s.length,onClick:()=>{t(Yt())}}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Redo",icon:l.jsx(Gt,{}),isDisabled:0===n.length,onClick:()=>{t(Jt())}}),l.jsx(Jn,{}),l.jsx(Pn,{}),l.jsx(cn,{}),ue.isStandaloneWindow()&&l.jsxs(N,{children:[l.jsx(R,{as:T,icon:l.jsx(Ht,{}),variant:"ghost",size:"sm"}),l.jsx(P,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(e=>l.jsx(I,{onClick:()=>{return t=e,void ue.getI18nInstance().changeLanguage(t);var t},children:Ut[e][e]},e))})]}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Settings",icon:l.jsx(Vt,{}),onClick:()=>a(!0)}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Help",icon:l.jsx(Kt,{}),onClick:()=>d(!0)})]})]}),l.jsx(Yn,{isOpen:o,onClose:()=>a(!1)}),l.jsx(ms,{isOpen:c,onClose:()=>d(!1)})]})}function qn(){const e=ye(),t=ve(e=>e.runtime.globalAlerts);return l.jsx(l.Fragment,{children:Object.entries(t).map(([t,{message:s,url:n,linkedApp:r}])=>l.jsxs(L,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[l.jsx($,{}),r?l.jsx(E,{onClick:()=>(e=>{ue.isStandaloneWindow()?window.open(`/${e}`,"_blank"):ue.openApp({appId:e})})(r),children:s}):n?l.jsx(E,{href:n,target:"_blank",children:s}):s,l.jsx(Y,{ml:"auto",onClick:()=>e(Zt(t))})]},t))})}}}})}();
