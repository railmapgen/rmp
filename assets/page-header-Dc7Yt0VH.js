import{j as e,ag as Q,M as Z,ah as ee,J,K as se,L as X,h as js,ai as _t,N as f,B as E,aj as Ae,ak as ze,T as le,al as ce,b as de,q as ls,t as I,O as me,am as kt,an as Mt,ao as Oe,R as N,ap as P,Q as tt,aq as As,ar as Ts,a2 as ne,as as zs,at as pe,x as te,au as cs,av as q,U as ss,V as ts,X as ds,Y as Gs,G as Ot,H as At,n as nt,a8 as rt,e as it,w as ot,m as at,E as lt,aw as Te,ax as Tt,a7 as fe,a1 as zt,ay as Rt,az as Et,aA as V,aB as $s,aC as Nt,aD as R,aE as O,aF as It}from"./chakra-C1zJvDsN.js";import{u as Lt,r as z,C as Dt,M as Rs,d as ct,n as ws,S as W,R as Us,a as dt,b as L,c as H,e as G,f as Pt,g as Bt,h as Wt,i as Gt,j as Ge,k as Ee,E as _e,s as $t,l as ns,m as Ut,L as hs,o as Ft,p as Fs,q as Ht,t as Es,v as Ns,w as re,x as xe,y as ie,z as ue,A as ht,B as Vt,D as pt,F as bs,G as Ne,H as He,I as Hs,J as Vs,K as Yt,N as Kt,O as Zt,P as Ys,Q as Jt,T as Ks,U as Xt,V as qt,W as Qt,X as en,Y as sn,Z as tn,_ as nn,$ as rn,a0 as on,a1 as an,a2 as ln,a3 as cn,a4 as dn,a5 as hn,a6 as pn,a7 as qe,a8 as un,a9 as gn,aa as xn,ab as mn,ac as ye,ad as fn,ae as jn,af as wn,ag as bn,ah as je,ai as Sn,aj as yn,ak as Zs,al as Cn,am as vn,an as ps,ao as _n,ap as kn,aq as Mn,ar as On,as as An,at as Tn,au as zn,av as Rn,aw as En,ax as Nn,ay as In}from"./index-C1Aha3WL.js";import{u as $,b as j,T as Ss,r as Qe}from"./react-BpF4RbzH.js";import{d as ys,r as Ln,i as Js,m as Dn,a as Pn,s as Bn,b as ut,p as Cs,M as Wn}from"./master-manager-DEW_aLj9.js";import{C as Gn}from"./change-type-modal-CJSLNF-a.js";import"./change-types-D9pEw3tP.js";var Xs=function(s){return Lt(z.ready(),s)};const $n=s=>{const{isOpen:a,onClose:i}=s,{t}=$(),r=z.getAppVersion();return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:t("header.about.title")}),e.jsx(se,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(js,{direction:"row",children:[e.jsx(_t,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(js,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(f,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),e.jsx(f,{children:r}),e.jsx(f,{}),e.jsx(f,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e.jsx(E,{margin:5,children:e.jsx(f,{fontSize:"xl",children:t("header.about.desc")})}),e.jsx(Ae,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e.jsx(Ae,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e.jsxs(ze,{children:[e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(f,{fontSize:"sm",children:t("header.about.content1")}),e.jsx(f,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(f,{fontSize:"sm",children:t("header.about.langonginc")}),e.jsx(f,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Ae,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),e.jsxs(ze,{children:[e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(f,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(f,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(f,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),e.jsx(Ae,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),e.jsxs(ze,{children:[e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e.jsx(f,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e.jsx(f,{fontSize:"sm",children:t("header.about.slackContent")}),e.jsx(f,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Ae,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),e.jsxs(ze,{children:[e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",pb:1,children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),e.jsx(f,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),e.jsxs(le,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ce,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(de,{display:"block",width:"100%",pb:1,children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),e.jsx(f,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Ve(s){const a=s.sizes.shift(),i=Math.max(Math.ceil(a[0]),1),t=Math.max(Math.ceil(a[1]),1),r=[i-1,t-1,1,1],o=performance.now(),n=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let p,c;n?(p=new OffscreenCanvas(1,1),c=new OffscreenCanvas(i,t)):(p=document.createElement("canvas"),p.width=1,p.height=1,c=document.createElement("canvas"),c.width=i,c.height=t);const u=p.getContext("2d"),m=c.getContext("2d");m&&(m.fillRect.apply(m,r),u.drawImage(c,i-1,t-1,1,1,0,0,1,1));const x=u&&u.getImageData(0,0,1,1).data[3]!==0,d=parseInt(performance.now()-o);return[p,c].forEach((h=>{h.height=0,h.width=0})),n?(postMessage({width:i,height:t,testTime:d,isTestPass:x}),!x&&s.sizes.length&&setTimeout((()=>{Ve(s)}),0)):x?s.onSuccess({width:i,height:t,testTime:d}):(s.onError({width:i,height:t,testTime:d}),s.sizes.length&&setTimeout((()=>{Ve(s)}),0)),x}const us={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Re={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},$e={};function gs(s){const a=s.width===s.height,i=s.height===1,t=s.width===1,r=[];if(!s.width||!s.height)s.sizes.forEach((o=>{const n=a||i?o:1,p=a||t?o:1;r.push([n,p])}));else{const o=s.min||Re.min,n=s.step||Re.step;let p=Math.max(s.width,s.height);for(;p>=o;){const c=a||i?p:1,u=a||t?p:1;r.push([c,u]),p-=n}}return r}function es(s){const a=typeof window<"u",i=a&&"Promise"in window,t=a&&"HTMLCanvasElement"in window,r=a&&"OffscreenCanvas"in window,o=URL.createObjectURL(new Blob([])).slice(-36),n=performance.now(),{onError:p,onSuccess:c,...u}=s,m=()=>parseInt(performance.now()-n);let x=null;if(!t)return!1;if(s.useWorker&&r){const d="\n            var canvasTest = ".concat(Ve.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),h=new Blob([d],{type:"application/javascript"}),l=URL.createObjectURL(h);x=new Worker(l),URL.revokeObjectURL(l),x.onmessage=function(g){const{width:S,height:b,testTime:w,isTestPass:y}=g.data,k={width:S,height:b,testTime:w,totalTime:m()};y?($e[o].onSuccess(k),delete $e[o]):$e[o].onError(k)}}if(i)return new Promise((d=>{const h={...s,onError(l){let{width:g,height:S,testTime:b}=l;const w={width:g,height:S,testTime:b,totalTime:m()};let y;if(s.sizes.length===0)y=!0;else{const[[k,C]]=s.sizes.slice(-1);y=g===k&&S===C}p(w),y&&d({...w,success:!1})},onSuccess(l){let{width:g,height:S,testTime:b}=l;const w={width:g,height:S,testTime:b,totalTime:m()};c(w),d({...w,success:!0})}};if(x){const{onError:l,onSuccess:g}=h;$e[o]={onError:l,onSuccess:g},x.postMessage(u)}else Ve(h)}));if(x)$e[o]={onError:p,onSuccess:c},x.postMessage(u);else return Ve(s)}const Un={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=gs({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...us.area]}),i={...Re,...s,sizes:a};return es(i)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=gs({width:1,height:s.max,min:s.min,step:s.step,sizes:[...us.height]}),i={...Re,...s,sizes:a};return es(i)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=gs({width:s.max,height:1,min:s.min,step:s.step,sizes:[...us.width]}),i={...Re,...s,sizes:a};return es(i)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={...Re,...s};return a.sizes=[...a.sizes],a.width&&a.height&&(a.sizes=[[a.width,a.height]]),es(a)}};var Ye=(s=>(s.left="l",s.right="r",s))(Ye||{}),ve=(s=>(s.through="through",s.nonThrough="nonthrough",s))(ve||{}),rs=(s=>(s.local="local",s.express="express",s.direct="direct",s))(rs||{}),we=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(we||{}),Is=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Is||{});const ge=new Set,vs=new Set,_s=new Set,ks=new Set,gt=new Map,be=new Map,xs=new Set,ms=new Map,K=new Map;let D=[],Ue=0;const Fe=new Map,fs=new Map,Ms=new Set,Fn={localisedName:{en:"LEFT END"},num:"00",services:[rs.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Hn={localisedName:{en:"RIGHT END"},num:"00",services:[rs.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Vn={},xt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:we.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Ye.right,platform_num:"1",theme:[Dt.Shanghai,"sh1","#E3002B",Rs.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Vn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Is.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Yn={localisedName:{},num:"",services:[rs.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},A=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),Ls=s=>ct.has(s),Kn=s=>{if(Ls(s.style))return structuredClone(s[s.style].color)},Zn=(s,a)=>{const[i,t]=s.extremities(a),r=s.getEdgeAttributes(a),o=r.style;if(i!=t&&Ls(o)){const n=Kn(r);ks.has(A(n))||(_s.add(n),ks.add(A(n)),gt.set(n,i),be.set(A(n),new Set)),be.get(A(n)).add(i),be.get(A(n)).add(t),K.has(i)?D.push({target:t,next:K.get(i),color:n}):D.push({target:t,next:-1,color:n}),K.set(i,Ue),Ue++,K.has(t)?D.push({target:i,next:K.get(t),color:n}):D.push({target:i,next:-1,color:n}),K.set(t,Ue),Ue++}},mt=(s,a,i)=>{if(be.get(A(i)).has(s)){be.get(A(i)).delete(s);for(let t=K.get(s);t!=-1;t=D[t].next){const r=D[t].target,o=D[t].color;A(o)==A(i)&&mt(r,s,i)}}},ft=(s,a,i)=>{if(ge.has(s))return;ge.add(s);let t=0;const r=new Set;for(let o=K.get(s);o!=-1;o=D[o].next){const n=D[o].target,p=D[o].color;A(p)==A(i)&&(r.has(n)||(r.add(n),t++,n!=a&&ft(n,s,i)))}Fe.set(s,t)},qs=(s,a)=>{const i=s.stn_list.lineend.parents;i.push(a),s.stn_list.lineend.parents=structuredClone(i).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[ve.through,i[1]]:void 0}},Jn=(s,a)=>{let i=0;for(let t=K.get(s);t!=-1;t=D[t].next){D[t].target;const r=D[t].color;A(r)==A(a)&&i++}return i},jt=(s,a,i)=>{if(Ms.has(s))return[];Ms.add(s);const t=[];for(let r=K.get(s);r!=-1;r=D[r].next){const o=D[r].target,n=D[r].color;o!=a&&A(n)==A(i)&&(o.startsWith("stn")?t.push(o):t.push(...jt(o,s,i)))}return t},Os=(s,a,i,t,r,o,n)=>{var d;if(ge.has(s)&&(!s.startsWith("misc_node_")&&n.stn_list[s]==null||s.startsWith("misc_node_")&&!vs.has(s)||n.loop))return[];if(ge.has(s)&&n.stn_list[s]!=null&&Jn(s,o)-1>=2){const h=[...n.stn_list[s].parents,a];if(n.stn_list[h[1]]==null){const S=h[0];h[0]=h[1],h[1]=S}n.stn_list[s].parents=structuredClone(h).reverse(),n.stn_list[s].branch={...n.stn_list[s].branch,left:[ve.through,h[1]]};const l=[];for(const S of n.stn_list[s].children)S!=a&&l.push(S);n.stn_list[s].children=structuredClone(l),(d=n.stn_list[s].branch)==null||delete d.right;const g=[];for(const S of n.stn_list.lineend.parents)S!=s&&g.push(S);return n.stn_list.lineend.parents=structuredClone(g).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[ve.through,g[1]]:void 0},l.length==0&&(n.stn_list[s].children=["lineend"],qs(n,s)),[s]}ge.add(s);const p=[],c=[],u=[],m=new Set,x=new Set;for(let h=K.get(s);h!=-1;h=D[h].next){const l=D[h].target,g=D[h].color;if(l!=i){if(A(g)==A(o)){if(x.has(l))continue;if(x.add(l),s.startsWith("misc_node_")){const S=Os(l,a,s,t+1,r,o,n);S.length!=0&&p.push(...S)}else{const S=Os(l,s,s,t+1,r,o,n);S.length!=0&&p.push(...S)}}if(!m.has(A(g))&&A(g)!=A(o)){m.add(A(g));const S={theme:g,name:["ch_".concat(A(g)),"en_".concat(A(g))]};u.push(S)}}}if(p.length==2){for(let h=0;h<2;h++)p[h]=="lineend"&&p.splice(h,1);if(n.stn_list[p[1]].parents.length>=2){const h=p[0];p[0]=p[1],p[1]=h}}if(ge.has(s)&&n.stn_list[s]!=null){const h=[];for(const l of n.stn_list.lineend.parents)l!=s&&h.push(l);n.stn_list.lineend.parents=structuredClone(h).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[ve.through,h[1]]:void 0},p.length==0&&(Ms.clear(),c.push(...jt(s,a,o)))}if(s.startsWith("misc_node_"))return vs.add(s),p;{const h=r.getNodeAttributes(s).type,l=r.getNodeAttributes(s)[h];if(n.stn_list[s]=structuredClone(Yn),n.stn_list[s].localisedName={zh:l.names[0],en:l.names[1]},n.stn_list[s].num=String(t),r.getNodeAttributes(s).type==W.GzmtrBasic){const g=l;n.stn_list[s].num=g.stationCode,(g.secondaryNames[0]!==""||g.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:g.secondaryNames[0],en:g.secondaryNames[1]})}if(r.getNodeAttributes(s).type==W.GzmtrInt){const g=l,S=g.transfer[0];for(const b of S)if(A(b)==A(o)){n.stn_list[s].num=String(b[5]);break}(g.secondaryNames[0]!==""||g.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:g.secondaryNames[0],en:g.secondaryNames[1]})}return p.length!=0?(n.stn_list[s].children=structuredClone(p).reverse(),p.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,right:[ve.through,p[1]]})):(n.stn_list[s].children=["lineend"],qs(n,s)),c.push(a),n.stn_list[s].parents=structuredClone(c).reverse(),c.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,left:[ve.through,c[1]]}),u.length!=0&&(n.stn_list[s].transfer.groups[0].lines=structuredClone(u)),[s]}},Xn=(s,a,i,t)=>{const r=structuredClone(xt);t=="LOOP"&&(r.loop=!0);let o;switch(s.getNodeAttributes(i).type){case W.GzmtrBasic:case W.GzmtrInt:o=we.GZMTR;break;case W.MTR:o=we.MTR;break;default:o=we.SHMetro;break}r.theme=structuredClone(a),r.style=o,r.stn_list.linestart=structuredClone(Fn),r.stn_list.lineend=structuredClone(Hn),ge.clear(),vs.clear();const n=Os(i,"linestart","linestart",1,s,a,r);if(r.current_stn_idx=n[0],r.stn_list.linestart.children=[n[0]],!(Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3))return structuredClone(r)},qn=s=>{var t,r;ge.clear(),_s.clear(),ks.clear(),gt.clear(),be.clear(),xs.clear(),ms.clear(),K.clear(),D=[],Ue=0,Fe.clear(),fs.clear(),s.filterEdges(o=>o.startsWith("line")).forEach(o=>{Ls(s.getEdgeAttributes(o).style)&&Zn(s,o)});let a=0;s.forEachNode(o=>{fs.set(o,++a)}),fs.set("lineend",++a);const i=[];for(const o of _s){let n=0;for(;be.get(A(o)).size!=0;){let p="line_root";be.get(A(o)).forEach(u=>{p=="line_root"&&(p=u)}),mt(p,"line_root",o);const c={theme:o,index:++n};xs.add(c),ms.set(c,p)}}for(const o of xs){const{theme:n}=o;ge.clear(),Fe.clear(),ft(ms.get(o),"line_root",n);let p=!0,c="LINE";const u=[];for(const[x,d]of Fe)d==1&&u.push(x),d==3&&(c="BRANCH"),d>3&&(p=!1);if(!p)continue;u.length==0&&(c="LOOP",Fe.forEach((x,d)=>{u.push(d)}));const m=[];for(const x of u){const d=Xn(s,n,x,c);d!=null&&m.push([d,(t=d.stn_list[d.current_stn_idx].localisedName.zh)!=null?t:"",(r=d.stn_list[d.current_stn_idx].localisedName.en)!=null?r:""])}m.length!=0&&i.push({id:ws(10),theme:n,param:structuredClone(m),type:c})}return i},Qn=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),er=(s,a)=>{let i=s;return a.forEach((t,r)=>{const o=new RegExp("ch_".concat(r),"g"),n=new RegExp("en_".concat(r),"g");i=i.replace(o,t[0]),i=i.replace(n,t[1])}),i},sr=(s,a,i,t)=>{s.line_name=a,s.line_num=String(i),ys("RMG_".concat(Qn(a),".json"),"application/json",er(JSON.stringify(s),t))},tr={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},nr=s=>{const{isOpen:a,onClose:i}=s,{t}=$(),r=j.useRef(window.graph),[o,n]=j.useState(!1),[p,c]=j.useState([[xt,"",""]]),[u,m]=j.useState(["","",""]),[x,d]=j.useState(new Map),[h,l]=j.useState(new Map),[g,S]=j.useState([]);j.useEffect(()=>{if(a){const w=qn(r.current),y=new Map;w.forEach(({id:k,theme:C})=>{y.set(A(C),k)}),S(w),d(y)}},[a]);const b=(w,y)=>document.getElementById("2RMG_"+y+"_"+w).value.trim();return e.jsxs(Q,{isOpen:a,onClose:i,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:e.jsx(f,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),e.jsx(se,{}),e.jsxs(X,{children:[e.jsx(f,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),e.jsx(f,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),e.jsx("br",{}),g.length===0?e.jsx(f,{fontSize:"md",children:t("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:g.map(({id:w,theme:y,param:k,type:C})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Us,{name:y[0]=="other"&&y[1]=="other"?y[2]:y[1],bg:y[2],fg:y[3]})}),e.jsx("td",{children:e.jsx(ls,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(ls,{placeholder:t("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(ls,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(Us,{name:t("header.download.2rmg.type.".concat(C.toLowerCase())),bg:tr[C],fg:Rs.white})}),e.jsx("td",{children:e.jsx(I,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const M=b(w,"nameCh"),_=b(w,"nameEn"),B=b(w,"lineNum"),U=new Map;x.forEach((F,oe)=>{U.set(oe,[b(F,"nameCh"),b(F,"nameEn")])}),c(k),m([M,_,B]),l(U),n(!0)},size:"sm",children:e.jsx(dt,{})})})]},w))})})]}),e.jsx(me,{children:e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:t("close")})})]}),e.jsx(rr,{isOpen:o,onClose:()=>n(!1),param:p,nameList:u,interchangeName:h})]})},rr=s=>{const{isOpen:a,onClose:i,param:t,nameList:r,interchangeName:o}=s,{t:n}=$(),[p,c]=j.useState("");return j.useEffect(()=>{r[0]!=""&&r[1]!=""?c(r[0]+"/"+r[1]):r[0]!=""?c(r[0]):r[1]!=""?c(r[1]):c("")},[...r]),e.jsxs(Q,{isOpen:a,onClose:i,size:"md",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:e.jsxs(f,{as:"b",fontSize:"xl",children:[n("header.download.2rmg.download")," ",p]})}),e.jsx(se,{}),e.jsx(X,{children:e.jsxs(kt,{children:[e.jsx(f,{fontSize:"sm",mb:"2",lineHeight:"100%",children:n("header.download.2rmg.downloadInfo")}),t.map(([u,m,x])=>e.jsxs(I,{onClick:()=>{sr(u,[r[0],r[1]],r[2],o)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[m.replaceAll("\n","⏎"),"/",x.replaceAll("\n","⏎")]},"".concat(m).concat(x)))]})}),e.jsx(me,{children:e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:n("close")})})]})]})},ir=s=>{const{isOpen:a,onClose:i}=s,{t}=$();return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:t("header.download.termsAndConditions")}),e.jsx(se,{}),e.jsx(X,{children:e.jsxs(Mt,{children:[e.jsxs(Oe,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(N,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(P,{as:L})]}),", ",e.jsxs(N,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(P,{as:L})]})," or ",e.jsxs(N,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(P,{as:L})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(N,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(P,{as:L})]}),"，",e.jsxs(N,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(P,{as:L})]}),"或",e.jsxs(N,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(P,{as:L})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(Oe,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(P,{as:L})]})," and ",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(P,{as:L})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(P,{as:L})]}),"及",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(P,{as:L})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(Oe,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(N,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(P,{as:L})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(N,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(P,{as:L})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(Oe,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(Oe,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(N,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(P,{as:L})]})," ","– the open-source emoji and icon project. License:",e.jsxs(N,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(P,{as:L})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(N,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(P,{as:L})]}),"所设计。许可证：",e.jsxs(N,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(P,{as:L})]})]}),e.jsxs(Oe,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},or=()=>{const s="https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download",a=new Date,i="".concat(a.getFullYear()).concat(String(a.getMonth()+1).padStart(2,"0"),"01"),t="".concat(String(a.getFullYear()).slice(-2),".").concat(a.getMonth()+1,".1"),r=navigator.platform,o=r.includes("Linux")?"amd64.AppImage":r.includes("Mac")?"aarch64.dmg":"x64-setup.exe";return s+"/tauri-".concat(i,"/Rail.Map.Toolkit_").concat(t,"_").concat(o)};function ar(){const s=tt("white","var(--chakra-colors-gray-800)"),a=H(),{activeSubscriptions:{RMP_EXPORT:i}}=G(v=>v.account),{telemetry:{project:t}}=G(v=>v.app),{languages:r}=G(v=>v.fonts),o=G(v=>v.param),{existsNodeTypes:n}=G(v=>v.runtime),p=z.isAllowAnalytics(),{t:c}=$(),u=j.useRef(window.graph),[m,x]=j.useState("png"),d={png:c("header.download.png"),svg:c("header.download.svg")},[h,l]=j.useState(2),[g,S]=j.useState({width:1,height:1,benchmark:.001}),[b,w]=j.useState(200),y=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],k=Object.fromEntries(y.map(v=>[v,"".concat(v,"%")])),[C,M]=j.useState([]),[_,B]=j.useState(!1),U=[{type:"select",label:c("header.download.format"),value:m,options:d,onChange:v=>x(v==="png"?"png":"svg")}],F=[{type:"select",label:c("header.download.svgVersion"),value:h,options:{1.1:c("header.download.svg1.1"),2:c("header.download.svg2")},onChange:v=>{l(v),v===1.1&&Ze(!0)}}],oe=[{type:"select",label:c("header.download.scale"),value:b,options:k,onChange:v=>w(v)},{type:"switch",label:c("header.download.transparent"),isChecked:_,onChange:B}],[Ie,Le]=j.useState(!1),[is,Ke]=j.useState(!1),[De,Ze]=j.useState(!1),[Pe,Je]=j.useState(!1),[T,Ds]=j.useState(!1),[Ps,bt]=j.useState(!1),[St,Xe]=j.useState(!1),[yt,Bs]=j.useState(!1);j.useEffect(()=>{(async()=>{const Se=await Un.maxArea({usePromise:!0,useWorker:!0});S(Se)})()},[]),j.useEffect(()=>{if(Ie){const{xMin:v,yMin:Se,xMax:Be,yMax:Y}=Pt(u.current),[ke,ae]=[Be-v,Y-Se],We=y.filter(Me=>ke*Me/100>g.width&&ae*Me/100>g.height);M(We),Ln(n)?(Je(!1),Ds(!0)):Ds(!1)}},[Ie]);const Ct=async()=>{p&&z.event(_e.DOWNLOAD_PARAM,t?{"#nodes":u.current.order,"#edges":u.current.size}:{});const v=[];for(const Be of u.current.filterNodes((Y,ke)=>{var ae;return Y.startsWith("misc_node")&&ke.type==="image"&&((ae=ke.image)==null?void 0:ae.href)!==void 0})){const Y=u.current.getNodeAttributes(Be).image;Y.href&&Y.href.startsWith("img-l")&&await Js.has(Y.href)&&v.push({id:Y.href,base64:await Js.get(Y.href)})}const Se={...o,images:v};ys("RMP_".concat(new Date().valueOf(),".json"),"application/json",$t(Se))},vt=async()=>{Xe(!0),p&&z.event(_e.DOWNLOAD_IMAGES,t?{numberOfNodes:u.current.order,numberOfEdges:u.current.size}:{});const{elem:v,width:Se,height:Be}=await Dn(u.current,Pe,De,r,n,h),Y=v.outerHTML.replace(/&nbsp;/g," ");if(m==="svg"){ys("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Y),Xe(!1);return}if(Ge){window.parent.__TAURI__.core.invoke("render_image",{svgString:Y,scale:b,isTransparent:_,isSystemFontsOnly:De}).then(()=>Xe(!1));return}document.body.appendChild(v);const ke="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Y)));document.body.removeChild(v),v.remove();const ae=document.createElement("canvas"),[We,Me]=[Se*b/100,Be*b/100];ae.width=We,ae.height=Me;const os=ae.getContext("2d");_||(os.fillStyle=s,os.fillRect(0,0,We,Me));const as=new Image;as.onload=()=>{setTimeout(()=>{os.drawImage(as,0,0,We,Me),ae.toBlob(Ws=>{if(Xe(!1),!Ws){a(ns({status:"error",message:c("header.download.imageTooBig")}));return}Pn("RMP_".concat(new Date().valueOf(),".png"),Ws)},"image/png")},Ut()?2e3:0)},as.src=ke};return e.jsxs(As,{id:"download",children:[e.jsx(Ts,{as:ne,size:"sm",variant:"ghost",icon:e.jsx(dt,{})}),e.jsxs(zs,{children:[e.jsx(pe,{icon:e.jsx(Bt,{}),onClick:()=>Ct(),children:c("header.download.config")}),e.jsxs(pe,{icon:e.jsx(Wt,{}),onClick:()=>Bs(!0),children:[c("header.download.2rmg.title"),e.jsx(te,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(pe,{icon:e.jsx(Gt,{}),onClick:()=>Le(!0),children:c("header.download.image")})]}),e.jsxs(Q,{size:"2xl",isOpen:Ie,onClose:()=>Le(!1),children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:c("header.download.image")}),e.jsx(se,{}),e.jsxs(X,{children:[e.jsx(Ee,{fields:U}),m==="svg"&&e.jsx(Ee,{fields:F}),m==="png"&&e.jsx(Ee,{fields:oe}),e.jsx("br",{}),e.jsx(cs,{isChecked:De,isDisabled:m==="svg"&&h===1.1,onChange:v=>Ze(v.target.checked),children:e.jsx(f,{children:c("header.download.isSystemFontsOnly")})}),e.jsxs(q,{children:[e.jsx(cs,{id:"share_info",isChecked:Pe,isDisabled:T&&!i,onChange:v=>Je(v.target.checked),children:e.jsxs(f,{children:[c("header.download.shareInfo1"),e.jsxs(N,{color:"teal.500",href:"https://railmapgen.org/rmp",children:[c("header.about.rmp")," ",e.jsx(P,{as:L})]}),c("header.download.shareInfo2")]})}),T&&e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})]}),e.jsx(cs,{id:"agree_terms",isChecked:Ps,onChange:v=>bt(v.target.checked),children:e.jsxs(f,{children:[c("header.download.termsAndConditionsInfo"),e.jsxs(N,{color:"teal.500",onClick:()=>Ke(!0),children:[c("header.download.termsAndConditions")," ",e.jsx(P,{as:L})]}),c("header.download.period")]})}),T&&e.jsxs(ss,{status:"error",mt:"4",children:[e.jsx(ts,{}),e.jsx(E,{children:e.jsx(ds,{children:c("header.download.rmpInfoSpecificNodeExists")})})]}),m==="png"&&C.includes(b)&&!Ge&&e.jsxs(ss,{status:"error",mt:"4",children:[e.jsx(ts,{}),e.jsxs(E,{children:[e.jsx(ds,{children:c("header.download.disabledScaleOptions")}),e.jsx(Gs,{children:e.jsx(Ss,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:e.jsx(N,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:e.jsx(N,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:or()})}})})]})]}),m==="png"&&C.includes(b)&&Ge&&!i&&e.jsxs(ss,{status:"error",mt:"4",children:[e.jsx(ts,{}),e.jsxs(E,{children:[e.jsx(ds,{children:c("header.download.disabledScaleOptions")}),e.jsx(Gs,{children:c("header.settings.pro")})]})]})]}),e.jsx(me,{children:e.jsx(q,{children:e.jsx(I,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Ps||m==="png"&&C.includes(b)&&!Ge||m==="png"&&C.includes(b)&&Ge&&!i,isLoading:St,onClick:vt,children:c("header.download.confirm")})})}),e.jsx(ir,{isOpen:is,onClose:()=>Ke(!1)})]})]}),e.jsx(nr,{isOpen:yt,onClose:()=>Bs(!1)})]})}function wt(s){const{isOpen:a,onClose:i,onConfirm:t}=s,{t:r}=$(),o=j.useRef(null);return e.jsx(Ot,{isOpen:a,leastDestructiveRef:o,onClose:i,children:e.jsx(Z,{children:e.jsxs(At,{children:[e.jsx(J,{fontSize:"lg",fontWeight:"bold",children:r("header.open.confirmOverwrite.title")}),e.jsx(X,{children:r("header.open.confirmOverwrite.body")}),e.jsxs(me,{children:[e.jsx(I,{ref:o,onClick:i,children:r("cancel")}),e.jsx(I,{id:"confirm_overwrite",colorScheme:"red",onClick:t,ml:3,children:r("header.open.confirmOverwrite.overwrite")})]})]})})})}const lr=(s,{info_panel_type:a,line_num:i,stn_list:t,style:r,theme:o},n,p,c)=>{const u=Object.fromEntries(Object.keys(t).filter(d=>!["linestart","lineend"].includes(d)).map(d=>[d,"stn_".concat(ws(10))]));Object.entries(t).filter(([d,h])=>!["linestart","lineend"].includes(d)).forEach(([d,h])=>{const l=s.filterNodes((g,S)=>Object.values(W).includes(S.type)&&S[S.type].names[0]===h.localisedName.zh);l.length!==0&&(u[d]=l[0])});const m=[["linestart",-1,0]],x={};for(;m.length;){const[d,h,l]=m.shift();t[d].children.filter(S=>S!="lineend").forEach((S,b)=>{const w=Math.max(b,l+b);x[S]={x:h*150,y:w*75},m.push([S,h+1,w])})}Object.entries(t).filter(([d,h])=>!["linestart","lineend"].includes(d)).filter(([d,h])=>s.filterNodes((l,g)=>Object.values(W).includes(g.type)&&g[g.type].names[0]===h.localisedName.zh).length===0).map(([d,h])=>{var w,y,k;let l=W.ShmetroBasic;const g=h.transfer.groups,S=g.map(C=>{var M;return(M=C.lines)!=null?M:[]}).flat();r===we.SHMetro?S.length>0?l=W.ShmetroInt:a===Is.sh2020?l=W.ShmetroBasic2020:l=W.ShmetroBasic:r===we.GZMTR?S.length>0?l=W.GzmtrInt:l=W.GzmtrBasic:r===we.MTR&&(l=W.MTR);const b={...structuredClone(Bn[l].defaultAttrs),names:[(w=h.localisedName.zh)!=null?w:"",(y=h.localisedName.en)!=null?y:""]};return l===W.ShmetroBasic2020?b.color=o:l===W.GzmtrBasic?(b.color=o,b.lineCode=i,b.stationCode=h.num):l===W.GzmtrInt?b.transfer=g.map((C,M)=>{var B,U;const _=(U=(B=C.lines)==null?void 0:B.map(F=>{var oe;return[...(oe=F.theme)!=null?oe:o,"1","01"]}))!=null?U:[];return M===0?[[...o,i,h.num],..._]:_}):l===W.MTR&&((k=g[0].lines)!=null&&k.length?b.transfer=[[[...o,"",""],...g[0].lines.map(C=>{var M;return[...(M=C.theme)!=null?M:o,"",""]})]]:b.transfer=[[]]),{node:u[d],attr:{visible:!0,zIndex:0,x:n+x[d].x,y:p+x[d].y,type:l,[l]:b}}}).forEach(({node:d,attr:h})=>s.addNode(d,h)),Object.entries(t).filter(([d,h])=>!["linestart","lineend"].includes(d)).forEach(([d,h])=>{h.children.filter(l=>!["linestart","lineend"].includes(l)).forEach(l=>{const g=hs.Diagonal,[S,b]=[u[d],u[l]],w=c?Ft(s,g,S,b,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(ws(10)),S,b,{visible:!0,zIndex:0,type:g,[hs.Diagonal]:structuredClone(Ht[hs.Diagonal].defaultAttrs),style:Fs.SingleColor,[Fs.SingleColor]:{color:o},reconcileId:"",parallelIndex:w})})})},cr="rmg-bridge--",dr={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function hr(s){const{isOpen:a,onClose:i}=s,{t}=$(),{preference:{autoParallel:r}}=G(b=>b.app),{svgViewBoxZoom:o,svgViewBoxMin:n}=G(b=>b.param),p=H(),c=z.isAllowAnalytics(),u=Es(),{height:m,width:x}=Ns(u),d=Qe.useRef(window.graph),[h]=Qe.useState(crypto.randomUUID()),l="/rmg/#/import?"+new URLSearchParams({parentComponent:z.getAppName(),parentId:h}),g=Qe.useCallback(()=>{p(re(d.current.export())),p(xe()),p(ie())},[p,xe,ie,re,d]),S=b=>{try{c&&z.event(_e.IMPORT_RMG_PARAM,{});const w=n.x+x*o/100/3,y=n.y+m*o/100/3;lr(d.current,b,w,y,r),g()}catch(w){p(ns({status:"error",message:t("header.open.unknownError")})),ue.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",w)}finally{i()}};return Qe.useEffect(()=>{const b=new BroadcastChannel(cr+h);return b.onmessage=w=>{const{event:y,data:k}=w.data;ue.debug("[rmp] Received event from RMG app clip:",y),y==="CLOSE"?i():y==="IMPORT"&&S(k)},()=>b.close()},[n.x,n.y,o,m,x,r]),e.jsx(ht,{isOpen:a,onClose:i,sx:dr,children:e.jsx("iframe",{src:l,loading:"lazy"})})}const pr="RMP_GALLERY_CHANNEL",ur="OPEN_TEMPLATE",Qs=new BroadcastChannel(pr),gr={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function xr(s){const{isOpen:a,onClose:i}=s,{t}=$(),r=H(),{isOpen:o,onOpen:n,onClose:p}=nt(),[c,u]=j.useState(null),{telemetry:{project:m}}=G(w=>w.app),x=z.isAllowAnalytics(),d=j.useRef(window.graph),h=j.useCallback(()=>{r(re(d.current.export())),r(xe()),r(ie())},[r,xe,ie,re,d]),l=async w=>{const{version:y,images:k,...C}=JSON.parse(await pt(JSON.stringify(w)));r(bs()),d.current.clear(),d.current.import(C.graph),Array.isArray(k)&&k.length>0&&await ut(d.current,k),r(Cs()),h();const{svgViewBoxZoom:M,svgViewBoxMin:_}=C;typeof M=="number"&&r(Ne(M)),typeof _.x=="number"&&typeof _.y=="number"&&r(He(_))},g=async()=>{c&&await l(c),p(),u(null)},S=async(w,y)=>{var M;const k=y?"https://".concat(y):"",C=await((M=(await Promise.allSettled([fetch("".concat(k,"/rmp-gallery/resources/real_world/").concat(w,".json")),fetch("".concat(k,"/rmp-gallery/resources/fantasy/").concat(w,".json"))])).filter(_=>_.status==="fulfilled").find(_=>_.value.status===200))==null?void 0:M.value.json());if(C){if(u(C),n(),x){const _={id:w};m&&y&&(_.host=y),z.event(_e.IMPORT_WORK_FROM_GALLERY,_)}z.sendNotification({title:t("header.open.importOK",{id:w}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}else z.sendNotification({title:t("header.open.importFail",{id:w}),message:t("header.open.importFailContent"),type:"error",duration:9e3})},b=async w=>{try{const y=await fetch("".concat(Vt,"/").concat(w));if(y.status!==200)throw new Error(t("header.open.importFailContent"));const k=await y.json();u(k),n(),x&&z.event(_e.IMPORT_WORK_FROM_SHARE,{share:w}),z.sendNotification({title:t("header.open.importOK",{id:w}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}catch(y){z.sendNotification({title:t("header.open.importFail",{id:w}),message:y.message,type:"error",duration:9e3})}};return j.useEffect(()=>{const y=new URL(window.location.href).searchParams;if(y.size>0){const k=y.keys().next().value,C=k.indexOf("."),M=k.substring(0,C===-1?void 0:C);let _;C!==-1&&(_=k.substring(C+1)),_==="org"?b(M):S(M,_),z.updateAppMetadata({search:""})}},[]),j.useEffect(()=>(Qs.onmessage=w=>{const{event:y,data:k}=w.data;y===ur&&(S(k),i())},()=>Qs.close()),[]),e.jsxs(e.Fragment,{children:[e.jsxs(ht,{isOpen:a,onClose:i,size:"full",sx:gr,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(rt,{onClick:i,position:"fixed",top:"5px",right:"15px"})]}),e.jsx(wt,{isOpen:o,onClose:p,onConfirm:g})]})}function mr(){const s=H(),{t:a}=$(),{isOpen:i,onOpen:t,onClose:r}=nt(),[o,n]=j.useState(null),p=Es(),{height:c}=Ns(p),u=j.useRef(window.graph),m=j.useRef(null),[x,d]=j.useState(!1),[h,l]=j.useState(!1),g=j.useCallback(()=>{s(re(u.current.export())),s(xe()),s(ie())},[s,xe,ie,re,u]),S=()=>{s(bs()),u.current.clear(),s(Ne(100)),s(He({x:0,y:0})),g()},b=async C=>{const{version:M,images:_,...B}=JSON.parse(await pt(C));s(bs()),u.current.clear(),u.current.import(B.graph),Array.isArray(_)&&_.length>0&&await ut(u.current,_),s(Cs()),g();const{svgViewBoxZoom:U,svgViewBoxMin:F}=B;typeof U=="number"&&s(Ne(U)),typeof F.x=="number"&&typeof F.y=="number"&&s(He(F))},w=async()=>{if(o){await b(o);const C=await Ys();if(o.length===C.length){s(He({x:-10,y:-13}));const M=Math.max(0,Math.min(400,-.132*c+117.772));s(Ne(M)),await s(Cs()),z.event(_e.LOAD_TUTORIAL,{})}}r(),n(null)},y=async C=>{var _;const M=(_=C.target.files)==null?void 0:_[0];if(ue.debug("OpenActions.handleUpload():: received file",M),(M==null?void 0:M.type)!=="application/json")s(ns({status:"error",message:a("header.open.invalidType")})),ue.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const B=await fr(M);n(B),t()}catch(B){s(ns({status:"error",message:a("header.open.unknownError")})),ue.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",B)}C.target.value=""},k=async()=>{const C=await Ys();n(C),t()};return j.useEffect(()=>{const C=async M=>{const{type:_,key:B,from:U}=M.data;if(_===Jt.SAVE_CHANGED&&B===Ks.PARAM&&U==="rmt"){ue.debug("Received save changed event on key: ".concat(B));const F=localStorage.getItem(Ks.PARAM);if(!F)return;await b(F)}};return Hs.addEventListener("message",C),()=>Hs.removeEventListener("message",C)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(As,{children:[e.jsx(Ts,{as:ne,size:"sm",variant:"ghost",icon:e.jsx(Vs,{})}),e.jsxs(zs,{children:[e.jsx(pe,{icon:e.jsx(Yt,{}),onClick:S,children:a("header.open.new")}),e.jsx("input",{id:"upload_project",ref:m,type:"file",accept:".json",hidden:!0,onChange:y,"data-testid":"file-upload"}),e.jsx(pe,{icon:e.jsx(Vs,{}),onClick:()=>{var C;return(C=m==null?void 0:m.current)==null?void 0:C.click()},children:a("header.open.config")}),e.jsx(pe,{icon:e.jsx(Kt,{}),onClick:()=>d(!0),children:a("header.open.projectRMG")}),e.jsxs(pe,{icon:e.jsx(L,{}),onClick:()=>l(!0),children:[a("header.open.gallery"),e.jsx(te,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(pe,{icon:e.jsx(Zt,{}),onClick:k,children:a("header.open.tutorial")})]}),e.jsx(hr,{isOpen:x,onClose:()=>d(!1)}),e.jsx(xr,{isOpen:h,onClose:()=>l(!1)})]}),e.jsx(wt,{isOpen:i,onClose:r,onConfirm:w})]})}const fr=s=>new Promise(a=>{const i=new FileReader;i.onloadend=()=>a(i.result),i.readAsText(s)}),jr=()=>{const[s,a]=j.useState(!1),{t:i}=$(),t=H(),r=j.useRef(window.graph),o=Es(),{width:n,height:p}=Ns(o),[c,u]=j.useState([]);j.useEffect(()=>{s&&u(r.current.nodes().filter(x=>x.startsWith("stn")).map(x=>{const d=r.current.getNodeAttributes(x),h=d.type,l=d[h].names.join("/");return{id:x,value:l}}))},[s]);const m=x=>{t(en(new Set([x])));const d=Math.max(0,Math.min(400,-.132*p+117.772)),{x:h,y:l}=sn((n-300)/2,p/2,d,{x:-r.current.getNodeAttribute(x,"x"),y:-r.current.getNodeAttribute(x,"y")});t(Ne(d)),t(He({x:-h,y:-l}))};return e.jsxs(it,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(ot,{children:e.jsx(ne,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Xt,{}),onClick:()=>a(!s)})}),e.jsx(at,{children:e.jsx(lt,{children:e.jsx(qt,{label:i("header.search"),children:e.jsx(Qt,{data:c,displayHandler:x=>e.jsx(te,{children:x.value}),filter:(x,d)=>d.value.toLowerCase().includes(x.toLowerCase())||Object.values(d.value).some(h=>h.toLowerCase().includes(x.toLowerCase())),value:"",onChange:x=>m(x.id)})})})})]})},wr=s=>{const{isOpen:a,onClose:i}=s,t=H(),{t:r}=$(),o=j.useRef(window.graph),{theme:n,requestThemeChange:p}=tn(),c=()=>{o.current.filterEdges((u,m,x,d,h,l,g)=>ct.has(m.style)&&JSON.stringify(m[m.style].color)===JSON.stringify(n)).forEach(u=>o.current.dropEdge(u)),t(re(o.current.export())),t(ie()),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(se,{}),e.jsxs(X,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(nn,{theme:n,onClick:p})]}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:c,children:r("remove")})]})]})]})},br=s=>{const{isOpen:a,onClose:i}=s,t=H(),{t:r}=$(),o=j.useRef(window.graph),[n,p]=j.useState(1),c=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:n.toString(),variant:"number",onChange:m=>p(Number(m)),minW:"full"}],u=()=>{o.current.forEachNode((m,x)=>{o.current.updateNodeAttribute(m,"x",d=>(d!=null?d:0)*n),o.current.updateNodeAttribute(m,"y",d=>(d!=null?d:0)*n)}),t(re(o.current.export())),t(xe()),t(ie()),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:r("header.settings.procedures.scale.title")}),e.jsx(se,{}),e.jsxs(X,{children:[r("header.settings.procedures.scale.content"),e.jsx(Ee,{fields:c})]}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:u,children:r("apply")})]})]})]})},Sr=s=>{const{isOpen:a,onClose:i}=s,t=H(),{t:r}=$(),o=j.useRef(window.graph),[n,p]=j.useState(0),[c,u]=j.useState(0),m=[{type:"input",label:r("header.settings.procedures.translate.x"),value:n.toString(),variant:"number",onChange:d=>p(Number(d)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:c.toString(),variant:"number",onChange:d=>u(Number(d)),minW:"full"}],x=()=>{o.current.forEachNode((d,h)=>{o.current.updateNodeAttribute(d,"x",l=>(l!=null?l:0)+n),o.current.updateNodeAttribute(d,"y",l=>(l!=null?l:0)+c)}),t(re(o.current.export())),t(xe()),t(ie()),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:r("header.settings.procedures.translate.title")}),e.jsx(se,{}),e.jsxs(X,{children:[r("header.settings.procedures.translate.content"),e.jsx(Ee,{fields:m})]}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:x,children:r("apply")})]})]})]})},yr=s=>{const{isOpen:a,onClose:i}=s,t=H(),{preference:{unlockSimplePathAttempts:r}}=G(c=>c.app),{activeSubscriptions:o}=G(c=>c.account),{t:n}=$(),p=()=>{t(rn(-1))};return e.jsxs(Q,{isOpen:a,onClose:i,size:"5xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:n("header.settings.procedures.unlockSimplePath.title")}),e.jsx(se,{}),e.jsxs(X,{children:[e.jsx(f,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(f,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(f,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(me,{children:e.jsx(Te,{label:n("header.settings.pro"),isOpen:!o.RMP_CLOUD&&r>=0,children:e.jsx(I,{onClick:p,isDisabled:!o.RMP_CLOUD||r<0,children:r>=0?n("header.settings.procedures.unlockSimplePath.check"):n("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},Cr=s=>{const{isOpen:a,onClose:i}=s,t=H(),r=Tt(),{t:o}=$(),n=j.useRef(window.graph),[p,c]=j.useState(!1),u=async()=>{c(!0);const m=JSON.stringify(n.current.export());try{const x=await kr(m);n.current.clear(),n.current.import(x),t(re(n.current.export())),t(xe()),t(ie()),r({title:o("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(x){ue.error("[rmp] Error in updating all colors: ".concat(x)),r({title:o("header.settings.procedures.updateColor.error",{e:x}),status:"error",duration:9e3,isClosable:!0})}c(!1),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:o("header.settings.procedures.updateColor.title")}),e.jsx(se,{}),e.jsx(X,{children:e.jsx(f,{children:o("header.settings.procedures.updateColor.content")})}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:o("cancel")}),e.jsx(I,{colorScheme:"red",onClick:u,isLoading:p,children:o("apply")})]})]})]})},et=s=>s.length>=4&&s.every(a=>typeof a=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(Rs).includes(s[3]),vr=s=>{const a=[],i=(t,r)=>{if(Array.isArray(t)&&et(t)){a.push({path:r||"",value:t});return}for(const o in t){const n=t[o],p=r?"".concat(r,".").concat(o):o;Array.isArray(n)?et(n)?a.push({path:p,value:n}):n.forEach((c,u)=>i(c,"".concat(p,".").concat(u))):n&&typeof n=="object"&&i(n,p)}};return i(s),a},_r=(s,a,i)=>{const t=a.split(".");let r=s;for(let o=0;o<t.length-1;o++)r=r[t[o]];r[t[t.length-1]]=i},kr=async s=>{const a=JSON.parse(s),i=new Date().getTime(),t=vr(a);ue.debug("[rmp] Found all themes pending for update",t);const r=1e4;let o,n=!1;const p=new Promise((c,u)=>{o=setTimeout(()=>{n=!0,u("Executing time exceeds ".concat(r,"ms"))},r),(async()=>{for(const{path:m,value:x}of t){if(n)throw new Error("Update aborted");const[d,h,l,g,...S]=x,b=await on([d,h,l,g]);_r(a,m,[...b,...S])}})().then(c).catch(u)});try{return await p,ue.debug("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-i)/1e3," sec")),a}finally{clearTimeout(o)}},st=1,Mr=()=>{const s=H(),{state:a,token:i}=G(g=>g.account),{count:{stations:t,miscNodes:r,masters:o,lines:n,parallel:p}}=G(g=>g.runtime),{t:c}=$(),[u,m]=j.useState(!1),[x,d]=j.useState(st);j.useEffect(()=>{let g;return u&&x>0?g=window.setTimeout(()=>{d(x-1)},1e3):x===0&&m(!1),()=>clearTimeout(g)},[u,x]);const h=()=>{m(!0),d(st),i&&ln(s,i)},l={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),e.jsxs(E,{mt:"3",children:[e.jsxs(E,{mb:"1",children:[e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:c("header.settings.status.count.stations")}),e.jsx(f,{children:t})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:c("header.settings.status.count.miscNodes")}),e.jsx(f,{children:r})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:c("header.settings.status.count.masters")}),e.jsx(f,{children:o})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:c("header.settings.status.count.lines")}),e.jsx(f,{children:n})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:c("header.settings.status.count.parallel")}),e.jsx(f,{children:p})]})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsxs(f,{flex:"1",children:[c("header.settings.status.subscription.content")," ",l[a]]}),e.jsx(ne,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(an,{}),isDisabled:u,onClick:()=>h()})]})]})]})},Ce={width:"100%",justifyContent:"space-between"},he={fontFamily:"-apple-system"},Or=s=>{const{isOpen:a,onClose:i}=s,{activeSubscriptions:t}=G(T=>T.account),{telemetry:{project:r},preference:{autoParallel:o,randomStationsNames:n,gridLines:p,snapLines:c,predictNextNode:u,autoChangeStationType:m}}=G(T=>T.app),{keepLastPath:x,count:{parallel:d}}=G(T=>T.runtime),h=H(),{t:l}=$(),g=tt("primary.500","primary.300"),[S,b]=j.useState(!1),[w,y]=j.useState(!1),[k,C]=j.useState(!1),[M,_]=j.useState(!1),[B,U]=j.useState(!1),[F,oe]=j.useState(!1),[Ie,Le]=j.useState(!1),is=z.isAllowAnalytics(),Ke=T=>{h(yn(T))},De=t.RMP_CLOUD?cn:dn,Ze=d>=De,Pe=!t.RMP_CLOUD,Je=T=>{h(Sn(T.target.value))};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:l("header.settings.title")}),e.jsx(se,{}),e.jsx(X,{children:e.jsxs(ze,{divider:e.jsx(It,{borderColor:"gray.200"}),children:[e.jsx(Mr,{}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:l("header.settings.preference.title")}),e.jsxs(ze,{spacing:"0",mt:"3",align:"stretch",children:[e.jsxs(q,{mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.preference.keepLastPath")}),e.jsx(fe,{isChecked:x,onChange:({target:{checked:T}})=>h(hn(T))})]}),e.jsxs(q,{mb:"1",children:[e.jsx(f,{children:l("header.settings.preference.autoParallel")}),e.jsx(te,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(Te,{label:l("header.settings.proWithTrial"),children:e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(fe,{ml:"1",isDisabled:Ze,isChecked:o,onChange:({target:{checked:T}})=>h(pn(T))})]}),e.jsxs(q,{mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.preference.randomStationNames.title")}),e.jsx(te,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(Te,{label:l("header.settings.pro"),children:e.jsx(te,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(zt,{size:"xs",width:"auto",ml:"1",value:n,onChange:Je,children:[e.jsx("option",{value:"none",children:l("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:qe.Shmetro,disabled:Pe,children:l("header.settings.preference.randomStationNames.".concat(qe.Shmetro))}),e.jsx("option",{value:qe.Bjsubway,disabled:Pe,children:l("header.settings.preference.randomStationNames.".concat(qe.Bjsubway))})]})]}),e.jsxs(q,{mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.preference.gridline")}),e.jsx(fe,{isChecked:p,onChange:({target:{checked:T}})=>h(un(T))})]}),e.jsxs(q,{mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.preference.snapline")}),e.jsx(fe,{isChecked:c,onChange:({target:{checked:T}})=>h(gn(T))})]}),e.jsxs(q,{mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.preference.predictNextNode")}),e.jsx(fe,{isChecked:u,onChange:({target:{checked:T}})=>h(xn(T))})]}),e.jsxs(q,{mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.preference.autoChangeStationType")}),e.jsx(fe,{isChecked:m,onChange:({target:{checked:T}})=>h(mn(T))})]})]})]}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:l("header.settings.procedures.title")}),e.jsxs(E,{mt:"3",children:[e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>b(!0),children:l("header.settings.procedures.translate.title")}),e.jsx(Sr,{isOpen:S,onClose:()=>b(!1)}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>y(!0),children:l("header.settings.procedures.scale.title")}),e.jsx(br,{isOpen:w,onClose:()=>y(!1)}),e.jsxs(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>C(!0),children:[l("header.settings.procedures.changeType.title"),e.jsx(Te,{label:l("header.settings.pro"),children:e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(Gn,{isOpen:k,onClose:()=>C(!1),isSelect:!1}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>_(!0),children:l("header.settings.procedures.removeLines.title")}),e.jsx(wr,{isOpen:M,onClose:()=>_(!1)}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>U(!0),children:l("header.settings.procedures.updateColor.title")}),e.jsx(Cr,{isOpen:B,onClose:()=>U(!1)}),e.jsxs(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>oe(!0),children:[l("header.settings.procedures.unlockSimplePath.title"),e.jsx(Te,{label:l("header.settings.pro"),children:e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(yr,{isOpen:F,onClose:()=>oe(!1)}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>Le(!0),children:l("header.settings.procedures.masterManager.title")}),e.jsx(Wn,{isOpen:Ie,onClose:()=>Le(!1)})]})]}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:l("header.settings.shortcuts.title")}),e.jsx(E,{mt:"3",children:e.jsxs(Rt,{children:[e.jsx(Et,{children:e.jsxs(V,{children:[e.jsx($s,{children:l("header.settings.shortcuts.keys")}),e.jsx($s,{children:l("header.settings.shortcuts.description")})]})}),e.jsxs(Nt,{children:[e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(O,{children:"f"})}),e.jsx(R,{children:l("header.settings.shortcuts.f")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(O,{children:"s"})}),e.jsx(R,{children:l("header.settings.shortcuts.s")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(O,{children:"c"})}),e.jsx(R,{children:l("header.settings.shortcuts.c")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(E,{display:"flex",flexDirection:"row",children:[e.jsx(fn,{}),e.jsx(jn,{}),e.jsx(wn,{}),e.jsx(bn,{})]})}),e.jsx(R,{children:l("header.settings.shortcuts.arrows")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(E,{display:"flex",flexDirection:"row",children:[e.jsx(O,{children:"i"}),e.jsx(O,{children:"j"}),e.jsx(O,{children:"k"}),e.jsx(O,{children:"l"})]})}),e.jsx(R,{children:l("header.settings.shortcuts.ijkl")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsx(O,{sx:he,children:"⇧"}):e.jsx(O,{children:"shift"})}),e.jsx(R,{children:l("header.settings.shortcuts.shift")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsx(O,{sx:he,children:"⌥"}):e.jsx(O,{children:"alt"})}),e.jsx(R,{children:l("header.settings.shortcuts.alt")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsx(O,{sx:he,children:"⌫"}):e.jsx(O,{children:"delete"})}),e.jsx(R,{children:l("header.settings.shortcuts.delete")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"x"})]}),e.jsx(R,{children:l("header.settings.shortcuts.cut")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"c"})]}),e.jsx(R,{children:l("header.settings.shortcuts.copy")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"v"})]}),e.jsx(R,{children:l("header.settings.shortcuts.paste")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"z"})]}),e.jsx(R,{children:l("header.settings.shortcuts.undo")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:he,children:"⇧"})," + ",e.jsx(O,{sx:he,children:"⌘"})," + ",e.jsx(O,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"y"})]})}),e.jsx(R,{children:l("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:l("header.settings.telemetry.title")}),e.jsxs(E,{mt:"3",children:[e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.info")}),e.jsxs(E,{mt:"3",mb:"1",children:[e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:l("header.settings.telemetry.essential")}),e.jsx(Te,{label:l("header.settings.telemetry.essentialTooltip"),children:e.jsx(fe,{isChecked:is,isDisabled:!0})})]}),e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.essentialInfo")}),e.jsxs(N,{color:g,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[l("header.settings.telemetry.essentialLink")," ",e.jsx(P,{as:L})]})]}),e.jsxs(E,{mt:"1",mb:"1",children:[e.jsxs(E,{display:"flex",children:[e.jsx(f,{flex:"1",children:l("header.settings.telemetry.additional")}),e.jsx(fe,{isChecked:r,onChange:({target:{checked:T}})=>Ke(T)})]}),e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},Ar=()=>{const[s,a]=j.useState(!1),{svgViewBoxZoom:i}=G(o=>o.param),t=H(),r=[{type:"slider",label:"",value:400-i,min:10,max:390,step:1,onChange:o=>t(Ne(400-o)),leftIcon:e.jsx(Cn,{}),rightIcon:e.jsx(Zs,{}),minW:160}];return e.jsxs(it,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(ot,{children:e.jsx(ne,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Zs,{}),onClick:()=>a(!s)})}),e.jsx(at,{children:e.jsx(lt,{children:e.jsx(Ee,{fields:r,noLabel:!0})})})]})};function Tr(){const{t:s}=$(),a=H(),{past:i,future:t}=G(g=>g.param),r=z.isAllowAnalytics(),[o,n]=j.useState(!1),[p,c]=j.useState(!1),u=Xs(z.getEnv),m=Xs(z.getAppVersion),x=vn();j.useEffect(()=>{r&&u!==ps.DEV&&z.event(_e.APP_LOAD,{isStandaloneWindow:z.isStandaloneWindow()})},[u]);const d=g=>{z.getI18nInstance().changeLanguage(g)},h=()=>{a(En())},l=()=>{a(Nn())};return e.jsxs(_n,{children:[e.jsxs(js,{direction:x==="landscape"?"row":"column",width:"100%",children:[e.jsxs(q,{height:"32px",children:[e.jsx(Ae,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(kn,{environment:u,version:m,popoverHeader:u===ps.PRD?void 0:e.jsxs(Ss,{i18nKey:"header.popoverHeader",environment:u,children:["You're on ",{environment:u}," environment!"]}),popoverBody:u===ps.PRD?void 0:e.jsx(Ss,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),e.jsxs(q,{overflowX:"auto",ml:x==="landscape"?"auto":void 0,children:[e.jsx(jr,{}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(Mn,{}),isDisabled:i.length===0,onClick:h}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(On,{}),isDisabled:t.length===0,onClick:l}),e.jsx(Ar,{}),e.jsx(mr,{}),e.jsx(ar,{}),z.isStandaloneWindow()&&e.jsxs(As,{children:[e.jsx(Ts,{as:ne,icon:e.jsx(An,{}),variant:"ghost",size:"sm"}),e.jsx(zs,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(g=>e.jsx(pe,{onClick:()=>d(g),children:Tn[g][g]},g))})]}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(zn,{}),onClick:()=>n(!0)}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Rn,{}),onClick:()=>c(!0)})]})]}),e.jsx(Or,{isOpen:o,onClose:()=>n(!1)}),e.jsx($n,{isOpen:p,onClose:()=>c(!1)})]})}function zr(){const s=H(),a=G(t=>t.runtime.globalAlerts),i=t=>{z.isStandaloneWindow()?window.open("/".concat(t),"_blank"):z.openApp({appId:t})};return e.jsx(e.Fragment,{children:Object.entries(a).map(([t,{message:r,url:o,linkedApp:n}])=>e.jsxs(ss,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(ts,{}),n?e.jsx(N,{onClick:()=>i(n),children:r}):o?e.jsx(N,{href:o,target:"_blank",children:r}):r,e.jsx(rt,{ml:"auto",onClick:()=>s(In(t))})]},t))})}function Pr(){return e.jsxs(e.Fragment,{children:[e.jsx(Tr,{}),e.jsx(zr,{})]})}export{Pr as default};
