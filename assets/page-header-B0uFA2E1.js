import{j as e,ah as le,M as se,ai as ce,K as te,L as de,N as X,h as Os,aj as Ut,O as j,B as L,ak as Fe,al as Ae,T as je,am as be,b as we,q as ys,v as D,Q as oe,an as Kt,ao as Yt,ap as Be,U as W,aq as H,R as bt,ar as Bs,as as Gs,a3 as pe,at as $s,au as ue,y as ge,av as Ss,aw as J,V as us,X as ps,Y as Cs,Z as Xs,H as Jt,J as Zt,ax as qs,n as wt,a9 as yt,e as St,x as Ct,m as vt,G as At,ay as Xt,a8 as ye,az as ls,a2 as qt,aA as Qt,aB as en,aC as Y,aD as Qs,aE as sn,aF as R,aG as O,aH as tn}from"./chakra-BZH9ddpD.js";import{u as nn,r as I,C as Ce,M as re,n as Me,d as Tt,S as _,R as et,a as zt,b as $,c as q,e as K,f as rn,g as on,h as an,i as ln,j as Ze,k as Ne,E as De,s as cn,l as gs,m as dn,o as st,p as ts,L as G,q as Ee,t as ve,T as hn,v as un,w as ie,x as me,y as ae,z as xs,A as xe,B as Le,D as He,F as pn,G as Fs,H as Vs,I as _t,J as gn,K as Mt,N as tt,O as nt,P as xn,Q as mn,U as fn,V as rt,W as ot,X as jn,Y as it,Z as bn,_ as wn,$ as yn,a0 as Sn,a1 as Cn,a2 as vn,a3 as An,a4 as Tn,a5 as zn,a6 as _n,a7 as Mn,a8 as On,a9 as kn,aa as Rn,ab as cs,ac as En,ad as In,ae as Nn,af as Ln,ag as Dn,ah as Ge,ai as Pn,aj as Wn,ak as Bn,al as Gn,am as _e,an as $n,ao as Fn,ap as at,aq as Vn,ar as Hn,as as vs,at as Un,au as Kn,av as Yn,aw as Jn,ax as Zn,ay as Xn,az as qn,aA as Qn,aB as er,aC as sr,aD as tr}from"./index-CA0nMqc4.js";import{u as U,b as f,T as ks,a as ds}from"./react-CLIJjNOF.js";import{d as Rs,r as nr,i as lt,m as rr,a as or,s as Ot,b as ir,c as kt,p as Es,M as ar}from"./misc-nodes-ChWFCqYU.js";import{a as lr,b as Rt,c as cr,d as ct}from"./change-types-CHEEQkZx.js";import{C as dr}from"./change-type-modal-Cavl1taU.js";var dt=function(s){return nn(I.ready(),s)};const hr=s=>{const{isOpen:n,onClose:r}=s,{t}=U(),a=I.getAppVersion();return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:t("header.about.title")}),e.jsx(de,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(Os,{direction:"row",children:[e.jsx(Ut,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(Os,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(j,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),e.jsx(j,{children:a}),e.jsx(j,{}),e.jsx(j,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e.jsx(L,{margin:5,children:e.jsx(j,{fontSize:"xl",children:t("header.about.desc")})}),e.jsx(Fe,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e.jsx(Fe,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e.jsxs(Ae,{children:[e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(j,{fontSize:"sm",children:t("header.about.content1")}),e.jsx(j,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(j,{fontSize:"sm",children:t("header.about.langonginc")}),e.jsx(j,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Fe,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),e.jsxs(Ae,{children:[e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(j,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(j,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(j,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),e.jsx(Fe,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),e.jsxs(Ae,{children:[e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e.jsx(j,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e.jsx(j,{fontSize:"sm",children:t("header.about.slackContent")}),e.jsx(j,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Fe,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),e.jsxs(Ae,{children:[e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",pb:1,children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),e.jsx(j,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),e.jsxs(je,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(be,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(we,{display:"block",width:"100%",pb:1,children:[e.jsx(j,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),e.jsx(j,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function es(s){const n=s.sizes.shift(),r=Math.max(Math.ceil(n[0]),1),t=Math.max(Math.ceil(n[1]),1),a=[r-1,t-1,1,1],i=performance.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let l,c;o?(l=new OffscreenCanvas(1,1),c=new OffscreenCanvas(r,t)):(l=document.createElement("canvas"),l.width=1,l.height=1,c=document.createElement("canvas"),c.width=r,c.height=t);const x=l.getContext("2d"),m=c.getContext("2d");m&&(m.fillRect.apply(m,a),x.drawImage(c,r-1,t-1,1,1,0,0,1,1));const u=x&&x.getImageData(0,0,1,1).data[3]!==0,h=parseInt(performance.now()-i);return[l,c].forEach((p=>{p.height=0,p.width=0})),o?(postMessage({width:r,height:t,testTime:h,isTestPass:u}),!u&&s.sizes.length&&setTimeout((()=>{es(s)}),0)):u?s.onSuccess({width:r,height:t,testTime:h}):(s.onError({width:r,height:t,testTime:h}),s.sizes.length&&setTimeout((()=>{es(s)}),0)),u}const As={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Ve={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Xe={};function Ts(s){const n=s.width===s.height,r=s.height===1,t=s.width===1,a=[];if(!s.width||!s.height)s.sizes.forEach((i=>{const o=n||r?i:1,l=n||t?i:1;a.push([o,l])}));else{const i=s.min||Ve.min,o=s.step||Ve.step;let l=Math.max(s.width,s.height);for(;l>=i;){const c=n||r?l:1,x=n||t?l:1;a.push([c,x]),l-=o}}return a}function hs(s){const n=typeof window<"u",r=n&&"Promise"in window,t=n&&"HTMLCanvasElement"in window,a=n&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),o=performance.now(),{onError:l,onSuccess:c,...x}=s,m=()=>parseInt(performance.now()-o);let u=null;if(!t)return!1;if(s.useWorker&&a){const h="\n            var canvasTest = ".concat(es.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),p=new Blob([h],{type:"application/javascript"}),g=URL.createObjectURL(p);u=new Worker(g),URL.revokeObjectURL(g),u.onmessage=function(d){const{width:b,height:w,testTime:y,isTestPass:T}=d.data,C={width:b,height:w,testTime:y,totalTime:m()};T?(Xe[i].onSuccess(C),delete Xe[i]):Xe[i].onError(C)}}if(r)return new Promise((h=>{const p={...s,onError(g){let{width:d,height:b,testTime:w}=g;const y={width:d,height:b,testTime:w,totalTime:m()};let T;if(s.sizes.length===0)T=!0;else{const[[C,A]]=s.sizes.slice(-1);T=d===C&&b===A}l(y),T&&h({...y,success:!1})},onSuccess(g){let{width:d,height:b,testTime:w}=g;const y={width:d,height:b,testTime:w,totalTime:m()};c(y),h({...y,success:!0})}};if(u){const{onError:g,onSuccess:d}=p;Xe[i]={onError:g,onSuccess:d},u.postMessage(x)}else es(p)}));if(u)Xe[i]={onError:l,onSuccess:c},u.postMessage(x);else return es(s)}const ur={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Ts({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...As.area]}),r={...Ve,...s,sizes:n};return hs(r)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Ts({width:1,height:s.max,min:s.min,step:s.step,sizes:[...As.height]}),r={...Ve,...s,sizes:n};return hs(r)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Ts({width:s.max,height:1,min:s.min,step:s.step,sizes:[...As.width]}),r={...Ve,...s,sizes:n};return hs(r)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={...Ve,...s};return n.sizes=[...n.sizes],n.width&&n.height&&(n.sizes=[[n.width,n.height]]),hs(n)}};var rs=(s=>(s.left="l",s.right="r",s))(rs||{}),Ie=(s=>(s.through="through",s.nonThrough="nonthrough",s))(Ie||{}),fs=(s=>(s.local="local",s.express="express",s.direct="direct",s))(fs||{}),Oe=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(Oe||{}),Hs=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Hs||{});const Te=new Set,Is=new Set,Ns=new Set,Ls=new Set,Et=new Map,ke=new Map,zs=new Set,_s=new Map,ee=new Map;let V=[],qe=0;const Qe=new Map,Ms=new Map,Ds=new Set,pr={localisedName:{en:"LEFT END"},num:"00",services:[fs.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:rs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},gr={localisedName:{en:"RIGHT END"},num:"00",services:[fs.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:rs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},xr={},It={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:Oe.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:rs.right,platform_num:"1",theme:[Ce.Shanghai,"sh1","#E3002B",re.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:xr,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Hs.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},mr={localisedName:{},num:"",services:[fs.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:rs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},E=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),Us=s=>Tt.has(s),fr=s=>{if(Us(s.style))return structuredClone(s[s.style].color)},jr=(s,n)=>{const[r,t]=s.extremities(n),a=s.getEdgeAttributes(n),i=a.style;if(r!=t&&Us(i)){const o=fr(a);Ls.has(E(o))||(Ns.add(o),Ls.add(E(o)),Et.set(o,r),ke.set(E(o),new Set)),ke.get(E(o)).add(r),ke.get(E(o)).add(t),ee.has(r)?V.push({target:t,next:ee.get(r),color:o}):V.push({target:t,next:-1,color:o}),ee.set(r,qe),qe++,ee.has(t)?V.push({target:r,next:ee.get(t),color:o}):V.push({target:r,next:-1,color:o}),ee.set(t,qe),qe++}},Nt=(s,n,r)=>{if(ke.get(E(r)).has(s)){ke.get(E(r)).delete(s);for(let t=ee.get(s);t!=-1;t=V[t].next){const a=V[t].target,i=V[t].color;E(i)==E(r)&&Nt(a,s,r)}}},Lt=(s,n,r)=>{if(Te.has(s))return;Te.add(s);let t=0;const a=new Set;for(let i=ee.get(s);i!=-1;i=V[i].next){const o=V[i].target,l=V[i].color;E(l)==E(r)&&(a.has(o)||(a.add(o),t++,o!=n&&Lt(o,s,r)))}Qe.set(s,t)},ht=(s,n)=>{const r=s.stn_list.lineend.parents;r.push(n),s.stn_list.lineend.parents=structuredClone(r).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[Ie.through,r[1]]:void 0}},br=(s,n)=>{let r=0;for(let t=ee.get(s);t!=-1;t=V[t].next){V[t].target;const a=V[t].color;E(a)==E(n)&&r++}return r},Dt=(s,n,r)=>{if(Ds.has(s))return[];Ds.add(s);const t=[];for(let a=ee.get(s);a!=-1;a=V[a].next){const i=V[a].target,o=V[a].color;i!=n&&E(o)==E(r)&&(i.startsWith("stn")?t.push(i):t.push(...Dt(i,s,r)))}return t},Ps=(s,n,r,t,a,i,o)=>{var h;if(Te.has(s)&&(!s.startsWith("misc_node_")&&o.stn_list[s]==null||s.startsWith("misc_node_")&&!Is.has(s)||o.loop))return[];if(Te.has(s)&&o.stn_list[s]!=null&&br(s,i)-1>=2){const p=[...o.stn_list[s].parents,n];if(o.stn_list[p[1]]==null){const b=p[0];p[0]=p[1],p[1]=b}o.stn_list[s].parents=structuredClone(p).reverse(),o.stn_list[s].branch={...o.stn_list[s].branch,left:[Ie.through,p[1]]};const g=[];for(const b of o.stn_list[s].children)b!=n&&g.push(b);o.stn_list[s].children=structuredClone(g),(h=o.stn_list[s].branch)==null||delete h.right;const d=[];for(const b of o.stn_list.lineend.parents)b!=s&&d.push(b);return o.stn_list.lineend.parents=structuredClone(d).reverse(),o.stn_list.lineend.branch={...o.stn_list.lineend.branch,left:o.stn_list.lineend.parents.length==2?[Ie.through,d[1]]:void 0},g.length==0&&(o.stn_list[s].children=["lineend"],ht(o,s)),[s]}Te.add(s);const l=[],c=[],x=[],m=new Set,u=new Set;for(let p=ee.get(s);p!=-1;p=V[p].next){const g=V[p].target,d=V[p].color;if(g!=r){if(E(d)==E(i)){if(u.has(g))continue;if(u.add(g),s.startsWith("misc_node_")){const b=Ps(g,n,s,t+1,a,i,o);b.length!=0&&l.push(...b)}else{const b=Ps(g,s,s,t+1,a,i,o);b.length!=0&&l.push(...b)}}if(!m.has(E(d))&&E(d)!=E(i)){m.add(E(d));const b={theme:d,name:["ch_".concat(E(d)),"en_".concat(E(d))]};x.push(b)}}}if(l.length==2){for(let p=0;p<2;p++)l[p]=="lineend"&&l.splice(p,1);if(o.stn_list[l[1]].parents.length>=2){const p=l[0];l[0]=l[1],l[1]=p}}if(Te.has(s)&&o.stn_list[s]!=null){const p=[];for(const g of o.stn_list.lineend.parents)g!=s&&p.push(g);o.stn_list.lineend.parents=structuredClone(p).reverse(),o.stn_list.lineend.branch={...o.stn_list.lineend.branch,left:o.stn_list.lineend.parents.length==2?[Ie.through,p[1]]:void 0},l.length==0&&(Ds.clear(),c.push(...Dt(s,n,i)))}if(s.startsWith("misc_node_"))return Is.add(s),l;{const p=a.getNodeAttributes(s).type,g=a.getNodeAttributes(s)[p];if(o.stn_list[s]=structuredClone(mr),o.stn_list[s].localisedName={zh:g.names[0],en:g.names[1]},o.stn_list[s].num=String(t),a.getNodeAttributes(s).type==_.GzmtrBasic){const d=g;o.stn_list[s].num=d.stationCode,(d.secondaryNames[0]!==""||d.secondaryNames[1]!=="")&&(o.stn_list[s].localisedSecondaryName={zh:d.secondaryNames[0],en:d.secondaryNames[1]})}if(a.getNodeAttributes(s).type==_.GzmtrInt){const d=g,b=d.transfer[0];for(const w of b)if(E(w)==E(i)){o.stn_list[s].num=String(w[5]);break}(d.secondaryNames[0]!==""||d.secondaryNames[1]!=="")&&(o.stn_list[s].localisedSecondaryName={zh:d.secondaryNames[0],en:d.secondaryNames[1]})}return l.length!=0?(o.stn_list[s].children=structuredClone(l).reverse(),l.length==2&&(o.stn_list[s].branch={...o.stn_list[s].branch,right:[Ie.through,l[1]]})):(o.stn_list[s].children=["lineend"],ht(o,s)),c.push(n),o.stn_list[s].parents=structuredClone(c).reverse(),c.length==2&&(o.stn_list[s].branch={...o.stn_list[s].branch,left:[Ie.through,c[1]]}),x.length!=0&&(o.stn_list[s].transfer.groups[0].lines=structuredClone(x)),[s]}},wr=(s,n,r,t)=>{const a=structuredClone(It);t=="LOOP"&&(a.loop=!0);let i;switch(s.getNodeAttributes(r).type){case _.GzmtrBasic:case _.GzmtrInt:i=Oe.GZMTR;break;case _.MTR:i=Oe.MTR;break;default:i=Oe.SHMetro;break}a.theme=structuredClone(n),a.style=i,a.stn_list.linestart=structuredClone(pr),a.stn_list.lineend=structuredClone(gr),Te.clear(),Is.clear();const o=Ps(r,"linestart","linestart",1,s,n,a);if(a.current_stn_idx=o[0],a.stn_list.linestart.children=[o[0]],!(Object.keys(a.stn_list).length<=3||a.stn_list.lineend.parents.length>=3))return structuredClone(a)},yr=s=>{var t,a;Te.clear(),Ns.clear(),Ls.clear(),Et.clear(),ke.clear(),zs.clear(),_s.clear(),ee.clear(),V=[],qe=0,Qe.clear(),Ms.clear(),s.filterEdges(i=>i.startsWith("line")).forEach(i=>{Us(s.getEdgeAttributes(i).style)&&jr(s,i)});let n=0;s.forEachNode(i=>{Ms.set(i,++n)}),Ms.set("lineend",++n);const r=[];for(const i of Ns){let o=0;for(;ke.get(E(i)).size!=0;){let l="line_root";ke.get(E(i)).forEach(x=>{l=="line_root"&&(l=x)}),Nt(l,"line_root",i);const c={theme:i,index:++o};zs.add(c),_s.set(c,l)}}for(const i of zs){const{theme:o}=i;Te.clear(),Qe.clear(),Lt(_s.get(i),"line_root",o);let l=!0,c="LINE";const x=[];for(const[u,h]of Qe)h==1&&x.push(u),h==3&&(c="BRANCH"),h>3&&(l=!1);if(!l)continue;x.length==0&&(c="LOOP",Qe.forEach((u,h)=>{x.push(h)}));const m=[];for(const u of x){const h=wr(s,o,u,c);h!=null&&m.push([h,(t=h.stn_list[h.current_stn_idx].localisedName.zh)!=null?t:"",(a=h.stn_list[h.current_stn_idx].localisedName.en)!=null?a:""])}m.length!=0&&r.push({id:Me(10),theme:o,param:structuredClone(m),type:c})}return r},Sr=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),Cr=(s,n)=>{let r=s;return n.forEach((t,a)=>{const i=new RegExp("ch_".concat(a),"g"),o=new RegExp("en_".concat(a),"g");r=r.replace(i,t[0]),r=r.replace(o,t[1])}),r},vr=(s,n,r,t)=>{s.line_name=n,s.line_num=String(r),Rs("RMG_".concat(Sr(n),".json"),"application/json",Cr(JSON.stringify(s),t))},Ar={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Tr=s=>{const{isOpen:n,onClose:r}=s,{t}=U(),a=f.useRef(window.graph),[i,o]=f.useState(!1),[l,c]=f.useState([[It,"",""]]),[x,m]=f.useState(["","",""]),[u,h]=f.useState(new Map),[p,g]=f.useState(new Map),[d,b]=f.useState([]);f.useEffect(()=>{if(n){const y=yr(a.current),T=new Map;y.forEach(({id:C,theme:A})=>{T.set(E(A),C)}),b(y),h(T)}},[n]);const w=(y,T)=>document.getElementById("2RMG_"+T+"_"+y).value.trim();return e.jsxs(le,{isOpen:n,onClose:r,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:e.jsx(j,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),e.jsx(de,{}),e.jsxs(X,{children:[e.jsx(j,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),e.jsx(j,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),e.jsx("br",{}),d.length===0?e.jsx(j,{fontSize:"md",children:t("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:d.map(({id:y,theme:T,param:C,type:A})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(et,{name:T[0]=="other"&&T[1]=="other"?T[2]:T[1],bg:T[2],fg:T[3]})}),e.jsx("td",{children:e.jsx(ys,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(y),size:"sm"})}),e.jsx("td",{children:e.jsx(ys,{placeholder:t("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(y),size:"sm"})}),e.jsx("td",{children:e.jsx(ys,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(y),size:"sm"})}),e.jsx("td",{children:e.jsx(et,{name:t("header.download.2rmg.type.".concat(A.toLowerCase())),bg:Ar[A],fg:re.white})}),e.jsx("td",{children:e.jsx(D,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const M=w(y,"nameCh"),v=w(y,"nameEn"),N=w(y,"lineNum"),S=new Map;u.forEach((P,B)=>{S.set(B,[w(P,"nameCh"),w(P,"nameEn")])}),c(C),m([M,v,N]),g(S),o(!0)},size:"sm",children:e.jsx(zt,{})})})]},y))})})]}),e.jsx(oe,{children:e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:t("close")})})]}),e.jsx(zr,{isOpen:i,onClose:()=>o(!1),param:l,nameList:x,interchangeName:p})]})},zr=s=>{const{isOpen:n,onClose:r,param:t,nameList:a,interchangeName:i}=s,{t:o}=U(),[l,c]=f.useState("");return f.useEffect(()=>{a[0]!=""&&a[1]!=""?c(a[0]+"/"+a[1]):a[0]!=""?c(a[0]):a[1]!=""?c(a[1]):c("")},[...a]),e.jsxs(le,{isOpen:n,onClose:r,size:"md",scrollBehavior:"inside",children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:e.jsxs(j,{as:"b",fontSize:"xl",children:[o("header.download.2rmg.download")," ",l]})}),e.jsx(de,{}),e.jsx(X,{children:e.jsxs(Kt,{children:[e.jsx(j,{fontSize:"sm",mb:"2",lineHeight:"100%",children:o("header.download.2rmg.downloadInfo")}),t.map(([x,m,u])=>e.jsxs(D,{onClick:()=>{vr(x,[a[0],a[1]],a[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[m.replaceAll("\n","⏎"),"/",u.replaceAll("\n","⏎")]},"".concat(m).concat(u)))]})}),e.jsx(oe,{children:e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:o("close")})})]})]})},_r=s=>{const{isOpen:n,onClose:r}=s,{t}=U();return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:t("header.download.termsAndConditions")}),e.jsx(de,{}),e.jsx(X,{children:e.jsxs(Yt,{children:[e.jsxs(Be,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(W,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(H,{as:$})]}),", ",e.jsxs(W,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(H,{as:$})]})," or ",e.jsxs(W,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(H,{as:$})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(W,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(H,{as:$})]}),"，",e.jsxs(W,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(H,{as:$})]}),"或",e.jsxs(W,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(H,{as:$})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(Be,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(W,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:$})]})," and ",e.jsxs(W,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:$})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(W,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(H,{as:$})]}),"及",e.jsxs(W,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(H,{as:$})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(Be,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(W,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(H,{as:$})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(W,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(H,{as:$})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(Be,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(Be,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(W,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:$})]})," ","– the open-source emoji and icon project. License:",e.jsxs(W,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:$})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(W,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(H,{as:$})]}),"所设计。许可证：",e.jsxs(W,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(H,{as:$})]})]}),e.jsxs(Be,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},Mr=()=>{const s="https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download",n=new Date,r="".concat(n.getFullYear()).concat(String(n.getMonth()+1).padStart(2,"0"),"01"),t="".concat(String(n.getFullYear()).slice(-2),".").concat(n.getMonth()+1,".1"),a=navigator.platform,i=a.includes("Linux")?"amd64.AppImage":a.includes("Mac")?"aarch64.dmg":"x64-setup.exe";return s+"/tauri-".concat(r,"/Rail.Map.Toolkit_").concat(t,"_").concat(i)};function Or(){const s=bt("white","var(--chakra-colors-gray-800)"),n=q(),{activeSubscriptions:{RMP_EXPORT:r}}=K(z=>z.account),{telemetry:{project:t}}=K(z=>z.app),{languages:a}=K(z=>z.fonts),i=K(z=>z.param),{existsNodeTypes:o}=K(z=>z.runtime),l=I.isAllowAnalytics(),{t:c}=U(),x=f.useRef(window.graph),[m,u]=f.useState("png"),h={png:c("header.download.png"),svg:c("header.download.svg")},[p,g]=f.useState(2),[d,b]=f.useState({width:1,height:1,benchmark:.001}),[w,y]=f.useState(200),T=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],C=Object.fromEntries(T.map(z=>[z,"".concat(z,"%")])),[A,M]=f.useState([]),[v,N]=f.useState(!1),S=[{type:"select",label:c("header.download.format"),value:m,options:h,onChange:z=>u(z==="png"?"png":"svg")}],P=[{type:"select",label:c("header.download.svgVersion"),value:p,options:{1.1:c("header.download.svg1.1"),2:c("header.download.svg2")},onChange:z=>{g(z),z===1.1&&Ke(!0)}}],B=[{type:"select",label:c("header.download.scale"),value:w,options:C,onChange:z=>y(z)},{type:"switch",label:c("header.download.transparent"),isChecked:v,onChange:N}],[F,ne]=f.useState(!1),[he,os]=f.useState(!1),[Ue,Ke]=f.useState(!1),[is,k]=f.useState(!1),[js,Ks]=f.useState(!1),[Ys,Gt]=f.useState(!1),[$t,as]=f.useState(!1),[Ft,Js]=f.useState(!1);f.useEffect(()=>{(async()=>{const Re=await ur.maxArea({usePromise:!0,useWorker:!0});b(Re)})()},[]),f.useEffect(()=>{if(F){const{xMin:z,yMin:Re,xMax:Ye,yMax:Q}=rn(x.current),[Pe,fe]=[Ye-z,Q-Re],Je=T.filter(We=>Pe*We/100>d.width&&fe*We/100>d.height);M(Je),nr(o)?(k(!1),Ks(!0)):Ks(!1)}},[F]);const Vt=async()=>{l&&I.event(De.DOWNLOAD_PARAM,t?{"#nodes":x.current.order,"#edges":x.current.size}:{});const z=[];for(const Ye of x.current.filterNodes((Q,Pe)=>{var fe;return Q.startsWith("misc_node")&&Pe.type==="image"&&((fe=Pe.image)==null?void 0:fe.href)!==void 0})){const Q=x.current.getNodeAttributes(Ye).image;Q.href&&Q.href.startsWith("img-l")&&await lt.has(Q.href)&&z.push({id:Q.href,base64:await lt.get(Q.href)})}const Re={...i,images:z};Rs("RMP_".concat(new Date().valueOf(),".json"),"application/json",cn(Re))},Ht=async()=>{as(!0),l&&I.event(De.DOWNLOAD_IMAGES,t?{numberOfNodes:x.current.order,numberOfEdges:x.current.size}:{});const{elem:z,width:Re,height:Ye}=await rr(x.current,is,Ue,a,o,p),Q=z.outerHTML.replace(/&nbsp;/g," ").replace(new RegExp("\\p{Cc}","gu"),"");if(m==="svg"){Rs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Q),as(!1);return}if(Ze){window.parent.__TAURI__.core.invoke("render_image",{svgString:Q,scale:w,isTransparent:v,isSystemFontsOnly:Ue}).then(()=>as(!1));return}document.body.appendChild(z);const Pe="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Q)));document.body.removeChild(z),z.remove();const fe=document.createElement("canvas"),[Je,We]=[Re*w/100,Ye*w/100];fe.width=Je,fe.height=We;const bs=fe.getContext("2d");v||(bs.fillStyle=s,bs.fillRect(0,0,Je,We));const ws=new Image;ws.onload=()=>{setTimeout(()=>{bs.drawImage(ws,0,0,Je,We),fe.toBlob(Zs=>{if(as(!1),!Zs){n(gs({status:"error",message:c("header.download.imageTooBig")}));return}or("RMP_".concat(new Date().valueOf(),".png"),Zs)},"image/png")},dn()?2e3:0)},ws.src=Pe};return e.jsxs(Bs,{id:"download",children:[e.jsx(Gs,{as:pe,size:"sm",variant:"ghost",icon:e.jsx(zt,{})}),e.jsxs($s,{children:[e.jsx(ue,{icon:e.jsx(on,{}),onClick:()=>Vt(),children:c("header.download.config")}),e.jsxs(ue,{icon:e.jsx(an,{}),onClick:()=>Js(!0),children:[c("header.download.2rmg.title"),e.jsx(ge,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ue,{icon:e.jsx(ln,{}),onClick:()=>ne(!0),children:c("header.download.image")})]}),e.jsxs(le,{size:"2xl",isOpen:F,onClose:()=>ne(!1),children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:c("header.download.image")}),e.jsx(de,{}),e.jsxs(X,{children:[e.jsx(Ne,{fields:S}),m==="svg"&&e.jsx(Ne,{fields:P}),m==="png"&&e.jsx(Ne,{fields:B}),e.jsx("br",{}),e.jsx(Ss,{isChecked:Ue,isDisabled:m==="svg"&&p===1.1,onChange:z=>Ke(z.target.checked),children:e.jsx(j,{children:c("header.download.isSystemFontsOnly")})}),e.jsxs(J,{children:[e.jsx(Ss,{id:"share_info",isChecked:is,isDisabled:js&&!r,onChange:z=>k(z.target.checked),children:e.jsxs(j,{children:[c("header.download.shareInfo1"),e.jsxs(W,{color:"teal.500",href:"https://railmapgen.org/rmp",children:[c("header.about.rmp")," ",e.jsx(H,{as:$})]}),c("header.download.shareInfo2")]})}),js&&e.jsx(ge,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})]}),e.jsx(Ss,{id:"agree_terms",isChecked:Ys,onChange:z=>Gt(z.target.checked),children:e.jsxs(j,{children:[c("header.download.termsAndConditionsInfo"),e.jsxs(W,{color:"teal.500",onClick:()=>os(!0),children:[c("header.download.termsAndConditions")," ",e.jsx(H,{as:$})]}),c("header.download.period")]})}),js&&e.jsxs(us,{status:"error",mt:"4",children:[e.jsx(ps,{}),e.jsx(L,{children:e.jsx(Cs,{children:c("header.download.rmpInfoSpecificNodeExists")})})]}),m==="png"&&A.includes(w)&&!Ze&&e.jsxs(us,{status:"error",mt:"4",children:[e.jsx(ps,{}),e.jsxs(L,{children:[e.jsx(Cs,{children:c("header.download.disabledScaleOptions")}),e.jsx(Xs,{children:e.jsx(ks,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:e.jsx(W,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:e.jsx(W,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:Mr()})}})})]})]}),m==="png"&&A.includes(w)&&Ze&&!r&&e.jsxs(us,{status:"error",mt:"4",children:[e.jsx(ps,{}),e.jsxs(L,{children:[e.jsx(Cs,{children:c("header.download.disabledScaleOptions")}),e.jsx(Xs,{children:c("header.settings.pro")})]})]})]}),e.jsx(oe,{children:e.jsx(J,{children:e.jsx(D,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Ys||m==="png"&&A.includes(w)&&!Ze||m==="png"&&A.includes(w)&&Ze&&!r,isLoading:$t,onClick:Ht,children:c("header.download.confirm")})})}),e.jsx(_r,{isOpen:he,onClose:()=>os(!1)})]})]}),e.jsx(Tr,{isOpen:Ft,onClose:()=>Js(!1)})]})}function Pt(s){const{isOpen:n,onClose:r,onConfirm:t,saveVersion:a}=s,{t:i}=U(),o=f.useRef(null),l=a>st;return e.jsx(Jt,{isOpen:n,leastDestructiveRef:o,onClose:r,children:e.jsx(se,{children:e.jsxs(Zt,{children:[e.jsx(te,{fontSize:"lg",fontWeight:"bold",children:i("header.open.confirmOverwrite.title")}),e.jsxs(X,{children:[i("header.open.confirmOverwrite.body"),l&&e.jsx(j,{mt:4,color:"orange.500",fontWeight:"semibold",children:i("header.open.confirmOverwrite.newerVersion",{saveVersion:a,currentVersion:st})})]}),e.jsxs(oe,{children:[e.jsx(D,{ref:o,onClick:r,children:i("cancel")}),e.jsx(D,{id:"confirm_overwrite",colorScheme:"red",onClick:t,ml:3,children:i("header.open.confirmOverwrite.overwrite")})]})]})})})}const ze=.3125,ut=ze*25,pt={size:10,color:"#000000"};var Ws=(s=>(s.Beijing="beijing",s.Changsha="changsha",s.Chengdu="chengdu",s.Hangzhou="hangzhou",s.Kunming="kunming",s.Shanghai="shanghai",s.Suzhou="suzhou",s.Wuhan="wuhan",s))(Ws||{});const ms={suzhou:{basic:_.SuzhouRTBasic,int:_.SuzhouRTInt},beijing:{basic:_.BjsubwayBasic,int:_.BjsubwayInt},shanghai:{basic:_.ShmetroBasic,int:_.ShmetroInt},kunming:{basic:_.KunmingRTBasic,int:_.KunmingRTInt},changsha:{basic:_.CsmetroBasic,int:_.CsmetroInt},chengdu:{basic:_.ChengduRTBasic,int:_.ChengduRTInt},wuhan:{basic:_.WuhanRTBasic,int:_.WuhanRTInt},hangzhou:{basic:_.HzmetroBasic,int:_.HzmetroInt}},Z=new Map,ss=new Map,kr=new Map,Wt=(s,n,r)=>{var i,o;const t="stn_".concat(Me(10));Z.set(n.id,t);const a={...structuredClone(Ot[r].defaultAttrs),names:[(i=n.name)!=null?i:"",(o=n.nameS)!=null?o:""],nameOffsetX:n.nameP?n.nameP[0]>0?"right":n.nameP[0]===0?"middle":"left":"right",nameOffsetY:n.nameP?n.nameP[1]>0?"bottom":n.nameP[1]===0?"middle":"top":"top"};s.addNode(t,{visible:!0,zIndex:0,x:n.pos[0]*ze,y:n.pos[1]*ze,type:r,[r]:a})},ns=(s,n,r,t={},a=0)=>{const i="misc_node_".concat(Me(10));Z.set(n.id,i);const o={...structuredClone(ir[r].defaultAttrs),...t};s.addNode(i,{visible:!0,zIndex:a,x:n.pos[0]*ze,y:n.pos[1]*ze,type:r,[r]:o})},Bt=(s,n,r)=>s===0?{style:ve.SingleColor,theme:[Ce.Other,"other",r||"#000000",re.white]}:n===0?{style:ve.SingleColor,theme:[Ce.Other,"other",r||"#000000",re.white]}:n===1?{style:ve.SingleColor,theme:[Ce.Other,"other","#cccccc",re.white]}:n===2?{style:ve.River,theme:[Ce.Other,"other","#c3e5eb",re.white]}:n===3?{style:ve.SingleColor,theme:[Ce.Other,"other","#ceeda4",re.white]}:n===4?{style:ve.SingleColor,theme:[Ce.Other,"other","#ffffff",re.white]}:{style:ve.SingleColor,theme:[Ce.Other,"other","#000000",re.white]},Rr=(s,n)=>{var i;const{style:r,theme:t}=Bt(n.type,(i=n.colorPre)!=null?i:0,n.color);n.isFilled&&(s.dropNode(Z.get(n.pts[0])),Z.delete(n.pts[0]),ns(s,ss.get(n.pts[0]),ts.Fill,{color:t,opacity:1},-1));let a=n.pts[0];for(let o=1;o<n.pts.length;o++){const l=n.pts[o],c="line_".concat(Me(10)),x=Z.get(a),m=Z.get(l),u=ss.get(a),h=ss.get(l);if(x!==m&&x&&m)if(cr(s,"any",t,[x,m].filter(p=>p.startsWith("stn")),[]),Math.abs(Math.abs(u.pos[0]-h.pos[0])-Math.abs(u.pos[1]-h.pos[1]))<.01)u.dir===0&&h.dir===0?s.addDirectedEdgeWithKey(c,x,m,{visible:!0,zIndex:0,type:G.Perpendicular,[G.Perpendicular]:structuredClone(Ee[G.Perpendicular].defaultAttrs),style:r,[r]:{color:t},reconcileId:"",parallelIndex:-1}):s.addDirectedEdgeWithKey(c,x,m,{visible:!0,zIndex:0,type:G.Diagonal,[G.Diagonal]:structuredClone(Ee[G.Diagonal].defaultAttrs),style:r,[r]:{color:t},reconcileId:"",parallelIndex:-1});else if((u.dir===0&&h.dir===0||u.dir===1&&h.dir===1)&&Math.abs(u.pos[0]-h.pos[0])>.01&&Math.abs(u.pos[1]-h.pos[1])>.01){ns(s,{id:1e9+l,pos:[(u.pos[0]+h.pos[0])/2,(u.pos[1]+h.pos[1])/2]},ts.Virtual);const p=Z.get(1e9+l),g="line_".concat(Me(10));s.addDirectedEdgeWithKey(c,x,p,{visible:!0,zIndex:0,type:G.Diagonal,[G.Diagonal]:{...structuredClone(Ee[G.Diagonal].defaultAttrs),startFrom:u.dir===0?"from":"to"},style:r,[r]:{color:t},reconcileId:"",parallelIndex:-1}),s.addDirectedEdgeWithKey(g,p,m,{visible:!0,zIndex:0,type:G.Diagonal,[G.Diagonal]:{...structuredClone(Ee[G.Diagonal].defaultAttrs),startFrom:u.dir===0?"to":"from"},style:r,[r]:{color:t},reconcileId:"",parallelIndex:-1})}else s.addDirectedEdgeWithKey(c,x,m,{visible:!0,zIndex:0,type:G.Diagonal,[G.Diagonal]:{...structuredClone(Ee[G.Diagonal].defaultAttrs),startFrom:u.dir===0?"from":"to"},style:r,[r]:{color:t},reconcileId:"",parallelIndex:-1});a=l}n.isFilled&&s.addDirectedEdgeWithKey("line_".concat(Me(10)),Z.get(a),Z.get(n.pts[0]),{visible:!0,zIndex:0,type:G.Diagonal,[G.Diagonal]:structuredClone(Ee[G.Diagonal].defaultAttrs),style:r,[r]:{color:t},reconcileId:"",parallelIndex:-1})},Er=(s,n,r,t,a)=>{const i=s.getEdgeAttribute(n,"type"),[o,l]=s.extremities(n),c=s.getEdgeAttributes(n);o===r?c[i].offsetFrom=a:c[i].offsetTo=a,s.dropEdge(n),s.addDirectedEdgeWithKey(n,o===r?t:o,l===r?t:l,{...c,type:i})},Ir=(s,n,r,t)=>{let a=0,i=0,o="",l="";r.forEach(u=>{a+=s.getNodeAttribute(u,"x"),i+=s.getNodeAttribute(u,"y");const h=s.getNodeAttribute(u,"type"),p=s.getNodeAttributes(u)[h].names,g=p[0]?o!==""?"/".concat(p[0]):p[0]:"",d=p[1]?l!==""?"/".concat(p[1]):p[1]:"";o+=g,l+=d});const c=a/r.length,x=i/r.length;Wt(s,{id:1e8+n,name:o,nameS:l,pos:[c/ze,x/ze]},ms[t].int);const m=Z.get(1e8+n);r.forEach(u=>{const h=s.getNodeAttribute(u,"x"),p=s.getNodeAttribute(u,"y"),g=Math.sqrt(Math.pow(h-c,2)+Math.pow(p-x,2));s.edges(u).forEach(d=>{Er(s,d,u,m,g)}),s.dropNode(u)})},Nr=s=>{const n=new Map,r=Array.from(Z.values()).filter(i=>i.startsWith("stn")),t=new Set,a=new Map;for(let i=0;i<r.length;i++){const o=r[i],l=s.getNodeAttribute(o,"x"),c=s.getNodeAttribute(o,"y");for(let x=i+1;x<r.length;x++){const m=r[x],u=s.getNodeAttribute(m,"x"),h=s.getNodeAttribute(m,"y");(Math.abs(l-u)===ut&&c===h||Math.abs(c-h)===ut&&u===l)&&(a.has(o)||a.set(o,[]),a.has(m)||a.set(m,[]),a.get(o).push(m),a.get(m).push(o))}}return r.forEach(i=>{if(!t.has(i)&&a.has(i)){const o=[],l=[i];for(t.add(i);l.length>0;){const c=l.shift();o.push(c),a.get(c).forEach(x=>{t.has(x)||(t.add(x),l.push(x))})}n.set(i,o)}}),n},gt=(s,n,r,t,a,i,o,l)=>{const c={content:r,color:l!=null?l:[Ce.Other,"other",t.color||"#000000",re.white],fontSize:30*(t.size||1)*o*1.2*ze,lineHeight:30*(t.size||1)*o*1.2*ze,textAnchor:a===0?"middle":a===1?"start":"end",dominantBaseline:i===0?"central":i===1?"hanging":"text-before-edge",language:hn.en,rotate:0,italic:t.i?"italic":"normal",bold:t.b?"bold":"normal",outline:0};ns(s,n,ts.Text,c)},xt=(s,n,r,t)=>{var c,x,m,u,h,p,g,d,b,w;const a={id:n.id,pos:n.pos},i={id:n.id+1e9,pos:n.pos},o=(c=n.text)==null?void 0:c.trim(),l=(x=n.textS)==null?void 0:x.trim();o&&gt(s,a,(m=n.text)!=null?m:"",(u=n.textOp)!=null?u:pt,(h=n.anchorX)!=null?h:0,(p=n.anchorY)!=null?p:0,r.textTagPlain&&r.textTagPlain.fontSize?r.textTagPlain.fontSize:1,t),l&&gt(s,i,(g=n.textS)!=null?g:"",(d=n.textSOp)!=null?d:pt,(b=n.anchorX)!=null?b:0,(w=n.anchorY)!=null?w:0,r.textTagPlain&&r.textTagPlain.subFontSize?r.textTagPlain.subFontSize:1,t)},Lr=s=>s&&typeof s=="object"&&typeof s.idIncre=="number"&&Array.isArray(s.points)&&Array.isArray(s.lines)&&Array.isArray(s.textTags)&&Array.isArray(s.cvsSize)&&s.config&&typeof s.config=="object",Dr=(s,n,r="suzhou")=>{Z.clear(),ss.clear(),kr.clear();const t=JSON.parse(s);if(!Lr(t))throw new Error("Invalid AARC save data");t.points.forEach(l=>{ss.set(l.id,l),l.sta===1?Wt(n,l,ms[r].basic):ns(n,l,ts.Virtual)}),t.lines.forEach(l=>{Rr(n,l)});const a=Nr(n),i=new Set;let o=0;a.forEach(l=>{Ir(n,o,l,r),l.forEach(c=>i.add(c)),o++});for(const[l,c]of Z)i.has(c)&&Z.delete(l);t.textTags.forEach(l=>{var c,x,m;if(l.forId===void 0)xt(n,l,t.config);else{const u=l.forId,h=t.lines.find(p=>p.id===u);if(h){const{theme:p}=Bt(h.type,(c=h.colorPre)!=null?c:0,h.color);h.type===1?xt(n,l,t.config,p):ns(n,{id:l.id,pos:l.pos},ts.GzmtrLineBadge,{names:[(x=l.text)!=null?x:h.name||"",(m=l.textS)!=null?m:h.nameSub||""],color:p})}}}),Z.forEach(l=>{n.hasNode(l)&&l.startsWith("stn")&&(lr(n,l),Rt(n,l))})};function Pr({isOpen:s,onClose:n}){const r=q(),{t}=U(),[a,i]=f.useState(""),[o,l]=f.useState(1),[c,x]=f.useState(Ws.Suzhou),m=f.useRef(window.graph),u=f.useRef(new un),h=f.useCallback(()=>{r(ie(m.current.export())),r(me()),r(ae())},[r]),[p,g]=f.useState(0),[d,b]=f.useState(0),w=()=>{if(a.trim()){r(xs());try{u.current.clear(),Dr(a,u.current),g(u.current.nodes().length),b(u.current.edges().length)}catch(v){xe.error("ImportFromAarc.handleImport():: Error occurred while importing data from other tools",v),g(0),b(0)}l(2)}},y=()=>{ct(u.current,_.SuzhouRTBasic,ms[c].basic,u.current.nodes().filter(v=>v.startsWith("stn_"))),ct(u.current,_.SuzhouRTInt,ms[c].int,u.current.nodes().filter(v=>v.startsWith("stn_"))),u.current.nodes().filter(v=>v.startsWith("stn_")).forEach(v=>{Rt(u.current,v)}),m.current.clear(),m.current.import(u.current.export()),r(Le(100)),r(He({x:0,y:0})),h(),i(""),l(1),n()},T=()=>{i(""),l(1)},C=()=>{i(""),l(1),n()},A=Object.values(Ws).reduce((v,N)=>(v[N]=t("header.open.otherPlatform.mode.".concat(N)),v),{}),M=[{type:"select",label:t("header.open.otherPlatform.mode.desc"),value:c,options:A,onChange:v=>x(v)}];return e.jsxs(le,{isOpen:s,onClose:C,size:"lg",isCentered:!0,children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:t("header.open.otherPlatform.title")}),e.jsx(de,{onClick:C}),e.jsx(X,{pb:0,children:e.jsxs(J,{justify:"center",spacing:8,mb:2,children:[e.jsxs(J,{children:[e.jsx(qs,{size:"8",bg:o===1?"blue.500":"gray.300",color:"white",fontWeight:"bold",children:"1"}),e.jsx(j,{fontSize:"sm",color:o===1?"blue.500":"gray.500",children:t("header.open.otherPlatform.step1")})]}),e.jsxs(J,{children:[e.jsx(qs,{size:"8",bg:o===2?"blue.500":"gray.300",color:"white",fontWeight:"bold",children:"2"}),e.jsx(j,{fontSize:"sm",color:o===2?"blue.500":"gray.500",children:t("header.open.otherPlatform.step2")})]})]})}),o===1&&e.jsxs(e.Fragment,{children:[e.jsx(X,{pt:2,children:e.jsxs(Ae,{align:"stretch",spacing:4,children:[e.jsx(j,{fontSize:"sm",color:"gray.500",children:t("header.open.otherPlatform.desc")}),e.jsx("input",{type:"file",accept:"application/json,.json",onChange:v=>{var P;const N=(P=v.target.files)==null?void 0:P[0];if(!N)return;const S=new FileReader;S.onload=()=>{const B=S.result;if(B)try{const F=JSON.parse(String(B));i(JSON.stringify(F,null,2))}catch(F){i(String(B))}},S.readAsText(N)},"aria-label":"Upload JSON file"})]})}),e.jsx(oe,{children:e.jsx(D,{colorScheme:"blue",onClick:w,isDisabled:!a.trim(),children:t("header.open.otherPlatform.next")})})]}),o===2&&(p>0&&d>0?e.jsxs(e.Fragment,{children:[e.jsx(X,{pt:2,children:e.jsxs(Ae,{align:"stretch",spacing:4,children:[e.jsx(j,{fontSize:"md",children:t("header.open.otherPlatform.detected",{x:p,y:d})}),e.jsx(Ne,{fields:M})]})}),e.jsxs(oe,{children:[e.jsx(D,{variant:"outline",mr:3,onClick:T,children:t("header.open.otherPlatform.previous")}),e.jsx(D,{colorScheme:"red",onClick:y,children:t("header.open.otherPlatform.confirm")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{pt:2,children:e.jsx(Ae,{align:"stretch",spacing:4,children:e.jsx(j,{fontSize:"md",children:t("header.open.otherPlatform.error")})})}),e.jsx(oe,{children:e.jsx(D,{variant:"outline",onClick:T,children:t("previous")})})]}))]})]})}const Wr=(s,{info_panel_type:n,line_num:r,stn_list:t,style:a,theme:i},o,l,c)=>{const x=Object.fromEntries(Object.keys(t).filter(h=>!["linestart","lineend"].includes(h)).map(h=>[h,"stn_".concat(Me(10))]));Object.entries(t).filter(([h,p])=>!["linestart","lineend"].includes(h)).forEach(([h,p])=>{const g=s.filterNodes((d,b)=>Object.values(_).includes(b.type)&&b[b.type].names[0]===p.localisedName.zh);g.length!==0&&(x[h]=g[0])});const m=[["linestart",-1,0]],u={};for(;m.length;){const[h,p,g]=m.shift();t[h].children.filter(b=>b!="lineend").forEach((b,w)=>{const y=Math.max(w,g+w);u[b]={x:p*150,y:y*75},m.push([b,p+1,y])})}Object.entries(t).filter(([h,p])=>!["linestart","lineend"].includes(h)).filter(([h,p])=>s.filterNodes((g,d)=>Object.values(_).includes(d.type)&&d[d.type].names[0]===p.localisedName.zh).length===0).map(([h,p])=>{var y,T,C;let g=_.ShmetroBasic;const d=p.transfer.groups,b=d.map(A=>{var M;return(M=A.lines)!=null?M:[]}).flat();a===Oe.SHMetro?b.length>0?g=_.ShmetroInt:n===Hs.sh2020?g=_.ShmetroBasic2020:g=_.ShmetroBasic:a===Oe.GZMTR?b.length>0?g=_.GzmtrInt:g=_.GzmtrBasic:a===Oe.MTR&&(g=_.MTR);const w={...structuredClone(Ot[g].defaultAttrs),names:[(y=p.localisedName.zh)!=null?y:"",(T=p.localisedName.en)!=null?T:""]};return g===_.ShmetroBasic2020?w.color=i:g===_.GzmtrBasic?(w.color=i,w.lineCode=r,w.stationCode=p.num):g===_.GzmtrInt?w.transfer=d.map((A,M)=>{var N,S;const v=(S=(N=A.lines)==null?void 0:N.map(P=>{var B;return[...(B=P.theme)!=null?B:i,"1","01"]}))!=null?S:[];return M===0?[[...i,r,p.num],...v]:v}):g===_.MTR&&((C=d[0].lines)!=null&&C.length?w.transfer=[[[...i,"",""],...d[0].lines.map(A=>{var M;return[...(M=A.theme)!=null?M:i,"",""]})]]:w.transfer=[[]]),{node:x[h],attr:{visible:!0,zIndex:0,x:o+u[h].x,y:l+u[h].y,type:g,[g]:w}}}).forEach(({node:h,attr:p})=>s.addNode(h,p)),Object.entries(t).filter(([h,p])=>!["linestart","lineend"].includes(h)).forEach(([h,p])=>{p.children.filter(g=>!["linestart","lineend"].includes(g)).forEach(g=>{const d=G.Diagonal,[b,w]=[x[h],x[g]],y=c?pn(s,d,b,w,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(Me(10)),b,w,{visible:!0,zIndex:0,type:d,[G.Diagonal]:structuredClone(Ee[G.Diagonal].defaultAttrs),style:ve.SingleColor,[ve.SingleColor]:{color:i},reconcileId:"",parallelIndex:y})})})},Br="rmg-bridge--",Gr={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function $r(s){const{isOpen:n,onClose:r}=s,{t}=U(),{preference:{autoParallel:a}}=K(w=>w.app),{svgViewBoxZoom:i,svgViewBoxMin:o}=K(w=>w.param),l=q(),c=I.isAllowAnalytics(),x=Fs(),{height:m,width:u}=Vs(x),h=ds.useRef(window.graph),[p]=ds.useState(crypto.randomUUID()),g="/rmg/#/import?"+new URLSearchParams({parentComponent:I.getAppName(),parentId:p}),d=ds.useCallback(()=>{l(ie(h.current.export())),l(me()),l(ae())},[l,me,ae,ie,h]),b=w=>{try{c&&I.event(De.IMPORT_RMG_PARAM,{});const y=o.x+u*i/100/3,T=o.y+m*i/100/3;Wr(h.current,w,y,T,a),d()}catch(y){l(gs({status:"error",message:t("header.open.unknownError")})),xe.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",y)}finally{r()}};return ds.useEffect(()=>{const w=new BroadcastChannel(Br+p);return w.onmessage=y=>{const{event:T,data:C}=y.data;xe.debug("[rmp] Received event from RMG app clip:",T),T==="CLOSE"?r():T==="IMPORT"&&b(C)},()=>w.close()},[o.x,o.y,i,m,u,a]),e.jsx(_t,{isOpen:n,onClose:r,sx:Gr,children:e.jsx("iframe",{src:g,loading:"lazy"})})}const Fr="RMP_GALLERY_CHANNEL",Vr="OPEN_TEMPLATE",mt=new BroadcastChannel(Fr),Hr={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function Ur(s){const{isOpen:n,onClose:r}=s,{t}=U(),a=q(),{isOpen:i,onOpen:o,onClose:l}=wt(),[c,x]=f.useState(null),[m,u]=f.useState(0),{telemetry:{project:h}}=K(C=>C.app),p=I.isAllowAnalytics(),g=f.useRef(window.graph),d=f.useCallback(()=>{a(ie(g.current.export())),a(me()),a(ae())},[a,me,ae,ie,g]),b=async C=>{const{version:A,images:M,...v}=JSON.parse(await Mt(JSON.stringify(C)));a(xs()),g.current.clear(),g.current.import(v.graph),Array.isArray(M)&&M.length>0&&await kt(g.current,M),a(Es()),d();const{svgViewBoxZoom:N,svgViewBoxMin:S}=v;typeof N=="number"&&a(Le(N)),typeof S.x=="number"&&typeof S.y=="number"&&a(He(S))},w=async()=>{c&&await b(c),l(),x(null)},y=async(C,A)=>{var N;const M=A?"https://".concat(A):"",v=await((N=(await Promise.allSettled([fetch("".concat(M,"/rmp-gallery/resources/real_world/").concat(C,".json")),fetch("".concat(M,"/rmp-gallery/resources/fantasy/").concat(C,".json"))])).filter(S=>S.status==="fulfilled").find(S=>S.value.status===200))==null?void 0:N.value.json());if(v){if(x(v),u(v.version),o(),p){const S={id:C};h&&A&&(S.host=A),I.event(De.IMPORT_WORK_FROM_GALLERY,S)}I.sendNotification({title:t("header.open.importOK",{id:C}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}else I.sendNotification({title:t("header.open.importFail",{id:C}),message:t("header.open.importFailContent"),type:"error",duration:9e3})},T=async C=>{try{const A=await fetch("".concat(gn,"/").concat(C));if(A.status!==200)throw new Error(t("header.open.importFailContent"));const M=await A.json();x(M),u(M.version),o(),p&&I.event(De.IMPORT_WORK_FROM_SHARE,{share:C}),I.sendNotification({title:t("header.open.importOK",{id:C}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}catch(A){I.sendNotification({title:t("header.open.importFail",{id:C}),message:A.message,type:"error",duration:9e3})}};return f.useEffect(()=>{const A=new URL(window.location.href).searchParams;if(A.size>0){const M=A.keys().next().value,v=M.indexOf("."),N=M.substring(0,v===-1?void 0:v);let S;v!==-1&&(S=M.substring(v+1)),S==="org"?T(N):y(N,S),I.updateAppMetadata({search:""})}},[]),f.useEffect(()=>(mt.onmessage=C=>{const{event:A,data:M}=C.data;A===Vr&&(y(M),r())},()=>mt.close()),[]),e.jsxs(e.Fragment,{children:[e.jsxs(_t,{isOpen:n,onClose:r,size:"full",sx:Hr,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(yt,{onClick:r,position:"fixed",top:"5px",right:"15px"})]}),e.jsx(Pt,{isOpen:i,onClose:l,onConfirm:w,saveVersion:m})]})}function Kr(){const s=q(),{t:n}=U(),{isOpen:r,onOpen:t,onClose:a}=wt(),[i,o]=f.useState(null),[l,c]=f.useState(0),x=Fs(),{height:m}=Vs(x),u=f.useRef(window.graph),h=f.useRef(null),[p,g]=f.useState(!1),[d,b]=f.useState(!1),[w,y]=f.useState(!1),T=f.useCallback(()=>{s(ie(u.current.export())),s(me()),s(ae())},[s,me,ae,ie,u]),C=()=>{s(xs()),u.current.clear(),s(Le(100)),s(He({x:0,y:0})),T()},A=async S=>{const{version:P,images:B,...F}=JSON.parse(await Mt(S));s(xs()),u.current.clear(),u.current.import(F.graph),Array.isArray(B)&&B.length>0&&await kt(u.current,B),s(Es()),T();const{svgViewBoxZoom:ne,svgViewBoxMin:he}=F;typeof ne=="number"&&s(Le(ne)),typeof he.x=="number"&&typeof he.y=="number"&&s(He(he))},M=async()=>{if(i){await A(i);const S=await rt();if(i.length===S.length){s(He({x:-10,y:-13}));const P=Math.max(0,Math.min(400,-.132*m+117.772));s(Le(P)),await s(Es()),I.event(De.LOAD_TUTORIAL,{})}}a(),o(null)},v=async S=>{var B;const P=(B=S.target.files)==null?void 0:B[0];if(xe.debug("OpenActions.handleUpload():: received file",P),(P==null?void 0:P.type)!=="application/json")s(gs({status:"error",message:n("header.open.invalidType")})),xe.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const F=await Yr(P);o(F);const ne=ot(F);c(ne),t()}catch(F){s(gs({status:"error",message:n("header.open.unknownError")})),xe.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",F)}S.target.value=""},N=async()=>{const S=await rt();o(S),c(ot(S)),t()};return f.useEffect(()=>{const S=async P=>{const{type:B,key:F,from:ne}=P.data;if(B===jn.SAVE_CHANGED&&F===it.PARAM&&ne==="rmt"){xe.debug("Received save changed event on key: ".concat(F));const he=localStorage.getItem(it.PARAM);if(!he)return;await A(he)}};return tt.addEventListener("message",S),()=>tt.removeEventListener("message",S)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Bs,{children:[e.jsx(Gs,{as:pe,size:"sm",variant:"ghost",icon:e.jsx(nt,{})}),e.jsxs($s,{children:[e.jsx(ue,{icon:e.jsx(xn,{}),onClick:C,children:n("header.open.new")}),e.jsx("input",{id:"upload_project",ref:h,type:"file",accept:".json",hidden:!0,onChange:v,"data-testid":"file-upload"}),e.jsx(ue,{icon:e.jsx(nt,{}),onClick:()=>{var S;return(S=h==null?void 0:h.current)==null?void 0:S.click()},children:n("header.open.config")}),e.jsx(ue,{icon:e.jsx(mn,{}),onClick:()=>g(!0),children:n("header.open.projectRMG")}),e.jsxs(ue,{icon:e.jsx($,{}),onClick:()=>b(!0),children:[n("header.open.gallery"),e.jsx(ge,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsxs(ue,{icon:e.jsx($,{}),onClick:()=>y(!0),children:[n("header.open.otherPlatform.title"),e.jsx(ge,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ue,{icon:e.jsx(fn,{}),onClick:N,children:n("header.open.tutorial")})]}),e.jsx($r,{isOpen:p,onClose:()=>g(!1)}),e.jsx(Ur,{isOpen:d,onClose:()=>b(!1)}),e.jsx(Pr,{isOpen:w,onClose:()=>y(!1)})]}),e.jsx(Pt,{isOpen:r,onClose:a,onConfirm:M,saveVersion:l})]})}const Yr=s=>new Promise(n=>{const r=new FileReader;r.onloadend=()=>n(r.result),r.readAsText(s)}),Jr=()=>{const[s,n]=f.useState(!1),{t:r}=U(),t=q(),a=f.useRef(window.graph),i=Fs(),{width:o,height:l}=Vs(i),[c,x]=f.useState([]);f.useEffect(()=>{s&&x(a.current.nodes().filter(u=>u.startsWith("stn")).map(u=>{const h=a.current.getNodeAttributes(u),p=h.type,g=h[p].names.join("/");return{id:u,value:g}}))},[s]);const m=u=>{t(Sn(new Set([u])));const h=Math.max(0,Math.min(400,-.132*l+117.772)),{x:p,y:g}=Cn((o-300)/2,l/2,h,{x:-a.current.getNodeAttribute(u,"x"),y:-a.current.getNodeAttribute(u,"y")});t(Le(h)),t(He({x:-p,y:-g}))};return e.jsxs(St,{isOpen:s,onOpen:()=>n(!0),onClose:()=>n(!1),children:[e.jsx(Ct,{children:e.jsx(pe,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(bn,{}),onClick:()=>n(!s)})}),e.jsx(vt,{children:e.jsx(At,{children:e.jsx(wn,{label:r("header.search"),children:e.jsx(yn,{data:c,displayHandler:u=>e.jsx(ge,{children:u.value}),filter:(u,h)=>h.value.toLowerCase().includes(u.toLowerCase())||Object.values(h.value).some(p=>p.toLowerCase().includes(u.toLowerCase())),value:"",onChange:u=>m(u.id)})})})})]})},Zr=s=>{const{isOpen:n,onClose:r}=s,t=q(),{t:a}=U(),i=f.useRef(window.graph),{theme:o,requestThemeChange:l}=vn(),c=()=>{i.current.filterEdges((x,m,u,h,p,g,d)=>Tt.has(m.style)&&JSON.stringify(m[m.style].color)===JSON.stringify(o)).forEach(x=>i.current.dropEdge(x)),t(ie(i.current.export())),t(ae()),r()};return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:a("header.settings.procedures.removeLines.title")}),e.jsx(de,{}),e.jsxs(X,{children:[a("header.settings.procedures.removeLines.content"),e.jsx(An,{theme:o,onClick:l})]}),e.jsxs(oe,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(D,{colorScheme:"red",onClick:c,children:a("remove")})]})]})]})},Xr=s=>{const{isOpen:n,onClose:r}=s,t=q(),{t:a}=U(),i=f.useRef(window.graph),[o,l]=f.useState(1),c=[{type:"input",label:a("header.settings.procedures.scale.factor"),value:o.toString(),variant:"number",onChange:m=>l(Number(m)),minW:"full"}],x=()=>{i.current.forEachNode((m,u)=>{i.current.updateNodeAttribute(m,"x",h=>(h!=null?h:0)*o),i.current.updateNodeAttribute(m,"y",h=>(h!=null?h:0)*o)}),t(ie(i.current.export())),t(me()),t(ae()),r()};return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:a("header.settings.procedures.scale.title")}),e.jsx(de,{}),e.jsxs(X,{children:[a("header.settings.procedures.scale.content"),e.jsx(Ne,{fields:c})]}),e.jsxs(oe,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(D,{colorScheme:"red",onClick:x,children:a("apply")})]})]})]})},qr=s=>{const{isOpen:n,onClose:r}=s,t=q(),{t:a}=U(),i=f.useRef(window.graph),[o,l]=f.useState(0),[c,x]=f.useState(0),m=[{type:"input",label:a("header.settings.procedures.translate.x"),value:o.toString(),variant:"number",onChange:h=>l(Number(h)),minW:"full"},{type:"input",label:a("header.settings.procedures.translate.y"),value:c.toString(),variant:"number",onChange:h=>x(Number(h)),minW:"full"}],u=()=>{i.current.forEachNode((h,p)=>{i.current.updateNodeAttribute(h,"x",g=>(g!=null?g:0)+o),i.current.updateNodeAttribute(h,"y",g=>(g!=null?g:0)+c)}),t(ie(i.current.export())),t(me()),t(ae()),r()};return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:a("header.settings.procedures.translate.title")}),e.jsx(de,{}),e.jsxs(X,{children:[a("header.settings.procedures.translate.content"),e.jsx(Ne,{fields:m})]}),e.jsxs(oe,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:a("cancel")}),e.jsx(D,{colorScheme:"red",onClick:u,children:a("apply")})]})]})]})},Qr=s=>{const{isOpen:n,onClose:r}=s,t=q(),a=Xt(),{t:i}=U(),o=f.useRef(window.graph),[l,c]=f.useState(!1),x=async()=>{c(!0);const m=JSON.stringify(o.current.export());try{const u=await to(m);o.current.clear(),o.current.import(u),t(ie(o.current.export())),t(me()),t(ae()),a({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(u){xe.error("[rmp] Error in updating all colors: ".concat(u)),a({title:i("header.settings.procedures.updateColor.error",{e:u}),status:"error",duration:9e3,isClosable:!0})}c(!1),r()};return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:i("header.settings.procedures.updateColor.title")}),e.jsx(de,{}),e.jsx(X,{children:e.jsx(j,{children:i("header.settings.procedures.updateColor.content")})}),e.jsxs(oe,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:r,children:i("cancel")}),e.jsx(D,{colorScheme:"red",onClick:x,isLoading:l,children:i("apply")})]})]})]})},ft=s=>s.length>=4&&s.every(n=>typeof n=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(re).includes(s[3]),eo=s=>{const n=[],r=(t,a)=>{if(Array.isArray(t)&&ft(t)){n.push({path:a||"",value:t});return}for(const i in t){const o=t[i],l=a?"".concat(a,".").concat(i):i;Array.isArray(o)?ft(o)?n.push({path:l,value:o}):o.forEach((c,x)=>r(c,"".concat(l,".").concat(x))):o&&typeof o=="object"&&r(o,l)}};return r(s),n},so=(s,n,r)=>{const t=n.split(".");let a=s;for(let i=0;i<t.length-1;i++)a=a[t[i]];a[t[t.length-1]]=r},to=async s=>{const n=JSON.parse(s),r=new Date().getTime(),t=eo(n);xe.debug("[rmp] Found all themes pending for update",t);const a=1e4;let i,o=!1;const l=new Promise((c,x)=>{i=setTimeout(()=>{o=!0,x("Executing time exceeds ".concat(a,"ms"))},a),(async()=>{for(const{path:m,value:u}of t){if(o)throw new Error("Update aborted");const[h,p,g,d,...b]=u,w=await Tn([h,p,g,d]);so(n,m,[...w,...b])}})().then(c).catch(x)});try{return await l,xe.debug("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-r)/1e3," sec")),n}finally{clearTimeout(i)}},jt=1,no=()=>{const s=q(),{state:n,token:r}=K(d=>d.account),{count:{stations:t,miscNodes:a,masters:i,lines:o,parallel:l}}=K(d=>d.runtime),{t:c}=U(),[x,m]=f.useState(!1),[u,h]=f.useState(jt);f.useEffect(()=>{let d;return x&&u>0?d=window.setTimeout(()=>{h(u-1)},1e3):u===0&&m(!1),()=>clearTimeout(d)},[x,u]);const p=()=>{m(!0),h(jt),r&&_n(s,r)},g={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(j,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),e.jsxs(L,{mt:"3",children:[e.jsxs(L,{mb:"1",children:[e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:c("header.settings.status.count.stations")}),e.jsx(j,{children:t})]}),e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:c("header.settings.status.count.miscNodes")}),e.jsx(j,{children:a})]}),e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:c("header.settings.status.count.masters")}),e.jsx(j,{children:i})]}),e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:c("header.settings.status.count.lines")}),e.jsx(j,{children:o})]}),e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:c("header.settings.status.count.parallel")}),e.jsx(j,{children:l})]})]}),e.jsxs(L,{display:"flex",mb:"1",children:[e.jsxs(j,{flex:"1",children:[c("header.settings.status.subscription.content")," ",g[n]]}),e.jsx(pe,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(zn,{}),isDisabled:x,onClick:()=>p()})]})]})]})},$e={width:"100%",justifyContent:"space-between"},Se={fontFamily:"-apple-system"},ro=s=>{const{isOpen:n,onClose:r}=s,{activeSubscriptions:t}=K(k=>k.account),{telemetry:{project:a},preference:{autoParallel:i,randomStationsNames:o,gridLines:l,snapLines:c,predictNextNode:x,autoChangeStationType:m,disableWarning:{changeType:u}}}=K(k=>k.app),{keepLastPath:h,count:{parallel:p}}=K(k=>k.runtime),g=q(),{t:d}=U(),b=bt("primary.500","primary.300"),[w,y]=f.useState(!1),[T,C]=f.useState(!1),[A,M]=f.useState(!1),[v,N]=f.useState(!1),[S,P]=f.useState(!1),[B,F]=f.useState(!1),ne=I.isAllowAnalytics(),he=k=>{g(Fn(k))},os=t.RMP_CLOUD?Mn:On,Ue=p>=os,Ke=!t.RMP_CLOUD,is=k=>{g($n(k.target.value))};return e.jsxs(le,{isOpen:n,onClose:r,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(se,{}),e.jsxs(ce,{children:[e.jsx(te,{children:d("header.settings.title")}),e.jsx(de,{}),e.jsx(X,{children:e.jsxs(Ae,{divider:e.jsx(tn,{borderColor:"gray.200"}),children:[e.jsx(no,{}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(j,{as:"b",fontSize:"xl",children:d("header.settings.preference.title")}),e.jsxs(Ae,{spacing:"0",mt:"3",align:"stretch",children:[e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.keepLastPath")}),e.jsx(ye,{isChecked:h,onChange:({target:{checked:k}})=>g(kn(k))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{children:d("header.settings.preference.autoParallel")}),e.jsx(ge,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ls,{label:d("header.settings.proWithTrial"),children:e.jsx(ge,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(ye,{ml:"1",isDisabled:Ue,isChecked:i,onChange:({target:{checked:k}})=>g(Rn(k))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.randomStationNames.title")}),e.jsx(ge,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ls,{label:d("header.settings.pro"),children:e.jsx(ge,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(qt,{size:"xs",width:"auto",ml:"1",value:o,onChange:is,children:[e.jsx("option",{value:"none",children:d("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:cs.Shmetro,disabled:Ke,children:d("header.settings.preference.randomStationNames.".concat(cs.Shmetro))}),e.jsx("option",{value:cs.Bjsubway,disabled:Ke,children:d("header.settings.preference.randomStationNames.".concat(cs.Bjsubway))})]})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.gridline")}),e.jsx(ye,{isChecked:l,onChange:({target:{checked:k}})=>g(En(k))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.snapline")}),e.jsx(ye,{isChecked:c,onChange:({target:{checked:k}})=>g(In(k))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.predictNextNode")}),e.jsx(ye,{isChecked:x,onChange:({target:{checked:k}})=>g(Nn(k))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.autoChangeStationType")}),e.jsx(ye,{isChecked:m,onChange:({target:{checked:k}})=>g(Ln(k))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.preference.disableWarningChangeType")}),e.jsx(ye,{isChecked:u,onChange:({target:{checked:k}})=>g(Dn(k))})]})]})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(j,{as:"b",fontSize:"xl",children:d("header.settings.procedures.title")}),e.jsxs(L,{mt:"3",children:[e.jsx(D,{sx:$e,rightIcon:e.jsx(Ge,{}),onClick:()=>y(!0),children:d("header.settings.procedures.translate.title")}),e.jsx(qr,{isOpen:w,onClose:()=>y(!1)}),e.jsx(D,{sx:$e,rightIcon:e.jsx(Ge,{}),onClick:()=>C(!0),children:d("header.settings.procedures.scale.title")}),e.jsx(Xr,{isOpen:T,onClose:()=>C(!1)}),e.jsxs(D,{sx:$e,rightIcon:e.jsx(Ge,{}),onClick:()=>M(!0),children:[d("header.settings.procedures.changeType.title"),e.jsx(ls,{label:d("header.settings.pro"),children:e.jsx(ge,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(dr,{isOpen:A,onClose:()=>M(!1),isSelect:!1}),e.jsx(D,{sx:$e,rightIcon:e.jsx(Ge,{}),onClick:()=>N(!0),children:d("header.settings.procedures.removeLines.title")}),e.jsx(Zr,{isOpen:v,onClose:()=>N(!1)}),e.jsx(D,{sx:$e,rightIcon:e.jsx(Ge,{}),onClick:()=>P(!0),children:d("header.settings.procedures.updateColor.title")}),e.jsx(Qr,{isOpen:S,onClose:()=>P(!1)}),e.jsx(D,{sx:$e,rightIcon:e.jsx(Ge,{}),onClick:()=>F(!0),children:d("header.settings.procedures.masterManager.title")}),e.jsx(ar,{isOpen:B,onClose:()=>F(!1)})]})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(j,{as:"b",fontSize:"xl",children:d("header.settings.shortcuts.title")}),e.jsx(L,{mt:"3",children:e.jsxs(Qt,{children:[e.jsx(en,{children:e.jsxs(Y,{children:[e.jsx(Qs,{children:d("header.settings.shortcuts.keys")}),e.jsx(Qs,{children:d("header.settings.shortcuts.description")})]})}),e.jsxs(sn,{children:[e.jsxs(Y,{children:[e.jsx(R,{children:e.jsx(O,{children:"f"})}),e.jsx(R,{children:d("header.settings.shortcuts.f")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:e.jsx(O,{children:"s"})}),e.jsx(R,{children:d("header.settings.shortcuts.s")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:e.jsx(O,{children:"c"})}),e.jsx(R,{children:d("header.settings.shortcuts.c")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:e.jsxs(L,{display:"flex",flexDirection:"row",children:[e.jsx(Pn,{}),e.jsx(Wn,{}),e.jsx(Bn,{}),e.jsx(Gn,{})]})}),e.jsx(R,{children:d("header.settings.shortcuts.arrows")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:e.jsxs(L,{display:"flex",flexDirection:"row",children:[e.jsx(O,{children:"i"}),e.jsx(O,{children:"j"}),e.jsx(O,{children:"k"}),e.jsx(O,{children:"l"})]})}),e.jsx(R,{children:d("header.settings.shortcuts.ijkl")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:e.jsx(O,{children:"r"})}),e.jsx(R,{children:d("header.settings.shortcuts.rotate")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:_e?e.jsx(O,{sx:Se,children:"⇧"}):e.jsx(O,{children:"shift"})}),e.jsx(R,{children:d("header.settings.shortcuts.shift")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:_e?e.jsx(O,{sx:Se,children:"⌥"}):e.jsx(O,{children:"alt"})}),e.jsx(R,{children:d("header.settings.shortcuts.alt")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:_e?e.jsx(O,{sx:Se,children:"⌫"}):e.jsx(O,{children:"delete"})}),e.jsx(R,{children:d("header.settings.shortcuts.delete")})]}),e.jsxs(Y,{children:[e.jsxs(R,{children:[_e?e.jsx(O,{sx:Se,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"x"})]}),e.jsx(R,{children:d("header.settings.shortcuts.cut")})]}),e.jsxs(Y,{children:[e.jsxs(R,{children:[_e?e.jsx(O,{sx:Se,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"c"})]}),e.jsx(R,{children:d("header.settings.shortcuts.copy")})]}),e.jsxs(Y,{children:[e.jsxs(R,{children:[_e?e.jsx(O,{sx:Se,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"v"})]}),e.jsx(R,{children:d("header.settings.shortcuts.paste")})]}),e.jsxs(Y,{children:[e.jsxs(R,{children:[_e?e.jsx(O,{sx:Se,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"z"})]}),e.jsx(R,{children:d("header.settings.shortcuts.undo")})]}),e.jsxs(Y,{children:[e.jsx(R,{children:_e?e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:Se,children:"⇧"})," + ",e.jsx(O,{sx:Se,children:"⌘"})," + ",e.jsx(O,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"y"})]})}),e.jsx(R,{children:d("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(L,{width:"100%",mb:"3",children:[e.jsx(j,{as:"b",fontSize:"xl",children:d("header.settings.telemetry.title")}),e.jsxs(L,{mt:"3",children:[e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:d("header.settings.telemetry.info")}),e.jsxs(L,{mt:"3",mb:"1",children:[e.jsxs(L,{display:"flex",mb:"1",children:[e.jsx(j,{flex:"1",children:d("header.settings.telemetry.essential")}),e.jsx(ls,{label:d("header.settings.telemetry.essentialTooltip"),children:e.jsx(ye,{isChecked:ne,isDisabled:!0})})]}),e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:d("header.settings.telemetry.essentialInfo")}),e.jsxs(W,{color:b,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[d("header.settings.telemetry.essentialLink")," ",e.jsx(H,{as:$})]})]}),e.jsxs(L,{mt:"1",mb:"1",children:[e.jsxs(L,{display:"flex",children:[e.jsx(j,{flex:"1",children:d("header.settings.telemetry.additional")}),e.jsx(ye,{isChecked:a,onChange:({target:{checked:k}})=>he(k)})]}),e.jsx(j,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:d("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},oo=()=>{const[s,n]=f.useState(!1),{svgViewBoxZoom:r}=K(i=>i.param),t=q(),a=[{type:"slider",label:"",value:400-r,min:10,max:390,step:1,onChange:i=>t(Le(400-i)),leftIcon:e.jsx(Vn,{}),rightIcon:e.jsx(at,{}),minW:160}];return e.jsxs(St,{isOpen:s,onOpen:()=>n(!0),onClose:()=>n(!1),children:[e.jsx(Ct,{children:e.jsx(pe,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(at,{}),onClick:()=>n(!s)})}),e.jsx(vt,{children:e.jsx(At,{children:e.jsx(Ne,{fields:a,noLabel:!0})})})]})};function io(){const{t:s}=U(),n=q(),{past:r,future:t}=K(d=>d.param),a=I.isAllowAnalytics(),[i,o]=f.useState(!1),[l,c]=f.useState(!1),x=dt(I.getEnv),m=dt(I.getAppVersion),u=Hn();f.useEffect(()=>{a&&x!==vs.DEV&&I.event(De.APP_LOAD,{isStandaloneWindow:I.isStandaloneWindow()})},[x]);const h=d=>{I.getI18nInstance().changeLanguage(d)},p=()=>{n(er())},g=()=>{n(sr())};return e.jsxs(Un,{children:[e.jsxs(Os,{direction:u==="landscape"?"row":"column",width:"100%",children:[e.jsxs(J,{height:"32px",children:[e.jsx(Fe,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(Kn,{environment:x,version:m,popoverHeader:x===vs.PRD?void 0:e.jsxs(ks,{i18nKey:"header.popoverHeader",environment:x,children:["You're on ",{environment:x}," environment!"]}),popoverBody:x===vs.PRD?void 0:e.jsx(ks,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),e.jsxs(J,{overflowX:"auto",ml:u==="landscape"?"auto":void 0,children:[e.jsx(Jr,{}),e.jsx(pe,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(Yn,{}),isDisabled:r.length===0,onClick:p}),e.jsx(pe,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(Jn,{}),isDisabled:t.length===0,onClick:g}),e.jsx(oo,{}),e.jsx(Kr,{}),e.jsx(Or,{}),I.isStandaloneWindow()&&e.jsxs(Bs,{children:[e.jsx(Gs,{as:pe,icon:e.jsx(Zn,{}),variant:"ghost",size:"sm"}),e.jsx($s,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(d=>e.jsx(ue,{onClick:()=>h(d),children:Xn[d][d]},d))})]}),e.jsx(pe,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(qn,{}),onClick:()=>o(!0)}),e.jsx(pe,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Qn,{}),onClick:()=>c(!0)})]})]}),e.jsx(ro,{isOpen:i,onClose:()=>o(!1)}),e.jsx(hr,{isOpen:l,onClose:()=>c(!1)})]})}function ao(){const s=q(),n=K(t=>t.runtime.globalAlerts),r=t=>{I.isStandaloneWindow()?window.open("/".concat(t),"_blank"):I.openApp({appId:t})};return e.jsx(e.Fragment,{children:Object.entries(n).map(([t,{message:a,url:i,linkedApp:o}])=>e.jsxs(us,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(ps,{}),o?e.jsx(W,{onClick:()=>r(o),children:a}):i?e.jsx(W,{href:i,target:"_blank",children:a}):a,e.jsx(yt,{ml:"auto",onClick:()=>s(tr(t))})]},t))})}function xo(){return e.jsxs(e.Fragment,{children:[e.jsx(io,{}),e.jsx(ao,{})]})}export{xo as default};
