!function(){const e=["onError","onSuccess"],s=["version"],n=["version"];function t(e,s){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);s&&(t=t.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,t)}return n}function r(e){for(var s=1;s<arguments.length;s++){var n=null!=arguments[s]?arguments[s]:{};s%2?t(Object(n),!0).forEach((function(s){i(e,s,n[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))}))}return e}function i(e,s,n){return(s=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,s||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(s))in e?Object.defineProperty(e,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[s]=n,e}function o(e,s){if(null==e)return{};var n,t,r=function(e,s){if(null==e)return{};var n={};for(var t in e)if({}.hasOwnProperty.call(e,t)){if(-1!==s.indexOf(t))continue;n[t]=e[t]}return n}(e,s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],-1===s.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}System.register(["./chakra-legacy-BwGWQky_.js","./index-legacy-BnPlQKpM.js","./react-legacy-B-tEtBDe.js","./master-manager-legacy-BKmEpnEN.js","./change-type-modal-legacy-BTQ05AjJ.js"],(function(t,i){"use strict";var a,l,c,h,d,u,x,p,g,m,j,f,b,w,y,v,z,k,C,S,_,O,E,M,H,R,N,A,P,T,I,L,B,D,W,G,$,U,F,V,J,Y,Z,K,q,Q,X,ee,se,ne,te,re,ie,oe,ae,le,ce,he,de,ue,xe,pe,ge,me,je,fe,be,we,ye,ve,ze,ke,Ce,Se,_e,Oe,Ee,Me,He,Re,Ne,Ae,Pe,Te,Ie,Le,Be,De,We,Ge,$e,Ue,Fe,Ve,Je,Ye,Ze,Ke,qe,Qe,Xe,es,ss,ns,ts,rs,is,os,as,ls,cs,hs,ds,us,xs,ps,gs,ms,js,fs,bs,ws,ys,vs,zs,ks,Cs,Ss,_s,Os,Es,Ms,Hs,Rs,Ns,As,Ps,Ts,Is,Ls,Bs,Ds,Ws,Gs,$s,Us,Fs;return{setters:[e=>{a=e.j,l=e.ag,c=e.M,h=e.ah,d=e.J,u=e.K,x=e.L,p=e.h,g=e.ai,m=e.N,j=e.B,f=e.aj,b=e.ak,w=e.T,y=e.al,v=e.b,z=e.q,k=e.t,C=e.O,S=e.am,_=e.an,O=e.ao,E=e.R,M=e.ap,H=e.Q,R=e.aq,N=e.ar,A=e.a2,P=e.as,T=e.at,I=e.x,L=e.au,B=e.av,D=e.aw,W=e.a8,G=e.e,$=e.w,U=e.m,F=e.E,V=e.ax,J=e.a7,Y=e.a1,Z=e.ay,K=e.az,q=e.aA,Q=e.aB,X=e.aC,ee=e.aD,se=e.aE,ne=e.aF,te=e.k,re=e.W,ie=e.U,oe=e.V},e=>{ae=e.u,le=e.r,ce=e.C,he=e.M,de=e.L,ue=e.n,xe=e.S,pe=e.R,ge=e.a,me=e.b,je=e.c,fe=e.d,be=e.e,we=e.f,ye=e.g,ve=e.h,ze=e.i,ke=e.E,Ce=e.s,Se=e.j,_e=e.k,Oe=e.m,Ee=e.l,Me=e.o,He=e.p,Re=e.q,Ne=e.t,Ae=e.v,Pe=e.w,Te=e.x,Ie=e.y,Le=e.z,Be=e.A,De=e.B,We=e.D,Ge=e.F,$e=e.G,Ue=e.H,Fe=e.I,Ve=e.J,Je=e.K,Ye=e.N,Ze=e.O,Ke=e.P,qe=e.Q,Qe=e.T,Xe=e.U,es=e.V,ss=e.W,ns=e.X,ts=e.Y,rs=e.Z,is=e._,os=e.$,as=e.a0,ls=e.a1,cs=e.a2,hs=e.a3,ds=e.a4,us=e.a5,xs=e.a6,ps=e.a7,gs=e.a8,ms=e.a9,js=e.aa,fs=e.ab,bs=e.ac,ws=e.ad,ys=e.ae,vs=e.af,zs=e.ag,ks=e.ah,Cs=e.ai,Ss=e.aj,_s=e.ak,Os=e.al,Es=e.am,Ms=e.an,Hs=e.ao,Rs=e.ap,Ns=e.aq},e=>{As=e.u,Ps=e.b,Ts=e.a,Is=e.T},e=>{Ls=e.d,Bs=e.m,Ds=e.a,Ws=e.i,Gs=e.s,$s=e.u,Us=e.M},e=>{Fs=e.C}],execute:function(){t("default",(function(){return a.jsxs(a.Fragment,{children:[a.jsx(ht,{}),a.jsx(dt,{})]})}));var i=function(e){return ae(le.ready(),e)},Vs={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Js=e=>{const{isOpen:s,onClose:n}=e,{t:t}=As(),r=le.getAppVersion();return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:t("header.about.title")}),a.jsx(u,{}),a.jsxs(x,{paddingBottom:10,children:[a.jsxs(p,{direction:"row",children:[a.jsx(g,{boxSize:"128px",src:"/rmp//logo192.png"}),a.jsxs(p,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[a.jsx(m,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),a.jsx(m,{children:r}),a.jsx(m,{}),a.jsx(m,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),a.jsx(j,{margin:5,children:a.jsx(m,{fontSize:"xl",children:t("header.about.desc")})}),a.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),a.jsx(f,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),a.jsxs(b,{children:[a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),a.jsx(m,{fontSize:"sm",children:t("header.about.content1")}),a.jsx(m,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),a.jsx(m,{fontSize:"sm",children:t("header.about.langonginc")}),a.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),a.jsx(f,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),a.jsxs(b,{children:[a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),a.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),a.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),a.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),a.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),a.jsxs(b,{children:[a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),a.jsx(m,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),a.jsx(m,{fontSize:"sm",children:t("header.about.slackContent")}),a.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),a.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),a.jsxs(b,{children:[a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",pb:1,children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),a.jsx(m,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),a.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[a.jsx(y,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),a.jsxs(v,{display:"block",width:"100%",pb:1,children:[a.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),a.jsx(m,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function Ys(e){const s=e.sizes.shift(),n=Math.max(Math.ceil(s[0]),1),t=Math.max(Math.ceil(s[1]),1),r=[n-1,t-1,1,1],i=performance.now(),o="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let a,l;o?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(n,t)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=n,l.height=t);const c=a.getContext("2d"),h=l.getContext("2d");h&&(h.fillRect.apply(h,r),c.drawImage(l,n-1,t-1,1,1,0,0,1,1));const d=c&&0!==c.getImageData(0,0,1,1).data[3],u=parseInt(performance.now()-i);return[a,l].forEach((e=>{e.height=0,e.width=0})),o?(postMessage({width:n,height:t,testTime:u,isTestPass:d}),!d&&e.sizes.length&&setTimeout((()=>{Ys(e)}),0)):d?e.onSuccess({width:n,height:t,testTime:u}):(e.onError({width:n,height:t,testTime:u}),e.sizes.length&&setTimeout((()=>{Ys(e)}),0)),d}const Zs={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Ks={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},qs={};function Qs(e){const s=e.width===e.height,n=1===e.height,t=1===e.width,r=[];if(e.width&&e.height){const i=e.min||Ks.min,o=e.step||Ks.step;let a=Math.max(e.width,e.height);for(;a>=i;){const e=s||n?a:1,i=s||t?a:1;r.push([e,i]),a-=o}}else e.sizes.forEach((e=>{const i=s||n?e:1,o=s||t?e:1;r.push([i,o])}));return r}function Xs(s){const n="undefined"!=typeof window,t=n&&"Promise"in window,i=n&&"HTMLCanvasElement"in window,a=n&&"OffscreenCanvas"in window,l=URL.createObjectURL(new Blob([])).slice(-36),c=performance.now(),{onError:h,onSuccess:d}=s,u=o(s,e),x=()=>parseInt(performance.now()-c);let p=null;if(!i)return!1;if(s.useWorker&&a){const e=`\n            var canvasTest = ${Ys.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,s=new Blob([e],{type:"application/javascript"}),n=URL.createObjectURL(s);p=new Worker(n),URL.revokeObjectURL(n),p.onmessage=function(e){const{width:s,height:n,testTime:t,isTestPass:r}=e.data,i={width:s,height:n,testTime:t,totalTime:x()};r?(qs[l].onSuccess(i),delete qs[l]):qs[l].onError(i)}}return t?new Promise((e=>{const n=r(r({},s),{},{onError(n){let{width:t,height:i,testTime:o}=n;const a={width:t,height:i,testTime:o,totalTime:x()};let l;if(0===s.sizes.length)l=!0;else{const[[e,n]]=s.sizes.slice(-1);l=t===e&&i===n}h(a),l&&e(r(r({},a),{},{success:!1}))},onSuccess(s){let{width:n,height:t,testTime:i}=s;const o={width:n,height:t,testTime:i,totalTime:x()};d(o),e(r(r({},o),{},{success:!0}))}});if(p){const{onError:e,onSuccess:s}=n;qs[l]={onError:e,onSuccess:s},p.postMessage(u)}else Ys(n)})):p?(qs[l]={onError:h,onSuccess:d},void p.postMessage(u)):Ys(s)}const en={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=Qs({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...Zs.area]});return Xs(r(r(r({},Ks),e),{},{sizes:s}))},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=Qs({width:1,height:e.max,min:e.min,step:e.step,sizes:[...Zs.height]});return Xs(r(r(r({},Ks),e),{},{sizes:s}))},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=Qs({width:e.max,height:1,min:e.min,step:e.step,sizes:[...Zs.width]});return Xs(r(r(r({},Ks),e),{},{sizes:s}))},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=r(r({},Ks),e);return s.sizes=[...s.sizes],s.width&&s.height&&(s.sizes=[[s.width,s.height]]),Xs(s)}};var sn=(e=>(e.left="l",e.right="r",e))(sn||{}),nn=(e=>(e.through="through",e.nonThrough="nonthrough",e))(nn||{}),tn=(e=>(e.local="local",e.express="express",e.direct="direct",e))(tn||{}),rn=(e=>(e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro",e))(rn||{}),on=(e=>(e.sh="sh",e.sh2020="sh2020",e))(on||{});const an=new Set,ln=new Set,cn=new Set,hn=new Set,dn=new Map,un=new Map,xn=new Set,pn=new Map,gn=new Map;let mn=[],jn=0;const fn=new Map,bn=new Map,wn=new Set,yn={localisedName:{en:"LEFT END"},num:"00",services:[tn.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:sn.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},vn={localisedName:{en:"RIGHT END"},num:"00",services:[tn.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:sn.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},zn={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:rn.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:sn.right,platform_num:"1",theme:[ce.Shanghai,"sh1","#E3002B",he.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:{},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:on.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},kn={localisedName:{},num:"",services:[tn.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:sn.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Cn=e=>`${e[0]}/${e[1]}=${e[2]}${e[3]}`,Sn=e=>de.has(e),_n=(e,s)=>{const[n,t]=e.extremities(s),r=e.getEdgeAttributes(s),i=r.style;if(n!=t&&Sn(i)){const e=(e=>{if(Sn(e.style))return structuredClone(e[e.style].color)})(r);hn.has(Cn(e))||(cn.add(e),hn.add(Cn(e)),dn.set(e,n),un.set(Cn(e),new Set)),un.get(Cn(e)).add(n),un.get(Cn(e)).add(t),gn.has(n)?mn.push({target:t,next:gn.get(n),color:e}):mn.push({target:t,next:-1,color:e}),gn.set(n,jn),jn++,gn.has(t)?mn.push({target:n,next:gn.get(t),color:e}):mn.push({target:n,next:-1,color:e}),gn.set(t,jn),jn++}},On=(e,s,n)=>{if(un.get(Cn(n)).has(e)){un.get(Cn(n)).delete(e);for(let s=gn.get(e);-1!=s;s=mn[s].next){const t=mn[s].target,r=mn[s].color;Cn(r)==Cn(n)&&On(t,e,n)}}},En=(e,s,n)=>{if(an.has(e))return;an.add(e);let t=0;const r=new Set;for(let i=gn.get(e);-1!=i;i=mn[i].next){const o=mn[i].target,a=mn[i].color;Cn(a)==Cn(n)&&(r.has(o)||(r.add(o),t++,o!=s&&En(o,e,n)))}fn.set(e,t)},Mn=(e,s)=>{const n=e.stn_list.lineend.parents;n.push(s),e.stn_list.lineend.parents=structuredClone(n).reverse(),e.stn_list.lineend.branch=r(r({},e.stn_list.lineend.branch),{},{left:2==e.stn_list.lineend.parents.length?[nn.through,n[1]]:void 0})},Hn=(e,s,n)=>{if(wn.has(e))return[];wn.add(e);const t=[];for(let r=gn.get(e);-1!=r;r=mn[r].next){const i=mn[r].target,o=mn[r].color;i!=s&&(Cn(o)==Cn(n)&&(i.startsWith("stn")?t.push(i):t.push(...Hn(i,e,n))))}return t},Rn=(e,s,n,t,i,o,a)=>{if(an.has(e)&&(!e.startsWith("misc_node_")&&null==a.stn_list[e]||e.startsWith("misc_node_")&&!ln.has(e)||a.loop))return[];if(an.has(e)&&null!=a.stn_list[e]&&((e,s)=>{let n=0;for(let t=gn.get(e);-1!=t;t=mn[t].next){mn[t].target;const e=mn[t].color;Cn(e)==Cn(s)&&n++}return n})(e,o)-1>=2){var l;const n=[...a.stn_list[e].parents,s];if(null==a.stn_list[n[1]]){const e=n[0];n[0]=n[1],n[1]=e}a.stn_list[e].parents=structuredClone(n).reverse(),a.stn_list[e].branch=r(r({},a.stn_list[e].branch),{},{left:[nn.through,n[1]]});const t=[];for(const r of a.stn_list[e].children)r!=s&&t.push(r);a.stn_list[e].children=structuredClone(t),null===(l=a.stn_list[e].branch)||void 0===l||delete l.right;const i=[];for(const s of a.stn_list.lineend.parents)s!=e&&i.push(s);return a.stn_list.lineend.parents=structuredClone(i).reverse(),a.stn_list.lineend.branch=r(r({},a.stn_list.lineend.branch),{},{left:2==a.stn_list.lineend.parents.length?[nn.through,i[1]]:void 0}),0==t.length&&(a.stn_list[e].children=["lineend"],Mn(a,e)),[e]}an.add(e);const c=[],h=[],d=[],u=new Set,x=new Set;for(let r=gn.get(e);-1!=r;r=mn[r].next){const l=mn[r].target,h=mn[r].color;if(l!=n){if(Cn(h)==Cn(o)){if(x.has(l))continue;if(x.add(l),e.startsWith("misc_node_")){const n=Rn(l,s,e,t+1,i,o,a);0!=n.length&&c.push(...n)}else{const s=Rn(l,e,e,t+1,i,o,a);0!=s.length&&c.push(...s)}}if(!u.has(Cn(h))&&Cn(h)!=Cn(o)){u.add(Cn(h));const e={theme:h,name:[`ch_${Cn(h)}`,`en_${Cn(h)}`]};d.push(e)}}}if(2==c.length){for(let e=0;e<2;e++)"lineend"==c[e]&&c.splice(e,1);if(a.stn_list[c[1]].parents.length>=2){const e=c[0];c[0]=c[1],c[1]=e}}if(an.has(e)&&null!=a.stn_list[e]){const n=[];for(const s of a.stn_list.lineend.parents)s!=e&&n.push(s);a.stn_list.lineend.parents=structuredClone(n).reverse(),a.stn_list.lineend.branch=r(r({},a.stn_list.lineend.branch),{},{left:2==a.stn_list.lineend.parents.length?[nn.through,n[1]]:void 0}),0==c.length&&(wn.clear(),h.push(...Hn(e,s,o)))}if(e.startsWith("misc_node_"))return ln.add(e),c;{const n=i.getNodeAttributes(e).type,l=i.getNodeAttributes(e)[n];if(a.stn_list[e]=structuredClone(kn),a.stn_list[e].localisedName={zh:l.names[0],en:l.names[1]},a.stn_list[e].num=String(t),i.getNodeAttributes(e).type==xe.GzmtrBasic){const s=l;a.stn_list[e].num=s.stationCode,""===s.secondaryNames[0]&&""===s.secondaryNames[1]||(a.stn_list[e].localisedSecondaryName={zh:s.secondaryNames[0],en:s.secondaryNames[1]})}if(i.getNodeAttributes(e).type==xe.GzmtrInt){const s=l,n=s.transfer[0];for(const t of n)if(Cn(t)==Cn(o)){a.stn_list[e].num=String(t[5]);break}""===s.secondaryNames[0]&&""===s.secondaryNames[1]||(a.stn_list[e].localisedSecondaryName={zh:s.secondaryNames[0],en:s.secondaryNames[1]})}return 0!=c.length?(a.stn_list[e].children=structuredClone(c).reverse(),2==c.length&&(a.stn_list[e].branch=r(r({},a.stn_list[e].branch),{},{right:[nn.through,c[1]]}))):(a.stn_list[e].children=["lineend"],Mn(a,e)),h.push(s),a.stn_list[e].parents=structuredClone(h).reverse(),2==h.length&&(a.stn_list[e].branch=r(r({},a.stn_list[e].branch),{},{left:[nn.through,h[1]]})),0!=d.length&&(a.stn_list[e].transfer.groups[0].lines=structuredClone(d)),[e]}},Nn=(e,s,n,t)=>{const r=structuredClone(zn);let i;switch("LOOP"==t&&(r.loop=!0),e.getNodeAttributes(n).type){case xe.GzmtrBasic:case xe.GzmtrInt:i=rn.GZMTR;break;case xe.MTR:i=rn.MTR;break;default:i=rn.SHMetro}r.theme=structuredClone(s),r.style=i,r.stn_list.linestart=structuredClone(yn),r.stn_list.lineend=structuredClone(vn),an.clear(),ln.clear();const o=Rn(n,"linestart","linestart",1,e,s,r);return r.current_stn_idx=o[0],r.stn_list.linestart.children=[o[0]],Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3?void 0:structuredClone(r)},An=(e,s,n,t)=>{var r;e.line_name=s,e.line_num=String(n),Ls(`RMG_${r=s,""!=r[0]&&""!=r[1]?r[0]+"_"+r[1]:""!=r[0]?r[0]:""!=r[1]?r[1]:`${(new Date).valueOf()}`}.json`,"application/json",((e,s)=>{let n=e;return s.forEach(((e,s)=>{const t=new RegExp(`ch_${s}`,"g"),r=new RegExp(`en_${s}`,"g");n=n.replace(t,e[0]),n=n.replace(r,e[1])})),n})(JSON.stringify(e),t))},Pn={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Tn=e=>{const{isOpen:s,onClose:n}=e,{t:t}=As(),r=Ps.useRef(window.graph),[i,o]=Ps.useState(!1),[p,g]=Ps.useState([[zn,"",""]]),[j,f]=Ps.useState(["","",""]),[b,w]=Ps.useState(new Map),[y,v]=Ps.useState(new Map),[S,_]=Ps.useState([]);Ps.useEffect((()=>{if(s){const e=(e=>{an.clear(),cn.clear(),hn.clear(),dn.clear(),un.clear(),xn.clear(),pn.clear(),gn.clear(),mn=[],jn=0,fn.clear(),bn.clear(),e.filterEdges((e=>e.startsWith("line"))).forEach((s=>{Sn(e.getEdgeAttributes(s).style)&&_n(e,s)}));let s=0;e.forEachNode((e=>{bn.set(e,++s)})),bn.set("lineend",++s);const n=[];for(const i of cn){let e=0;for(;0!=un.get(Cn(i)).size;){let s="line_root";un.get(Cn(i)).forEach((e=>{"line_root"==s&&(s=e)})),On(s,"line_root",i);const n={theme:i,index:++e};xn.add(n),pn.set(n,s)}}for(const i of xn){const{theme:s}=i;an.clear(),fn.clear(),En(pn.get(i),"line_root",s);let o=!0,a="LINE";const l=[];for(const[e,n]of fn)1==n&&l.push(e),3==n&&(a="BRANCH"),n>3&&(o=!1);if(!o)continue;0==l.length&&(a="LOOP",fn.forEach(((e,s)=>{l.push(s)})));const c=[];for(const n of l){const i=Nn(e,s,n,a);var t,r;null!=i&&c.push([i,null!==(t=i.stn_list[i.current_stn_idx].localisedName.zh)&&void 0!==t?t:"",null!==(r=i.stn_list[i.current_stn_idx].localisedName.en)&&void 0!==r?r:""])}0!=c.length&&n.push({id:ue(10),theme:s,param:structuredClone(c),type:a})}return n})(r.current),s=new Map;e.forEach((({id:e,theme:n})=>{s.set(Cn(n),e)})),_(e),w(s)}}),[s]);const O=(e,s)=>document.getElementById("2RMG_"+s+"_"+e).value.trim();return a.jsxs(l,{isOpen:s,onClose:n,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:a.jsx(m,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),a.jsx(u,{}),a.jsxs(x,{children:[a.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),a.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),a.jsx("br",{}),0===S.length?a.jsx(m,{fontSize:"md",children:t("header.download.2rmg.noline")}):a.jsx("table",{children:a.jsx("tbody",{children:S.map((({id:e,theme:s,param:n,type:r})=>a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx(pe,{name:"other"==s[0]&&"other"==s[1]?s[2]:s[1],bg:s[2],fg:s[3]})}),a.jsx("td",{children:a.jsx(z,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:`2RMG_nameCh_${e}`,size:"sm"})}),a.jsx("td",{children:a.jsx(z,{placeholder:t("header.download.2rmg.placeholder.english"),id:`2RMG_nameEn_${e}`,size:"sm"})}),a.jsx("td",{children:a.jsx(z,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:`2RMG_lineNum_${e}`,size:"sm"})}),a.jsx("td",{children:a.jsx(pe,{name:t(`header.download.2rmg.type.${r.toLowerCase()}`),bg:Pn[r],fg:he.white})}),a.jsx("td",{children:a.jsx(k,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const s=O(e,"nameCh"),t=O(e,"nameEn"),r=O(e,"lineNum"),i=new Map;b.forEach(((e,s)=>{i.set(s,[O(e,"nameCh"),O(e,"nameEn")])})),g(n),f([s,t,r]),v(i),o(!0)},size:"sm",children:a.jsx(ge,{})})})]},e)))})})]}),a.jsx(C,{children:a.jsx(k,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:t("close")})})]}),a.jsx(In,{isOpen:i,onClose:()=>o(!1),param:p,nameList:j,interchangeName:y})]})},In=e=>{const{isOpen:s,onClose:n,param:t,nameList:r,interchangeName:i}=e,{t:o}=As(),[p,g]=Ps.useState("");return Ps.useEffect((()=>{""!=r[0]&&""!=r[1]?g(r[0]+"/"+r[1]):""!=r[0]?g(r[0]):""!=r[1]?g(r[1]):g("")}),[...r]),a.jsxs(l,{isOpen:s,onClose:n,size:"md",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:a.jsxs(m,{as:"b",fontSize:"xl",children:[o("header.download.2rmg.download")," ",p]})}),a.jsx(u,{}),a.jsx(x,{children:a.jsxs(S,{children:[a.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:o("header.download.2rmg.downloadInfo")}),t.map((([e,s,n])=>a.jsxs(k,{onClick:()=>{An(e,[r[0],r[1]],r[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[s.replaceAll("\n","⏎"),"/",n.replaceAll("\n","⏎")]},`${s}${n}`)))]})}),a.jsx(C,{children:a.jsx(k,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("close")})})]})]})},Ln=e=>{const{isOpen:s,onClose:n}=e,{t:t}=As();return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:t("header.download.termsAndConditions")}),a.jsx(u,{}),a.jsx(x,{children:a.jsxs(_,{children:[a.jsxs(O,{children:["The layout of the elements on the signage or rail map, is designed by"," ",a.jsxs(E,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",a.jsx(M,{as:me})]}),", ",a.jsxs(E,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",a.jsx(M,{as:me})]})," or ",a.jsxs(E,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",a.jsx(M,{as:me})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",a.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",a.jsxs(E,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",a.jsx(M,{as:me})]}),"，",a.jsxs(E,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",a.jsx(M,{as:me})]}),"或",a.jsxs(E,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",a.jsx(M,{as:me})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),a.jsxs(O,{children:["The elements including shapes and lines on the image are drawn by"," ",a.jsxs(E,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",a.jsx(M,{as:me})]})," and ",a.jsxs(E,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",a.jsx(M,{as:me})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",a.jsx("br",{}),"图像的元素，包括图形及线条，均由",a.jsxs(E,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",a.jsx(M,{as:me})]}),"及",a.jsxs(E,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",a.jsx(M,{as:me})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),a.jsxs(O,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",a.jsxs(E,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",a.jsx(M,{as:me})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",a.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",a.jsxs(E,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",a.jsx(M,{as:me})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),a.jsxs(O,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",a.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),a.jsxs(O,{children:["All flag emojis shown on Windows platforms are designed by"," ",a.jsxs(E,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",a.jsx(M,{as:me})]})," ","– the open-source emoji and icon project. License:",a.jsxs(E,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",a.jsx(M,{as:me})]}),a.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",a.jsxs(E,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",a.jsx(M,{as:me})]}),"所设计。许可证：",a.jsxs(E,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",a.jsx(M,{as:me})]})]}),a.jsxs(O,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",a.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Bn(){const e=H("white","var(--chakra-colors-gray-800)"),s=je(),{telemetry:{project:n}}=fe((e=>e.app)),t=fe((e=>e.param)),r=le.isAllowAnalytics(),{t:i}=As(),o=Ps.useRef(window.graph),[p,g]=Ps.useState("png"),j={png:i("header.download.png"),svg:i("header.download.svg")},[f,b]=Ps.useState(2),[w,y]=Ps.useState({width:1,height:1,benchmark:.001}),[v,z]=Ps.useState(200),S=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],_=Object.fromEntries(S.map((e=>[e,`${e}%`]))),[O,D]=Ps.useState([]),[W,G]=Ps.useState(!1),$=[{type:"select",label:i("header.download.format"),value:p,options:j,onChange:e=>g("png"===e?"png":"svg")}],U=[{type:"select",label:i("header.download.svgVersion"),value:f,options:{1.1:i("header.download.svg1.1"),2:i("header.download.svg2")},onChange:e=>{b(e),1.1===e&&q(!0)}}],F=[{type:"select",label:i("header.download.scale"),value:v,options:_,disabledOptions:O,onChange:e=>z(e)},{type:"switch",label:i("header.download.transparent"),isChecked:W,onChange:G}],[V,J]=Ps.useState(!1),[Y,Z]=Ps.useState(!1),[K,q]=Ps.useState(!1),[Q,X]=Ps.useState(!1),[ee,se]=Ps.useState(!1),[ne,te]=Ps.useState(!1);Ps.useEffect((()=>{(async()=>{const e=await en.maxArea({usePromise:!0,useWorker:!0});y(e)})()}),[]),Ps.useEffect((()=>{if(V){const{xMin:e,yMin:s,xMax:n,yMax:t}=be(o.current),[r,i]=[n-e,t-s],a=S.filter((e=>r*e/100>w.width&&i*e/100>w.height));D(a)}}),[V]);return a.jsxs(R,{id:"download",children:[a.jsx(N,{as:A,size:"sm",variant:"ghost",icon:a.jsx(ge,{})}),a.jsxs(P,{children:[a.jsx(T,{icon:a.jsx(we,{}),onClick:()=>{r&&le.event(ke.DOWNLOAD_PARAM,n?{"#nodes":o.current.order,"#edges":o.current.size}:{}),Ls(`RMP_${(new Date).valueOf()}.json`,"application/json",Ce(t))},children:i("header.download.config")}),a.jsxs(T,{icon:a.jsx(ye,{}),onClick:()=>te(!0),children:[i("header.download.2rmg.title"),a.jsx(I,{ml:"1",colorScheme:"green",children:"New"})]}),a.jsx(T,{icon:a.jsx(ve,{}),onClick:()=>J(!0),children:i("header.download.image")})]}),a.jsxs(l,{size:"xl",isOpen:V,onClose:()=>J(!1),children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:i("header.download.image")}),a.jsx(u,{}),a.jsxs(x,{children:[a.jsx(ze,{fields:$}),"svg"===p&&a.jsx(ze,{fields:U}),"png"===p&&a.jsx(ze,{fields:F}),"png"===p&&O.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(m,{as:"i",fontSize:"sm",children:i("header.download.disabledScaleOptions")}),a.jsx("br",{}),a.jsx(m,{as:"i",fontSize:"sm",children:i("header.download.disabledScaleOptionsWorkarounds")}),a.jsxs(E,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",a.jsx(M,{as:me})]}),a.jsx("br",{})]}),a.jsx("br",{}),a.jsx(L,{isChecked:K,isDisabled:"svg"===p&&1.1===f,onChange:e=>q(e.target.checked),children:a.jsx(m,{children:i("header.download.useSystemFonts")})}),a.jsx(L,{isChecked:Q,onChange:e=>X(e.target.checked),children:a.jsxs(m,{children:[i("header.download.shareInfo1"),a.jsxs(E,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[i("header.about.rmp")," ",a.jsx(M,{as:me})]}),i("header.download.shareInfo2")]})}),a.jsx(L,{isChecked:ee,onChange:e=>se(e.target.checked),children:a.jsxs(m,{children:[i("header.download.termsAndConditionsInfo"),a.jsxs(E,{color:"teal.500",onClick:()=>Z(!0),children:[i("header.download.termsAndConditions")," ",a.jsx(M,{as:me})]}),i("header.download.period")]})})]}),a.jsx(C,{children:a.jsx(B,{children:a.jsx(k,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!ee||"png"===p&&O.includes(v),onClick:async()=>{J(!1),r&&le.event(ke.DOWNLOAD_IMAGES,n?{numberOfNodes:o.current.order,numberOfEdges:o.current.size}:{});const{elem:t,width:a,height:l}=await Bs(o.current,Q,K,f),c=t.outerHTML.replace(/&nbsp;/g," ");if("svg"===p)return void Ls(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",c);document.body.appendChild(t);const h="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(c)));document.body.removeChild(t),t.remove();const d=document.createElement("canvas"),[u,x]=[a*v/100,l*v/100];d.width=u,d.height=x;const g=d.getContext("2d");W||(g.fillStyle=e,g.fillRect(0,0,u,x));const m=new Image;m.onload=()=>{setTimeout((()=>{g.drawImage(m,0,0,u,x),d.toBlob((e=>{e?Ds(`RMP_${(new Date).valueOf()}.png`,e):s(Se({status:"error",message:i("header.download.imageTooBig")}))}),"image/png")}),Ws()?2e3:0)},m.src=h},children:i("header.download.confirm")})})}),a.jsx(Ln,{isOpen:Y,onClose:()=>Z(!1)})]})]}),a.jsx(Tn,{isOpen:ne,onClose:()=>te(!1)})]})}const Dn=(e,{info_panel_type:s,line_num:n,stn_list:t,style:i,theme:o},a,l,c)=>{const h=Object.fromEntries(Object.keys(t).filter((e=>!["linestart","lineend"].includes(e))).map((e=>[e,`stn_${ue(10)}`])));Object.entries(t).filter((([e,s])=>!["linestart","lineend"].includes(e))).forEach((([s,n])=>{const t=e.filterNodes(((e,s)=>Object.values(xe).includes(s.type)&&s[s.type].names[0]===n.localisedName.zh));0!==t.length&&(h[s]=t[0])}));const d=[["linestart",-1,0]],u={};for(;d.length;){const[e,s,n]=d.shift();t[e].children.filter((e=>"lineend"!=e)).forEach(((e,t)=>{const r=Math.max(t,n+t);u[e]={x:150*s,y:75*r},d.push([e,s+1,r])}))}Object.entries(t).filter((([e,s])=>!["linestart","lineend"].includes(e))).filter((([s,n])=>0===e.filterNodes(((e,s)=>Object.values(xe).includes(s.type)&&s[s.type].names[0]===n.localisedName.zh)).length)).map((([e,t])=>{var c,d;let x=xe.ShmetroBasic;const p=t.transfer.groups,g=p.map((e=>{var s;return null!==(s=e.lines)&&void 0!==s?s:[]})).flat();i===rn.SHMetro?x=g.length>0?xe.ShmetroInt:s===on.sh2020?xe.ShmetroBasic2020:xe.ShmetroBasic:i===rn.GZMTR?x=g.length>0?xe.GzmtrInt:xe.GzmtrBasic:i===rn.MTR&&(x=xe.MTR);const m=r(r({},structuredClone(Gs[x].defaultAttrs)),{},{names:[null!==(c=t.localisedName.zh)&&void 0!==c?c:"",null!==(d=t.localisedName.en)&&void 0!==d?d:""]});if(x===xe.ShmetroBasic2020)m.color=o;else if(x===xe.GzmtrBasic)m.color=o,m.lineCode=n,m.stationCode=t.num;else if(x===xe.GzmtrInt)m.transfer=p.map(((e,s)=>{var r,i;const a=null!==(r=null===(i=e.lines)||void 0===i?void 0:i.map((e=>{var s;return[...null!==(s=e.theme)&&void 0!==s?s:o,"1","01"]})))&&void 0!==r?r:[];return 0===s?[[...o,n,t.num],...a]:a}));else if(x===xe.MTR){var j;null!==(j=p[0].lines)&&void 0!==j&&j.length?m.transfer=[[[...o,"",""],...p[0].lines.map((e=>{var s;return[...null!==(s=e.theme)&&void 0!==s?s:o,"",""]}))]]:m.transfer=[[]]}return{node:h[e],attr:{visible:!0,zIndex:0,x:a+u[e].x,y:l+u[e].y,type:x,[x]:m}}})).forEach((({node:s,attr:n})=>e.addNode(s,n))),Object.entries(t).filter((([e,s])=>!["linestart","lineend"].includes(e))).forEach((([s,n])=>{n.children.filter((e=>!["linestart","lineend"].includes(e))).forEach((n=>{const t=_e.Diagonal,[r,i]=[h[s],h[n]],a=c?Oe(e,t,r,i,"from"):-1;e.addDirectedEdgeWithKey(`line_${ue(10)}`,r,i,{visible:!0,zIndex:0,type:t,[_e.Diagonal]:structuredClone(Me[_e.Diagonal].defaultAttrs),style:Ee.SingleColor,[Ee.SingleColor]:{color:o},reconcileId:"",parallelIndex:a})}))}))},Wn="rmg-bridge--",Gn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function $n(e){const{isOpen:s,onClose:n}=e,{t:t}=As(),{preference:{autoParallel:r}}=fe((e=>e.app)),{svgViewBoxZoom:i,svgViewBoxMin:o}=fe((e=>e.param)),l=je(),c=le.isAllowAnalytics(),h=$s(),{height:d,width:u}=He(h),x=Ts.useRef(window.graph),[p]=Ts.useState(crypto.randomUUID()),g="/rmg/#/import?"+new URLSearchParams({parentComponent:le.getAppName(),parentId:p}),m=Ts.useCallback((()=>{l(Re()),l(Ne()),l(Ae(x.current.export()))}),[l,Re,Ne,Ae,x]);return Ts.useEffect((()=>{const e=new BroadcastChannel(Wn+p);return e.onmessage=e=>{const{event:s,data:a}=e.data;console.log("[rmp] Received event from RMG app clip:",s),"CLOSE"===s?n():"IMPORT"===s&&(e=>{try{c&&le.event(ke.IMPORT_RMG_PARAM,{});const s=o.x+u*i/100/3,n=o.y+d*i/100/3;Dn(x.current,e,s,n,r),m()}catch(s){l(Se({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",s)}finally{n()}})(a)},()=>e.close()}),[o.x,o.y,i,d,u,r]),a.jsx(Pe,{isOpen:s,onClose:n,sx:Gn,children:a.jsx("iframe",{src:g,loading:"lazy"})})}const Un="OPEN_TEMPLATE",Fn=new BroadcastChannel("RMP_GALLERY_CHANNEL"),Vn={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function Jn(e){const{isOpen:n,onClose:t}=e,r=D(),{t:i}=As(),l=je(),{telemetry:{project:c}}=fe((e=>e.app)),h=le.isAllowAnalytics(),d=Ps.useRef(window.graph),u=Ps.useCallback((()=>{l(Re()),l(Ne()),l(Ae(d.current.export()))}),[l,Re,Ne,Ae,d]),x=async(e,n)=>{var t;const a=n?`https://${n}`:"",x=await(null===(t=(await Promise.allSettled([fetch(`${a}/rmp-gallery/resources/real_world/${e}.json`),fetch(`${a}/rmp-gallery/resources/fantasy/${e}.json`)])).filter((e=>"fulfilled"===e.status)).find((e=>200===e.value.status)))||void 0===t?void 0:t.value.json());if(x){if(h){const s={id:e};c&&n&&(s.host=n),le.event(ke.IMPORT_WORK_FROM_GALLERY,s)}(async e=>{const n=JSON.parse(await Te(JSON.stringify(e))),{version:t}=n,r=o(n,s);l(Ie()),d.current.clear(),d.current.import(r.graph),u();const{svgViewBoxZoom:i,svgViewBoxMin:a}=r;"number"==typeof i&&l(Le(i)),"number"==typeof a.x&&"number"==typeof a.y&&l(Be(a))})(x),r({title:i("header.open.importFromRMPGallery",{id:e}),status:"success",duration:9e3,isClosable:!0})}else r({title:i("header.open.failToImportFromRMPGallery",{id:e}),status:"error",duration:9e3,isClosable:!0});le.updateAppMetadata({hash:""})};return Ps.useEffect((()=>{const e=new URL(window.location.href).searchParams;if(e.size>0){const s=e.keys().next().value,n=s.indexOf("."),t=s.substring(0,-1===n?void 0:n);let r;-1!==n&&(r=s.substring(n+1)),x(t,r)}}),[]),Ps.useEffect((()=>(Fn.onmessage=e=>{const{event:s,data:n}=e.data;s===Un&&(x(n),t())},()=>Fn.close())),[]),a.jsxs(Pe,{isOpen:n,onClose:t,size:"full",sx:Vn,children:[a.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),a.jsx(W,{onClick:t,position:"fixed",top:"5px",right:"15px"})]})}function Yn(){const e=je(),{t:s}=As(),t=$s(),{height:r}=He(t),i=Ps.useRef(window.graph),l=Ps.useRef(null),[c,h]=Ps.useState(!1),[d,u]=Ps.useState(!1),x=Ps.useCallback((()=>{e(Re()),e(Ne()),e(Ae(i.current.export()))}),[e,Re,Ne,Ae,i]),p=async s=>{const t=JSON.parse(await Te(s)),{version:r}=t,a=o(t,n);e(Ie()),i.current.clear(),i.current.import(a.graph),x();const{svgViewBoxZoom:l,svgViewBoxMin:c}=a;"number"==typeof l&&e(Le(l)),"number"==typeof c.x&&"number"==typeof c.y&&e(Be(c))};return Ps.useEffect((()=>{const e=async e=>{const{type:s,key:n,from:t}=e.data;if(s===Ve.SAVE_CHANGED&&n===Je.PARAM&&"rmt"===t){Ye.debug(`Received save changed event on key: ${n}`);const e=localStorage.getItem(Je.PARAM);if(!e)return;await p(e)}};return De.addEventListener("message",e),()=>De.removeEventListener("message",e)}),[]),a.jsxs(R,{children:[a.jsx(N,{as:A,size:"sm",variant:"ghost",icon:a.jsx(We,{})}),a.jsxs(P,{children:[a.jsx(T,{icon:a.jsx(Ge,{}),onClick:()=>{e(Ie()),i.current.clear(),e(Le(100)),e(Be({x:0,y:0})),x()},children:s("header.open.new")}),a.jsx("input",{id:"upload_project",ref:l,type:"file",accept:".json",hidden:!0,onChange:async n=>{var t;const r=null===(t=n.target.files)||void 0===t?void 0:t[0];if(console.log("OpenActions.handleUpload():: received file",r),"application/json"!==(null==r?void 0:r.type))e(Se({status:"error",message:s("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const e=await Zn(r);await p(e)}catch(i){e(Se({status:"error",message:s("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",i)}n.target.value=""},"data-testid":"file-upload"}),a.jsx(T,{icon:a.jsx(We,{}),onClick:()=>{var e;return null==l||null===(e=l.current)||void 0===e?void 0:e.click()},children:s("header.open.config")}),a.jsx(T,{icon:a.jsx($e,{}),onClick:()=>h(!0),children:s("header.open.projectRMG")}),a.jsxs(T,{icon:a.jsx(me,{}),onClick:()=>u(!0),children:[s("header.open.gallery"),a.jsx(I,{ml:"1",colorScheme:"green",children:"New"})]}),a.jsx(T,{icon:a.jsx(Ue,{}),onClick:async()=>{await p(await Fe()),e(Be({x:-10,y:-13}));const s=Math.max(0,Math.min(400,-.132*r+117.772));e(Le(s)),le.event(ke.LOAD_TUTORIAL,{})},children:s("header.open.tutorial")})]}),a.jsx($n,{isOpen:c,onClose:()=>h(!1)}),a.jsx(Jn,{isOpen:d,onClose:()=>u(!1)})]})}const Zn=e=>new Promise((s=>{const n=new FileReader;n.onloadend=()=>s(n.result),n.readAsText(e)})),Kn=()=>{const[e,s]=Ps.useState(!1),{t:n}=As(),t=je(),r=Ps.useRef(window.graph),i=$s(),{width:o,height:l}=He(i),[c,h]=Ps.useState([]);Ps.useEffect((()=>{e&&h(r.current.nodes().filter((e=>e.startsWith("stn"))).map((e=>{const s=r.current.getNodeAttributes(e);return{id:e,value:s[s.type].names.join("/")}})))}),[e]);return a.jsxs(G,{isOpen:e,onOpen:()=>s(!0),onClose:()=>s(!1),children:[a.jsx($,{children:a.jsx(A,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:a.jsx(Ze,{}),onClick:()=>s(!e)})}),a.jsx(U,{children:a.jsx(F,{children:a.jsx(Ke,{label:n("header.search"),children:a.jsx(qe,{data:c,displayHandler:e=>a.jsx(I,{children:e.value}),filter:(e,s)=>s.value.toLowerCase().includes(e.toLowerCase())||Object.values(s.value).some((s=>s.toLowerCase().includes(e.toLowerCase()))),value:"",onChange:e=>(e=>{t(Qe(new Set([e])));const s=Math.max(0,Math.min(400,-.132*l+117.772)),{x:n,y:i}=Xe((o-300)/2,l/2,s,{x:-r.current.getNodeAttribute(e,"x"),y:-r.current.getNodeAttribute(e,"y")});t(Le(s)),t(Be({x:-n,y:-i}))})(e.id)})})})})]})},qn=e=>{const{isOpen:s,onClose:n}=e,t=je(),{theme:r,paletteAppClip:{output:i}}=fe((e=>e.runtime)),{t:o}=As(),p=Ps.useRef(window.graph),[g,m]=Ps.useState(r),[j,f]=Ps.useState(!1);Ps.useEffect((()=>{j&&i&&(m(i),f(!1))}),[null==i?void 0:i.toString()]);return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:o("header.settings.procedures.removeLines.title")}),a.jsx(u,{}),a.jsxs(x,{children:[o("header.settings.procedures.removeLines.content"),a.jsx(es,{theme:g,onClick:()=>{f(!0),t(ss(g))}})]}),a.jsxs(C,{children:[a.jsx(k,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:o("cancel")}),a.jsx(k,{colorScheme:"red",onClick:()=>{p.current.filterEdges(((e,s,n,t,r,i,o)=>de.has(s.style)&&JSON.stringify(s[s.style].color)===JSON.stringify(g))).forEach((e=>p.current.dropEdge(e))),t(Ne()),t(Ae(p.current.export())),n()},children:o("remove")})]})]})]})},Qn=e=>{const{isOpen:s,onClose:n}=e,t=je(),{t:r}=As(),i=Ps.useRef(window.graph),[o,p]=Ps.useState(1),g=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:o.toString(),variant:"number",onChange:e=>p(Number(e)),minW:"full"}];return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:r("header.settings.procedures.scale.title")}),a.jsx(u,{}),a.jsxs(x,{children:[r("header.settings.procedures.scale.content"),a.jsx(ze,{fields:g})]}),a.jsxs(C,{children:[a.jsx(k,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:r("cancel")}),a.jsx(k,{colorScheme:"red",onClick:()=>{i.current.forEachNode(((e,s)=>{i.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)*o)),i.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)*o))})),t(Re()),t(Ne()),t(Ae(i.current.export())),n()},children:r("apply")})]})]})]})},Xn=e=>{const{isOpen:s,onClose:n}=e,t=je(),{t:r}=As(),i=Ps.useRef(window.graph),[o,p]=Ps.useState(0),[g,m]=Ps.useState(0),j=[{type:"input",label:r("header.settings.procedures.translate.x"),value:o.toString(),variant:"number",onChange:e=>p(Number(e)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:g.toString(),variant:"number",onChange:e=>m(Number(e)),minW:"full"}];return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:r("header.settings.procedures.translate.title")}),a.jsx(u,{}),a.jsxs(x,{children:[r("header.settings.procedures.translate.content"),a.jsx(ze,{fields:j})]}),a.jsxs(C,{children:[a.jsx(k,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:r("cancel")}),a.jsx(k,{colorScheme:"red",onClick:()=>{i.current.forEachNode(((e,s)=>{i.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)+o)),i.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)+g))})),t(Re()),t(Ne()),t(Ae(i.current.export())),n()},children:r("apply")})]})]})]})},et=e=>{const{isOpen:s,onClose:n}=e,t=je(),{preference:{unlockSimplePathAttempts:r}}=fe((e=>e.app)),{activeSubscriptions:i}=fe((e=>e.account)),{t:o}=As();return a.jsxs(l,{isOpen:s,onClose:n,size:"5xl",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:o("header.settings.procedures.unlockSimplePath.title")}),a.jsx(u,{}),a.jsxs(x,{children:[a.jsx(m,{mb:"2",children:o("header.settings.procedures.unlockSimplePath.content1")}),a.jsx(m,{mb:"2",children:o("header.settings.procedures.unlockSimplePath.content2")}),a.jsx(m,{mb:"2",children:o("header.settings.procedures.unlockSimplePath.content3")})]}),a.jsx(C,{children:a.jsx(V,{label:o("header.settings.pro"),isOpen:!i.RMP_CLOUD&&r>=0,children:a.jsx(k,{onClick:()=>{t(ns(-1))},isDisabled:!i.RMP_CLOUD||r<0,children:o(r>=0?"header.settings.procedures.unlockSimplePath.check":"header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},st=e=>{const{isOpen:s,onClose:n}=e,t=je(),r=D(),{t:i}=As(),o=Ps.useRef(window.graph),[p,g]=Ps.useState(!1);return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:i("header.settings.procedures.updateColor.title")}),a.jsx(u,{}),a.jsx(x,{children:a.jsx(m,{children:i("header.settings.procedures.updateColor.content")})}),a.jsxs(C,{children:[a.jsx(k,{colorScheme:"blue",variant:"outline",mr:"1",onClick:n,children:i("cancel")}),a.jsx(k,{colorScheme:"red",onClick:async()=>{g(!0);const e=JSON.stringify(o.current.export());try{const s=await rt(e);o.current.clear(),o.current.import(s),t(Re()),t(Ne()),t(Ae(o.current.export())),r({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(s){console.error(`[rmp] Error in updating all colors: ${s}`),r({title:i("header.settings.procedures.updateColor.error",{e:s}),status:"error",duration:9e3,isClosable:!0})}g(!1),n()},isLoading:p,children:i("apply")})]})]})]})},nt=e=>e.length>=4&&e.every((e=>"string"==typeof e))&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(he).includes(e[3]),tt=(e,s,n)=>{const t=s.split(".");let r=e;for(let i=0;i<t.length-1;i++)r=r[t[i]];r[t[t.length-1]]=n},rt=async e=>{const s=JSON.parse(e),n=(new Date).getTime(),t=(e=>{const s=[],n=(e,t)=>{if(Array.isArray(e)&&nt(e))s.push({path:t||"",value:e});else for(const r in e){const i=e[r],o=t?`${t}.${r}`:r;Array.isArray(i)?nt(i)?s.push({path:o,value:i}):i.forEach(((e,s)=>n(e,`${o}.${s}`))):i&&"object"==typeof i&&n(i,o)}};return n(e),s})(s);console.log("[rmp] Found all themes pending for update",t);let r,i=!1;const o=new Promise(((e,n)=>{r=setTimeout((()=>{i=!0,n("Executing time exceeds 10000ms")}),1e4),(async()=>{for(const{path:e,value:n}of t){if(i)throw new Error("Update aborted");const[t,r,o,a,...l]=n,c=await ts([t,r,o,a]);tt(s,e,[...c,...l])}})().then(e).catch(n)}));try{return await o,console.log(`[rmp] Themes update completed, elapsed time ${((new Date).getTime()-n)/1e3} sec`),s}finally{clearTimeout(r)}},it=()=>{const e=je(),{state:s,token:n}=fe((e=>e.account)),{t:t}=As(),[r,i]=Ps.useState(!1),[o,l]=Ps.useState(1);Ps.useEffect((()=>{let e;return r&&o>0?e=window.setTimeout((()=>{l(o-1)}),1e3):0===o&&i(!1),()=>clearTimeout(e)}),[r,o]);const c={"logged-out":t("header.settings.subscription.logged-out"),free:t("header.settings.subscription.free"),subscriber:t("header.settings.subscription.subscriber"),expired:t("header.settings.subscription.expired")};return a.jsxs(j,{width:"100%",mb:"3",children:[a.jsx(m,{as:"b",fontSize:"xl",children:t("header.settings.subscription.title")}),a.jsx(j,{mt:"3",children:a.jsxs(j,{display:"flex",mb:"1",children:[a.jsx(m,{flex:"1",children:c[s]}),a.jsx(A,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:a.jsx(rs,{}),isDisabled:r,onClick:()=>(i(!0),l(1),void(n&&is(e,n)))})]})})]})},ot={width:"100%",justifyContent:"space-between"},at={fontFamily:"-apple-system"},lt=e=>{const{isOpen:s,onClose:n}=e,{activeSubscriptions:t}=fe((e=>e.account)),{telemetry:{project:r},preference:{autoParallel:i,randomStationsNames:o,gridLines:p,snapLines:g}}=fe((e=>e.app)),{keepLastPath:f,parallelLinesCount:w}=fe((e=>e.runtime)),y=je(),{t:v}=As(),z=H("primary.500","primary.300"),[C,S]=Ps.useState(!1),[_,O]=Ps.useState(!1),[R,N]=Ps.useState(!1),[A,P]=Ps.useState(!1),[T,L]=Ps.useState(!1),[B,D]=Ps.useState(!1),[W,G]=Ps.useState(!1),$=le.isAllowAnalytics(),U=w>=(t.RMP_CLOUD?os:as),F=!t.RMP_CLOUD;return a.jsxs(l,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[a.jsx(c,{}),a.jsxs(h,{children:[a.jsx(d,{children:v("header.settings.title")}),a.jsx(u,{}),a.jsx(x,{children:a.jsxs(b,{divider:a.jsx(ne,{borderColor:"gray.200"}),children:[a.jsx(it,{}),a.jsxs(j,{width:"100%",mb:"3",children:[a.jsx(m,{as:"b",fontSize:"xl",children:v("header.settings.preference.title")}),a.jsxs(j,{mt:"3",children:[a.jsxs(j,{display:"flex",mb:"1",children:[a.jsx(m,{flex:"1",children:v("header.settings.preference.keepLastPath")}),a.jsx(J,{isChecked:f,onChange:({target:{checked:e}})=>y(ls(e))})]}),a.jsxs(j,{display:"flex",mb:"1",children:[a.jsx(m,{children:v("header.settings.preference.autoParallel")}),a.jsx(I,{ml:"auto",colorScheme:"green",children:"New"}),a.jsx(V,{label:v("header.settings.proWithTrial"),children:a.jsx(I,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),a.jsx(J,{ml:"1",isDisabled:U,isChecked:i,onChange:({target:{checked:e}})=>y(cs(e))})]}),a.jsxs(j,{mb:"1",display:"flex",children:[a.jsx(m,{flex:"1",children:v("header.settings.preference.randomStationNames.title")}),a.jsx(I,{ml:"auto",colorScheme:"green",children:"New"}),a.jsx(V,{label:v("header.settings.pro"),children:a.jsx(I,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),a.jsxs(Y,{size:"xs",width:"auto",ml:"1",value:o,onChange:e=>{y(bs(e.target.value))},children:[a.jsx("option",{value:"none",children:v("header.settings.preference.randomStationNames.none")}),a.jsx("option",{value:hs.Shmetro,disabled:F,children:v(`header.settings.preference.randomStationNames.${hs.Shmetro}`)}),a.jsx("option",{value:hs.Bjsubway,disabled:F,children:v(`header.settings.preference.randomStationNames.${hs.Bjsubway}`)})]})]}),a.jsxs(j,{display:"flex",mb:"1",children:[a.jsx(m,{flex:"1",children:v("header.settings.preference.gridline")}),a.jsx(J,{isChecked:p,onChange:({target:{checked:e}})=>y(ds(e))})]}),a.jsxs(j,{display:"flex",mb:"1",children:[a.jsx(m,{flex:"1",children:v("header.settings.preference.snapline")}),a.jsx(J,{isChecked:g,onChange:({target:{checked:e}})=>y(us(e))})]})]})]}),a.jsxs(j,{width:"100%",mb:"3",children:[a.jsx(m,{as:"b",fontSize:"xl",children:v("header.settings.procedures.title")}),a.jsxs(j,{mt:"3",children:[a.jsx(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>S(!0),children:v("header.settings.procedures.translate.title")}),a.jsx(Xn,{isOpen:C,onClose:()=>S(!1)}),a.jsx(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>O(!0),children:v("header.settings.procedures.scale.title")}),a.jsx(Qn,{isOpen:_,onClose:()=>O(!1)}),a.jsxs(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>N(!0),children:[v("header.settings.procedures.changeType.title"),a.jsx(V,{label:v("header.settings.pro"),children:a.jsx(I,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),a.jsx(Fs,{isOpen:R,onClose:()=>N(!1),isSelect:!1}),a.jsx(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>P(!0),children:v("header.settings.procedures.removeLines.title")}),a.jsx(qn,{isOpen:A,onClose:()=>P(!1)}),a.jsx(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>L(!0),children:v("header.settings.procedures.updateColor.title")}),a.jsx(st,{isOpen:T,onClose:()=>L(!1)}),a.jsxs(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>D(!0),children:[v("header.settings.procedures.unlockSimplePath.title"),a.jsx(V,{label:v("header.settings.pro"),children:a.jsx(I,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),a.jsx(et,{isOpen:B,onClose:()=>D(!1)}),a.jsx(k,{sx:ot,rightIcon:a.jsx(xs,{}),onClick:()=>G(!0),children:v("header.settings.procedures.masterManager.title")}),a.jsx(Us,{isOpen:W,onClose:()=>G(!1)})]})]}),a.jsxs(j,{width:"100%",mb:"3",children:[a.jsx(m,{as:"b",fontSize:"xl",children:v("header.settings.shortcuts.title")}),a.jsx(j,{mt:"3",children:a.jsxs(Z,{children:[a.jsx(K,{children:a.jsxs(q,{children:[a.jsx(Q,{children:v("header.settings.shortcuts.keys")}),a.jsx(Q,{children:v("header.settings.shortcuts.description")})]})}),a.jsxs(X,{children:[a.jsxs(q,{children:[a.jsx(ee,{children:a.jsx(se,{children:"f"})}),a.jsx(ee,{children:v("header.settings.shortcuts.f")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:a.jsx(se,{children:"s"})}),a.jsx(ee,{children:v("header.settings.shortcuts.s")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:a.jsxs(j,{display:"flex",flexDirection:"row",children:[a.jsx(ps,{}),a.jsx(gs,{}),a.jsx(ms,{}),a.jsx(js,{})]})}),a.jsx(ee,{children:v("header.settings.shortcuts.arrows")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:a.jsxs(j,{display:"flex",flexDirection:"row",children:[a.jsx(se,{children:"i"}),a.jsx(se,{children:"j"}),a.jsx(se,{children:"k"}),a.jsx(se,{children:"l"})]})}),a.jsx(ee,{children:v("header.settings.shortcuts.ijkl")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:fs?a.jsx(se,{sx:at,children:"⇧"}):a.jsx(se,{children:"shift"})}),a.jsx(ee,{children:v("header.settings.shortcuts.shift")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:fs?a.jsx(se,{sx:at,children:"⌥"}):a.jsx(se,{children:"alt"})}),a.jsx(ee,{children:v("header.settings.shortcuts.alt")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:fs?a.jsx(se,{sx:at,children:"⌫"}):a.jsx(se,{children:"delete"})}),a.jsx(ee,{children:v("header.settings.shortcuts.delete")})]}),a.jsxs(q,{children:[a.jsxs(ee,{children:[fs?a.jsx(se,{sx:at,children:"⌘"}):a.jsx(se,{children:"ctrl"})," + ",a.jsx(se,{children:"x"})]}),a.jsx(ee,{children:v("header.settings.shortcuts.cut")})]}),a.jsxs(q,{children:[a.jsxs(ee,{children:[fs?a.jsx(se,{sx:at,children:"⌘"}):a.jsx(se,{children:"ctrl"})," + ",a.jsx(se,{children:"c"})]}),a.jsx(ee,{children:v("header.settings.shortcuts.copy")})]}),a.jsxs(q,{children:[a.jsxs(ee,{children:[fs?a.jsx(se,{sx:at,children:"⌘"}):a.jsx(se,{children:"ctrl"})," + ",a.jsx(se,{children:"v"})]}),a.jsx(ee,{children:v("header.settings.shortcuts.paste")})]}),a.jsxs(q,{children:[a.jsxs(ee,{children:[fs?a.jsx(se,{sx:at,children:"⌘"}):a.jsx(se,{children:"ctrl"})," + ",a.jsx(se,{children:"z"})]}),a.jsx(ee,{children:v("header.settings.shortcuts.undo")})]}),a.jsxs(q,{children:[a.jsx(ee,{children:fs?a.jsxs(a.Fragment,{children:[a.jsx(se,{sx:at,children:"⇧"})," + ",a.jsx(se,{sx:at,children:"⌘"})," + ",a.jsx(se,{children:"z"})]}):a.jsxs(a.Fragment,{children:[a.jsx(se,{children:"ctrl"})," + ",a.jsx(se,{children:"y"})]})}),a.jsx(ee,{children:v("header.settings.shortcuts.redo")})]})]})]})})]}),a.jsxs(j,{width:"100%",mb:"3",children:[a.jsx(m,{as:"b",fontSize:"xl",children:v("header.settings.telemetry.title")}),a.jsxs(j,{mt:"3",children:[a.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:v("header.settings.telemetry.info")}),a.jsxs(j,{mt:"3",mb:"1",children:[a.jsxs(j,{display:"flex",mb:"1",children:[a.jsx(m,{flex:"1",children:v("header.settings.telemetry.essential")}),a.jsx(V,{label:v("header.settings.telemetry.essentialTooltip"),children:a.jsx(J,{isChecked:$,isDisabled:!0})})]}),a.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:v("header.settings.telemetry.essentialInfo")}),a.jsxs(E,{color:z,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[v("header.settings.telemetry.essentialLink")," ",a.jsx(M,{as:me})]})]}),a.jsxs(j,{mt:"1",mb:"1",children:[a.jsxs(j,{display:"flex",children:[a.jsx(m,{flex:"1",children:v("header.settings.telemetry.additional")}),a.jsx(J,{isChecked:r,onChange:({target:{checked:e}})=>{y(ws(e))}})]}),a.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:v("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},ct=()=>{const[e,s]=Ps.useState(!1),{svgViewBoxZoom:n}=fe((e=>e.param)),t=je(),r=[{type:"slider",label:"",value:400-n,min:10,max:390,step:1,onChange:e=>t(Le(400-e)),leftIcon:a.jsx(vs,{}),rightIcon:a.jsx(ys,{}),minW:160}];return a.jsxs(G,{isOpen:e,onOpen:()=>s(!0),onClose:()=>s(!1),children:[a.jsx($,{children:a.jsx(A,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:a.jsx(ys,{}),onClick:()=>s(!e)})}),a.jsx(U,{children:a.jsx(F,{children:a.jsx(ze,{fields:r,noLabel:!0})})})]})};function ht(){const{t:e}=As(),s=je(),{past:n,future:t}=fe((e=>e.param)),r=le.isAllowAnalytics(),[o,l]=Ps.useState(!1),[c,h]=Ps.useState(!1),d=i(le.getEnv),u=i(le.getAppVersion);Ps.useEffect((()=>{r&&d!==zs.DEV&&le.event(ke.APP_LOAD,{isStandaloneWindow:le.isStandaloneWindow()})}),[d]);return a.jsxs(ks,{children:[a.jsx(f,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rmp")}),a.jsx(Cs,{environment:d,version:u,popoverHeader:d===zs.PRD?void 0:a.jsxs(Is,{i18nKey:"header.popoverHeader",environment:d,children:["You're on ",{environment:d}," environment!"]}),popoverBody:d===zs.PRD?void 0:a.jsx(Is,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),a.jsxs(te,{ml:"auto",children:[a.jsx(re,{children:a.jsx(Kn,{})}),a.jsx(re,{children:a.jsx(A,{size:"sm",variant:"ghost","aria-label":"Undo",icon:a.jsx(Ss,{}),isDisabled:0===n.length,onClick:()=>{s(Hs()),s(Re()),s(Ne())}})}),a.jsx(re,{children:a.jsx(A,{size:"sm",variant:"ghost","aria-label":"Redo",icon:a.jsx(_s,{}),isDisabled:0===t.length,onClick:()=>{s(Rs()),s(Re()),s(Ne())}})}),a.jsx(re,{children:a.jsx(ct,{})}),a.jsx(re,{children:a.jsx(Yn,{})}),a.jsx(re,{children:a.jsx(Bn,{})}),le.isStandaloneWindow()&&a.jsx(re,{children:a.jsxs(R,{children:[a.jsx(N,{as:A,icon:a.jsx(Os,{}),variant:"ghost",size:"sm"}),a.jsx(P,{children:["en","zh-Hans","zh-Hant","ja","ko"].map((e=>a.jsx(T,{onClick:()=>{return s=e,void le.getI18nInstance().changeLanguage(s);var s},children:Vs[e][e]},e)))})]})}),a.jsx(re,{children:a.jsx(A,{size:"sm",variant:"ghost","aria-label":"Settings",icon:a.jsx(Es,{}),onClick:()=>l(!0)})}),a.jsx(re,{children:a.jsx(A,{size:"sm",variant:"ghost","aria-label":"Help",icon:a.jsx(Ms,{}),onClick:()=>h(!0)})})]}),a.jsx(lt,{isOpen:o,onClose:()=>l(!1)}),a.jsx(Js,{isOpen:c,onClose:()=>h(!1)})]})}function dt(){const e=je(),s=fe((e=>e.runtime.globalAlerts));return a.jsx(a.Fragment,{children:Object.entries(s).map((([s,{message:n,url:t,linkedApp:r}])=>a.jsxs(ie,{status:s,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[a.jsx(oe,{}),r?a.jsx(E,{onClick:()=>(e=>{le.isStandaloneWindow()?window.open(`/${e}`,"_blank"):le.openApp({appId:e})})(r),children:n}):t?a.jsx(E,{href:t,target:"_blank",children:n}):n,a.jsx(W,{ml:"auto",onClick:()=>e(Ns(s))})]},s)))})}}}}))}();
