import{b as h}from"./react-2c0b8364.js";import{p as m}from"./index-b6e3d991.js";const v=typeof window<"u"?h.useInsertionEffect||h.useLayoutEffect:()=>{};function W(r){const t=h.useRef(O);v(()=>{t.current=r},[r]);const c=h.useRef(null);return c.current||(c.current=function(){return t.current.apply(this,arguments)}),c.current}function O(){throw new Error("INVALID_USEEVENT_INVOCATION: the callback from useEvent cannot be invoked before the component has mounted.")}const j=(r,t,c)=>{const f={};let[a,u]=[0,0];t.forEach(n=>{const o=r.getNodeAttributes(n);f[n]=o,a+=o.x,u+=o.y});const d={};c.forEach(n=>{const[o,E]=r.extremities(n);d[n]={attr:r.getEdgeAttributes(n),source:o,target:E}});const i={app:"rmp",version:1,nodesWithAttrs:f,edgesWithAttrs:d,avgX:a/t.size,avgY:u/t.size};return JSON.stringify(i)},I=(r,t,c,f)=>{const{nodesWithAttrs:a,edgesWithAttrs:u,version:d}=JSON.parse(r);if(d!==1)throw Error(`Unrecognized version: ${d}`);const i={};Object.keys(a).filter(e=>t.hasNode(e)).forEach(e=>{const s=m(10);if(e.startsWith("stn_"))i[e]=`stn_${s}`;else if(e.startsWith("misc_node_"))i[e]=`misc_node_${s}`;else throw Error(`Unrecognized node id: ${e}`)}),Object.keys(u).filter(e=>t.hasEdge(e)).forEach(e=>i[e]=`line_${m(10)}`);const n=Object.entries(i).reduce((e,[s,l])=>e.replaceAll(s,l),r),{nodesWithAttrs:o,edgesWithAttrs:E,avgX:g,avgY:b}=JSON.parse(n),[A,N]=[c-g,f-b];return Object.entries(o).forEach(([e,s])=>{s.x+=A,s.y+=N,t.addNode(e,s)}),Object.entries(E).forEach(([e,{attr:s,source:l,target:p}])=>t.addDirectedEdgeWithKey(e,l,p,s)),{nodes:Object.keys(o),edges:Object.keys(E)}};export{j as e,I as i,W as u};
