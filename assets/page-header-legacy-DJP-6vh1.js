!function(){const e=["onError","onSuccess"],s=["version","images"],t=["version","images"];function n(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);s&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),t.push.apply(t,n)}return t}function r(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?n(Object(t),!0).forEach(function(s){i(e,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))})}return e}function i(e,s,t){return(s=function(e){var s=function(e,s){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,s||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(e)}(e,"string");return"symbol"==typeof s?s:s+""}(s))in e?Object.defineProperty(e,s,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[s]=t,e}function o(e,s){if(null==e)return{};var t,n,r=function(e,s){if(null==e)return{};var t={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==s.indexOf(n))continue;t[n]=e[n]}return t}(e,s);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],-1===s.indexOf(t)&&{}.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}System.register(["./chakra-legacy-DJB5Se8L.js","./index-legacy-D3XanFtf.js","./react-legacy-BN3K1j7S.js","./master-manager-legacy-DuFAepWZ.js","./change-type-modal-legacy-BT116lOG.js","./change-types-legacy-BB2UFp2q.js"],function(n,i){"use strict";var l,a,c,d,h,u,x,p,g,m,j,f,b,w,y,v,C,S,_,k,O,z,E,M,N,R,A,T,P,I,L,D,B,$,W,G,F,H,U,V,Y,J,K,Z,q,X,Q,ee,se,te,ne,re,ie,oe,le,ae,ce,de,he,ue,xe,pe,ge,me,je,fe,be,we,ye,ve,Ce,Se,_e,ke,Oe,ze,Ee,Me,Ne,Re,Ae,Te,Pe,Ie,Le,De,Be,$e,We,Ge,Fe,He,Ue,Ve,Ye,Je,Ke,Ze,qe,Xe,Qe,es,ss,ts,ns,rs,is,os,ls,as,cs,ds,hs,us,xs,ps,gs,ms,js,fs,bs,ws,ys,vs,Cs,Ss,_s,ks,Os,zs,Es,Ms,Ns,Rs,As,Ts,Ps,Is,Ls,Ds,Bs,$s,Ws,Gs,Fs,Hs,Us,Vs,Ys,Js,Ks,Zs,qs,Xs,Qs,et,st,tt,nt,rt;return{setters:[e=>{l=e.j,a=e.ag,c=e.M,d=e.ah,h=e.J,u=e.K,x=e.L,p=e.h,g=e.ai,m=e.N,j=e.B,f=e.aj,b=e.ak,w=e.T,y=e.al,v=e.b,C=e.q,S=e.t,_=e.O,k=e.am,O=e.an,z=e.ao,E=e.R,M=e.ap,N=e.Q,R=e.aq,A=e.ar,T=e.a2,P=e.as,I=e.at,L=e.x,D=e.au,B=e.av,$=e.U,W=e.V,G=e.X,F=e.Y,H=e.G,U=e.H,V=e.n,Y=e.a8,J=e.e,K=e.w,Z=e.m,q=e.E,X=e.aw,Q=e.ax,ee=e.a7,se=e.a1,te=e.ay,ne=e.az,re=e.aA,ie=e.aB,oe=e.aC,le=e.aD,ae=e.aE,ce=e.aF},e=>{de=e.u,he=e.r,ue=e.C,xe=e.M,pe=e.d,ge=e.n,me=e.S,je=e.R,fe=e.a,be=e.b,we=e.c,ye=e.e,ve=e.f,Ce=e.g,Se=e.h,_e=e.i,ke=e.j,Oe=e.k,ze=e.E,Ee=e.s,Me=e.l,Ne=e.m,Re=e.L,Ae=e.o,Te=e.p,Pe=e.q,Ie=e.t,Le=e.v,De=e.w,Be=e.x,$e=e.y,We=e.z,Ge=e.A,Fe=e.B,He=e.D,Ue=e.F,Ve=e.G,Ye=e.H,Je=e.I,Ke=e.J,Ze=e.K,qe=e.N,Xe=e.O,Qe=e.P,es=e.Q,ss=e.T,ts=e.U,ns=e.V,rs=e.W,is=e.X,os=e.Y,ls=e.Z,as=e._,cs=e.$,ds=e.a0,hs=e.a1,us=e.a2,xs=e.a3,ps=e.a4,gs=e.a5,ms=e.a6,js=e.a7,fs=e.a8,bs=e.a9,ws=e.aa,ys=e.ab,vs=e.ac,Cs=e.ad,Ss=e.ae,_s=e.af,ks=e.ag,Os=e.ah,zs=e.ai,Es=e.aj,Ms=e.ak,Ns=e.al,Rs=e.am,As=e.an,Ts=e.ao,Ps=e.ap,Is=e.aq,Ls=e.ar,Ds=e.as,Bs=e.at,$s=e.au,Ws=e.av,Gs=e.aw,Fs=e.ax,Hs=e.ay},e=>{Us=e.u,Vs=e.b,Ys=e.T,Js=e.r},e=>{Ks=e.d,Zs=e.r,qs=e.i,Xs=e.m,Qs=e.a,et=e.s,st=e.b,tt=e.p,nt=e.M},e=>{rt=e.C},null],execute:function(){n("default",function(){return l.jsxs(l.Fragment,{children:[l.jsx(Sn,{}),l.jsx(_n,{})]})});var i=function(e){return de(he.ready(),e)};const it=e=>{const{isOpen:s,onClose:t}=e,{t:n}=Us(),r=he.getAppVersion();return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:n("header.about.title")}),l.jsx(u,{}),l.jsxs(x,{paddingBottom:10,children:[l.jsxs(p,{direction:"row",children:[l.jsx(g,{boxSize:"128px",src:"/rmp//logo192.png"}),l.jsxs(p,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[l.jsx(m,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),l.jsx(m,{children:r}),l.jsx(m,{}),l.jsx(m,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),l.jsx(j,{margin:5,children:l.jsx(m,{fontSize:"xl",children:n("header.about.desc")})}),l.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),l.jsx(f,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),l.jsx(m,{fontSize:"sm",children:n("header.about.content1")}),l.jsx(m,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),l.jsx(m,{fontSize:"sm",children:n("header.about.langonginc")}),l.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),l.jsx(f,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),l.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),l.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.Swiftiecott")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),l.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.Minwtraft")})]})]})]}),l.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),l.jsx(m,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),l.jsx(m,{fontSize:"sm",children:n("header.about.slackContent")}),l.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),l.jsx(f,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),l.jsxs(b,{children:[l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",pb:1,children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),l.jsx(m,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),l.jsxs(w,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[l.jsx(y,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),l.jsxs(v,{display:"block",width:"100%",pb:1,children:[l.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),l.jsx(m,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */function ot(e){const s=e.sizes.shift(),t=Math.max(Math.ceil(s[0]),1),n=Math.max(Math.ceil(s[1]),1),r=[t-1,n-1,1,1],i=performance.now(),o="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let l,a;o?(l=new OffscreenCanvas(1,1),a=new OffscreenCanvas(t,n)):(l=document.createElement("canvas"),l.width=1,l.height=1,a=document.createElement("canvas"),a.width=t,a.height=n);const c=l.getContext("2d"),d=a.getContext("2d");d&&(d.fillRect.apply(d,r),c.drawImage(a,t-1,n-1,1,1,0,0,1,1));const h=c&&0!==c.getImageData(0,0,1,1).data[3],u=parseInt(performance.now()-i);return[l,a].forEach(e=>{e.height=0,e.width=0}),o?(postMessage({width:t,height:n,testTime:u,isTestPass:h}),!h&&e.sizes.length&&setTimeout(()=>{ot(e)},0)):h?e.onSuccess({width:t,height:n,testTime:u}):(e.onError({width:t,height:n,testTime:u}),e.sizes.length&&setTimeout(()=>{ot(e)},0)),h}const lt={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},at={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},ct={};function dt(e){const s=e.width===e.height,t=1===e.height,n=1===e.width,r=[];if(e.width&&e.height){const i=e.min||at.min,o=e.step||at.step;let l=Math.max(e.width,e.height);for(;l>=i;){const e=s||t?l:1,i=s||n?l:1;r.push([e,i]),l-=o}}else e.sizes.forEach(e=>{const i=s||t?e:1,o=s||n?e:1;r.push([i,o])});return r}function ht(s){const t="undefined"!=typeof window,n=t&&"Promise"in window,i=t&&"HTMLCanvasElement"in window,l=t&&"OffscreenCanvas"in window,a=URL.createObjectURL(new Blob([])).slice(-36),c=performance.now(),{onError:d,onSuccess:h}=s,u=o(s,e),x=()=>parseInt(performance.now()-c);let p=null;if(!i)return!1;if(s.useWorker&&l){const e=`\n            var canvasTest = ${ot.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,s=new Blob([e],{type:"application/javascript"}),t=URL.createObjectURL(s);p=new Worker(t),URL.revokeObjectURL(t),p.onmessage=function(e){const{width:s,height:t,testTime:n,isTestPass:r}=e.data,i={width:s,height:t,testTime:n,totalTime:x()};r?(ct[a].onSuccess(i),delete ct[a]):ct[a].onError(i)}}return n?new Promise(e=>{const t=r(r({},s),{},{onError(t){let{width:n,height:i,testTime:o}=t;const l={width:n,height:i,testTime:o,totalTime:x()};let a;if(0===s.sizes.length)a=!0;else{const[[e,t]]=s.sizes.slice(-1);a=n===e&&i===t}d(l),a&&e(r(r({},l),{},{success:!1}))},onSuccess(s){let{width:t,height:n,testTime:i}=s;const o={width:t,height:n,testTime:i,totalTime:x()};h(o),e(r(r({},o),{},{success:!0}))}});if(p){const{onError:e,onSuccess:s}=t;ct[a]={onError:e,onSuccess:s},p.postMessage(u)}else ot(t)}):p?(ct[a]={onError:d,onSuccess:h},void p.postMessage(u)):ot(s)}const ut={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=dt({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...lt.area]});return ht(r(r(r({},at),e),{},{sizes:s}))},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=dt({width:1,height:e.max,min:e.min,step:e.step,sizes:[...lt.height]});return ht(r(r(r({},at),e),{},{sizes:s}))},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=dt({width:e.max,height:1,min:e.min,step:e.step,sizes:[...lt.width]});return ht(r(r(r({},at),e),{},{sizes:s}))},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=r(r({},at),e);return s.sizes=[...s.sizes],s.width&&s.height&&(s.sizes=[[s.width,s.height]]),ht(s)}};var xt=(e=>(e.left="l",e.right="r",e))(xt||{}),pt=(e=>(e.through="through",e.nonThrough="nonthrough",e))(pt||{}),gt=(e=>(e.local="local",e.express="express",e.direct="direct",e))(gt||{}),mt=(e=>(e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro",e))(mt||{}),jt=(e=>(e.sh="sh",e.sh2020="sh2020",e))(jt||{});const ft=new Set,bt=new Set,wt=new Set,yt=new Set,vt=new Map,Ct=new Map,St=new Set,_t=new Map,kt=new Map;let Ot=[],zt=0;const Et=new Map,Mt=new Map,Nt=new Set,Rt={localisedName:{en:"LEFT END"},num:"00",services:[gt.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:xt.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},At={localisedName:{en:"RIGHT END"},num:"00",services:[gt.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:xt.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Tt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:mt.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:xt.right,platform_num:"1",theme:[ue.Shanghai,"sh1","#E3002B",xe.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:{},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:jt.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Pt={localisedName:{},num:"",services:[gt.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:xt.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},It=e=>`${e[0]}/${e[1]}=${e[2]}${e[3]}`,Lt=e=>pe.has(e),Dt=(e,s)=>{const[t,n]=e.extremities(s),r=e.getEdgeAttributes(s),i=r.style;if(t!=n&&Lt(i)){const e=(e=>{if(Lt(e.style))return structuredClone(e[e.style].color)})(r);yt.has(It(e))||(wt.add(e),yt.add(It(e)),vt.set(e,t),Ct.set(It(e),new Set)),Ct.get(It(e)).add(t),Ct.get(It(e)).add(n),kt.has(t)?Ot.push({target:n,next:kt.get(t),color:e}):Ot.push({target:n,next:-1,color:e}),kt.set(t,zt),zt++,kt.has(n)?Ot.push({target:t,next:kt.get(n),color:e}):Ot.push({target:t,next:-1,color:e}),kt.set(n,zt),zt++}},Bt=(e,s,t)=>{if(Ct.get(It(t)).has(e)){Ct.get(It(t)).delete(e);for(let s=kt.get(e);-1!=s;s=Ot[s].next){const n=Ot[s].target,r=Ot[s].color;It(r)==It(t)&&Bt(n,e,t)}}},$t=(e,s,t)=>{if(ft.has(e))return;ft.add(e);let n=0;const r=new Set;for(let i=kt.get(e);-1!=i;i=Ot[i].next){const o=Ot[i].target,l=Ot[i].color;It(l)==It(t)&&(r.has(o)||(r.add(o),n++,o!=s&&$t(o,e,t)))}Et.set(e,n)},Wt=(e,s)=>{const t=e.stn_list.lineend.parents;t.push(s),e.stn_list.lineend.parents=structuredClone(t).reverse(),e.stn_list.lineend.branch=r(r({},e.stn_list.lineend.branch),{},{left:2==e.stn_list.lineend.parents.length?[pt.through,t[1]]:void 0})},Gt=(e,s,t)=>{if(Nt.has(e))return[];Nt.add(e);const n=[];for(let r=kt.get(e);-1!=r;r=Ot[r].next){const i=Ot[r].target,o=Ot[r].color;i!=s&&(It(o)==It(t)&&(i.startsWith("stn")?n.push(i):n.push(...Gt(i,e,t))))}return n},Ft=(e,s,t,n,i,o,l)=>{if(ft.has(e)&&(!e.startsWith("misc_node_")&&null==l.stn_list[e]||e.startsWith("misc_node_")&&!bt.has(e)||l.loop))return[];if(ft.has(e)&&null!=l.stn_list[e]&&((e,s)=>{let t=0;for(let n=kt.get(e);-1!=n;n=Ot[n].next){Ot[n].target;const e=Ot[n].color;It(e)==It(s)&&t++}return t})(e,o)-1>=2){var a;const t=[...l.stn_list[e].parents,s];if(null==l.stn_list[t[1]]){const e=t[0];t[0]=t[1],t[1]=e}l.stn_list[e].parents=structuredClone(t).reverse(),l.stn_list[e].branch=r(r({},l.stn_list[e].branch),{},{left:[pt.through,t[1]]});const n=[];for(const r of l.stn_list[e].children)r!=s&&n.push(r);l.stn_list[e].children=structuredClone(n),null===(a=l.stn_list[e].branch)||void 0===a||delete a.right;const i=[];for(const s of l.stn_list.lineend.parents)s!=e&&i.push(s);return l.stn_list.lineend.parents=structuredClone(i).reverse(),l.stn_list.lineend.branch=r(r({},l.stn_list.lineend.branch),{},{left:2==l.stn_list.lineend.parents.length?[pt.through,i[1]]:void 0}),0==n.length&&(l.stn_list[e].children=["lineend"],Wt(l,e)),[e]}ft.add(e);const c=[],d=[],h=[],u=new Set,x=new Set;for(let r=kt.get(e);-1!=r;r=Ot[r].next){const a=Ot[r].target,d=Ot[r].color;if(a!=t){if(It(d)==It(o)){if(x.has(a))continue;if(x.add(a),e.startsWith("misc_node_")){const t=Ft(a,s,e,n+1,i,o,l);0!=t.length&&c.push(...t)}else{const s=Ft(a,e,e,n+1,i,o,l);0!=s.length&&c.push(...s)}}if(!u.has(It(d))&&It(d)!=It(o)){u.add(It(d));const e={theme:d,name:[`ch_${It(d)}`,`en_${It(d)}`]};h.push(e)}}}if(2==c.length){for(let e=0;e<2;e++)"lineend"==c[e]&&c.splice(e,1);if(l.stn_list[c[1]].parents.length>=2){const e=c[0];c[0]=c[1],c[1]=e}}if(ft.has(e)&&null!=l.stn_list[e]){const t=[];for(const s of l.stn_list.lineend.parents)s!=e&&t.push(s);l.stn_list.lineend.parents=structuredClone(t).reverse(),l.stn_list.lineend.branch=r(r({},l.stn_list.lineend.branch),{},{left:2==l.stn_list.lineend.parents.length?[pt.through,t[1]]:void 0}),0==c.length&&(Nt.clear(),d.push(...Gt(e,s,o)))}if(e.startsWith("misc_node_"))return bt.add(e),c;{const t=i.getNodeAttributes(e).type,a=i.getNodeAttributes(e)[t];if(l.stn_list[e]=structuredClone(Pt),l.stn_list[e].localisedName={zh:a.names[0],en:a.names[1]},l.stn_list[e].num=String(n),i.getNodeAttributes(e).type==me.GzmtrBasic){const s=a;l.stn_list[e].num=s.stationCode,""===s.secondaryNames[0]&&""===s.secondaryNames[1]||(l.stn_list[e].localisedSecondaryName={zh:s.secondaryNames[0],en:s.secondaryNames[1]})}if(i.getNodeAttributes(e).type==me.GzmtrInt){const s=a,t=s.transfer[0];for(const n of t)if(It(n)==It(o)){l.stn_list[e].num=String(n[5]);break}""===s.secondaryNames[0]&&""===s.secondaryNames[1]||(l.stn_list[e].localisedSecondaryName={zh:s.secondaryNames[0],en:s.secondaryNames[1]})}return 0!=c.length?(l.stn_list[e].children=structuredClone(c).reverse(),2==c.length&&(l.stn_list[e].branch=r(r({},l.stn_list[e].branch),{},{right:[pt.through,c[1]]}))):(l.stn_list[e].children=["lineend"],Wt(l,e)),d.push(s),l.stn_list[e].parents=structuredClone(d).reverse(),2==d.length&&(l.stn_list[e].branch=r(r({},l.stn_list[e].branch),{},{left:[pt.through,d[1]]})),0!=h.length&&(l.stn_list[e].transfer.groups[0].lines=structuredClone(h)),[e]}},Ht=(e,s,t,n)=>{const r=structuredClone(Tt);let i;switch("LOOP"==n&&(r.loop=!0),e.getNodeAttributes(t).type){case me.GzmtrBasic:case me.GzmtrInt:i=mt.GZMTR;break;case me.MTR:i=mt.MTR;break;default:i=mt.SHMetro}r.theme=structuredClone(s),r.style=i,r.stn_list.linestart=structuredClone(Rt),r.stn_list.lineend=structuredClone(At),ft.clear(),bt.clear();const o=Ft(t,"linestart","linestart",1,e,s,r);return r.current_stn_idx=o[0],r.stn_list.linestart.children=[o[0]],Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3?void 0:structuredClone(r)},Ut=(e,s,t,n)=>{var r;e.line_name=s,e.line_num=String(t),Ks(`RMG_${r=s,""!=r[0]&&""!=r[1]?r[0]+"_"+r[1]:""!=r[0]?r[0]:""!=r[1]?r[1]:`${(new Date).valueOf()}`}.json`,"application/json",((e,s)=>{let t=e;return s.forEach((e,s)=>{const n=new RegExp(`ch_${s}`,"g"),r=new RegExp(`en_${s}`,"g");t=t.replace(n,e[0]),t=t.replace(r,e[1])}),t})(JSON.stringify(e),n))},Vt={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Yt=e=>{const{isOpen:s,onClose:t}=e,{t:n}=Us(),r=Vs.useRef(window.graph),[i,o]=Vs.useState(!1),[p,g]=Vs.useState([[Tt,"",""]]),[j,f]=Vs.useState(["","",""]),[b,w]=Vs.useState(new Map),[y,v]=Vs.useState(new Map),[k,O]=Vs.useState([]);Vs.useEffect(()=>{if(s){const e=(e=>{ft.clear(),wt.clear(),yt.clear(),vt.clear(),Ct.clear(),St.clear(),_t.clear(),kt.clear(),Ot=[],zt=0,Et.clear(),Mt.clear(),e.filterEdges(e=>e.startsWith("line")).forEach(s=>{Lt(e.getEdgeAttributes(s).style)&&Dt(e,s)});let s=0;e.forEachNode(e=>{Mt.set(e,++s)}),Mt.set("lineend",++s);const t=[];for(const i of wt){let e=0;for(;0!=Ct.get(It(i)).size;){let s="line_root";Ct.get(It(i)).forEach(e=>{"line_root"==s&&(s=e)}),Bt(s,"line_root",i);const t={theme:i,index:++e};St.add(t),_t.set(t,s)}}for(const i of St){const{theme:s}=i;ft.clear(),Et.clear(),$t(_t.get(i),"line_root",s);let o=!0,l="LINE";const a=[];for(const[e,t]of Et)1==t&&a.push(e),3==t&&(l="BRANCH"),t>3&&(o=!1);if(!o)continue;0==a.length&&(l="LOOP",Et.forEach((e,s)=>{a.push(s)}));const c=[];for(const t of a){const i=Ht(e,s,t,l);var n,r;null!=i&&c.push([i,null!==(n=i.stn_list[i.current_stn_idx].localisedName.zh)&&void 0!==n?n:"",null!==(r=i.stn_list[i.current_stn_idx].localisedName.en)&&void 0!==r?r:""])}0!=c.length&&t.push({id:ge(10),theme:s,param:structuredClone(c),type:l})}return t})(r.current),s=new Map;e.forEach(({id:e,theme:t})=>{s.set(It(t),e)}),O(e),w(s)}},[s]);const z=(e,s)=>document.getElementById("2RMG_"+s+"_"+e).value.trim();return l.jsxs(a,{isOpen:s,onClose:t,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:l.jsx(m,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")})}),l.jsx(u,{}),l.jsxs(x,{children:[l.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info1")}),l.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info2")}),l.jsx("br",{}),0===k.length?l.jsx(m,{fontSize:"md",children:n("header.download.2rmg.noline")}):l.jsx("table",{children:l.jsx("tbody",{children:k.map(({id:e,theme:s,param:t,type:r})=>l.jsxs("tr",{children:[l.jsx("td",{children:l.jsx(je,{name:"other"==s[0]&&"other"==s[1]?s[2]:s[1],bg:s[2],fg:s[3]})}),l.jsx("td",{children:l.jsx(C,{placeholder:n("header.download.2rmg.placeholder.chinese"),id:`2RMG_nameCh_${e}`,size:"sm"})}),l.jsx("td",{children:l.jsx(C,{placeholder:n("header.download.2rmg.placeholder.english"),id:`2RMG_nameEn_${e}`,size:"sm"})}),l.jsx("td",{children:l.jsx(C,{placeholder:n("header.download.2rmg.placeholder.lineCode"),id:`2RMG_lineNum_${e}`,size:"sm"})}),l.jsx("td",{children:l.jsx(je,{name:n(`header.download.2rmg.type.${r.toLowerCase()}`),bg:Vt[r],fg:xe.white})}),l.jsx("td",{children:l.jsx(S,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const s=z(e,"nameCh"),n=z(e,"nameEn"),r=z(e,"lineNum"),i=new Map;b.forEach((e,s)=>{i.set(s,[z(e,"nameCh"),z(e,"nameEn")])}),g(t),f([s,n,r]),v(i),o(!0)},size:"sm",children:l.jsx(fe,{})})})]},e))})})]}),l.jsx(_,{children:l.jsx(S,{colorScheme:"blue",variant:"outline",mr:"1",onClick:t,children:n("close")})})]}),l.jsx(Jt,{isOpen:i,onClose:()=>o(!1),param:p,nameList:j,interchangeName:y})]})},Jt=e=>{const{isOpen:s,onClose:t,param:n,nameList:r,interchangeName:i}=e,{t:o}=Us(),[p,g]=Vs.useState("");return Vs.useEffect(()=>{""!=r[0]&&""!=r[1]?g(r[0]+"/"+r[1]):""!=r[0]?g(r[0]):""!=r[1]?g(r[1]):g("")},[...r]),l.jsxs(a,{isOpen:s,onClose:t,size:"md",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:l.jsxs(m,{as:"b",fontSize:"xl",children:[o("header.download.2rmg.download")," ",p]})}),l.jsx(u,{}),l.jsx(x,{children:l.jsxs(k,{children:[l.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:o("header.download.2rmg.downloadInfo")}),n.map(([e,s,t])=>l.jsxs(S,{onClick:()=>{Ut(e,[r[0],r[1]],r[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[s.replaceAll("\n","⏎"),"/",t.replaceAll("\n","⏎")]},`${s}${t}`))]})}),l.jsx(_,{children:l.jsx(S,{colorScheme:"blue",variant:"outline",mr:"1",onClick:t,children:o("close")})})]})]})},Kt=e=>{const{isOpen:s,onClose:t}=e,{t:n}=Us();return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:n("header.download.termsAndConditions")}),l.jsx(u,{}),l.jsx(x,{children:l.jsxs(O,{children:[l.jsxs(z,{children:["The layout of the elements on the signage or rail map, is designed by"," ",l.jsxs(E,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",l.jsx(M,{as:be})]}),", ",l.jsxs(E,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",l.jsx(M,{as:be})]})," or ",l.jsxs(E,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",l.jsx(M,{as:be})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",l.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",l.jsxs(E,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",l.jsx(M,{as:be})]}),"，",l.jsxs(E,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",l.jsx(M,{as:be})]}),"或",l.jsxs(E,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",l.jsx(M,{as:be})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),l.jsxs(z,{children:["The elements including shapes and lines on the image are drawn by"," ",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",l.jsx(M,{as:be})]})," and ",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",l.jsx(M,{as:be})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",l.jsx("br",{}),"图像的元素，包括图形及线条，均由",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",l.jsx(M,{as:be})]}),"及",l.jsxs(E,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",l.jsx(M,{as:be})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),l.jsxs(z,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",l.jsxs(E,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",l.jsx(M,{as:be})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",l.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",l.jsxs(E,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",l.jsx(M,{as:be})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),l.jsxs(z,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",l.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),l.jsxs(z,{children:["All flag emojis shown on Windows platforms are designed by"," ",l.jsxs(E,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",l.jsx(M,{as:be})]})," ","– the open-source emoji and icon project. License:",l.jsxs(E,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",l.jsx(M,{as:be})]}),l.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",l.jsxs(E,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",l.jsx(M,{as:be})]}),"所设计。许可证：",l.jsxs(E,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",l.jsx(M,{as:be})]})]}),l.jsxs(z,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",l.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},Zt=()=>{const e=new Date,s=`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}01`,t=`${String(e.getFullYear()).slice(-2)}.${e.getMonth()+1}.1`,n=navigator.platform;return`https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download/tauri-${s}/Rail.Map.Toolkit_${t}_${n.includes("Linux")?"amd64.AppImage":n.includes("Mac")?"aarch64.dmg":"x64-setup.exe"}`};function qt(){const e=N("white","var(--chakra-colors-gray-800)"),s=we(),{activeSubscriptions:{RMP_EXPORT:t}}=ye(e=>e.account),{telemetry:{project:n}}=ye(e=>e.app),{languages:i}=ye(e=>e.fonts),o=ye(e=>e.param),{existsNodeTypes:p}=ye(e=>e.runtime),g=he.isAllowAnalytics(),{t:f}=Us(),b=Vs.useRef(window.graph),[w,y]=Vs.useState("png"),v={png:f("header.download.png"),svg:f("header.download.svg")},[C,k]=Vs.useState(2),[O,z]=Vs.useState({width:1,height:1,benchmark:.001}),[H,U]=Vs.useState(200),V=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],Y=Object.fromEntries(V.map(e=>[e,`${e}%`])),[J,K]=Vs.useState([]),[Z,q]=Vs.useState(!1),X=[{type:"select",label:f("header.download.format"),value:w,options:v,onChange:e=>y("png"===e?"png":"svg")}],Q=[{type:"select",label:f("header.download.svgVersion"),value:C,options:{1.1:f("header.download.svg1.1"),2:f("header.download.svg2")},onChange:e=>{k(e),1.1===e&&oe(!0)}}],ee=[{type:"select",label:f("header.download.scale"),value:H,options:Y,onChange:e=>U(e)},{type:"switch",label:f("header.download.transparent"),isChecked:Z,onChange:q}],[se,te]=Vs.useState(!1),[ne,re]=Vs.useState(!1),[ie,oe]=Vs.useState(!1),[le,ae]=Vs.useState(!1),[ce,de]=Vs.useState(!1),[ue,xe]=Vs.useState(!1),[pe,ge]=Vs.useState(!1),[me,je]=Vs.useState(!1);Vs.useEffect(()=>{(async()=>{const e=await ut.maxArea({usePromise:!0,useWorker:!0});z(e)})()},[]),Vs.useEffect(()=>{if(se){const{xMin:e,yMin:s,xMax:t,yMax:n}=ve(b.current),[r,i]=[t-e,n-s],o=V.filter(e=>r*e/100>O.width&&i*e/100>O.height);K(o),Zs(p)?(ae(!1),de(!0)):de(!1)}},[se]);return l.jsxs(R,{id:"download",children:[l.jsx(A,{as:T,size:"sm",variant:"ghost",icon:l.jsx(fe,{})}),l.jsxs(P,{children:[l.jsx(I,{icon:l.jsx(Ce,{}),onClick:()=>(async()=>{g&&he.event(ze.DOWNLOAD_PARAM,n?{"#nodes":b.current.order,"#edges":b.current.size}:{});const e=[];for(const t of b.current.filterNodes((e,s)=>{var t;return e.startsWith("misc_node")&&"image"===s.type&&void 0!==(null===(t=s.image)||void 0===t?void 0:t.href)})){const s=b.current.getNodeAttributes(t).image;s.href&&s.href.startsWith("img-l")&&await qs.has(s.href)&&e.push({id:s.href,base64:await qs.get(s.href)})}const s=r(r({},o),{},{images:e});Ks(`RMP_${(new Date).valueOf()}.json`,"application/json",Ee(s))})(),children:f("header.download.config")}),l.jsxs(I,{icon:l.jsx(Se,{}),onClick:()=>je(!0),children:[f("header.download.2rmg.title"),l.jsx(L,{ml:"1",colorScheme:"green",children:"New"})]}),l.jsx(I,{icon:l.jsx(_e,{}),onClick:()=>te(!0),children:f("header.download.image")})]}),l.jsxs(a,{size:"2xl",isOpen:se,onClose:()=>te(!1),children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:f("header.download.image")}),l.jsx(u,{}),l.jsxs(x,{children:[l.jsx(Oe,{fields:X}),"svg"===w&&l.jsx(Oe,{fields:Q}),"png"===w&&l.jsx(Oe,{fields:ee}),l.jsx("br",{}),l.jsx(D,{isChecked:ie,isDisabled:"svg"===w&&1.1===C,onChange:e=>oe(e.target.checked),children:l.jsx(m,{children:f("header.download.isSystemFontsOnly")})}),l.jsxs(B,{children:[l.jsx(D,{id:"share_info",isChecked:le,isDisabled:ce&&!t,onChange:e=>ae(e.target.checked),children:l.jsxs(m,{children:[f("header.download.shareInfo1"),l.jsxs(E,{color:"teal.500",href:"https://railmapgen.org/rmp",children:[f("header.about.rmp")," ",l.jsx(M,{as:be})]}),f("header.download.shareInfo2")]})}),ce&&l.jsx(L,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})]}),l.jsx(D,{id:"agree_terms",isChecked:ue,onChange:e=>xe(e.target.checked),children:l.jsxs(m,{children:[f("header.download.termsAndConditionsInfo"),l.jsxs(E,{color:"teal.500",onClick:()=>re(!0),children:[f("header.download.termsAndConditions")," ",l.jsx(M,{as:be})]}),f("header.download.period")]})}),ce&&l.jsxs($,{status:"error",mt:"4",children:[l.jsx(W,{}),l.jsx(j,{children:l.jsx(G,{children:f("header.download.rmpInfoSpecificNodeExists")})})]}),"png"===w&&J.includes(H)&&!ke&&l.jsxs($,{status:"error",mt:"4",children:[l.jsx(W,{}),l.jsxs(j,{children:[l.jsx(G,{children:f("header.download.disabledScaleOptions")}),l.jsx(F,{children:l.jsx(Ys,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:l.jsx(E,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:l.jsx(E,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:Zt()})}})})]})]}),"png"===w&&J.includes(H)&&ke&&!t&&l.jsxs($,{status:"error",mt:"4",children:[l.jsx(W,{}),l.jsxs(j,{children:[l.jsx(G,{children:f("header.download.disabledScaleOptions")}),l.jsx(F,{children:f("header.settings.pro")})]})]})]}),l.jsx(_,{children:l.jsx(B,{children:l.jsx(S,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!ue||"png"===w&&J.includes(H)&&!ke||"png"===w&&J.includes(H)&&ke&&!t,isLoading:pe,onClick:async()=>{ge(!0),g&&he.event(ze.DOWNLOAD_IMAGES,n?{numberOfNodes:b.current.order,numberOfEdges:b.current.size}:{});const{elem:t,width:r,height:o}=await Xs(b.current,le,ie,i,p,C),l=t.outerHTML.replace(/&nbsp;/g," ");if("svg"===w)return Ks(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",l),void ge(!1);if(ke)return void window.parent.__TAURI__.core.invoke("render_image",{svgString:l,scale:H,isTransparent:Z,isSystemFontsOnly:ie}).then(()=>ge(!1));document.body.appendChild(t);const a="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)));document.body.removeChild(t),t.remove();const c=document.createElement("canvas"),[d,h]=[r*H/100,o*H/100];c.width=d,c.height=h;const u=c.getContext("2d");Z||(u.fillStyle=e,u.fillRect(0,0,d,h));const x=new Image;x.onload=()=>{setTimeout(()=>{u.drawImage(x,0,0,d,h),c.toBlob(e=>{ge(!1),e?Qs(`RMP_${(new Date).valueOf()}.png`,e):s(Me({status:"error",message:f("header.download.imageTooBig")}))},"image/png")},Ne()?2e3:0)},x.src=a},children:f("header.download.confirm")})})}),l.jsx(Kt,{isOpen:ne,onClose:()=>re(!1)})]})]}),l.jsx(Yt,{isOpen:me,onClose:()=>je(!1)})]})}function Xt(e){const{isOpen:s,onClose:t,onConfirm:n}=e,{t:r}=Us(),i=Vs.useRef(null);return l.jsx(H,{isOpen:s,leastDestructiveRef:i,onClose:t,children:l.jsx(c,{children:l.jsxs(U,{children:[l.jsx(h,{fontSize:"lg",fontWeight:"bold",children:r("header.open.confirmOverwrite.title")}),l.jsx(x,{children:r("header.open.confirmOverwrite.body")}),l.jsxs(_,{children:[l.jsx(S,{ref:i,onClick:t,children:r("cancel")}),l.jsx(S,{id:"confirm_overwrite",colorScheme:"red",onClick:n,ml:3,children:r("header.open.confirmOverwrite.overwrite")})]})]})})})}const Qt=(e,{info_panel_type:s,line_num:t,stn_list:n,style:i,theme:o},l,a,c)=>{const d=Object.fromEntries(Object.keys(n).filter(e=>!["linestart","lineend"].includes(e)).map(e=>[e,`stn_${ge(10)}`]));Object.entries(n).filter(([e,s])=>!["linestart","lineend"].includes(e)).forEach(([s,t])=>{const n=e.filterNodes((e,s)=>Object.values(me).includes(s.type)&&s[s.type].names[0]===t.localisedName.zh);0!==n.length&&(d[s]=n[0])});const h=[["linestart",-1,0]],u={};for(;h.length;){const[e,s,t]=h.shift();n[e].children.filter(e=>"lineend"!=e).forEach((e,n)=>{const r=Math.max(n,t+n);u[e]={x:150*s,y:75*r},h.push([e,s+1,r])})}Object.entries(n).filter(([e,s])=>!["linestart","lineend"].includes(e)).filter(([s,t])=>0===e.filterNodes((e,s)=>Object.values(me).includes(s.type)&&s[s.type].names[0]===t.localisedName.zh).length).map(([e,n])=>{var c,h;let x=me.ShmetroBasic;const p=n.transfer.groups,g=p.map(e=>{var s;return null!==(s=e.lines)&&void 0!==s?s:[]}).flat();i===mt.SHMetro?x=g.length>0?me.ShmetroInt:s===jt.sh2020?me.ShmetroBasic2020:me.ShmetroBasic:i===mt.GZMTR?x=g.length>0?me.GzmtrInt:me.GzmtrBasic:i===mt.MTR&&(x=me.MTR);const m=r(r({},structuredClone(et[x].defaultAttrs)),{},{names:[null!==(c=n.localisedName.zh)&&void 0!==c?c:"",null!==(h=n.localisedName.en)&&void 0!==h?h:""]});if(x===me.ShmetroBasic2020)m.color=o;else if(x===me.GzmtrBasic)m.color=o,m.lineCode=t,m.stationCode=n.num;else if(x===me.GzmtrInt)m.transfer=p.map((e,s)=>{var r,i;const l=null!==(r=null===(i=e.lines)||void 0===i?void 0:i.map(e=>{var s;return[...null!==(s=e.theme)&&void 0!==s?s:o,"1","01"]}))&&void 0!==r?r:[];return 0===s?[[...o,t,n.num],...l]:l});else if(x===me.MTR){var j;null!==(j=p[0].lines)&&void 0!==j&&j.length?m.transfer=[[[...o,"",""],...p[0].lines.map(e=>{var s;return[...null!==(s=e.theme)&&void 0!==s?s:o,"",""]})]]:m.transfer=[[]]}return{node:d[e],attr:{visible:!0,zIndex:0,x:l+u[e].x,y:a+u[e].y,type:x,[x]:m}}}).forEach(({node:s,attr:t})=>e.addNode(s,t)),Object.entries(n).filter(([e,s])=>!["linestart","lineend"].includes(e)).forEach(([s,t])=>{t.children.filter(e=>!["linestart","lineend"].includes(e)).forEach(t=>{const n=Re.Diagonal,[r,i]=[d[s],d[t]],l=c?Ae(e,n,r,i,"from"):-1;e.addDirectedEdgeWithKey(`line_${ge(10)}`,r,i,{visible:!0,zIndex:0,type:n,[Re.Diagonal]:structuredClone(Pe[Re.Diagonal].defaultAttrs),style:Te.SingleColor,[Te.SingleColor]:{color:o},reconcileId:"",parallelIndex:l})})})},en="rmg-bridge--",sn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function tn(e){const{isOpen:s,onClose:t}=e,{t:n}=Us(),{preference:{autoParallel:r}}=ye(e=>e.app),{svgViewBoxZoom:i,svgViewBoxMin:o}=ye(e=>e.param),a=we(),c=he.isAllowAnalytics(),d=Ie(),{height:h,width:u}=Le(d),x=Js.useRef(window.graph),[p]=Js.useState(crypto.randomUUID()),g="/rmg/#/import?"+new URLSearchParams({parentComponent:he.getAppName(),parentId:p}),m=Js.useCallback(()=>{a(De(x.current.export())),a(Be()),a($e())},[a,Be,$e,De,x]);return Js.useEffect(()=>{const e=new BroadcastChannel(en+p);return e.onmessage=e=>{const{event:s,data:l}=e.data;We.debug("[rmp] Received event from RMG app clip:",s),"CLOSE"===s?t():"IMPORT"===s&&(e=>{try{c&&he.event(ze.IMPORT_RMG_PARAM,{});const s=o.x+u*i/100/3,t=o.y+h*i/100/3;Qt(x.current,e,s,t,r),m()}catch(s){a(Me({status:"error",message:n("header.open.unknownError")})),We.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",s)}finally{t()}})(l)},()=>e.close()},[o.x,o.y,i,h,u,r]),l.jsx(Ge,{isOpen:s,onClose:t,sx:sn,children:l.jsx("iframe",{src:g,loading:"lazy"})})}const nn="OPEN_TEMPLATE",rn=new BroadcastChannel("RMP_GALLERY_CHANNEL"),on={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function ln(e){const{isOpen:t,onClose:n}=e,{t:r}=Us(),i=we(),{isOpen:a,onOpen:c,onClose:d}=V(),[h,u]=Vs.useState(null),{telemetry:{project:x}}=ye(e=>e.app),p=he.isAllowAnalytics(),g=Vs.useRef(window.graph),m=Vs.useCallback(()=>{i(De(g.current.export())),i(Be()),i($e())},[i,Be,$e,De,g]),j=async(e,s)=>{var t;const n=s?`https://${s}`:"",i=await(null===(t=(await Promise.allSettled([fetch(`${n}/rmp-gallery/resources/real_world/${e}.json`),fetch(`${n}/rmp-gallery/resources/fantasy/${e}.json`)])).filter(e=>"fulfilled"===e.status).find(e=>200===e.value.status))||void 0===t?void 0:t.value.json());if(i){if(u(i),c(),p){const t={id:e};x&&s&&(t.host=s),he.event(ze.IMPORT_WORK_FROM_GALLERY,t)}he.sendNotification({title:r("header.open.importOK",{id:e}),message:r("header.open.importOKContent"),type:"success",duration:9e3})}else he.sendNotification({title:r("header.open.importFail",{id:e}),message:r("header.open.importFailContent"),type:"error",duration:9e3})};return Vs.useEffect(()=>{const e=new URL(window.location.href).searchParams;if(e.size>0){const s=e.keys().next().value,t=s.indexOf("."),n=s.substring(0,-1===t?void 0:t);let i;-1!==t&&(i=s.substring(t+1)),"org"===i?(async e=>{try{const s=await fetch(`${Fe}/${e}`);if(200!==s.status)throw new Error(r("header.open.importFailContent"));const t=await s.json();u(t),c(),p&&he.event(ze.IMPORT_WORK_FROM_SHARE,{share:e}),he.sendNotification({title:r("header.open.importOK",{id:e}),message:r("header.open.importOKContent"),type:"success",duration:9e3})}catch(s){he.sendNotification({title:r("header.open.importFail",{id:e}),message:s.message,type:"error",duration:9e3})}})(n):j(n,i),he.updateAppMetadata({search:""})}},[]),Vs.useEffect(()=>(rn.onmessage=e=>{const{event:s,data:t}=e.data;s===nn&&(j(t),n())},()=>rn.close()),[]),l.jsxs(l.Fragment,{children:[l.jsxs(Ge,{isOpen:t,onClose:n,size:"full",sx:on,children:[l.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),l.jsx(Y,{onClick:n,position:"fixed",top:"5px",right:"15px"})]}),l.jsx(Xt,{isOpen:a,onClose:d,onConfirm:async()=>{h&&await(async e=>{const t=JSON.parse(await He(JSON.stringify(e))),{version:n,images:r}=t,l=o(t,s);i(Ue()),g.current.clear(),g.current.import(l.graph),Array.isArray(r)&&r.length>0&&await st(g.current,r),i(tt()),m();const{svgViewBoxZoom:a,svgViewBoxMin:c}=l;"number"==typeof a&&i(Ve(a)),"number"==typeof c.x&&"number"==typeof c.y&&i(Ye(c))})(h),d(),u(null)}})]})}function an(){const e=we(),{t:s}=Us(),{isOpen:n,onOpen:r,onClose:i}=V(),[a,c]=Vs.useState(null),d=Ie(),{height:h}=Le(d),u=Vs.useRef(window.graph),x=Vs.useRef(null),[p,g]=Vs.useState(!1),[m,j]=Vs.useState(!1),f=Vs.useCallback(()=>{e(De(u.current.export())),e(Be()),e($e())},[e,Be,$e,De,u]),b=async s=>{const n=JSON.parse(await He(s)),{version:r,images:i}=n,l=o(n,t);e(Ue()),u.current.clear(),u.current.import(l.graph),Array.isArray(i)&&i.length>0&&await st(u.current,i),e(tt()),f();const{svgViewBoxZoom:a,svgViewBoxMin:c}=l;"number"==typeof a&&e(Ve(a)),"number"==typeof c.x&&"number"==typeof c.y&&e(Ye(c))};return Vs.useEffect(()=>{const e=async e=>{const{type:s,key:t,from:n}=e.data;if(s===es.SAVE_CHANGED&&t===ss.PARAM&&"rmt"===n){We.debug(`Received save changed event on key: ${t}`);const e=localStorage.getItem(ss.PARAM);if(!e)return;await b(e)}};return Je.addEventListener("message",e),()=>Je.removeEventListener("message",e)},[]),l.jsxs(l.Fragment,{children:[l.jsxs(R,{children:[l.jsx(A,{as:T,size:"sm",variant:"ghost",icon:l.jsx(Ke,{})}),l.jsxs(P,{children:[l.jsx(I,{icon:l.jsx(Ze,{}),onClick:()=>{e(Ue()),u.current.clear(),e(Ve(100)),e(Ye({x:0,y:0})),f()},children:s("header.open.new")}),l.jsx("input",{id:"upload_project",ref:x,type:"file",accept:".json",hidden:!0,onChange:async t=>{var n;const i=null===(n=t.target.files)||void 0===n?void 0:n[0];if(We.debug("OpenActions.handleUpload():: received file",i),"application/json"!==(null==i?void 0:i.type))e(Me({status:"error",message:s("header.open.invalidType")})),We.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const e=await cn(i);c(e),r()}catch(o){e(Me({status:"error",message:s("header.open.unknownError")})),We.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",o)}t.target.value=""},"data-testid":"file-upload"}),l.jsx(I,{icon:l.jsx(Ke,{}),onClick:()=>{var e;return null==x||null===(e=x.current)||void 0===e?void 0:e.click()},children:s("header.open.config")}),l.jsx(I,{icon:l.jsx(qe,{}),onClick:()=>g(!0),children:s("header.open.projectRMG")}),l.jsxs(I,{icon:l.jsx(be,{}),onClick:()=>j(!0),children:[s("header.open.gallery"),l.jsx(L,{ml:"1",colorScheme:"green",children:"New"})]}),l.jsx(I,{icon:l.jsx(Xe,{}),onClick:async()=>{const e=await Qe();c(e),r()},children:s("header.open.tutorial")})]}),l.jsx(tn,{isOpen:p,onClose:()=>g(!1)}),l.jsx(ln,{isOpen:m,onClose:()=>j(!1)})]}),l.jsx(Xt,{isOpen:n,onClose:i,onConfirm:async()=>{if(a){await b(a);const s=await Qe();if(a.length===s.length){e(Ye({x:-10,y:-13}));const s=Math.max(0,Math.min(400,-.132*h+117.772));e(Ve(s)),await e(tt()),he.event(ze.LOAD_TUTORIAL,{})}}i(),c(null)}})]})}const cn=e=>new Promise(s=>{const t=new FileReader;t.onloadend=()=>s(t.result),t.readAsText(e)}),dn=()=>{const[e,s]=Vs.useState(!1),{t:t}=Us(),n=we(),r=Vs.useRef(window.graph),i=Ie(),{width:o,height:a}=Le(i),[c,d]=Vs.useState([]);Vs.useEffect(()=>{e&&d(r.current.nodes().filter(e=>e.startsWith("stn")).map(e=>{const s=r.current.getNodeAttributes(e);return{id:e,value:s[s.type].names.join("/")}}))},[e]);return l.jsxs(J,{isOpen:e,onOpen:()=>s(!0),onClose:()=>s(!1),children:[l.jsx(K,{children:l.jsx(T,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:l.jsx(ts,{}),onClick:()=>s(!e)})}),l.jsx(Z,{children:l.jsx(q,{children:l.jsx(ns,{label:t("header.search"),children:l.jsx(rs,{data:c,displayHandler:e=>l.jsx(L,{children:e.value}),filter:(e,s)=>s.value.toLowerCase().includes(e.toLowerCase())||Object.values(s.value).some(s=>s.toLowerCase().includes(e.toLowerCase())),value:"",onChange:e=>(e=>{n(is(new Set([e])));const s=Math.max(0,Math.min(400,-.132*a+117.772)),{x:t,y:i}=os((o-300)/2,a/2,s,{x:-r.current.getNodeAttribute(e,"x"),y:-r.current.getNodeAttribute(e,"y")});n(Ve(s)),n(Ye({x:-t,y:-i}))})(e.id)})})})})]})},hn=e=>{const{isOpen:s,onClose:t}=e,n=we(),{t:r}=Us(),i=Vs.useRef(window.graph),{theme:o,requestThemeChange:p}=ls();return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:r("header.settings.procedures.removeLines.title")}),l.jsx(u,{}),l.jsxs(x,{children:[r("header.settings.procedures.removeLines.content"),l.jsx(as,{theme:o,onClick:p})]}),l.jsxs(_,{children:[l.jsx(S,{colorScheme:"blue",variant:"outline",mr:"1",onClick:t,children:r("cancel")}),l.jsx(S,{colorScheme:"red",onClick:()=>{i.current.filterEdges((e,s,t,n,r,i,l)=>pe.has(s.style)&&JSON.stringify(s[s.style].color)===JSON.stringify(o)).forEach(e=>i.current.dropEdge(e)),n(De(i.current.export())),n($e()),t()},children:r("remove")})]})]})]})},un=e=>{const{isOpen:s,onClose:t}=e,n=we(),{t:r}=Us(),i=Vs.useRef(window.graph),[o,p]=Vs.useState(1),g=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:o.toString(),variant:"number",onChange:e=>p(Number(e)),minW:"full"}];return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:r("header.settings.procedures.scale.title")}),l.jsx(u,{}),l.jsxs(x,{children:[r("header.settings.procedures.scale.content"),l.jsx(Oe,{fields:g})]}),l.jsxs(_,{children:[l.jsx(S,{colorScheme:"blue",variant:"outline",mr:"1",onClick:t,children:r("cancel")}),l.jsx(S,{colorScheme:"red",onClick:()=>{i.current.forEachNode((e,s)=>{i.current.updateNodeAttribute(e,"x",e=>(null!=e?e:0)*o),i.current.updateNodeAttribute(e,"y",e=>(null!=e?e:0)*o)}),n(De(i.current.export())),n(Be()),n($e()),t()},children:r("apply")})]})]})]})},xn=e=>{const{isOpen:s,onClose:t}=e,n=we(),{t:r}=Us(),i=Vs.useRef(window.graph),[o,p]=Vs.useState(0),[g,m]=Vs.useState(0),j=[{type:"input",label:r("header.settings.procedures.translate.x"),value:o.toString(),variant:"number",onChange:e=>p(Number(e)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:g.toString(),variant:"number",onChange:e=>m(Number(e)),minW:"full"}];return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:r("header.settings.procedures.translate.title")}),l.jsx(u,{}),l.jsxs(x,{children:[r("header.settings.procedures.translate.content"),l.jsx(Oe,{fields:j})]}),l.jsxs(_,{children:[l.jsx(S,{colorScheme:"blue",variant:"outline",mr:"1",onClick:t,children:r("cancel")}),l.jsx(S,{colorScheme:"red",onClick:()=>{i.current.forEachNode((e,s)=>{i.current.updateNodeAttribute(e,"x",e=>(null!=e?e:0)+o),i.current.updateNodeAttribute(e,"y",e=>(null!=e?e:0)+g)}),n(De(i.current.export())),n(Be()),n($e()),t()},children:r("apply")})]})]})]})},pn=e=>{const{isOpen:s,onClose:t}=e,n=we(),{preference:{unlockSimplePathAttempts:r}}=ye(e=>e.app),{activeSubscriptions:i}=ye(e=>e.account),{t:o}=Us();return l.jsxs(a,{isOpen:s,onClose:t,size:"5xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:o("header.settings.procedures.unlockSimplePath.title")}),l.jsx(u,{}),l.jsxs(x,{children:[l.jsx(m,{mb:"2",children:o("header.settings.procedures.unlockSimplePath.content1")}),l.jsx(m,{mb:"2",children:o("header.settings.procedures.unlockSimplePath.content2")}),l.jsx(m,{mb:"2",children:o("header.settings.procedures.unlockSimplePath.content3")})]}),l.jsx(_,{children:l.jsx(X,{label:o("header.settings.pro"),isOpen:!i.RMP_CLOUD&&r>=0,children:l.jsx(S,{onClick:()=>{n(cs(-1))},isDisabled:!i.RMP_CLOUD||r<0,children:o(r>=0?"header.settings.procedures.unlockSimplePath.check":"header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},gn=e=>{const{isOpen:s,onClose:t}=e,n=we(),r=Q(),{t:i}=Us(),o=Vs.useRef(window.graph),[p,g]=Vs.useState(!1);return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:i("header.settings.procedures.updateColor.title")}),l.jsx(u,{}),l.jsx(x,{children:l.jsx(m,{children:i("header.settings.procedures.updateColor.content")})}),l.jsxs(_,{children:[l.jsx(S,{colorScheme:"blue",variant:"outline",mr:"1",onClick:t,children:i("cancel")}),l.jsx(S,{colorScheme:"red",onClick:async()=>{g(!0);const e=JSON.stringify(o.current.export());try{const s=await fn(e);o.current.clear(),o.current.import(s),n(De(o.current.export())),n(Be()),n($e()),r({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(s){We.error(`[rmp] Error in updating all colors: ${s}`),r({title:i("header.settings.procedures.updateColor.error",{e:s}),status:"error",duration:9e3,isClosable:!0})}g(!1),t()},isLoading:p,children:i("apply")})]})]})]})},mn=e=>e.length>=4&&e.every(e=>"string"==typeof e)&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(xe).includes(e[3]),jn=(e,s,t)=>{const n=s.split(".");let r=e;for(let i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=t},fn=async e=>{const s=JSON.parse(e),t=(new Date).getTime(),n=(e=>{const s=[],t=(e,n)=>{if(Array.isArray(e)&&mn(e))s.push({path:n||"",value:e});else for(const r in e){const i=e[r],o=n?`${n}.${r}`:r;Array.isArray(i)?mn(i)?s.push({path:o,value:i}):i.forEach((e,s)=>t(e,`${o}.${s}`)):i&&"object"==typeof i&&t(i,o)}};return t(e),s})(s);We.debug("[rmp] Found all themes pending for update",n);let r,i=!1;const o=new Promise((e,t)=>{r=setTimeout(()=>{i=!0,t("Executing time exceeds 10000ms")},1e4),(async()=>{for(const{path:e,value:t}of n){if(i)throw new Error("Update aborted");const[n,r,o,l,...a]=t,c=await ds([n,r,o,l]);jn(s,e,[...c,...a])}})().then(e).catch(t)});try{return await o,We.debug(`[rmp] Themes update completed, elapsed time ${((new Date).getTime()-t)/1e3} sec`),s}finally{clearTimeout(r)}},bn=()=>{const e=we(),{state:s,token:t}=ye(e=>e.account),{count:{stations:n,miscNodes:r,masters:i,lines:o,parallel:a}}=ye(e=>e.runtime),{t:c}=Us(),[d,h]=Vs.useState(!1),[u,x]=Vs.useState(1);Vs.useEffect(()=>{let e;return d&&u>0?e=window.setTimeout(()=>{x(u-1)},1e3):0===u&&h(!1),()=>clearTimeout(e)},[d,u]);const p={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),l.jsxs(j,{mt:"3",children:[l.jsxs(j,{mb:"1",children:[l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.stations")}),l.jsx(m,{children:n})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.miscNodes")}),l.jsx(m,{children:r})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.masters")}),l.jsx(m,{children:i})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.lines")}),l.jsx(m,{children:o})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:c("header.settings.status.count.parallel")}),l.jsx(m,{children:a})]})]}),l.jsxs(j,{display:"flex",mb:"1",children:[l.jsxs(m,{flex:"1",children:[c("header.settings.status.subscription.content")," ",p[s]]}),l.jsx(T,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:l.jsx(hs,{}),isDisabled:d,onClick:()=>(h(!0),x(1),void(t&&us(e,t)))})]})]})]})},wn={width:"100%",justifyContent:"space-between"},yn={fontFamily:"-apple-system"},vn=e=>{const{isOpen:s,onClose:t}=e,{activeSubscriptions:n}=ye(e=>e.account),{telemetry:{project:r},preference:{autoParallel:i,randomStationsNames:o,gridLines:p,snapLines:g,predictNextNode:f,autoChangeStationType:w}}=ye(e=>e.app),{keepLastPath:y,count:{parallel:v}}=ye(e=>e.runtime),C=we(),{t:_}=Us(),k=N("primary.500","primary.300"),[O,z]=Vs.useState(!1),[R,A]=Vs.useState(!1),[T,P]=Vs.useState(!1),[I,D]=Vs.useState(!1),[$,W]=Vs.useState(!1),[G,F]=Vs.useState(!1),[H,U]=Vs.useState(!1),V=he.isAllowAnalytics(),Y=v>=(n.RMP_CLOUD?xs:ps),J=!n.RMP_CLOUD;return l.jsxs(a,{isOpen:s,onClose:t,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[l.jsx(c,{}),l.jsxs(d,{children:[l.jsx(h,{children:_("header.settings.title")}),l.jsx(u,{}),l.jsx(x,{children:l.jsxs(b,{divider:l.jsx(ce,{borderColor:"gray.200"}),children:[l.jsx(bn,{}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.preference.title")}),l.jsxs(b,{spacing:"0",mt:"3",align:"stretch",children:[l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.keepLastPath")}),l.jsx(ee,{isChecked:y,onChange:({target:{checked:e}})=>C(gs(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{children:_("header.settings.preference.autoParallel")}),l.jsx(L,{ml:"auto",colorScheme:"green",children:"New"}),l.jsx(X,{label:_("header.settings.proWithTrial"),children:l.jsx(L,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),l.jsx(ee,{ml:"1",isDisabled:Y,isChecked:i,onChange:({target:{checked:e}})=>C(ms(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.randomStationNames.title")}),l.jsx(L,{ml:"auto",colorScheme:"green",children:"New"}),l.jsx(X,{label:_("header.settings.pro"),children:l.jsx(L,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),l.jsxs(se,{size:"xs",width:"auto",ml:"1",value:o,onChange:e=>{C(zs(e.target.value))},children:[l.jsx("option",{value:"none",children:_("header.settings.preference.randomStationNames.none")}),l.jsx("option",{value:js.Shmetro,disabled:J,children:_(`header.settings.preference.randomStationNames.${js.Shmetro}`)}),l.jsx("option",{value:js.Bjsubway,disabled:J,children:_(`header.settings.preference.randomStationNames.${js.Bjsubway}`)})]})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.gridline")}),l.jsx(ee,{isChecked:p,onChange:({target:{checked:e}})=>C(fs(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.snapline")}),l.jsx(ee,{isChecked:g,onChange:({target:{checked:e}})=>C(bs(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.predictNextNode")}),l.jsx(ee,{isChecked:f,onChange:({target:{checked:e}})=>C(ws(e))})]}),l.jsxs(B,{mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.preference.autoChangeStationType")}),l.jsx(ee,{isChecked:w,onChange:({target:{checked:e}})=>C(ys(e))})]})]})]}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.procedures.title")}),l.jsxs(j,{mt:"3",children:[l.jsx(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>z(!0),children:_("header.settings.procedures.translate.title")}),l.jsx(xn,{isOpen:O,onClose:()=>z(!1)}),l.jsx(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>A(!0),children:_("header.settings.procedures.scale.title")}),l.jsx(un,{isOpen:R,onClose:()=>A(!1)}),l.jsxs(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>P(!0),children:[_("header.settings.procedures.changeType.title"),l.jsx(X,{label:_("header.settings.pro"),children:l.jsx(L,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),l.jsx(rt,{isOpen:T,onClose:()=>P(!1),isSelect:!1}),l.jsx(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>D(!0),children:_("header.settings.procedures.removeLines.title")}),l.jsx(hn,{isOpen:I,onClose:()=>D(!1)}),l.jsx(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>W(!0),children:_("header.settings.procedures.updateColor.title")}),l.jsx(gn,{isOpen:$,onClose:()=>W(!1)}),l.jsxs(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>F(!0),children:[_("header.settings.procedures.unlockSimplePath.title"),l.jsx(X,{label:_("header.settings.pro"),children:l.jsx(L,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),l.jsx(pn,{isOpen:G,onClose:()=>F(!1)}),l.jsx(S,{sx:wn,rightIcon:l.jsx(vs,{}),onClick:()=>U(!0),children:_("header.settings.procedures.masterManager.title")}),l.jsx(nt,{isOpen:H,onClose:()=>U(!1)})]})]}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.shortcuts.title")}),l.jsx(j,{mt:"3",children:l.jsxs(te,{children:[l.jsx(ne,{children:l.jsxs(re,{children:[l.jsx(ie,{children:_("header.settings.shortcuts.keys")}),l.jsx(ie,{children:_("header.settings.shortcuts.description")})]})}),l.jsxs(oe,{children:[l.jsxs(re,{children:[l.jsx(le,{children:l.jsx(ae,{children:"f"})}),l.jsx(le,{children:_("header.settings.shortcuts.f")})]}),l.jsxs(re,{children:[l.jsx(le,{children:l.jsx(ae,{children:"s"})}),l.jsx(le,{children:_("header.settings.shortcuts.s")})]}),l.jsxs(re,{children:[l.jsx(le,{children:l.jsx(ae,{children:"c"})}),l.jsx(le,{children:_("header.settings.shortcuts.c")})]}),l.jsxs(re,{children:[l.jsx(le,{children:l.jsxs(j,{display:"flex",flexDirection:"row",children:[l.jsx(Cs,{}),l.jsx(Ss,{}),l.jsx(_s,{}),l.jsx(ks,{})]})}),l.jsx(le,{children:_("header.settings.shortcuts.arrows")})]}),l.jsxs(re,{children:[l.jsx(le,{children:l.jsxs(j,{display:"flex",flexDirection:"row",children:[l.jsx(ae,{children:"i"}),l.jsx(ae,{children:"j"}),l.jsx(ae,{children:"k"}),l.jsx(ae,{children:"l"})]})}),l.jsx(le,{children:_("header.settings.shortcuts.ijkl")})]}),l.jsxs(re,{children:[l.jsx(le,{children:Os?l.jsx(ae,{sx:yn,children:"⇧"}):l.jsx(ae,{children:"shift"})}),l.jsx(le,{children:_("header.settings.shortcuts.shift")})]}),l.jsxs(re,{children:[l.jsx(le,{children:Os?l.jsx(ae,{sx:yn,children:"⌥"}):l.jsx(ae,{children:"alt"})}),l.jsx(le,{children:_("header.settings.shortcuts.alt")})]}),l.jsxs(re,{children:[l.jsx(le,{children:Os?l.jsx(ae,{sx:yn,children:"⌫"}):l.jsx(ae,{children:"delete"})}),l.jsx(le,{children:_("header.settings.shortcuts.delete")})]}),l.jsxs(re,{children:[l.jsxs(le,{children:[Os?l.jsx(ae,{sx:yn,children:"⌘"}):l.jsx(ae,{children:"ctrl"})," + ",l.jsx(ae,{children:"x"})]}),l.jsx(le,{children:_("header.settings.shortcuts.cut")})]}),l.jsxs(re,{children:[l.jsxs(le,{children:[Os?l.jsx(ae,{sx:yn,children:"⌘"}):l.jsx(ae,{children:"ctrl"})," + ",l.jsx(ae,{children:"c"})]}),l.jsx(le,{children:_("header.settings.shortcuts.copy")})]}),l.jsxs(re,{children:[l.jsxs(le,{children:[Os?l.jsx(ae,{sx:yn,children:"⌘"}):l.jsx(ae,{children:"ctrl"})," + ",l.jsx(ae,{children:"v"})]}),l.jsx(le,{children:_("header.settings.shortcuts.paste")})]}),l.jsxs(re,{children:[l.jsxs(le,{children:[Os?l.jsx(ae,{sx:yn,children:"⌘"}):l.jsx(ae,{children:"ctrl"})," + ",l.jsx(ae,{children:"z"})]}),l.jsx(le,{children:_("header.settings.shortcuts.undo")})]}),l.jsxs(re,{children:[l.jsx(le,{children:Os?l.jsxs(l.Fragment,{children:[l.jsx(ae,{sx:yn,children:"⇧"})," + ",l.jsx(ae,{sx:yn,children:"⌘"})," + ",l.jsx(ae,{children:"z"})]}):l.jsxs(l.Fragment,{children:[l.jsx(ae,{children:"ctrl"})," + ",l.jsx(ae,{children:"y"})]})}),l.jsx(le,{children:_("header.settings.shortcuts.redo")})]})]})]})})]}),l.jsxs(j,{width:"100%",mb:"3",children:[l.jsx(m,{as:"b",fontSize:"xl",children:_("header.settings.telemetry.title")}),l.jsxs(j,{mt:"3",children:[l.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:_("header.settings.telemetry.info")}),l.jsxs(j,{mt:"3",mb:"1",children:[l.jsxs(j,{display:"flex",mb:"1",children:[l.jsx(m,{flex:"1",children:_("header.settings.telemetry.essential")}),l.jsx(X,{label:_("header.settings.telemetry.essentialTooltip"),children:l.jsx(ee,{isChecked:V,isDisabled:!0})})]}),l.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:_("header.settings.telemetry.essentialInfo")}),l.jsxs(E,{color:k,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[_("header.settings.telemetry.essentialLink")," ",l.jsx(M,{as:be})]})]}),l.jsxs(j,{mt:"1",mb:"1",children:[l.jsxs(j,{display:"flex",children:[l.jsx(m,{flex:"1",children:_("header.settings.telemetry.additional")}),l.jsx(ee,{isChecked:r,onChange:({target:{checked:e}})=>{C(Es(e))}})]}),l.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:_("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},Cn=()=>{const[e,s]=Vs.useState(!1),{svgViewBoxZoom:t}=ye(e=>e.param),n=we(),r=[{type:"slider",label:"",value:400-t,min:10,max:390,step:1,onChange:e=>n(Ve(400-e)),leftIcon:l.jsx(Ns,{}),rightIcon:l.jsx(Ms,{}),minW:160}];return l.jsxs(J,{isOpen:e,onOpen:()=>s(!0),onClose:()=>s(!1),children:[l.jsx(K,{children:l.jsx(T,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:l.jsx(Ms,{}),onClick:()=>s(!e)})}),l.jsx(Z,{children:l.jsx(q,{children:l.jsx(Oe,{fields:r,noLabel:!0})})})]})};function Sn(){const{t:e}=Us(),s=we(),{past:t,future:n}=ye(e=>e.param),r=he.isAllowAnalytics(),[o,a]=Vs.useState(!1),[c,d]=Vs.useState(!1),h=i(he.getEnv),u=i(he.getAppVersion),x=Rs();Vs.useEffect(()=>{r&&h!==As.DEV&&he.event(ze.APP_LOAD,{isStandaloneWindow:he.isStandaloneWindow()})},[h]);return l.jsxs(Ts,{children:[l.jsxs(p,{direction:"landscape"===x?"row":"column",width:"100%",children:[l.jsxs(B,{height:"32px",children:[l.jsx(f,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rmp")}),l.jsx(Ps,{environment:h,version:u,popoverHeader:h===As.PRD?void 0:l.jsxs(Ys,{i18nKey:"header.popoverHeader",environment:h,children:["You're on ",{environment:h}," environment!"]}),popoverBody:h===As.PRD?void 0:l.jsx(Ys,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),l.jsxs(B,{overflowX:"auto",ml:"landscape"===x?"auto":void 0,children:[l.jsx(dn,{}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Undo",icon:l.jsx(Is,{}),isDisabled:0===t.length,onClick:()=>{s(Gs())}}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Redo",icon:l.jsx(Ls,{}),isDisabled:0===n.length,onClick:()=>{s(Fs())}}),l.jsx(Cn,{}),l.jsx(an,{}),l.jsx(qt,{}),he.isStandaloneWindow()&&l.jsxs(R,{children:[l.jsx(A,{as:T,icon:l.jsx(Ds,{}),variant:"ghost",size:"sm"}),l.jsx(P,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(e=>l.jsx(I,{onClick:()=>{return s=e,void he.getI18nInstance().changeLanguage(s);var s},children:Bs[e][e]},e))})]}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Settings",icon:l.jsx($s,{}),onClick:()=>a(!0)}),l.jsx(T,{size:"sm",variant:"ghost","aria-label":"Help",icon:l.jsx(Ws,{}),onClick:()=>d(!0)})]})]}),l.jsx(vn,{isOpen:o,onClose:()=>a(!1)}),l.jsx(it,{isOpen:c,onClose:()=>d(!1)})]})}function _n(){const e=we(),s=ye(e=>e.runtime.globalAlerts);return l.jsx(l.Fragment,{children:Object.entries(s).map(([s,{message:t,url:n,linkedApp:r}])=>l.jsxs($,{status:s,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[l.jsx(W,{}),r?l.jsx(E,{onClick:()=>(e=>{he.isStandaloneWindow()?window.open(`/${e}`,"_blank"):he.openApp({appId:e})})(r),children:t}):n?l.jsx(E,{href:n,target:"_blank",children:t}):t,l.jsx(Y,{ml:"auto",onClick:()=>e(Hs(s))})]},s))})}}}})}();
