!function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function t(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach(function(e){n(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function n(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}System.register(["./chakra-legacy-nXMG1WKf.js","./index-legacy-C5Ybctvx.js","./react-legacy-n6CMfwan.js","./change-types-legacy-DQi-M_3L.js","./misc-nodes-legacy-BGW8Y0I-.js","./change-type-modal-legacy-u7D3TyWL.js","./localized-order-legacy-CcESqjMI.js","./useEvent-legacy-D1mmFtZM.js"],function(e,n){"use strict";var r,i,s,a,l,o,c,d,u,p,h,g,m,b,f,x,j,y,v,w,S,A,C,E,N,O,k,z,W,P,T,R,I,D,M,L,_,U,F,V,B,G,K,$,q,H,J,Q,X,Y,Z,ee,te,ne,re,ie,se,ae,le,oe,ce,de;return{setters:[e=>{r=e.j,i=e.B,s=e.ak,a=e.al,l=e.aw,o=e.v,c=e.az,d=e.y,u=e.D,p=e.H,h=e.M,g=e.J,m=e.K,b=e.N,f=e.av,x=e.Q,j=e.O},e=>{y=e.c,v=e.e,w=e.bi,S=e.a0,A=e.bj,C=e.b0,E=e.w,N=e.y,O=e.q,k=e.aK,z=e.L,W=e.t,P=e._,T=e.bk,R=e.ag,I=e.x,D=e.S,M=e.a7,L=e.a8,_=e.k,U=e.F,F=e.z,V=e.b1,B=e.aG,G=e.bl,K=e.bm,$=e.bn,q=e.bo,H=e.p,J=e.bf,Q=e.bp,X=e.n,Y=e.aP},e=>{Z=e.u,ee=e.b},e=>{te=e.f,ne=e.g,re=e.h,ie=e.b,se=e.e},e=>{ae=e.s,le=e.b},e=>{oe=e.C},e=>{ce=e.b},e=>{de=e.u}],execute:function(){function n(){const{t:e}=Z(),t=y(),{selected:n}=v(e=>e.runtime),p=ee.useRef(window.graph),h=e=>{if(p.current.hasNode(e)){const t=p.current.getNodeAttributes(e),n=t.type;return e.startsWith("stn")?t[n].names.join("/"):n}if(p.current.hasEdge(e)){const[t,n]=p.current.extremities(e),r=p.current.getSourceAttributes(e),i=p.current.getTargetAttributes(e),s=r.type,a=i.type;return(t.startsWith("stn")?r[s].names[0]:s)+" - "+(n.startsWith("stn")?i[a].names[0]:a)}},[g,m]=ee.useState([]);ee.useEffect(()=>{m(["station","misc-node","line"])},[n]);const[b,f]=ee.useState(!1);return r.jsxs(i,{children:[r.jsxs(s,{as:"h5",size:"sm",children:[e("panel.details.multipleSelection.selected")," ",n.size]}),r.jsxs(a,{m:"var(--chakra-space-1)",children:[r.jsxs(l,{w:"100%",children:[r.jsx(s,{as:"h5",size:"xs",w:"100%",children:e("panel.details.multipleSelection.show")}),r.jsx(w,{selections:[{label:e("panel.details.multipleSelection.station"),value:"station"},{label:e("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:e("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:g,multiSelect:!0,onChange:e=>m(e)})]}),0!==g.length&&r.jsxs(r.Fragment,{children:[r.jsxs(o,{width:"100%",size:"sm",onClick:()=>f(!0),children:[e("panel.details.multipleSelection.change"),r.jsx(c,{label:e("header.settings.pro"),children:r.jsx(d,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),r.jsx(u,{})]}),[...n].filter(e=>g.includes("station")||!e.startsWith("stn")).filter(e=>g.includes("misc-node")||!e.startsWith("misc")).filter(e=>g.includes("line")||!e.startsWith("line")).map(e=>{var n;return r.jsxs(l,{width:"100%",children:[r.jsx(o,{width:"100%",size:"sm",variant:"solid",onClick:()=>t(S(new Set([e]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:null===(n=h(e))||void 0===n?void 0:n.replaceAll("\n","âŽ")}),r.jsx(o,{size:"sm",onClick:()=>t(C(e)),children:r.jsx(A,{})})]},e)})]}),r.jsx(oe,{isOpen:b,onClose:()=>f(!1),isSelect:!0,filter:g})]})}const ue=new Set([W.ShmetroVirtualInt,W.GzmtrVirtualInt,W.River,W.MTRPaidArea,W.MTRUnpaidArea,W.MRTTapeOut]),pe=(e,t,n)=>(e!==z.Simple||!ue.has(t))&&(!(!O[e].isPro||n)||(!(!k[t].isPro||n)||!k[t].metadata.supportLinePathType.includes(e)));function he(){var e,t;const{i18n:n,t:i}=Z(),s=y(),a=ee.useCallback(()=>{s(E(S.current.export())),s(N())},[s,N,E]),{activeSubscriptions:l}=v(e=>e.account),{preference:{autoParallel:c,disableWarning:d}}=v(e=>e.app),{selected:u,theme:j}=v(e=>e.runtime),[w]=u,S=ee.useRef(window.graph),[A,C]=ee.useState(!1),I=ee.useRef(null),[D,M]=ee.useState(!1),L=Object.fromEntries(Object.entries(O).map(([e,t])=>[e,i(t.metadata.displayName).toString()])),[_,U]=ee.useState(S.current.getEdgeAttribute(w,"type")),[F,V]=ee.useState(void 0),B=Object.fromEntries(null!==(e=null===(t=ce[n.language])||void 0===t?void 0:t.map(e=>[e,i(k[e].metadata.displayName).toString()]))&&void 0!==e?e:[]),[G,K]=ee.useState(S.current.getEdgeAttribute(w,"style")),[$,q]=ee.useState(void 0);ee.useEffect(()=>{U(S.current.getEdgeAttribute(w,"type")),K(S.current.getEdgeAttribute(w,"style"))},[w]);const H=Object.values(z).filter(e=>pe(e,G,l.RMP_CLOUD)),J=Object.values(W).filter(e=>pe(_,e,l.RMP_CLOUD)),Q=e=>{e&&(te(S.current,w,e,c),U(S.current.getEdgeAttribute(w,"type")),a())},X=e=>{e&&(ne(S.current,w,e,j),K(S.current.getEdgeAttribute(w,"style")),a())},Y=e=>{e&&(F?(Q(F),V(void 0)):$&&(X($),q(void 0)),D&&s(R(!0))),M(!1),C(!1)};return r.jsxs(r.Fragment,{children:[r.jsx(P,{label:i("panel.details.info.linePathType"),minW:"276",children:r.jsx(T,{options:L,disabledOptions:H,defaultValue:_,value:_,onChange:({target:{value:e}})=>{d.changeType?Q(e):(V(e),C(!0))}})}),r.jsx(P,{label:i("panel.details.info.lineStyleType"),minW:"276",children:r.jsx(T,{options:B,disabledOptions:J,defaultValue:G,value:G,onChange:({target:{value:e}})=>{d.changeType?X(e):(q(e),C(!0))}})}),r.jsx(p,{isOpen:A,leastDestructiveRef:I,onClose:()=>Y(!1),children:r.jsx(h,{children:r.jsxs(g,{children:[r.jsx(m,{children:i("warning")}),r.jsxs(b,{children:[i("panel.details.changeLineTypeContent"),r.jsx(f,{mt:4,isChecked:D,onChange:e=>M(e.target.checked),width:"100%",children:i("noShowAgain")})]}),r.jsxs(x,{children:[r.jsx(o,{ref:I,onClick:()=>Y(!1),children:i("cancel")}),r.jsx(o,{ml:"2",colorScheme:"red",onClick:()=>Y(!0),children:i("panel.details.changeType")})]})]})})})]})}function ge(){const{t:e}=Z(),t=y(),n=ee.useCallback(()=>{t(E(d.current.export())),t(I())},[t,I,E]),{selected:i,refresh:{nodes:s}}=v(e=>e.runtime),{preference:{autoChangeStationType:a,disableWarning:l}}=v(e=>e.app),[c]=i,d=ee.useRef(window.graph),[u,j]=ee.useState(!1),w=ee.useRef(null),[S,A]=ee.useState(void 0),[C,N]=ee.useState(!1),[O,k]=ee.useState(D.ShmetroBasic);ee.useEffect(()=>{if(null!=c&&c.startsWith("stn")){const e=d.current.getNodeAttribute(c,"type");k(e)}},[s,i]);const z=Object.fromEntries(Object.entries(ae).map(([t,n])=>[t,e(n.metadata.displayName).toString()])),W=e=>{e&&(re(d.current,c,e),a&&c.startsWith("stn")&&ie(d.current,c),n())},M=e=>{e&&S&&(W(S),C&&t(R(!0))),A(void 0),N(!1),j(!1)};return r.jsxs(r.Fragment,{children:[r.jsx(P,{label:e("panel.details.info.stationType"),minW:"276",children:r.jsx(T,{options:z,disabledOptions:[O],value:O,onChange:({target:{value:e}})=>{l.changeType?W(e):(A(e),j(!0))}})}),r.jsx(p,{isOpen:u,leastDestructiveRef:w,onClose:()=>M(!1),children:r.jsx(h,{children:r.jsxs(g,{children:[r.jsx(m,{children:e("warning")}),r.jsxs(b,{children:[e("panel.details.changeStationTypeContent"),r.jsx(f,{mt:4,isChecked:C,onChange:e=>N(e.target.checked),width:"100%",children:e("noShowAgain")})]}),r.jsxs(x,{children:[r.jsx(o,{ref:w,onClick:()=>M(!1),children:e("cancel")}),r.jsx(o,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:e("panel.details.changeType")})]})]})})})]})}function me(){const{t:e}=Z(),t=y(),a=ee.useCallback(()=>{t(E(u.current.export())),t(I()),t(N())},[t,I,N,E]),{activeSubscriptions:l}=v(e=>e.account),{selected:o,count:{parallel:c}}=v(e=>e.runtime),[d]=o,u=ee.useRef(window.graph),p=e=>{u.current.setEdgeAttribute(d,"parallelIndex",e),t(E(u.current.export())),t(N())},h=[];if(0===o.size);else if(1===o.size){if(h.push({type:"input",label:e("panel.details.info.id"),value:d,minW:276}),h.push({type:"select",label:e("panel.details.info.zIndex"),value:d?u.current.hasNode(d)?u.current.getNodeAttribute(d,"zIndex"):u.current.hasEdge(d)?u.current.getEdgeAttribute(d,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(e,t)=>[t-10,(t-10).toString()])),onChange:e=>(e=>{const t=Math.min(Math.max(e,-10),10);u.current.hasNode(d)&&u.current.setNodeAttribute(d,"zIndex",t),u.current.hasEdge(d)&&u.current.setEdgeAttribute(d,"zIndex",t),a()})(Number(e))}),u.current.hasEdge(d)){const t=u.current.getEdgeAttributes(d),{parallelIndex:n,type:r}=t,i=l.RMP_CLOUD?M:L,s=c>i&&n<0||r===z.Simple,a=c>i&&n>=0;h.push({type:"switch",label:e("panel.details.info.parallel"),isDisabled:s,isChecked:n>=0,onChange:e=>((e,t)=>{let n=-1;if(e){const e=u.current.getEdgeAttributes(d),[r,i]=u.current.extremities(d);n=U(u.current,e.type,r,i,t)}p(n)})(e,t[t.type].startFrom),oneLine:!0,minW:276}),n>=0&&h.push({type:"input",label:e("panel.details.info.parallelIndex"),variant:"number",isDisabled:a,value:t.parallelIndex.toString(),onChange:e=>p(Number(e)),minW:276})}}else o.size>1&&h.push({type:"input",label:e("panel.details.info.type"),value:e("panel.details.multipleSelection.title"),minW:276});return r.jsxs(i,{p:1,children:[r.jsx(s,{as:"h5",size:"sm",children:e("panel.details.info.title")}),r.jsx(_,{fields:h,minW:130}),1===o.size&&d.startsWith("stn")&&u.current.hasNode(d)&&u.current.getNodeAttribute(d,"type")in ae&&r.jsx(ge,{}),1===o.size&&d.startsWith("line")&&u.current.hasEdge(d)&&u.current.getEdgeAttribute(d,"type")in O&&u.current.getEdgeAttribute(d,"style")in k&&r.jsx(he,{}),o.size>1&&r.jsx(n,{})]})}function be(){const{t:e}=Z(),t=y(),{selected:n}=v(e=>e.runtime),[a]=n,l=ee.useRef(window.graph),[c,d]=ee.useState("undefined"),[u,p]=ee.useState("undefined"),[h,g]=ee.useState("undefined"),[m,b]=ee.useState("undefined");ee.useEffect(()=>{if(null!=a&&a.startsWith("line")){const[i,s]=l.current.extremities(a);if(d(i),p(s),i.startsWith("stn")){var e,t;const n=l.current.getNodeAttribute(i,"type");g(null!==(e=null===(t=l.current.getNodeAttribute(i,n))||void 0===t?void 0:t.names.at(0))&&void 0!==e?e:"undefined")}if(s.startsWith("stn")){var n,r;const e=l.current.getNodeAttribute(s,"type");b(null!==(n=null===(r=l.current.getNodeAttribute(s,e))||void 0===r?void 0:r.names.at(0))&&void 0!==n?n:"undefined")}}},[n]);const f=de(()=>{t(F()),t(V(c))}),x=de(()=>{t(F()),t(V(u))}),j=[{type:"custom",label:e("panel.details.lineExtremities.source"),component:r.jsx(o,{ml:"auto",size:"sm",variant:"link",onClick:f,children:c}),oneLine:!0,minW:"full"},{type:"input",label:e("panel.details.lineExtremities.sourceName"),value:h,minW:"full"},{type:"custom",label:e("panel.details.lineExtremities.target"),component:r.jsx(o,{ml:"auto",size:"sm",variant:"link",onClick:x,children:u}),oneLine:!0,minW:"full"},{type:"input",label:e("panel.details.lineExtremities.targetName"),value:m,minW:"full"}];return r.jsxs(i,{p:1,children:[r.jsx(s,{as:"h5",size:"sm",children:e("panel.details.lineExtremities.title")}),r.jsx(_,{fields:j,minW:130})]})}function fe(){const{t:e}=Z(),t=y(),n=ee.useCallback(()=>{t(E(c.current.export())),t(I()),t(N())},[t,I,N,E]),{selected:a,refresh:{nodes:l}}=v(e=>e.runtime),[o]=a,c=ee.useRef(window.graph),[d,u]=ee.useState({x:0,y:0});ee.useEffect(()=>{if(null!=o&&o.startsWith("stn")||null!=o&&o.startsWith("misc_node_")){const e=c.current.getNodeAttribute(o,"x"),t=c.current.getNodeAttribute(o,"y");u({x:e,y:t})}},[l,a]);const p=[{type:"input",label:e("panel.details.nodePosition.pos.x"),value:d.x.toString(),validator:e=>!Number.isNaN(e),onChange:e=>{c.current.mergeNodeAttributes(o,{x:Number(e)}),n()}},{type:"input",label:e("panel.details.nodePosition.pos.y"),value:d.y.toString(),validator:e=>!Number.isNaN(e),onChange:e=>{c.current.mergeNodeAttributes(o,{y:Number(e)}),n()}}];return r.jsxs(i,{p:1,children:[r.jsx(s,{as:"h5",size:"sm",children:e("panel.details.nodePosition.title")}),r.jsx(_,{fields:p,minW:130})]})}const xe=t(t({},ae),le),je=()=>{var e;const t=y(),{selected:n}=v(e=>e.runtime),{t:i}=Z(),[s]=n,a=window.graph.getNodeAttribute(s,"type"),l=a in xe&&xe[a].attrsComponent,o=null!==(e=window.graph.getNodeAttribute(s,a))&&void 0!==e?e:{};return l?r.jsx(l,{id:s,attrs:o,handleAttrsUpdate:(e,n)=>{const r=window.graph.getNodeAttribute(e,"type");window.graph.mergeNodeAttributes(e,{[r]:n}),t(E(window.graph.export())),t(I())}}):r.jsx(j,{fontSize:"xs",m:"var(--chakra-space-1)",children:i("panel.details.unknown.error",{category:i("panel.details.unknown.node")})})},ye=()=>{var e,t;const n=y(),{preference:{autoParallel:i}}=v(e=>e.app),{selected:s}=v(e=>e.runtime),{t:a}=Z(),[l]=s,{type:o,style:c,parallelIndex:d,reconcileId:u}=window.graph.getEdgeAttributes(l),p=null!==(e=window.graph.getEdgeAttribute(l,o))&&void 0!==e?e:{},h=o in O&&O[o].attrsComponent,g=null!==(t=window.graph.getEdgeAttribute(l,c))&&void 0!==t?t:{},m=c in k&&k[c].attrsComponent;return r.jsxs(r.Fragment,{children:[h?r.jsx(h,{id:l,attrs:p,recalculateParallelIndex:(e,t)=>{let n=-1;if(i){const[r,i]=window.graph.extremities(e);n=U(window.graph,o,r,i,t)}window.graph.setEdgeAttribute(e,"parallelIndex",n)},handleAttrsUpdate:(e,t)=>{window.graph.mergeEdgeAttributes(e,{[o]:t}),n(E(window.graph.export())),n(N())},parallelIndex:d}):r.jsx(j,{fontSize:"xs",m:"var(--chakra-space-1)",children:a("panel.details.unknown.error",{category:a("panel.details.unknown.linePath")})}),m?r.jsx(m,{id:l,attrs:g,handleAttrsUpdate:(e,t)=>{window.graph.mergeEdgeAttributes(e,{[c]:t}),n(E(window.graph.export())),n(N())},reconcileId:u}):r.jsx(j,{fontSize:"xs",m:"var(--chakra-space-1)",children:a("panel.details.unknown.error",{category:a("panel.details.unknown.lineStyle")})})]})};e("default",()=>{const{t:e}=Z(),t=y(),n=ee.useRef(window.graph),a=ee.useCallback(()=>{t(E(n.current.export())),t(I()),t(N())},[t,I,N,E]),{activeSubscriptions:c}=v(e=>e.account),{selected:d,isDetailsOpen:u,count:{masters:p}}=v(e=>e.runtime),{preference:{autoChangeStationType:h}}=v(e=>e.app),[g]=d,m=!c.RMP_CLOUD&&p+1>B;return r.jsxs(G,{isOpen:"show"===u,width:300,header:"Dummy header",alwaysOverlay:!0,children:[r.jsx(K,{onClose:()=>{J()?t(Q()):t(F())},children:e("panel.details.header")}),r.jsxs($,{children:[r.jsx(me,{}),1===d.size&&n.current.hasNode(g)&&r.jsx(fe,{}),1===d.size&&n.current.hasEdge(g)&&r.jsx(be,{}),1===d.size&&r.jsxs(i,{p:1,children:[r.jsx(s,{as:"h5",size:"sm",children:e("panel.details.specificAttrsTitle")}),window.graph.hasNode(g)&&r.jsx(je,{}),window.graph.hasEdge(g)&&r.jsx(ye,{})]})]}),r.jsx(q,{children:r.jsxs(l,{children:[1===d.size&&n.current.hasNode(g)&&r.jsx(o,{size:"sm",variant:"outline",onClick:()=>(e=>{const r=structuredClone(n.current.getNodeAttributes(e));r.x+=50,r.y+=50;const i=e.startsWith("stn")?`stn_${X(10)}`:`misc_node_${X(10)}`;n.current.addNode(i,r),t(E(n.current.export())),t(I())})(g),isDisabled:n.current.getNodeAttributes(g).type===H.Master&&m,children:e("panel.details.footer.duplicate")}),r.jsx(o,{size:"sm",variant:"outline",onClick:()=>(e=>{const t=Y(n.current,e);navigator.clipboard.writeText(t)})(d),children:e("panel.details.footer.copy")}),r.jsx(o,{size:"sm",variant:"outline",onClick:()=>{return e=d,t(F()),e.forEach(e=>{if(n.current.hasNode(e))n.current.dropNode(e);else if(n.current.hasEdge(e)){const[t,r]=n.current.extremities(e);n.current.dropEdge(e),h&&t.startsWith("stn")&&se(n.current,t),h&&r.startsWith("stn")&&se(n.current,r)}}),void a();var e},children:e("panel.details.footer.remove")})]})})]})})}}})}();
