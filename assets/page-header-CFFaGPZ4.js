import{j as e,ag as q,M as Z,ah as Q,J,K as ee,L as X,h as us,ai as yt,N as m,B as O,aj as Oe,ak as We,T as oe,al as ae,b as le,q as rs,t as I,O as xe,am as Ct,an as vt,ao as Me,R as N,ap as B,Q as Qs,aq as Ms,ar as Os,a2 as te,as as As,at as he,x as de,au as is,U as gs,V as xs,X as Ds,Y as Ps,av as ms,G as _t,H as kt,n as et,a8 as st,e as tt,w as nt,m as rt,E as it,aw as Ae,ax as Mt,a7 as be,a1 as Ot,ay as At,az as Tt,aA as V,aB as Bs,aC as zt,aD as R,aE as A,aF as Rt}from"./chakra-C1zJvDsN.js";import{u as Et,r as z,C as Nt,M as Ts,d as ot,n as fs,S as W,R as Ws,a as at,b as L,c as F,e as $,f as It,g as Lt,h as Dt,i as Pt,j as Pe,k as ze,E as ve,s as Bt,l as qe,m as Wt,L as os,o as Gt,p as Gs,q as $t,t as zs,v as Rs,w as ne,x as ge,y as re,z as pe,A as lt,B as Ut,D as ct,F as js,G as Re,H as Ue,I as $s,J as Us,K as Ft,N as Ht,O as Vt,P as Fs,Q as Yt,T as Hs,U as Kt,V as Zt,W as Jt,X as Xt,Y as qt,Z as Qt,_ as en,$ as sn,a0 as tn,a1 as nn,a2 as rn,a3 as on,a4 as an,a5 as ln,a6 as cn,a7 as Ze,a8 as dn,a9 as hn,aa as pn,ab as Se,ac as un,ad as gn,ae as xn,af as mn,ag as me,ah as fn,ai as jn,aj as Vs,ak as wn,al as bn,am as as,an as Sn,ao as yn,ap as Cn,aq as vn,ar as _n,as as kn,at as Mn,au as On,av as An,aw as Tn,ax as zn}from"./index-oNfFqJ7e.js";import{u as G,b as f,T as ws,r as Je}from"./react-BpF4RbzH.js";import{d as bs,i as Ys,m as Rn,a as En,s as Nn,b as dt,p as Ss,M as In}from"./master-manager--EETj_wQ.js";import{C as Ln}from"./change-type-modal-aX7lcdG9.js";var Ks=function(s){return Et(z.ready(),s)};const Dn=s=>{const{isOpen:a,onClose:o}=s,{t}=G(),r=z.getAppVersion();return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:t("header.about.title")}),e.jsx(ee,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(us,{direction:"row",children:[e.jsx(yt,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(us,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(m,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),e.jsx(m,{children:r}),e.jsx(m,{}),e.jsx(m,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e.jsx(O,{margin:5,children:e.jsx(m,{fontSize:"xl",children:t("header.about.desc")})}),e.jsx(Oe,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e.jsx(Oe,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e.jsxs(We,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(m,{fontSize:"sm",children:t("header.about.content1")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(m,{fontSize:"sm",children:t("header.about.langonginc")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Oe,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),e.jsxs(We,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),e.jsx(Oe,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),e.jsxs(We,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e.jsx(m,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e.jsx(m,{fontSize:"sm",children:t("header.about.slackContent")}),e.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Oe,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),e.jsxs(We,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),e.jsx(m,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ae,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(le,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),e.jsx(m,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Fe(s){const a=s.sizes.shift(),o=Math.max(Math.ceil(a[0]),1),t=Math.max(Math.ceil(a[1]),1),r=[o-1,t-1,1,1],i=performance.now(),n=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let c,h;n?(c=new OffscreenCanvas(1,1),h=new OffscreenCanvas(o,t)):(c=document.createElement("canvas"),c.width=1,c.height=1,h=document.createElement("canvas"),h.width=o,h.height=t);const u=c.getContext("2d"),b=h.getContext("2d");b&&(b.fillRect.apply(b,r),u.drawImage(h,o-1,t-1,1,1,0,0,1,1));const x=u&&u.getImageData(0,0,1,1).data[3]!==0,d=parseInt(performance.now()-i);return[c,h].forEach((l=>{l.height=0,l.width=0})),n?(postMessage({width:o,height:t,testTime:d,isTestPass:x}),!x&&s.sizes.length&&setTimeout((()=>{Fe(s)}),0)):x?s.onSuccess({width:o,height:t,testTime:d}):(s.onError({width:o,height:t,testTime:d}),s.sizes.length&&setTimeout((()=>{Fe(s)}),0)),x}const ls={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Te={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Be={};function cs(s){const a=s.width===s.height,o=s.height===1,t=s.width===1,r=[];if(!s.width||!s.height)s.sizes.forEach((i=>{const n=a||o?i:1,c=a||t?i:1;r.push([n,c])}));else{const i=s.min||Te.min,n=s.step||Te.step;let c=Math.max(s.width,s.height);for(;c>=i;){const h=a||o?c:1,u=a||t?c:1;r.push([h,u]),c-=n}}return r}function Xe(s){const a=typeof window<"u",o=a&&"Promise"in window,t=a&&"HTMLCanvasElement"in window,r=a&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),n=performance.now(),{onError:c,onSuccess:h,...u}=s,b=()=>parseInt(performance.now()-n);let x=null;if(!t)return!1;if(s.useWorker&&r){const d="\n            var canvasTest = ".concat(Fe.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),l=new Blob([d],{type:"application/javascript"}),p=URL.createObjectURL(l);x=new Worker(p),URL.revokeObjectURL(p),x.onmessage=function(g){const{width:j,height:S,testTime:w,isTestPass:y}=g.data,v={width:j,height:S,testTime:w,totalTime:b()};y?(Be[i].onSuccess(v),delete Be[i]):Be[i].onError(v)}}if(o)return new Promise((d=>{const l={...s,onError(p){let{width:g,height:j,testTime:S}=p;const w={width:g,height:j,testTime:S,totalTime:b()};let y;if(s.sizes.length===0)y=!0;else{const[[v,C]]=s.sizes.slice(-1);y=g===v&&j===C}c(w),y&&d({...w,success:!1})},onSuccess(p){let{width:g,height:j,testTime:S}=p;const w={width:g,height:j,testTime:S,totalTime:b()};h(w),d({...w,success:!0})}};if(x){const{onError:p,onSuccess:g}=l;Be[i]={onError:p,onSuccess:g},x.postMessage(u)}else Fe(l)}));if(x)Be[i]={onError:c,onSuccess:h},x.postMessage(u);else return Fe(s)}const Pn={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=cs({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...ls.area]}),o={...Te,...s,sizes:a};return Xe(o)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=cs({width:1,height:s.max,min:s.min,step:s.step,sizes:[...ls.height]}),o={...Te,...s,sizes:a};return Xe(o)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=cs({width:s.max,height:1,min:s.min,step:s.step,sizes:[...ls.width]}),o={...Te,...s,sizes:a};return Xe(o)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={...Te,...s};return a.sizes=[...a.sizes],a.width&&a.height&&(a.sizes=[[a.width,a.height]]),Xe(a)}};var He=(s=>(s.left="l",s.right="r",s))(He||{}),Ce=(s=>(s.through="through",s.nonThrough="nonthrough",s))(Ce||{}),Qe=(s=>(s.local="local",s.express="express",s.direct="direct",s))(Qe||{}),fe=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(fe||{}),Es=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Es||{});const ue=new Set,ys=new Set,Cs=new Set,vs=new Set,ht=new Map,je=new Map,ds=new Set,hs=new Map,K=new Map;let D=[],Ge=0;const $e=new Map,ps=new Map,_s=new Set,Bn={localisedName:{en:"LEFT END"},num:"00",services:[Qe.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:He.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Wn={localisedName:{en:"RIGHT END"},num:"00",services:[Qe.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:He.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Gn={},pt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:fe.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:He.right,platform_num:"1",theme:[Nt.Shanghai,"sh1","#E3002B",Ts.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Gn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Es.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},$n={localisedName:{},num:"",services:[Qe.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:He.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},T=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),Ns=s=>ot.has(s),Un=s=>{if(Ns(s.style))return structuredClone(s[s.style].color)},Fn=(s,a)=>{const[o,t]=s.extremities(a),r=s.getEdgeAttributes(a),i=r.style;if(o!=t&&Ns(i)){const n=Un(r);vs.has(T(n))||(Cs.add(n),vs.add(T(n)),ht.set(n,o),je.set(T(n),new Set)),je.get(T(n)).add(o),je.get(T(n)).add(t),K.has(o)?D.push({target:t,next:K.get(o),color:n}):D.push({target:t,next:-1,color:n}),K.set(o,Ge),Ge++,K.has(t)?D.push({target:o,next:K.get(t),color:n}):D.push({target:o,next:-1,color:n}),K.set(t,Ge),Ge++}},ut=(s,a,o)=>{if(je.get(T(o)).has(s)){je.get(T(o)).delete(s);for(let t=K.get(s);t!=-1;t=D[t].next){const r=D[t].target,i=D[t].color;T(i)==T(o)&&ut(r,s,o)}}},gt=(s,a,o)=>{if(ue.has(s))return;ue.add(s);let t=0;const r=new Set;for(let i=K.get(s);i!=-1;i=D[i].next){const n=D[i].target,c=D[i].color;T(c)==T(o)&&(r.has(n)||(r.add(n),t++,n!=a&&gt(n,s,o)))}$e.set(s,t)},Zs=(s,a)=>{const o=s.stn_list.lineend.parents;o.push(a),s.stn_list.lineend.parents=structuredClone(o).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[Ce.through,o[1]]:void 0}},Hn=(s,a)=>{let o=0;for(let t=K.get(s);t!=-1;t=D[t].next){D[t].target;const r=D[t].color;T(r)==T(a)&&o++}return o},xt=(s,a,o)=>{if(_s.has(s))return[];_s.add(s);const t=[];for(let r=K.get(s);r!=-1;r=D[r].next){const i=D[r].target,n=D[r].color;i!=a&&T(n)==T(o)&&(i.startsWith("stn")?t.push(i):t.push(...xt(i,s,o)))}return t},ks=(s,a,o,t,r,i,n)=>{var d;if(ue.has(s)&&(!s.startsWith("misc_node_")&&n.stn_list[s]==null||s.startsWith("misc_node_")&&!ys.has(s)||n.loop))return[];if(ue.has(s)&&n.stn_list[s]!=null&&Hn(s,i)-1>=2){const l=[...n.stn_list[s].parents,a];if(n.stn_list[l[1]]==null){const j=l[0];l[0]=l[1],l[1]=j}n.stn_list[s].parents=structuredClone(l).reverse(),n.stn_list[s].branch={...n.stn_list[s].branch,left:[Ce.through,l[1]]};const p=[];for(const j of n.stn_list[s].children)j!=a&&p.push(j);n.stn_list[s].children=structuredClone(p),(d=n.stn_list[s].branch)==null||delete d.right;const g=[];for(const j of n.stn_list.lineend.parents)j!=s&&g.push(j);return n.stn_list.lineend.parents=structuredClone(g).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[Ce.through,g[1]]:void 0},p.length==0&&(n.stn_list[s].children=["lineend"],Zs(n,s)),[s]}ue.add(s);const c=[],h=[],u=[],b=new Set,x=new Set;for(let l=K.get(s);l!=-1;l=D[l].next){const p=D[l].target,g=D[l].color;if(p!=o){if(T(g)==T(i)){if(x.has(p))continue;if(x.add(p),s.startsWith("misc_node_")){const j=ks(p,a,s,t+1,r,i,n);j.length!=0&&c.push(...j)}else{const j=ks(p,s,s,t+1,r,i,n);j.length!=0&&c.push(...j)}}if(!b.has(T(g))&&T(g)!=T(i)){b.add(T(g));const j={theme:g,name:["ch_".concat(T(g)),"en_".concat(T(g))]};u.push(j)}}}if(c.length==2){for(let l=0;l<2;l++)c[l]=="lineend"&&c.splice(l,1);if(n.stn_list[c[1]].parents.length>=2){const l=c[0];c[0]=c[1],c[1]=l}}if(ue.has(s)&&n.stn_list[s]!=null){const l=[];for(const p of n.stn_list.lineend.parents)p!=s&&l.push(p);n.stn_list.lineend.parents=structuredClone(l).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[Ce.through,l[1]]:void 0},c.length==0&&(_s.clear(),h.push(...xt(s,a,i)))}if(s.startsWith("misc_node_"))return ys.add(s),c;{const l=r.getNodeAttributes(s).type,p=r.getNodeAttributes(s)[l];if(n.stn_list[s]=structuredClone($n),n.stn_list[s].localisedName={zh:p.names[0],en:p.names[1]},n.stn_list[s].num=String(t),r.getNodeAttributes(s).type==W.GzmtrBasic){const g=p;n.stn_list[s].num=g.stationCode,(g.secondaryNames[0]!==""||g.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:g.secondaryNames[0],en:g.secondaryNames[1]})}if(r.getNodeAttributes(s).type==W.GzmtrInt){const g=p,j=g.transfer[0];for(const S of j)if(T(S)==T(i)){n.stn_list[s].num=String(S[5]);break}(g.secondaryNames[0]!==""||g.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:g.secondaryNames[0],en:g.secondaryNames[1]})}return c.length!=0?(n.stn_list[s].children=structuredClone(c).reverse(),c.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,right:[Ce.through,c[1]]})):(n.stn_list[s].children=["lineend"],Zs(n,s)),h.push(a),n.stn_list[s].parents=structuredClone(h).reverse(),h.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,left:[Ce.through,h[1]]}),u.length!=0&&(n.stn_list[s].transfer.groups[0].lines=structuredClone(u)),[s]}},Vn=(s,a,o,t)=>{const r=structuredClone(pt);t=="LOOP"&&(r.loop=!0);let i;switch(s.getNodeAttributes(o).type){case W.GzmtrBasic:case W.GzmtrInt:i=fe.GZMTR;break;case W.MTR:i=fe.MTR;break;default:i=fe.SHMetro;break}r.theme=structuredClone(a),r.style=i,r.stn_list.linestart=structuredClone(Bn),r.stn_list.lineend=structuredClone(Wn),ue.clear(),ys.clear();const n=ks(o,"linestart","linestart",1,s,a,r);if(r.current_stn_idx=n[0],r.stn_list.linestart.children=[n[0]],!(Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3))return structuredClone(r)},Yn=s=>{var t,r;ue.clear(),Cs.clear(),vs.clear(),ht.clear(),je.clear(),ds.clear(),hs.clear(),K.clear(),D=[],Ge=0,$e.clear(),ps.clear(),s.filterEdges(i=>i.startsWith("line")).forEach(i=>{Ns(s.getEdgeAttributes(i).style)&&Fn(s,i)});let a=0;s.forEachNode(i=>{ps.set(i,++a)}),ps.set("lineend",++a);const o=[];for(const i of Cs){let n=0;for(;je.get(T(i)).size!=0;){let c="line_root";je.get(T(i)).forEach(u=>{c=="line_root"&&(c=u)}),ut(c,"line_root",i);const h={theme:i,index:++n};ds.add(h),hs.set(h,c)}}for(const i of ds){const{theme:n}=i;ue.clear(),$e.clear(),gt(hs.get(i),"line_root",n);let c=!0,h="LINE";const u=[];for(const[x,d]of $e)d==1&&u.push(x),d==3&&(h="BRANCH"),d>3&&(c=!1);if(!c)continue;u.length==0&&(h="LOOP",$e.forEach((x,d)=>{u.push(d)}));const b=[];for(const x of u){const d=Vn(s,n,x,h);d!=null&&b.push([d,(t=d.stn_list[d.current_stn_idx].localisedName.zh)!=null?t:"",(r=d.stn_list[d.current_stn_idx].localisedName.en)!=null?r:""])}b.length!=0&&o.push({id:fs(10),theme:n,param:structuredClone(b),type:h})}return o},Kn=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),Zn=(s,a)=>{let o=s;return a.forEach((t,r)=>{const i=new RegExp("ch_".concat(r),"g"),n=new RegExp("en_".concat(r),"g");o=o.replace(i,t[0]),o=o.replace(n,t[1])}),o},Jn=(s,a,o,t)=>{s.line_name=a,s.line_num=String(o),bs("RMG_".concat(Kn(a),".json"),"application/json",Zn(JSON.stringify(s),t))},Xn={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},qn=s=>{const{isOpen:a,onClose:o}=s,{t}=G(),r=f.useRef(window.graph),[i,n]=f.useState(!1),[c,h]=f.useState([[pt,"",""]]),[u,b]=f.useState(["","",""]),[x,d]=f.useState(new Map),[l,p]=f.useState(new Map),[g,j]=f.useState([]);f.useEffect(()=>{if(a){const w=Yn(r.current),y=new Map;w.forEach(({id:v,theme:C})=>{y.set(T(C),v)}),j(w),d(y)}},[a]);const S=(w,y)=>document.getElementById("2RMG_"+y+"_"+w).value.trim();return e.jsxs(q,{isOpen:a,onClose:o,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:e.jsx(m,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),e.jsx(ee,{}),e.jsxs(X,{children:[e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),e.jsx("br",{}),g.length===0?e.jsx(m,{fontSize:"md",children:t("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:g.map(({id:w,theme:y,param:v,type:C})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ws,{name:y[0]=="other"&&y[1]=="other"?y[2]:y[1],bg:y[2],fg:y[3]})}),e.jsx("td",{children:e.jsx(rs,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(rs,{placeholder:t("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(rs,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(Ws,{name:t("header.download.2rmg.type.".concat(C.toLowerCase())),bg:Xn[C],fg:Ts.white})}),e.jsx("td",{children:e.jsx(I,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const _=S(w,"nameCh"),M=S(w,"nameEn"),P=S(w,"lineNum"),H=new Map;x.forEach((U,se)=>{H.set(se,[S(U,"nameCh"),S(U,"nameEn")])}),h(v),b([_,M,P]),p(H),n(!0)},size:"sm",children:e.jsx(at,{})})})]},w))})})]}),e.jsx(xe,{children:e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:t("close")})})]}),e.jsx(Qn,{isOpen:i,onClose:()=>n(!1),param:c,nameList:u,interchangeName:l})]})},Qn=s=>{const{isOpen:a,onClose:o,param:t,nameList:r,interchangeName:i}=s,{t:n}=G(),[c,h]=f.useState("");return f.useEffect(()=>{r[0]!=""&&r[1]!=""?h(r[0]+"/"+r[1]):r[0]!=""?h(r[0]):r[1]!=""?h(r[1]):h("")},[...r]),e.jsxs(q,{isOpen:a,onClose:o,size:"md",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:e.jsxs(m,{as:"b",fontSize:"xl",children:[n("header.download.2rmg.download")," ",c]})}),e.jsx(ee,{}),e.jsx(X,{children:e.jsxs(Ct,{children:[e.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:n("header.download.2rmg.downloadInfo")}),t.map(([u,b,x])=>e.jsxs(I,{onClick:()=>{Jn(u,[r[0],r[1]],r[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[b.replaceAll("\n","⏎"),"/",x.replaceAll("\n","⏎")]},"".concat(b).concat(x)))]})}),e.jsx(xe,{children:e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:n("close")})})]})]})},er=s=>{const{isOpen:a,onClose:o}=s,{t}=G();return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:t("header.download.termsAndConditions")}),e.jsx(ee,{}),e.jsx(X,{children:e.jsxs(vt,{children:[e.jsxs(Me,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(N,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(B,{as:L})]}),", ",e.jsxs(N,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(B,{as:L})]})," or ",e.jsxs(N,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(B,{as:L})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(N,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(B,{as:L})]}),"，",e.jsxs(N,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(B,{as:L})]}),"或",e.jsxs(N,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(B,{as:L})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(Me,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(B,{as:L})]})," and ",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(B,{as:L})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(B,{as:L})]}),"及",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(B,{as:L})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(Me,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(N,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(B,{as:L})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(N,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(B,{as:L})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(Me,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(Me,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(N,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(B,{as:L})]})," ","– the open-source emoji and icon project. License:",e.jsxs(N,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(B,{as:L})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(N,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(B,{as:L})]}),"所设计。许可证：",e.jsxs(N,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(B,{as:L})]})]}),e.jsxs(Me,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},sr=()=>{const s="https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download",a=new Date,o="".concat(a.getFullYear()).concat(String(a.getMonth()+1).padStart(2,"0"),"01"),t="".concat(String(a.getFullYear()).slice(-2),".").concat(a.getMonth()+1,".1"),r=navigator.platform,i=r.includes("Linux")?"amd64.AppImage":r.includes("Mac")?"aarch64.dmg":"x64-setup.exe";return s+"/tauri-".concat(o,"/Rail.Map.Toolkit_").concat(t,"_").concat(i)};function tr(){const s=Qs("white","var(--chakra-colors-gray-800)"),a=F(),{activeSubscriptions:{RMP_EXPORT:o}}=$(k=>k.account),{telemetry:{project:t}}=$(k=>k.app),{languages:r}=$(k=>k.fonts),i=$(k=>k.param),n=z.isAllowAnalytics(),{t:c}=G(),h=f.useRef(window.graph),[u,b]=f.useState("png"),x={png:c("header.download.png"),svg:c("header.download.svg")},[d,l]=f.useState(2),[p,g]=f.useState({width:1,height:1,benchmark:.001}),[j,S]=f.useState(200),w=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],y=Object.fromEntries(w.map(k=>[k,"".concat(k,"%")])),[v,C]=f.useState([]),[_,M]=f.useState(!1),P=[{type:"select",label:c("header.download.format"),value:u,options:x,onChange:k=>b(k==="png"?"png":"svg")}],H=[{type:"select",label:c("header.download.svgVersion"),value:d,options:{1.1:c("header.download.svg1.1"),2:c("header.download.svg2")},onChange:k=>{l(k),k===1.1&&Ye(!0)}}],U=[{type:"select",label:c("header.download.scale"),value:j,options:y,onChange:k=>S(k)},{type:"switch",label:c("header.download.transparent"),isChecked:_,onChange:M}],[se,Ee]=f.useState(!1),[es,Ve]=f.useState(!1),[Ne,Ye]=f.useState(!1),[Ie,ss]=f.useState(!1),[E,ft]=f.useState(!1),[jt,Ke]=f.useState(!1),[wt,Is]=f.useState(!1);f.useEffect(()=>{(async()=>{const we=await Pn.maxArea({usePromise:!0,useWorker:!0});g(we)})()},[]),f.useEffect(()=>{if(se){const{xMin:k,yMin:we,xMax:Le,yMax:Y}=It(h.current),[_e,ie]=[Le-k,Y-we],De=w.filter(ke=>_e*ke/100>p.width&&ie*ke/100>p.height);C(De)}},[se]);const bt=async()=>{n&&z.event(ve.DOWNLOAD_PARAM,t?{"#nodes":h.current.order,"#edges":h.current.size}:{});const k=[];for(const Le of h.current.filterNodes((Y,_e)=>{var ie;return Y.startsWith("misc_node")&&_e.type==="image"&&((ie=_e.image)==null?void 0:ie.href)!==void 0})){const Y=h.current.getNodeAttributes(Le).image;Y.href&&Y.href.startsWith("img-l")&&await Ys.has(Y.href)&&k.push({id:Y.href,base64:await Ys.get(Y.href)})}const we={...i,images:k};bs("RMP_".concat(new Date().valueOf(),".json"),"application/json",Bt(we))},St=async()=>{Ke(!0),n&&z.event(ve.DOWNLOAD_IMAGES,t?{numberOfNodes:h.current.order,numberOfEdges:h.current.size}:{});const{elem:k,width:we,height:Le}=await Rn(h.current,Ie,Ne,r,d),Y=k.outerHTML.replace(/&nbsp;/g," ");if(u==="svg"){bs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Y),Ke(!1);return}if(Pe){window.parent.__TAURI__.core.invoke("render_image",{svgString:Y,scale:j,isTransparent:_,isSystemFontsOnly:Ne}).then(()=>Ke(!1));return}document.body.appendChild(k);const _e="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Y)));document.body.removeChild(k),k.remove();const ie=document.createElement("canvas"),[De,ke]=[we*j/100,Le*j/100];ie.width=De,ie.height=ke;const ts=ie.getContext("2d");_||(ts.fillStyle=s,ts.fillRect(0,0,De,ke));const ns=new Image;ns.onload=()=>{setTimeout(()=>{ts.drawImage(ns,0,0,De,ke),ie.toBlob(Ls=>{if(Ke(!1),!Ls){a(qe({status:"error",message:c("header.download.imageTooBig")}));return}En("RMP_".concat(new Date().valueOf(),".png"),Ls)},"image/png")},Wt()?2e3:0)},ns.src=_e};return e.jsxs(Ms,{id:"download",children:[e.jsx(Os,{as:te,size:"sm",variant:"ghost",icon:e.jsx(at,{})}),e.jsxs(As,{children:[e.jsx(he,{icon:e.jsx(Lt,{}),onClick:()=>bt(),children:c("header.download.config")}),e.jsxs(he,{icon:e.jsx(Dt,{}),onClick:()=>Is(!0),children:[c("header.download.2rmg.title"),e.jsx(de,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(he,{icon:e.jsx(Pt,{}),onClick:()=>Ee(!0),children:c("header.download.image")})]}),e.jsxs(q,{size:"xl",isOpen:se,onClose:()=>Ee(!1),children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:c("header.download.image")}),e.jsx(ee,{}),e.jsxs(X,{children:[e.jsx(ze,{fields:P}),u==="svg"&&e.jsx(ze,{fields:H}),u==="png"&&e.jsx(ze,{fields:U}),e.jsx("br",{}),e.jsx(is,{isChecked:Ne,isDisabled:u==="svg"&&d===1.1,onChange:k=>Ye(k.target.checked),children:e.jsx(m,{children:c("header.download.isSystemFontsOnly")})}),e.jsx(is,{id:"share_info",isChecked:Ie,onChange:k=>ss(k.target.checked),children:e.jsxs(m,{children:[c("header.download.shareInfo1"),e.jsxs(N,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[c("header.about.rmp")," ",e.jsx(B,{as:L})]}),c("header.download.shareInfo2")]})}),e.jsx(is,{id:"agree_terms",isChecked:E,onChange:k=>ft(k.target.checked),children:e.jsxs(m,{children:[c("header.download.termsAndConditionsInfo"),e.jsxs(N,{color:"teal.500",onClick:()=>Ve(!0),children:[c("header.download.termsAndConditions")," ",e.jsx(B,{as:L})]}),c("header.download.period")]})}),u==="png"&&v.includes(j)&&!Pe&&e.jsxs(gs,{status:"error",mt:"4",children:[e.jsx(xs,{}),e.jsxs(O,{children:[e.jsx(Ds,{children:c("header.download.disabledScaleOptions")}),e.jsx(Ps,{children:e.jsx(ws,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:e.jsx(N,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:e.jsx(N,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:sr()})}})})]})]}),u==="png"&&v.includes(j)&&Pe&&!o&&e.jsxs(gs,{status:"error",mt:"4",children:[e.jsx(xs,{}),e.jsxs(O,{children:[e.jsx(Ds,{children:c("header.download.disabledScaleOptions")}),e.jsx(Ps,{children:c("header.settings.pro")})]})]})]}),e.jsx(xe,{children:e.jsx(ms,{children:e.jsx(I,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!E||u==="png"&&v.includes(j)&&!Pe||u==="png"&&v.includes(j)&&Pe&&!o,isLoading:jt,onClick:St,children:c("header.download.confirm")})})}),e.jsx(er,{isOpen:es,onClose:()=>Ve(!1)})]})]}),e.jsx(qn,{isOpen:wt,onClose:()=>Is(!1)})]})}function mt(s){const{isOpen:a,onClose:o,onConfirm:t}=s,{t:r}=G(),i=f.useRef(null);return e.jsx(_t,{isOpen:a,leastDestructiveRef:i,onClose:o,children:e.jsx(Z,{children:e.jsxs(kt,{children:[e.jsx(J,{fontSize:"lg",fontWeight:"bold",children:r("header.open.confirmOverwrite.title")}),e.jsx(X,{children:r("header.open.confirmOverwrite.body")}),e.jsxs(xe,{children:[e.jsx(I,{ref:i,onClick:o,children:r("cancel")}),e.jsx(I,{id:"confirm_overwrite",colorScheme:"red",onClick:t,ml:3,children:r("header.open.confirmOverwrite.overwrite")})]})]})})})}const nr=(s,{info_panel_type:a,line_num:o,stn_list:t,style:r,theme:i},n,c,h)=>{const u=Object.fromEntries(Object.keys(t).filter(d=>!["linestart","lineend"].includes(d)).map(d=>[d,"stn_".concat(fs(10))]));Object.entries(t).filter(([d,l])=>!["linestart","lineend"].includes(d)).forEach(([d,l])=>{const p=s.filterNodes((g,j)=>Object.values(W).includes(j.type)&&j[j.type].names[0]===l.localisedName.zh);p.length!==0&&(u[d]=p[0])});const b=[["linestart",-1,0]],x={};for(;b.length;){const[d,l,p]=b.shift();t[d].children.filter(j=>j!="lineend").forEach((j,S)=>{const w=Math.max(S,p+S);x[j]={x:l*150,y:w*75},b.push([j,l+1,w])})}Object.entries(t).filter(([d,l])=>!["linestart","lineend"].includes(d)).filter(([d,l])=>s.filterNodes((p,g)=>Object.values(W).includes(g.type)&&g[g.type].names[0]===l.localisedName.zh).length===0).map(([d,l])=>{var w,y,v;let p=W.ShmetroBasic;const g=l.transfer.groups,j=g.map(C=>{var _;return(_=C.lines)!=null?_:[]}).flat();r===fe.SHMetro?j.length>0?p=W.ShmetroInt:a===Es.sh2020?p=W.ShmetroBasic2020:p=W.ShmetroBasic:r===fe.GZMTR?j.length>0?p=W.GzmtrInt:p=W.GzmtrBasic:r===fe.MTR&&(p=W.MTR);const S={...structuredClone(Nn[p].defaultAttrs),names:[(w=l.localisedName.zh)!=null?w:"",(y=l.localisedName.en)!=null?y:""]};return p===W.ShmetroBasic2020?S.color=i:p===W.GzmtrBasic?(S.color=i,S.lineCode=o,S.stationCode=l.num):p===W.GzmtrInt?S.transfer=g.map((C,_)=>{var P,H;const M=(H=(P=C.lines)==null?void 0:P.map(U=>{var se;return[...(se=U.theme)!=null?se:i,"1","01"]}))!=null?H:[];return _===0?[[...i,o,l.num],...M]:M}):p===W.MTR&&((v=g[0].lines)!=null&&v.length?S.transfer=[[[...i,"",""],...g[0].lines.map(C=>{var _;return[...(_=C.theme)!=null?_:i,"",""]})]]:S.transfer=[[]]),{node:u[d],attr:{visible:!0,zIndex:0,x:n+x[d].x,y:c+x[d].y,type:p,[p]:S}}}).forEach(({node:d,attr:l})=>s.addNode(d,l)),Object.entries(t).filter(([d,l])=>!["linestart","lineend"].includes(d)).forEach(([d,l])=>{l.children.filter(p=>!["linestart","lineend"].includes(p)).forEach(p=>{const g=os.Diagonal,[j,S]=[u[d],u[p]],w=h?Gt(s,g,j,S,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(fs(10)),j,S,{visible:!0,zIndex:0,type:g,[os.Diagonal]:structuredClone($t[os.Diagonal].defaultAttrs),style:Gs.SingleColor,[Gs.SingleColor]:{color:i},reconcileId:"",parallelIndex:w})})})},rr="rmg-bridge--",ir={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function or(s){const{isOpen:a,onClose:o}=s,{t}=G(),{preference:{autoParallel:r}}=$(S=>S.app),{svgViewBoxZoom:i,svgViewBoxMin:n}=$(S=>S.param),c=F(),h=z.isAllowAnalytics(),u=zs(),{height:b,width:x}=Rs(u),d=Je.useRef(window.graph),[l]=Je.useState(crypto.randomUUID()),p="/rmg/#/import?"+new URLSearchParams({parentComponent:z.getAppName(),parentId:l}),g=Je.useCallback(()=>{c(ne(d.current.export())),c(ge()),c(re())},[c,ge,re,ne,d]),j=S=>{try{h&&z.event(ve.IMPORT_RMG_PARAM,{});const w=n.x+x*i/100/3,y=n.y+b*i/100/3;nr(d.current,S,w,y,r),g()}catch(w){c(qe({status:"error",message:t("header.open.unknownError")})),pe.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",w)}finally{o()}};return Je.useEffect(()=>{const S=new BroadcastChannel(rr+l);return S.onmessage=w=>{const{event:y,data:v}=w.data;pe.debug("[rmp] Received event from RMG app clip:",y),y==="CLOSE"?o():y==="IMPORT"&&j(v)},()=>S.close()},[n.x,n.y,i,b,x,r]),e.jsx(lt,{isOpen:a,onClose:o,sx:ir,children:e.jsx("iframe",{src:p,loading:"lazy"})})}const ar="RMP_GALLERY_CHANNEL",lr="OPEN_TEMPLATE",Js=new BroadcastChannel(ar),cr={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function dr(s){const{isOpen:a,onClose:o}=s,{t}=G(),r=F(),{isOpen:i,onOpen:n,onClose:c}=et(),[h,u]=f.useState(null),{telemetry:{project:b}}=$(w=>w.app),x=z.isAllowAnalytics(),d=f.useRef(window.graph),l=f.useCallback(()=>{r(ne(d.current.export())),r(ge()),r(re())},[r,ge,re,ne,d]),p=async w=>{const{version:y,images:v,...C}=JSON.parse(await ct(JSON.stringify(w)));r(js()),d.current.clear(),d.current.import(C.graph),Array.isArray(v)&&v.length>0&&await dt(d.current,v),r(Ss()),l();const{svgViewBoxZoom:_,svgViewBoxMin:M}=C;typeof _=="number"&&r(Re(_)),typeof M.x=="number"&&typeof M.y=="number"&&r(Ue(M))},g=async()=>{h&&await p(h),c(),u(null)},j=async(w,y)=>{var _;const v=y?"https://".concat(y):"",C=await((_=(await Promise.allSettled([fetch("".concat(v,"/rmp-gallery/resources/real_world/").concat(w,".json")),fetch("".concat(v,"/rmp-gallery/resources/fantasy/").concat(w,".json"))])).filter(M=>M.status==="fulfilled").find(M=>M.value.status===200))==null?void 0:_.value.json());if(C){if(u(C),n(),x){const M={id:w};b&&y&&(M.host=y),z.event(ve.IMPORT_WORK_FROM_GALLERY,M)}z.sendNotification({title:t("header.open.importOK",{id:w}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}else z.sendNotification({title:t("header.open.importFail",{id:w}),message:t("header.open.importFailContent"),type:"error",duration:9e3})},S=async w=>{try{const y=await fetch("".concat(Ut,"/").concat(w));if(y.status!==200)throw new Error(t("header.open.importFailContent"));const v=await y.json();u(v),n(),x&&z.event(ve.IMPORT_WORK_FROM_SHARE,{share:w}),z.sendNotification({title:t("header.open.importOK",{id:w}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}catch(y){z.sendNotification({title:t("header.open.importFail",{id:w}),message:y.message,type:"error",duration:9e3})}};return f.useEffect(()=>{const y=new URL(window.location.href).searchParams;if(y.size>0){const v=y.keys().next().value,C=v.indexOf("."),_=v.substring(0,C===-1?void 0:C);let M;C!==-1&&(M=v.substring(C+1)),M==="org"?S(_):j(_,M),z.updateAppMetadata({search:""})}},[]),f.useEffect(()=>(Js.onmessage=w=>{const{event:y,data:v}=w.data;y===lr&&(j(v),o())},()=>Js.close()),[]),e.jsxs(e.Fragment,{children:[e.jsxs(lt,{isOpen:a,onClose:o,size:"full",sx:cr,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(st,{onClick:o,position:"fixed",top:"5px",right:"15px"})]}),e.jsx(mt,{isOpen:i,onClose:c,onConfirm:g})]})}function hr(){const s=F(),{t:a}=G(),{isOpen:o,onOpen:t,onClose:r}=et(),[i,n]=f.useState(null),c=zs(),{height:h}=Rs(c),u=f.useRef(window.graph),b=f.useRef(null),[x,d]=f.useState(!1),[l,p]=f.useState(!1),g=f.useCallback(()=>{s(ne(u.current.export())),s(ge()),s(re())},[s,ge,re,ne,u]),j=()=>{s(js()),u.current.clear(),s(Re(100)),s(Ue({x:0,y:0})),g()},S=async C=>{const{version:_,images:M,...P}=JSON.parse(await ct(C));s(js()),u.current.clear(),u.current.import(P.graph),Array.isArray(M)&&M.length>0&&await dt(u.current,M),s(Ss()),g();const{svgViewBoxZoom:H,svgViewBoxMin:U}=P;typeof H=="number"&&s(Re(H)),typeof U.x=="number"&&typeof U.y=="number"&&s(Ue(U))},w=async()=>{if(i){await S(i);const C=await Fs();if(i.length===C.length){s(Ue({x:-10,y:-13}));const _=Math.max(0,Math.min(400,-.132*h+117.772));s(Re(_)),await s(Ss()),z.event(ve.LOAD_TUTORIAL,{})}}r(),n(null)},y=async C=>{var M;const _=(M=C.target.files)==null?void 0:M[0];if(pe.debug("OpenActions.handleUpload():: received file",_),(_==null?void 0:_.type)!=="application/json")s(qe({status:"error",message:a("header.open.invalidType")})),pe.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const P=await pr(_);n(P),t()}catch(P){s(qe({status:"error",message:a("header.open.unknownError")})),pe.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",P)}C.target.value=""},v=async()=>{const C=await Fs();n(C),t()};return f.useEffect(()=>{const C=async _=>{const{type:M,key:P,from:H}=_.data;if(M===Yt.SAVE_CHANGED&&P===Hs.PARAM&&H==="rmt"){pe.debug("Received save changed event on key: ".concat(P));const U=localStorage.getItem(Hs.PARAM);if(!U)return;await S(U)}};return $s.addEventListener("message",C),()=>$s.removeEventListener("message",C)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Ms,{children:[e.jsx(Os,{as:te,size:"sm",variant:"ghost",icon:e.jsx(Us,{})}),e.jsxs(As,{children:[e.jsx(he,{icon:e.jsx(Ft,{}),onClick:j,children:a("header.open.new")}),e.jsx("input",{id:"upload_project",ref:b,type:"file",accept:".json",hidden:!0,onChange:y,"data-testid":"file-upload"}),e.jsx(he,{icon:e.jsx(Us,{}),onClick:()=>{var C;return(C=b==null?void 0:b.current)==null?void 0:C.click()},children:a("header.open.config")}),e.jsx(he,{icon:e.jsx(Ht,{}),onClick:()=>d(!0),children:a("header.open.projectRMG")}),e.jsxs(he,{icon:e.jsx(L,{}),onClick:()=>p(!0),children:[a("header.open.gallery"),e.jsx(de,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(he,{icon:e.jsx(Vt,{}),onClick:v,children:a("header.open.tutorial")})]}),e.jsx(or,{isOpen:x,onClose:()=>d(!1)}),e.jsx(dr,{isOpen:l,onClose:()=>p(!1)})]}),e.jsx(mt,{isOpen:o,onClose:r,onConfirm:w})]})}const pr=s=>new Promise(a=>{const o=new FileReader;o.onloadend=()=>a(o.result),o.readAsText(s)}),ur=()=>{const[s,a]=f.useState(!1),{t:o}=G(),t=F(),r=f.useRef(window.graph),i=zs(),{width:n,height:c}=Rs(i),[h,u]=f.useState([]);f.useEffect(()=>{s&&u(r.current.nodes().filter(x=>x.startsWith("stn")).map(x=>{const d=r.current.getNodeAttributes(x),l=d.type,p=d[l].names.join("/");return{id:x,value:p}}))},[s]);const b=x=>{t(Xt(new Set([x])));const d=Math.max(0,Math.min(400,-.132*c+117.772)),{x:l,y:p}=qt((n-300)/2,c/2,d,{x:-r.current.getNodeAttribute(x,"x"),y:-r.current.getNodeAttribute(x,"y")});t(Re(d)),t(Ue({x:-l,y:-p}))};return e.jsxs(tt,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(nt,{children:e.jsx(te,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Kt,{}),onClick:()=>a(!s)})}),e.jsx(rt,{children:e.jsx(it,{children:e.jsx(Zt,{label:o("header.search"),children:e.jsx(Jt,{data:h,displayHandler:x=>e.jsx(de,{children:x.value}),filter:(x,d)=>d.value.toLowerCase().includes(x.toLowerCase())||Object.values(d.value).some(l=>l.toLowerCase().includes(x.toLowerCase())),value:"",onChange:x=>b(x.id)})})})})]})},gr=s=>{const{isOpen:a,onClose:o}=s,t=F(),{t:r}=G(),i=f.useRef(window.graph),{theme:n,requestThemeChange:c}=Qt(),h=()=>{i.current.filterEdges((u,b,x,d,l,p,g)=>ot.has(b.style)&&JSON.stringify(b[b.style].color)===JSON.stringify(n)).forEach(u=>i.current.dropEdge(u)),t(ne(i.current.export())),t(re()),o()};return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(ee,{}),e.jsxs(X,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(en,{theme:n,onClick:c})]}),e.jsxs(xe,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:h,children:r("remove")})]})]})]})},xr=s=>{const{isOpen:a,onClose:o}=s,t=F(),{t:r}=G(),i=f.useRef(window.graph),[n,c]=f.useState(1),h=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:n.toString(),variant:"number",onChange:b=>c(Number(b)),minW:"full"}],u=()=>{i.current.forEachNode((b,x)=>{i.current.updateNodeAttribute(b,"x",d=>(d!=null?d:0)*n),i.current.updateNodeAttribute(b,"y",d=>(d!=null?d:0)*n)}),t(ne(i.current.export())),t(ge()),t(re()),o()};return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:r("header.settings.procedures.scale.title")}),e.jsx(ee,{}),e.jsxs(X,{children:[r("header.settings.procedures.scale.content"),e.jsx(ze,{fields:h})]}),e.jsxs(xe,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:u,children:r("apply")})]})]})]})},mr=s=>{const{isOpen:a,onClose:o}=s,t=F(),{t:r}=G(),i=f.useRef(window.graph),[n,c]=f.useState(0),[h,u]=f.useState(0),b=[{type:"input",label:r("header.settings.procedures.translate.x"),value:n.toString(),variant:"number",onChange:d=>c(Number(d)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:h.toString(),variant:"number",onChange:d=>u(Number(d)),minW:"full"}],x=()=>{i.current.forEachNode((d,l)=>{i.current.updateNodeAttribute(d,"x",p=>(p!=null?p:0)+n),i.current.updateNodeAttribute(d,"y",p=>(p!=null?p:0)+h)}),t(ne(i.current.export())),t(ge()),t(re()),o()};return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:r("header.settings.procedures.translate.title")}),e.jsx(ee,{}),e.jsxs(X,{children:[r("header.settings.procedures.translate.content"),e.jsx(ze,{fields:b})]}),e.jsxs(xe,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:x,children:r("apply")})]})]})]})},fr=s=>{const{isOpen:a,onClose:o}=s,t=F(),{preference:{unlockSimplePathAttempts:r}}=$(h=>h.app),{activeSubscriptions:i}=$(h=>h.account),{t:n}=G(),c=()=>{t(sn(-1))};return e.jsxs(q,{isOpen:a,onClose:o,size:"5xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:n("header.settings.procedures.unlockSimplePath.title")}),e.jsx(ee,{}),e.jsxs(X,{children:[e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(xe,{children:e.jsx(Ae,{label:n("header.settings.pro"),isOpen:!i.RMP_CLOUD&&r>=0,children:e.jsx(I,{onClick:c,isDisabled:!i.RMP_CLOUD||r<0,children:r>=0?n("header.settings.procedures.unlockSimplePath.check"):n("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},jr=s=>{const{isOpen:a,onClose:o}=s,t=F(),r=Mt(),{t:i}=G(),n=f.useRef(window.graph),[c,h]=f.useState(!1),u=async()=>{h(!0);const b=JSON.stringify(n.current.export());try{const x=await Sr(b);n.current.clear(),n.current.import(x),t(ne(n.current.export())),t(ge()),t(re()),r({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(x){pe.error("[rmp] Error in updating all colors: ".concat(x)),r({title:i("header.settings.procedures.updateColor.error",{e:x}),status:"error",duration:9e3,isClosable:!0})}h(!1),o()};return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:i("header.settings.procedures.updateColor.title")}),e.jsx(ee,{}),e.jsx(X,{children:e.jsx(m,{children:i("header.settings.procedures.updateColor.content")})}),e.jsxs(xe,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:i("cancel")}),e.jsx(I,{colorScheme:"red",onClick:u,isLoading:c,children:i("apply")})]})]})]})},Xs=s=>s.length>=4&&s.every(a=>typeof a=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(Ts).includes(s[3]),wr=s=>{const a=[],o=(t,r)=>{if(Array.isArray(t)&&Xs(t)){a.push({path:r||"",value:t});return}for(const i in t){const n=t[i],c=r?"".concat(r,".").concat(i):i;Array.isArray(n)?Xs(n)?a.push({path:c,value:n}):n.forEach((h,u)=>o(h,"".concat(c,".").concat(u))):n&&typeof n=="object"&&o(n,c)}};return o(s),a},br=(s,a,o)=>{const t=a.split(".");let r=s;for(let i=0;i<t.length-1;i++)r=r[t[i]];r[t[t.length-1]]=o},Sr=async s=>{const a=JSON.parse(s),o=new Date().getTime(),t=wr(a);pe.debug("[rmp] Found all themes pending for update",t);const r=1e4;let i,n=!1;const c=new Promise((h,u)=>{i=setTimeout(()=>{n=!0,u("Executing time exceeds ".concat(r,"ms"))},r),(async()=>{for(const{path:b,value:x}of t){if(n)throw new Error("Update aborted");const[d,l,p,g,...j]=x,S=await tn([d,l,p,g]);br(a,b,[...S,...j])}})().then(h).catch(u)});try{return await c,pe.debug("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-o)/1e3," sec")),a}finally{clearTimeout(i)}},qs=1,yr=()=>{const s=F(),{state:a,token:o}=$(g=>g.account),{count:{stations:t,miscNodes:r,masters:i,lines:n,parallel:c}}=$(g=>g.runtime),{t:h}=G(),[u,b]=f.useState(!1),[x,d]=f.useState(qs);f.useEffect(()=>{let g;return u&&x>0?g=window.setTimeout(()=>{d(x-1)},1e3):x===0&&b(!1),()=>clearTimeout(g)},[u,x]);const l=()=>{b(!0),d(qs),o&&rn(s,o)},p={"logged-out":h("header.settings.status.subscription.logged-out"),free:h("header.settings.status.subscription.free"),subscriber:h("header.settings.status.subscription.subscriber"),expired:h("header.settings.status.subscription.expired")};return e.jsxs(O,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:h("header.settings.status.title")}),e.jsxs(O,{mt:"3",children:[e.jsxs(O,{mb:"1",children:[e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:h("header.settings.status.count.stations")}),e.jsx(m,{children:t})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:h("header.settings.status.count.miscNodes")}),e.jsx(m,{children:r})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:h("header.settings.status.count.masters")}),e.jsx(m,{children:i})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:h("header.settings.status.count.lines")}),e.jsx(m,{children:n})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:h("header.settings.status.count.parallel")}),e.jsx(m,{children:c})]})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsxs(m,{flex:"1",children:[h("header.settings.status.subscription.content")," ",p[a]]}),e.jsx(te,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(nn,{}),isDisabled:u,onClick:()=>l()})]})]})]})},ye={width:"100%",justifyContent:"space-between"},ce={fontFamily:"-apple-system"},Cr=s=>{const{isOpen:a,onClose:o}=s,{activeSubscriptions:t}=$(E=>E.account),{telemetry:{project:r},preference:{autoParallel:i,randomStationsNames:n,gridLines:c,snapLines:h,predictNextNode:u}}=$(E=>E.app),{keepLastPath:b,count:{parallel:x}}=$(E=>E.runtime),d=F(),{t:l}=G(),p=Qs("primary.500","primary.300"),[g,j]=f.useState(!1),[S,w]=f.useState(!1),[y,v]=f.useState(!1),[C,_]=f.useState(!1),[M,P]=f.useState(!1),[H,U]=f.useState(!1),[se,Ee]=f.useState(!1),es=z.isAllowAnalytics(),Ve=E=>{d(jn(E))},Ne=t.RMP_CLOUD?on:an,Ye=x>=Ne,Ie=!t.RMP_CLOUD,ss=E=>{d(fn(E.target.value))};return e.jsxs(q,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(Q,{children:[e.jsx(J,{children:l("header.settings.title")}),e.jsx(ee,{}),e.jsx(X,{children:e.jsxs(We,{divider:e.jsx(Rt,{borderColor:"gray.200"}),children:[e.jsx(yr,{}),e.jsxs(O,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.preference.title")}),e.jsxs(O,{mt:"3",children:[e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.keepLastPath")}),e.jsx(be,{isChecked:b,onChange:({target:{checked:E}})=>d(ln(E))})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{children:l("header.settings.preference.autoParallel")}),e.jsx(de,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(Ae,{label:l("header.settings.proWithTrial"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(be,{ml:"1",isDisabled:Ye,isChecked:i,onChange:({target:{checked:E}})=>d(cn(E))})]}),e.jsxs(O,{mb:"1",display:"flex",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.randomStationNames.title")}),e.jsx(de,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(Ae,{label:l("header.settings.pro"),children:e.jsx(de,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(Ot,{size:"xs",width:"auto",ml:"1",value:n,onChange:ss,children:[e.jsx("option",{value:"none",children:l("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:Ze.Shmetro,disabled:Ie,children:l("header.settings.preference.randomStationNames.".concat(Ze.Shmetro))}),e.jsx("option",{value:Ze.Bjsubway,disabled:Ie,children:l("header.settings.preference.randomStationNames.".concat(Ze.Bjsubway))})]})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.gridline")}),e.jsx(be,{isChecked:c,onChange:({target:{checked:E}})=>d(dn(E))})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.snapline")}),e.jsx(be,{isChecked:h,onChange:({target:{checked:E}})=>d(hn(E))})]}),e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.predictNextNode")}),e.jsx(be,{isChecked:u,onChange:({target:{checked:E}})=>d(pn(E))})]})]})]}),e.jsxs(O,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.procedures.title")}),e.jsxs(O,{mt:"3",children:[e.jsx(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>j(!0),children:l("header.settings.procedures.translate.title")}),e.jsx(mr,{isOpen:g,onClose:()=>j(!1)}),e.jsx(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>w(!0),children:l("header.settings.procedures.scale.title")}),e.jsx(xr,{isOpen:S,onClose:()=>w(!1)}),e.jsxs(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>v(!0),children:[l("header.settings.procedures.changeType.title"),e.jsx(Ae,{label:l("header.settings.pro"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(Ln,{isOpen:y,onClose:()=>v(!1),isSelect:!1}),e.jsx(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>_(!0),children:l("header.settings.procedures.removeLines.title")}),e.jsx(gr,{isOpen:C,onClose:()=>_(!1)}),e.jsx(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>P(!0),children:l("header.settings.procedures.updateColor.title")}),e.jsx(jr,{isOpen:M,onClose:()=>P(!1)}),e.jsxs(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>U(!0),children:[l("header.settings.procedures.unlockSimplePath.title"),e.jsx(Ae,{label:l("header.settings.pro"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(fr,{isOpen:H,onClose:()=>U(!1)}),e.jsx(I,{sx:ye,rightIcon:e.jsx(Se,{}),onClick:()=>Ee(!0),children:l("header.settings.procedures.masterManager.title")}),e.jsx(In,{isOpen:se,onClose:()=>Ee(!1)})]})]}),e.jsxs(O,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.shortcuts.title")}),e.jsx(O,{mt:"3",children:e.jsxs(At,{children:[e.jsx(Tt,{children:e.jsxs(V,{children:[e.jsx(Bs,{children:l("header.settings.shortcuts.keys")}),e.jsx(Bs,{children:l("header.settings.shortcuts.description")})]})}),e.jsxs(zt,{children:[e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(A,{children:"f"})}),e.jsx(R,{children:l("header.settings.shortcuts.f")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(A,{children:"s"})}),e.jsx(R,{children:l("header.settings.shortcuts.s")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(A,{children:"c"})}),e.jsx(R,{children:l("header.settings.shortcuts.c")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(O,{display:"flex",flexDirection:"row",children:[e.jsx(un,{}),e.jsx(gn,{}),e.jsx(xn,{}),e.jsx(mn,{})]})}),e.jsx(R,{children:l("header.settings.shortcuts.arrows")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(O,{display:"flex",flexDirection:"row",children:[e.jsx(A,{children:"i"}),e.jsx(A,{children:"j"}),e.jsx(A,{children:"k"}),e.jsx(A,{children:"l"})]})}),e.jsx(R,{children:l("header.settings.shortcuts.ijkl")})]}),e.jsxs(V,{children:[e.jsx(R,{children:me?e.jsx(A,{sx:ce,children:"⇧"}):e.jsx(A,{children:"shift"})}),e.jsx(R,{children:l("header.settings.shortcuts.shift")})]}),e.jsxs(V,{children:[e.jsx(R,{children:me?e.jsx(A,{sx:ce,children:"⌥"}):e.jsx(A,{children:"alt"})}),e.jsx(R,{children:l("header.settings.shortcuts.alt")})]}),e.jsxs(V,{children:[e.jsx(R,{children:me?e.jsx(A,{sx:ce,children:"⌫"}):e.jsx(A,{children:"delete"})}),e.jsx(R,{children:l("header.settings.shortcuts.delete")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[me?e.jsx(A,{sx:ce,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"x"})]}),e.jsx(R,{children:l("header.settings.shortcuts.cut")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[me?e.jsx(A,{sx:ce,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"c"})]}),e.jsx(R,{children:l("header.settings.shortcuts.copy")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[me?e.jsx(A,{sx:ce,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"v"})]}),e.jsx(R,{children:l("header.settings.shortcuts.paste")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[me?e.jsx(A,{sx:ce,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"z"})]}),e.jsx(R,{children:l("header.settings.shortcuts.undo")})]}),e.jsxs(V,{children:[e.jsx(R,{children:me?e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:ce,children:"⇧"})," + ",e.jsx(A,{sx:ce,children:"⌘"})," + ",e.jsx(A,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"y"})]})}),e.jsx(R,{children:l("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(O,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.telemetry.title")}),e.jsxs(O,{mt:"3",children:[e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.info")}),e.jsxs(O,{mt:"3",mb:"1",children:[e.jsxs(O,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.telemetry.essential")}),e.jsx(Ae,{label:l("header.settings.telemetry.essentialTooltip"),children:e.jsx(be,{isChecked:es,isDisabled:!0})})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.essentialInfo")}),e.jsxs(N,{color:p,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[l("header.settings.telemetry.essentialLink")," ",e.jsx(B,{as:L})]})]}),e.jsxs(O,{mt:"1",mb:"1",children:[e.jsxs(O,{display:"flex",children:[e.jsx(m,{flex:"1",children:l("header.settings.telemetry.additional")}),e.jsx(be,{isChecked:r,onChange:({target:{checked:E}})=>Ve(E)})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},vr=()=>{const[s,a]=f.useState(!1),{svgViewBoxZoom:o}=$(i=>i.param),t=F(),r=[{type:"slider",label:"",value:400-o,min:10,max:390,step:1,onChange:i=>t(Re(400-i)),leftIcon:e.jsx(wn,{}),rightIcon:e.jsx(Vs,{}),minW:160}];return e.jsxs(tt,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(nt,{children:e.jsx(te,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Vs,{}),onClick:()=>a(!s)})}),e.jsx(rt,{children:e.jsx(it,{children:e.jsx(ze,{fields:r,noLabel:!0})})})]})};function _r(){const{t:s}=G(),a=F(),{past:o,future:t}=$(g=>g.param),r=z.isAllowAnalytics(),[i,n]=f.useState(!1),[c,h]=f.useState(!1),u=Ks(z.getEnv),b=Ks(z.getAppVersion),x=bn();f.useEffect(()=>{r&&u!==as.DEV&&z.event(ve.APP_LOAD,{isStandaloneWindow:z.isStandaloneWindow()})},[u]);const d=g=>{z.getI18nInstance().changeLanguage(g)},l=()=>{a(An())},p=()=>{a(Tn())};return e.jsxs(Sn,{children:[e.jsxs(us,{direction:x==="landscape"?"row":"column",width:"100%",children:[e.jsxs(ms,{height:"32px",children:[e.jsx(Oe,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(yn,{environment:u,version:b,popoverHeader:u===as.PRD?void 0:e.jsxs(ws,{i18nKey:"header.popoverHeader",environment:u,children:["You're on ",{environment:u}," environment!"]}),popoverBody:u===as.PRD?void 0:e.jsx(ws,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),e.jsxs(ms,{overflowX:"auto",ml:x==="landscape"?"auto":void 0,children:[e.jsx(ur,{}),e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(Cn,{}),isDisabled:o.length===0,onClick:l}),e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(vn,{}),isDisabled:t.length===0,onClick:p}),e.jsx(vr,{}),e.jsx(hr,{}),e.jsx(tr,{}),z.isStandaloneWindow()&&e.jsxs(Ms,{children:[e.jsx(Os,{as:te,icon:e.jsx(_n,{}),variant:"ghost",size:"sm"}),e.jsx(As,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(g=>e.jsx(he,{onClick:()=>d(g),children:kn[g][g]},g))})]}),e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Mn,{}),onClick:()=>n(!0)}),e.jsx(te,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(On,{}),onClick:()=>h(!0)})]})]}),e.jsx(Cr,{isOpen:i,onClose:()=>n(!1)}),e.jsx(Dn,{isOpen:c,onClose:()=>h(!1)})]})}function kr(){const s=F(),a=$(t=>t.runtime.globalAlerts),o=t=>{z.isStandaloneWindow()?window.open("/".concat(t),"_blank"):z.openApp({appId:t})};return e.jsx(e.Fragment,{children:Object.entries(a).map(([t,{message:r,url:i,linkedApp:n}])=>e.jsxs(gs,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(xs,{}),n?e.jsx(N,{onClick:()=>o(n),children:r}):i?e.jsx(N,{href:i,target:"_blank",children:r}):r,e.jsx(st,{ml:"auto",onClick:()=>s(zn(t))})]},t))})}function Rr(){return e.jsxs(e.Fragment,{children:[e.jsx(_r,{}),e.jsx(kr,{})]})}export{Rr as default};
