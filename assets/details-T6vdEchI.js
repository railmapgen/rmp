import{j as e,B as W,aj as z,ak as re,av as B,t as C,ax as le,x as oe,D as ce,G as K,M as Z,H as Q,J as Y,L as ee,O as te,N as F}from"./chakra-BujJOmjW.js";import{c as L,d as A,aI as de,T as ue,aJ as pe,aB as he,t as E,v as w,o as I,aw as O,k as ne,l as ge,P as H,aK as U,q as T,S as me,$ as fe,a0 as xe,i as V,m as se,y as M,aC as X,aH as ye,aL as be,aM as Se,aN as je,aO as we,aE as Ae,n as $}from"./index-BK5SR9JX.js";import{u as P,b as d}from"./react-D4c9atUM.js";import{u as J,e as Ne}from"./clipboard-C5Z9j8hb.js";import{s as G}from"./master-manager-cuQqsIGW.js";import{C as Ce,c as Ee,a as ve,b as Te}from"./change-type-modal-CpxU9zJ-.js";import{LearnHowToAdd as Le}from"./tools-9h6Ucf2C.js";import{m as Pe}from"./misc-nodes-QGiSzLmE.js";function Re(){const{t:n}=P(),r=L(),{selected:o}=A(s=>s.runtime),p=d.useRef(window.graph),u=s=>{if(p.current.hasNode(s)){const l=p.current.getNodeAttributes(s),m=l.type;return s.startsWith("stn")?l[m].names.join("/"):m}else if(p.current.hasEdge(s)){const[l,m]=p.current.extremities(s),c=p.current.getSourceAttributes(s),f=p.current.getTargetAttributes(s),S=c.type,g=f.type;return(l.startsWith("stn")?c[S].names[0]:S)+" - "+(m.startsWith("stn")?f[g].names[0]:g)}},[a,t]=d.useState([]);d.useEffect(()=>{t(["station","misc-node","line"])},[o]);const[i,b]=d.useState(!1);return e.jsxs(W,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(re,{m:"var(--chakra-space-1)",children:[e.jsxs(B,{w:"100%",children:[e.jsx(z,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(de,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:a,multiSelect:!0,onChange:s=>t(s)})]}),a.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{width:"100%",size:"sm",onClick:()=>b(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(le,{label:n("header.settings.pro"),children:e.jsx(oe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(ce,{})]}),[...o].filter(s=>a.includes("station")||!s.startsWith("stn")).filter(s=>a.includes("misc-node")||!s.startsWith("misc")).filter(s=>a.includes("line")||!s.startsWith("line")).map(s=>{var l;return e.jsxs(B,{width:"100%",children:[e.jsx(C,{width:"100%",size:"sm",variant:"solid",onClick:()=>r(ue(new Set([s]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=u(s))==null?void 0:l.replaceAll("\n","⏎")}),e.jsx(C,{size:"sm",onClick:()=>r(he(s)),children:e.jsx(pe,{})})]},s)})]}),e.jsx(Ce,{isOpen:i,onClose:()=>b(!1),isSelect:!0,filter:a})]})}function ke(){const{t:n}=P(),r=L(),o=d.useCallback(()=>{r(E()),r(w(i.current.export()))},[r,E,w]),{preference:{autoParallel:p}}=A(j=>j.app),{selected:u,theme:a}=A(j=>j.runtime),[t]=u,i=d.useRef(window.graph),[b,s]=d.useState(!1),l=d.useRef(null),m=Object.fromEntries(Object.entries(I).map(([j,_])=>[j,n(_.metadata.displayName).toString()])),[c,f]=d.useState(i.current.getEdgeAttribute(t,"type")),[S,g]=d.useState(void 0),h=Object.fromEntries(Object.entries(O).map(([j,_])=>[j,n(_.metadata.displayName).toString()])),[x,y]=d.useState(i.current.getEdgeAttribute(t,"style")),[N,v]=d.useState(void 0);d.useEffect(()=>{f(i.current.getEdgeAttribute(t,"type")),y(i.current.getEdgeAttribute(t,"style"))},[t]);const R=Object.values(ne).filter(j=>!O[x].metadata.supportLinePathType.includes(j)),k=Object.values(ge).filter(j=>!O[j].metadata.supportLinePathType.includes(c)),ae=()=>{S&&(Ee(i.current,t,S,p),f(i.current.getEdgeAttribute(t,"type")),o())},ie=()=>{N&&(ve(i.current,t,N,a),y(i.current.getEdgeAttribute(t,"style")),o())},D=j=>{j&&(S?(ae(),g(void 0)):N&&(ie(),v(void 0))),s(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{label:n("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:m,disabledOptions:R,defaultValue:c,value:c,onChange:({target:{value:j}})=>{g(j),s(!0)}})}),e.jsx(H,{label:n("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:h,disabledOptions:k,defaultValue:x,value:x,onChange:({target:{value:j}})=>{v(j),s(!0)}})}),e.jsx(Le,{type:"line",expand:!0}),e.jsx(K,{isOpen:b,leastDestructiveRef:l,onClose:()=>D(!1),children:e.jsx(Z,{children:e.jsxs(Q,{children:[e.jsx(Y,{children:n("warning")}),e.jsx(ee,{children:n("panel.details.changeLineTypeContent")}),e.jsxs(te,{children:[e.jsx(C,{ref:l,onClick:()=>D(!1),children:n("cancel")}),e.jsx(C,{ml:"2",colorScheme:"red",onClick:()=>D(!0),children:n("panel.details.changeType")})]})]})})})]})}function Oe(){const{t:n}=P(),r=L(),o=d.useCallback(()=>{r(T()),r(w(t.current.export()))},[r,T,w]),{selected:p,refresh:{nodes:u}}=A(x=>x.runtime),[a]=p,t=d.useRef(window.graph),[i,b]=d.useState(!1),s=d.useRef(null),[l,m]=d.useState(void 0),[c,f]=d.useState(me.ShmetroBasic);d.useEffect(()=>{if(a!=null&&a.startsWith("stn")){const x=t.current.getNodeAttribute(a,"type");f(x)}},[u,p]);const S=Object.fromEntries(Object.entries(G).map(([x,y])=>[x,n(y.metadata.displayName).toString()])),g=()=>{l&&(Te(t.current,a,l),o())},h=x=>{x&&g(),m(void 0),b(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(H,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:S,disabledOptions:[c],value:c,onChange:({target:{value:x}})=>{m(x),b(!0)}})}),e.jsx(K,{isOpen:i,leastDestructiveRef:s,onClose:()=>h(!1),children:e.jsx(Z,{children:e.jsxs(Q,{children:[e.jsx(Y,{children:n("warning")}),e.jsx(ee,{children:n("panel.details.changeStationTypeContent")}),e.jsxs(te,{children:[e.jsx(C,{ref:s,onClick:()=>h(!1),children:n("cancel")}),e.jsx(C,{ml:"2",colorScheme:"red",onClick:()=>h(!0),children:n("panel.details.changeType")})]})]})})})]})}function ze(){const{t:n}=P(),r=L(),o=d.useCallback(()=>{r(T()),r(E()),r(w(i.current.export()))},[r,T,E,w]),{activeSubscriptions:p}=A(c=>c.account),{selected:u,parallelLinesCount:a}=A(c=>c.runtime),[t]=u,i=d.useRef(window.graph),b=c=>{const f=Math.min(Math.max(c,-10),10);i.current.hasNode(t)&&i.current.setNodeAttribute(t,"zIndex",f),i.current.hasEdge(t)&&i.current.setEdgeAttribute(t,"zIndex",f),o()},s=(c,f)=>{let S=-1;if(c){const g=i.current.getEdgeAttributes(t),[h,x]=i.current.extremities(t);S=se(i.current,g.type,h,x,f)}l(S)},l=c=>{i.current.setEdgeAttribute(t,"parallelIndex",c),r(E()),r(w(i.current.export()))},m=[];if(u.size!==0)if(u.size===1){if(m.push({type:"input",label:n("panel.details.info.id"),value:t,minW:276}),m.push({type:"select",label:n("panel.details.info.zIndex"),value:t?i.current.hasNode(t)?i.current.getNodeAttribute(t,"zIndex"):i.current.hasEdge(t)?i.current.getEdgeAttribute(t,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(c,f)=>[f-10,(f-10).toString()])),onChange:c=>b(Number(c))}),i.current.hasEdge(t)){const c=i.current.getEdgeAttributes(t),{parallelIndex:f,type:S}=c,g=p.RMP_CLOUD?fe:xe,h=a>g&&f<0||S===ne.Simple,x=a>g&&f>=0;m.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:h,isChecked:f>=0,onChange:y=>s(y,c[c.type].startFrom),oneLine:!0,minW:276}),f>=0&&m.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:x,value:c.parallelIndex.toString(),onChange:y=>l(Number(y)),minW:276})}}else u.size>1&&m.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(V,{fields:m,minW:130}),u.size===1&&t.startsWith("stn")&&i.current.hasNode(t)&&i.current.getNodeAttribute(t,"type")in G&&e.jsx(Oe,{}),u.size===1&&t.startsWith("line")&&i.current.hasEdge(t)&&i.current.getEdgeAttribute(t,"type")in I&&i.current.getEdgeAttribute(t,"style")in O&&e.jsx(ke,{}),u.size>1&&e.jsx(Re,{})]})}function We(){const{t:n}=P(),r=L(),{selected:o}=A(h=>h.runtime),[p]=o,u=d.useRef(window.graph),[a,t]=d.useState("undefined"),[i,b]=d.useState("undefined"),[s,l]=d.useState("undefined"),[m,c]=d.useState("undefined");d.useEffect(()=>{var h,x,y,N;if(p!=null&&p.startsWith("line")){const[v,R]=u.current.extremities(p);if(t(v),b(R),v.startsWith("stn")){const k=u.current.getNodeAttribute(v,"type");l((x=(h=u.current.getNodeAttribute(v,k))==null?void 0:h.names.at(0))!=null?x:"undefined")}if(R.startsWith("stn")){const k=u.current.getNodeAttribute(R,"type");c((N=(y=u.current.getNodeAttribute(R,k))==null?void 0:y.names.at(0))!=null?N:"undefined")}}},[o]);const f=J(()=>{r(M()),r(X(a))}),S=J(()=>{r(M()),r(X(i))}),g=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(C,{ml:"auto",size:"sm",variant:"link",onClick:f,children:a}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:s,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(C,{ml:"auto",size:"sm",variant:"link",onClick:S,children:i}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:m,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(V,{fields:g,minW:130})]})}function Ie(){const{t:n}=P(),r=L(),o=d.useCallback(()=>{r(T()),r(E()),r(w(t.current.export()))},[r,T,E,w]),{selected:p,refresh:{nodes:u}}=A(l=>l.runtime),[a]=p,t=d.useRef(window.graph),[i,b]=d.useState({x:0,y:0});d.useEffect(()=>{if(a!=null&&a.startsWith("stn")||a!=null&&a.startsWith("misc_node_")){const l=t.current.getNodeAttribute(a,"x"),m=t.current.getNodeAttribute(a,"y");b({x:l,y:m})}},[u,p]);const s=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:i.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{t.current.mergeNodeAttributes(a,{x:Number(l)}),o()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:i.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{t.current.mergeNodeAttributes(a,{y:Number(l)}),o()}}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(V,{fields:s,minW:130})]})}const q={...G,...Pe},Me=()=>{var b;const n=L(),{selected:r}=A(s=>s.runtime),{t:o}=P(),[p]=r,u=window.graph.getNodeAttribute(p,"type"),a=u in q&&q[u].attrsComponent,t=(b=window.graph.getNodeAttribute(p,u))!=null?b:{},i=(s,l)=>{const m=window.graph.getNodeAttribute(s,"type");window.graph.mergeNodeAttributes(s,{[m]:l}),n(T()),n(w(window.graph.export()))};return a?e.jsx(a,{id:p,attrs:t,handleAttrsUpdate:i}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},De=()=>{var h,x;const n=L(),{preference:{autoParallel:r}}=A(y=>y.app),{selected:o}=A(y=>y.runtime),{t:p}=P(),[u]=o,{type:a,style:t,parallelIndex:i,reconcileId:b}=window.graph.getEdgeAttributes(u),s=(h=window.graph.getEdgeAttribute(u,a))!=null?h:{},l=a in I&&I[a].attrsComponent,m=(x=window.graph.getEdgeAttribute(u,t))!=null?x:{},c=t in O&&O[t].attrsComponent,f=(y,N)=>{let v=-1;if(r){const[R,k]=window.graph.extremities(y);v=se(window.graph,a,R,k,N)}window.graph.setEdgeAttribute(y,"parallelIndex",v)},S=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[a]:N}),n(E()),n(w(window.graph.export()))},g=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[t]:N}),n(E()),n(w(window.graph.export()))};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:u,attrs:s,recalculateParallelIndex:f,handleAttrsUpdate:S,parallelIndex:i}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:p("panel.details.unknown.error",{category:p("panel.details.unknown.linePath")})}),c?e.jsx(c,{id:u,attrs:m,handleAttrsUpdate:g,reconcileId:b}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:p("panel.details.unknown.error",{category:p("panel.details.unknown.lineStyle")})})]})},$e=()=>{const{t:n}=P(),r=L(),o=d.useRef(window.graph),p=d.useCallback(()=>{r(T()),r(E()),r(w(o.current.export()))},[r,T,E,w]),{activeSubscriptions:u}=A(g=>g.account),{selected:a,mode:t,active:i,masterNodesCount:b}=A(g=>g.runtime),[s]=a,l=!u.RMP_CLOUD&&b+1>ye,m=()=>r(M()),c=g=>{const h=structuredClone(o.current.getNodeAttributes(g));h.x+=50,h.y+=50;const x=g.startsWith("stn")?"stn_".concat($(10)):"misc_node_".concat($(10));o.current.addNode(x,h),r(T()),r(w(o.current.export()))},f=g=>{const h=Ne(o.current,g);navigator.clipboard.writeText(h)},S=g=>{r(M()),g.forEach(h=>{o.current.hasNode(h)?o.current.dropNode(h):o.current.hasEdge(h)&&o.current.dropEdge(h)}),p()};return e.jsxs(be,{isOpen:a.size>0&&!t.startsWith("line")&&!i,width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(Se,{onClose:m,children:n("panel.details.header")}),e.jsxs(je,{children:[e.jsx(ze,{}),a.size===1&&o.current.hasNode(s)&&e.jsx(Ie,{}),a.size===1&&o.current.hasEdge(s)&&e.jsx(We,{}),a.size===1&&e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(s)&&e.jsx(Me,{}),window.graph.hasEdge(s)&&e.jsx(De,{})]})]}),e.jsx(we,{children:e.jsxs(B,{children:[a.size===1&&o.current.hasNode(s)&&e.jsx(C,{size:"sm",variant:"outline",onClick:()=>c(s),isDisabled:o.current.getNodeAttributes(s).type===Ae.Master&&l,children:n("panel.details.footer.duplicate")}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>f(a),children:n("panel.details.footer.copy")}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>S(a),children:n("panel.details.footer.remove")})]})})]})};export{$e as default};
