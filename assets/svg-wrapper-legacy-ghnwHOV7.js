System.register(["./chakra-legacy-oG9ixp5q.js","./index-legacy-8QIIIk-j.js","./react-legacy-J6S8G-Zx.js","./clipboard-legacy-dLsVViZB.js","./helpers-legacy-GKY2Ud0-.js","./misc-nodes-legacy-zKWYaoKf.js","./stations-legacy-qDmDWop8.js"],(function(e,t){"use strict";var r,n,s,i,o,l,d,c,a,u,y,x,f,h,p,g,v,m,b,A,k,w,E,N,S,j,C,I,P,z,K,W,D,L,$,_,T,M,O,R,F;return{setters:[e=>{r=e.j},e=>{n=e.t,s=e.N,i=e.q,o=e.j,l=e.d,d=e.af,c=e.ag,a=e.ah,u=e.ai,y=e.aj,x=e.y,f=e.z,h=e.S,p=e.e,g=e.n,v=e.v,m=e.r,b=e.E,A=e.A,k=e.D,w=e.Q,E=e.K,N=e.J,S=e.a4,j=e.a6},e=>{C=e.r,I=e.b},e=>{P=e.u,z=e.e,K=e.i},e=>{W=e.b,D=e.r,L=e.f,$=e.F,_=e.p,T=e.d,M=e.e,O=e.a},e=>{R=e.m},e=>{F=e.s}],execute:function(){const t=e=>e.filterNodes(((e,t)=>e.startsWith("stn"))).map((t=>[t,e.getNodeAttributes(t)])).filter((([e,t])=>t.visible)).sort(((e,t)=>e[1].zIndex-t[1].zIndex)).map((([e,t])=>({node:e,visible:t.visible,zIndex:t.zIndex,x:t.x,y:t.y,type:t.type,[t.type]:t[t.type]}))),B=e=>e.filterDirectedEdges(((e,t,r,n,s,i,o)=>e.startsWith("line")&&t.visible&&""===t.reconcileId)).sort(((t,r)=>e.getEdgeAttribute(t,"zIndex")-e.getEdgeAttribute(r,"zIndex"))).map((t=>{const r=e.getEdgeAttribute(t,"type"),n=e.getEdgeAttribute(t,r),s=e.getEdgeAttribute(t,"style"),i=e.getEdgeAttribute(t,s),[o,l]=e.extremities(t),d=e.getNodeAttributes(o),c=e.getNodeAttributes(l);return{edge:t,x1:d.x,y1:d.y,x2:c.x,y2:c.y,type:r,attr:n,style:s,styleAttr:i}})),U=e=>e.filterNodes(((e,t)=>e.startsWith("misc_node"))).map((t=>[t,e.getNodeAttributes(t)])).filter((([e,t])=>t.visible)).sort(((e,t)=>e[1].zIndex-t[1].zIndex)).map((([e,t])=>({node:e,visible:t.visible,zIndex:t.zIndex,x:t.x,y:t.y,type:t.type,[t.type]:t[t.type]}))),V=e=>{const{id:t,x:n,y:s,handlePointerDown:i,handlePointerMove:o,handlePointerUp:l}=e,d=I.useCallback((e=>i(t,e)),[t,i]),c=I.useCallback((e=>o(t,e)),[t,o]),a=I.useCallback((e=>l(t,e)),[t,l]);return r.jsx("g",{id:t,transform:`translate(${n-6.4},${s-6.4})scale(0.025)`,onPointerDown:d,onPointerMove:c,onPointerUp:a,style:{cursor:"move"},children:r.jsx("path",{id:`stn_core_${t}`,fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},J=e=>{const{id:t,path:n,handleClick:s}=e,i=I.useCallback((e=>s(t,e)),[t,s]);return r.jsx("path",{id:t,d:n,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onClick:i})},Y=e=>{var t,o;const{id:l,type:d,attrs:c=n[d].defaultAttrs,styleType:a,styleAttrs:u=s[a].defaultAttrs,newLine:y,handleClick:x}=e,{x1:f,y1:h,x2:p,y2:g}=e,[v,m]=I.useState("M 0,0 L 0,0");I.useEffect((()=>{let e="M 0,0 L 0,0";if(d in n)if(["offsetFrom","offsetTo"].every((e=>Object.keys(c).includes(e)))&&!Number.isNaN(c.offsetFrom)&&!Number.isNaN(c.offsetTo)&&c.offsetFrom===c.offsetTo&&((f===p||h===g)&&[i.Diagonal,i.Perpendicular].includes(d)||1===Math.abs((g-h)/(p-f))&&[i.Diagonal,i.RotatePerpendicular].includes(d))){const t=c.offsetFrom;e=n[i.Simple].generatePath(f,p,h,g,{offset:t})}else e=n[d].generatePath(f,p,h,g,c);else e=`M ${f},${h} L ${p},${g}`;m(e)}),[d,JSON.stringify(c),f,p,h,g]);const b=null!==(t=null===(o=s[a])||void 0===o?void 0:o.component)&&void 0!==t?t:J;return I.useMemo((()=>r.jsx(b,{id:l,type:d,path:v,styleAttrs:u,newLine:y,handleClick:x})),[l,d,v,a,JSON.stringify(u),y,x])},Z=()=>{const e=o(),w=I.useRef(window.graph),{telemetry:{project:E}}=l((e=>e.app)),{svgViewBoxZoom:N}=l((e=>e.param)),{selected:S,refresh:{nodes:j,edges:C},mode:z,active:K,keepLastPath:L,theme:$}=l((e=>e.runtime)),[_,T]=I.useState({x:0,y:0}),[M,O]=I.useState({x:0,y:0}),Z=P(((t,r)=>{r.stopPropagation(),"select"===z&&e(d("free"));const n=r.currentTarget,{x:s,y:i}=W(r);n.setPointerCapture(r.pointerId),T({x:s,y:i}),e(c(t)),r.shiftKey?S.has(t)?e(u(t)):e(y(t)):S.has(t)||e(a(new Set([t])))})),q=P(((t,r)=>{const{x:n,y:s}=W(r);"free"===z&&K===t?(S.forEach((e=>{w.current.hasNode(e)&&w.current.updateNodeAttributes(e,(e=>({...e,x:D(e.x-(_.x-n)*N/100,r.altKey?1:5),y:D(e.y-(_.y-s)*N/100,r.altKey?1:5)})))})),e(x()),e(f())):z.startsWith("line")&&O({x:(_.x-n)*N/100,y:(_.y-s)*N/100})})),H=P(((t,r)=>{if(z.startsWith("line")){L||e(d("free"));const t=[...Object.values(h),p.Virtual],s=w.current.hasNode(K)&&t.includes(w.current.getNodeAttribute(K,"type"));["stn_core_","virtual_circle_"].forEach((e=>{var t;const i=null===(t=document.elementsFromPoint(r.clientX,r.clientY)[0].attributes)||void 0===t||null===(t=t.getNamedItem("id"))||void 0===t?void 0:t.value,o=null==i?void 0:i.startsWith(e);if(s&&o){const t=z.slice(5),r=`line_${g(10)}`;w.current.addDirectedEdgeWithKey(r,K,i.slice(e.length),{visible:!0,zIndex:0,type:t,[t]:structuredClone(n[t].defaultAttrs),style:v.SingleColor,[v.SingleColor]:{color:$},reconcileId:""}),E&&m.event(b.ADD_LINE,{type:t})}})),e(f()),e(A(w.current.export()))}else if("free"===z&&K){const{x:t,y:n}=W(r);_.x-t==0&&_.y-n==0||e(A(w.current.export()))}e(c(void 0))})),Q=P(((t,r)=>{r.shiftKey||e(k()),r.shiftKey&&S.has(t)?e(u(t)):e(y(t))})),[X,G]=I.useState(t(w.current)),[ee,te]=I.useState(U(w.current)),[re,ne]=I.useState(B(w.current)),[se,ie]=I.useState([]),[oe,le]=I.useState([]);return I.useEffect((()=>{G(t(w.current)),te(U(w.current))}),[j]),I.useEffect((()=>{ne(B(w.current));const{allReconciledLines:e,danglingLines:t}=(e=>{const t=(e=>{const t=e.filterDirectedEdges(((e,t,r,n,s,i,o)=>e.startsWith("line")&&""!==t.reconcileId)),r={};for(const n of t){const t=e.getEdgeAttribute(n,"reconcileId");t in r?r[t].push(n):r[t]=[n]}return r})(e),r=[],n=[];return Object.values(t).forEach((t=>{if(1===t.length)return void n.push(...t);const s=e.getEdgeAttribute(t.at(0),"type");if(!t.every((t=>e.getEdgeAttribute(t,"type")===s)))return void n.push(...t);const i=e.getEdgeAttribute(t.at(0),"style");if(!t.every((t=>e.getEdgeAttribute(t,"style")===i)))return void n.push(...t);const o={},l=new Set,d=new Set,c=Object.fromEntries(t.map((t=>{var r,n;const[s,i]=e.extremities(t);return o[s]=(null!==(r=o[s])&&void 0!==r?r:0)+1,o[i]=(null!==(n=o[i])&&void 0!==n?n:0)+1,l.add(s),d.add(i),[s,[t,i]]}))),a=Array.from(l).filter((e=>1===o[e])),u=Array.from(d).filter((e=>1===o[e]));if(1!==a.length||1!==u.length)return void n.push(...t);const y=a[0],x=u[0];if(y===x)return void n.push(...t);const f=[c[y][0]];let h=c[y][1];for(let e=1;e<t.length;e+=1){var p;const e=null===(p=c[h])||void 0===p?void 0:p.at(1);if(!e)return void n.push(...t);f.push(c[h][0]),h=e}h===x&&f.length===t.length?r.push(f):n.push(...t)})),{allReconciledLines:r,danglingLines:n}})(w.current);ie(e),le(t)}),[C]),r.jsxs(r.Fragment,{children:[oe.map((e=>{const[t,s]=w.current.extremities(e),o=w.current.getNodeAttributes(t),l=w.current.getNodeAttributes(s);return r.jsx(Y,{id:e,x1:o.x,y1:o.y,x2:l.x,y2:l.y,newLine:!1,type:i.Simple,attrs:n[i.Simple].defaultAttrs,styleType:v.SingleColor,styleAttrs:{color:["","","#c0c0c0","#fff"]},handleClick:Q},e)})),se.map((e=>{var t,i;const o=((e,t)=>{if(!t.every((t=>e.hasEdge(t))))return;const r=t.map((t=>{var r,s,i;const[o,l]=e.extremities(t),d=e.getNodeAttributes(o),c=e.getNodeAttributes(l),a=e.getEdgeAttribute(t,"type"),u=null!==(r=e.getEdgeAttribute(t,a))&&void 0!==r?r:n[a].defaultAttrs;return null!==(s=null===(i=n[a])||void 0===i?void 0:i.generatePath(d.x,c.x,d.y,c.y,u))&&void 0!==s?s:`M ${d.x},${d.y} L ${c.x},${c.y}`}));let s=`${r[0]} `;for(let n=1;n<t.length;n+=1)s+=r[n].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return s})(w.current,e);if(!o)return r.jsx(r.Fragment,{});const l=e.at(0),d=w.current.getEdgeAttribute(l,"type"),c=w.current.getEdgeAttribute(l,"style"),a=w.current.getEdgeAttribute(l,c),u=null!==(t=null===(i=s[c])||void 0===i?void 0:i.component)&&void 0!==t?t:J;return r.jsx(u,{id:l,type:d,path:o,styleAttrs:a,newLine:!1,handleClick:Q},l)})),re.map((({edge:e,x1:t,y1:n,x2:s,y2:i,type:o,attr:l,style:d,styleAttr:c})=>r.jsx(Y,{id:e,x1:t,y1:n,x2:s,y2:i,newLine:!1,type:o,attrs:l,styleType:d,styleAttrs:c,handleClick:Q},e))),ee.map((e=>{var t,n;const{node:s,x:i,y:o,type:l}=e,d=null!==(t=null===(n=R[l])||void 0===n?void 0:n.component)&&void 0!==t?t:V;return r.jsx(d,{id:s,x:i,y:o,attrs:e[l],handlePointerDown:Z,handlePointerMove:q,handlePointerUp:H},s)})),X.map((e=>{var t,n;const{node:s,x:i,y:o,type:l}=e,d=null!==(t=null===(n=F[l])||void 0===n?void 0:n.component)&&void 0!==t?t:V;return r.jsx(d,{id:s,x:i,y:o,attrs:{[l]:e[l]},handlePointerDown:Z,handlePointerMove:q,handlePointerUp:H},s)})),z.startsWith("line")&&K&&r.jsx(Y,{id:"create_in_progress___no_use",x1:w.current.getNodeAttribute(K,"x"),y1:w.current.getNodeAttribute(K,"y"),x2:w.current.getNodeAttribute(K,"x")-M.x,y2:w.current.getNodeAttribute(K,"y")-M.y,newLine:!0,type:z.slice(5),attrs:n[z.slice(5)].defaultAttrs,styleType:v.SingleColor,styleAttrs:{color:$}})]})};e("default",(()=>{var e,t;const n=o(),s=I.useRef(window.graph),i=()=>{n(x()),n(f()),n(A(s.current.export()))},{telemetry:{project:u}}=l((e=>e.app)),{svgViewBoxZoom:y,svgViewBoxMin:h}=l((e=>e.param)),{mode:p,lastTool:v,active:B,selected:U,keepLastPath:V,theme:J,refresh:{nodes:Y}}=l((e=>e.runtime)),q=(()=>{const[e,t]=C.useState({width:void 0,height:void 0});return C.useEffect((()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[]),e})(),H=(null!==(e=q.height)&&void 0!==e?e:1280)-40,Q=(null!==(t=q.width)&&void 0!==t?t:720)-40;I.useEffect((()=>{const e=L(s.current);Object.entries(e).filter((([e,t])=>t&&e in $)).map((([e,t])=>e)).filter((e=>$[e]&&null===document.getElementById($[e].cssName))).map((e=>$[e].cssName)).filter(((e,t,r)=>t===r.findIndex((t=>t===e)))).forEach((e=>{const t=document.createElement("link");t.rel="stylesheet",t.id=e,t.href=`/rmp/styles/${e}.css`,document.head.append(t)}))}),[Y]);const[X,G]=I.useState({x:0,y:0}),[ee,te]=I.useState({x:0,y:0}),[re,ne]=I.useState({x:0,y:0}),[se,ie]=I.useState({x:0,y:0}),oe=P((e=>{const{x:t,y:r}=W(e);if(p.startsWith("station")){n(d("free"));const e=`stn_${g(10)}`,o=p.slice(8),l=structuredClone(F[o].defaultAttrs);"color"in l&&(l.color=J);const{x:c,y:x}=_(t,r,y,h);s.current.addNode(e,{visible:!0,zIndex:0,x:D(c,5),y:D(x,5),type:o,[o]:l}),i(),u&&m.event(b.ADD_STATION,{type:o}),n(a(new Set([e])))}else if(p.startsWith("misc-node")){n(d("free"));const e=`misc_node_${g(10)}`,o=p.slice(10),{x:l,y:c}=_(t,r,y,h);s.current.addNode(e,{visible:!0,zIndex:0,x:D(l,5),y:D(c,5),type:o,[o]:structuredClone(R[o].defaultAttrs)}),i(),u&&m.event(b.ADD_STATION,{type:o}),n(a(new Set([e])))}else"free"===p||p.startsWith("line")?(p.startsWith("line")&&(n(d("free")),V&&n(w(!1))),ne({x:t,y:r}),ie(h),e.shiftKey||(n(c("background")),n(k()))):"select"===p&&(G(_(t,r,y,h)),te(_(t,r,y,h)))})),le=P((e=>{if("select"===p){if(0!=X.x&&0!=X.y){const{x:t,y:r}=W(e);te(_(t,r,y,h))}}else if("background"===B){const{x:t,y:r}=W(e);n(E({x:se.x+(re.x-t)*y/100,y:se.y+(re.y-r)*y/100}))}})),de=P((e=>{if("select"===p){const{x:t,y:r}=W(e),{x:i,y:o}=_(t,r,y,h),l=T(s.current,X.x,X.y,i,o),c=M(s.current,new Set(l));n(a(new Set([...e.shiftKey?U:[],...l,...c]))),n(d("free")),G({x:0,y:0}),te({x:0,y:0})}"background"!==B||e.shiftKey||n(c(void 0))})),ce=P((e=>{let t=y;e.deltaY>0&&y+10<400?t=y+10:e.deltaY<0&&y-10>0&&(t=y-10),n(N(t));const{x:r,y:s}=W(e),i=e.currentTarget.getBoundingClientRect(),[o,l]=[r/i.width,s/i.height];n(E({x:h.x+r*y/100-Q*t/100*o,y:h.y+s*y/100-H*t/100*l}))})),ae=P((async e=>{if(O?"Backspace"===e.key:"Delete"===e.key)U.size>0&&(U.forEach((e=>{s.current.hasNode(e)?s.current.dropNode(e):s.current.hasEdge(e)&&s.current.dropEdge(e)})),n(k()),i());else if(e.key.startsWith("Arrow")){const t=100,r=e.key.endsWith("Left")?-1:e.key.endsWith("Right")?1:0,s=e.key.endsWith("Up")?-1:e.key.endsWith("Down")?1:0;n(E(_(t*r,t*s,y,h)))}else if("i"===e.key||"j"===e.key||"k"===e.key||"l"===e.key){const t=10,r=("j"===e.key?-1:"l"===e.key?1:0)*t,n=("i"===e.key?-1:"k"===e.key?1:0)*t;U.size>0&&U.forEach((e=>{s.current.hasNode(e)&&(s.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)+r)),s.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)+n)),i())}))}else if("f"===e.key&&v)n(d(v));else if("z"===e.key&&(O?e.metaKey&&!e.shiftKey:e.ctrlKey))O&&e.preventDefault(),n(S());else if("s"===e.key)n(d("select"));else if("c"!==e.key&&"x"!==e.key||!(O?e.metaKey&&!e.shiftKey:e.ctrlKey))if("v"===e.key&&(O?e.metaKey&&!e.shiftKey:e.ctrlKey)){const e=await navigator.clipboard.readText(),{x:t,y:r}=_(Q/2,H/2,y,h),{nodes:o,edges:l}=K(e,s.current,D(t,5),D(r,5));i();const d=structuredClone(o);l.forEach((e=>d.add(e))),n(a(d))}else(O&&"z"===e.key&&e.metaKey&&e.shiftKey||!O&&"y"===e.key&&e.ctrlKey)&&n(j());else{const t=z(s.current,U);navigator.clipboard.writeText(t),"x"===e.key&&(n(k()),U.forEach((e=>{s.current.hasNode(e)?s.current.dropNode(e):s.current.hasEdge(e)&&s.current.dropEdge(e)})),i())}})),[ue,ye]=I.useState({sx:0,sy:0,ex:0,ey:0});return I.useEffect((()=>{ye({sx:X.x<=ee.x?X.x:ee.x,ex:X.x>ee.x?X.x:ee.x,sy:X.y<=ee.y?X.y:ee.y,ey:X.y>ee.y?X.y:ee.y})}),[ee.x,ee.y]),r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none"},height:H,width:Q,viewBox:`${h.x} ${h.y} ${Q*y/100} ${H*y/100}`,onPointerDown:oe,onPointerMove:le,onPointerUp:de,onWheel:ce,tabIndex:0,onKeyDown:ae,children:[r.jsx(Z,{}),"select"===p&&0!=X.x&&0!=X.y&&r.jsx("rect",{x:ue.sx,y:ue.sy,width:ue.ex-ue.sx,height:ue.ey-ue.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"})]})}))}}}));
