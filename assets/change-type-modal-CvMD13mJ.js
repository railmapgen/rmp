import{j as n,ag as le,M as ce,ah as re,J as de,N as _,K as he,L as pe,aG as ue,aH as ye,aI as ge,B as Se,aJ as me,aK as fe,O as Te,t as D,aw as Ce}from"./chakra-C1zJvDsN.js";import{c as xe,e as I,x as H,y as G,z as J,t as be,aT as Le,C as je,M as we,S as Oe,q as ve,L as Ie,$ as Pe,Y as Be,R as Me,a0 as Ne,k as ke}from"./index-IqCGXd_c.js";import{u as Re,b as a}from"./react-BpF4RbzH.js";import{f as Ae,c as We,g as Ee,h as Fe,i as ze,j as Ze,k as _e}from"./change-types-RIY3Fvq1.js";import{s as De,g as He}from"./master-manager-DBOh-wZj.js";const Ye=K=>{const{isOpen:y,onClose:g,isSelect:c,filter:s}=K,{t}=Re(),p=xe(),{selected:d}=I(e=>e.runtime),{preference:{autoParallel:U,autoChangeStationType:q}}=I(e=>e.app),{activeSubscriptions:P}=I(e=>e.account),Y=a.useCallback(()=>{p(H(i.current.export())),p(G()),p(J())},[p,G,J,H]),i=a.useRef(window.graph),B={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(be).map(([e,o])=>[e,t(o.metadata.displayName).toString()]))},M={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(Le).map(([e,o])=>[e,t(o.metadata.displayName).toString()]))},N={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(De).map(([e,o])=>[e,t(o.metadata.displayName).toString()]))},S={id:"any",theme:[je.Other,"other","#ffffff",we.black],value:t("header.settings.procedures.changeType.any")},[m,k]=a.useState(!1),[R,A]=a.useState(0),[f,W]=a.useState(!1),[T,$]=a.useState("any"),[C,Q]=a.useState(Oe.ShmetroBasic),[x,E]=a.useState(!1),[b,V]=a.useState("any"),[L,X]=a.useState(ve.SingleColor),[j,F]=a.useState(!1),[w,ee]=a.useState("any"),[O,te]=a.useState(Ie.Diagonal),[v,z]=a.useState(!1),[h,Z]=a.useState(S),{theme:u,requestThemeChange:se}=Pe(),[ne,ae]=a.useState([]),ie=[{id:"changeZIndex",title:t("header.settings.procedures.changeZIndex"),onClose:()=>k(!m),field:[{type:"select",label:t("panel.details.info.zIndex"),value:R,options:Object.fromEntries(Array.from({length:21},(e,o)=>[o-10,(o-10).toString()])),onChange:e=>A(Number(e))}]},{id:"changeStationType",title:t("header.settings.procedures.changeStationType.title"),onClose:()=>W(!f),field:[{type:"select",label:t("header.settings.procedures.changeStationType.changeFrom"),options:N,value:T,disabledOptions:[C],onChange:e=>$(e)},{type:"select",label:t("header.settings.procedures.changeStationType.changeTo"),options:N,value:C,disabledOptions:["any",T],onChange:e=>Q(e)}]},{id:"changeLineStyleType",title:t("header.settings.procedures.changeLineStyleType.title"),onClose:()=>E(!x),field:[{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeFrom"),options:M,value:b,disabledOptions:[L],onChange:e=>V(e)},{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeTo"),options:M,value:L,disabledOptions:["any",b],onChange:e=>X(e)}]},{id:"changeLinePathType",title:t("header.settings.procedures.changeLinePathType.title"),onClose:()=>F(!j),field:[{type:"select",label:t("header.settings.procedures.changeLinePathType.changeFrom"),options:B,value:w,disabledOptions:[O],onChange:e=>ee(e)},{type:"select",label:t("header.settings.procedures.changeLinePathType.changeTo"),options:B,value:O,disabledOptions:["any","simple",w],onChange:e=>te(e)}]},{id:"changeColor",title:t("header.settings.procedures.changeColor.title"),onClose:()=>z(!v),field:[{type:"custom",label:t("header.settings.procedures.changeColor.changeFrom"),component:n.jsx(Be,{data:ne,displayHandler:e=>n.jsx(Me,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,o)=>o.id.toLowerCase().includes(e.toLowerCase())||Object.values(o.id).some(r=>r.toLowerCase().includes(e.toLowerCase())),value:h.value,onChange:e=>Z(e)})},{type:"custom",label:t("header.settings.procedures.changeColor.changeTo"),component:n.jsx(Ne,{theme:u,onClick:se})}]}];a.useEffect(()=>{y&&(k(!1),W(!1),E(!1),F(!1),z(!1),A(0),ae([S,...He(i.current,c?[...d].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):i.current.nodes(),c?[...d].filter(e=>e.startsWith("line")):i.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),Z(S))},[y]);const oe=()=>{const e=s!=null&&s.includes("station")?[...d].filter(l=>l.startsWith("stn")):c?[]:i.current.filterNodes(l=>l.startsWith("stn")),o=s!=null&&s.includes("misc-node")?[...d].filter(l=>l.startsWith("misc_node")):c?[]:i.current.filterNodes(l=>l.startsWith("misc_node")),r=c?[...d].filter(l=>l.startsWith("line")):i.current.edges();(!s||s.includes("station"))&&f&&(Ae(i.current,T,C,e),q&&e.forEach(l=>We(i.current,l))),(!s||s.includes("line"))&&x&&Ee(i.current,b,L,u,r),(!s||s.includes("line"))&&j&&Fe(i.current,w,O,r,U),v&&((!s||s.includes("line"))&&ze(i.current,h.id==="any"?"any":h.theme,u,r),(!s||s.includes("misc-node")||s.includes("station"))&&Ze(i.current,h.id==="any"?"any":h.theme,u,e,o)),m&&_e(i.current,!s||s.includes("station")?e:[],!s||s.includes("misc-node")?o:[],!s||s.includes("line")?r:[],R),Y(),g()};return n.jsxs(le,{isOpen:y,onClose:g,size:"md",scrollBehavior:"inside",children:[n.jsx(ce,{}),n.jsxs(re,{children:[n.jsxs(de,{children:[n.jsx(_,{as:"b",fontSize:"xl",children:t(c?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),n.jsx(he,{})]}),n.jsx(pe,{children:n.jsx(ue,{allowMultiple:!0,children:ie.map(e=>n.jsxs(ye,{children:[n.jsxs(ge,{onClick:e.onClose,children:[n.jsx(Se,{as:"span",flex:"1",textAlign:"left",children:n.jsx(_,{as:"b",fontSize:"md",children:e.title})}),n.jsx(me,{})]}),n.jsx(fe,{pb:4,children:n.jsx(ke,{fields:e.field,minW:270})})]},e.id))})}),n.jsxs(Te,{children:[n.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:g,children:t("cancel")}),n.jsx(Ce,{label:t("header.settings.pro"),isOpen:!P.RMP_CLOUD,children:n.jsx(D,{colorScheme:"red",mr:"1",onClick:oe,isDisabled:!P.RMP_CLOUD||!m&&!f&&!x&&!j&&!v,children:t("apply")})})]})]})]})};export{Ye as C};
