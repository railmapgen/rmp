import{j as e,B as z,aj as O,ak as me,av as _,t as E,aw as fe,x as xe,D as ye,G as ne,M as se,H as ae,J as ie,L as re,au as le,O as oe,N as B}from"./chakra-C1zJvDsN.js";import{c as P,e as C,ba as be,X as Se,bb as je,aT as we,w as A,y as v,q as I,aR as W,L as ce,p as Ce,V as F,bc as U,ac as de,x as L,S as Ae,a3 as Ne,a4 as Te,k as H,o as ue,F as D,aU as K,aC as Ee,bd as ve,be as ke,bf as Le,bg as Pe,aJ as Re,b5 as We,bh as Oe,n as Q,aD as ze}from"./index-BJEcvnB0.js";import{u as R,b as c}from"./react-BpF4RbzH.js";import{a as Ie,b as De,d as Me,e as _e,c as Y}from"./change-types-wziYmfmG.js";import{s as V}from"./master-manager-BPYhTJJv.js";import{C as Be}from"./change-type-modal-B8kfA0pO.js";import{l as Fe,L as Ue}from"./tools-nEYoDpts.js";import{u as ee}from"./useEvent-LzhclC4A.js";import{m as He}from"./misc-nodes-DZWhAlRl.js";function Ve(){const{t:n}=R(),s=P(),{selected:l}=C(t=>t.runtime),d=c.useRef(window.graph),u=t=>{if(d.current.hasNode(t)){const o=d.current.getNodeAttributes(t),f=o.type;return t.startsWith("stn")?o[f].names.join("/"):f}else if(d.current.hasEdge(t)){const[o,f]=d.current.extremities(t),p=d.current.getSourceAttributes(t),b=d.current.getTargetAttributes(t),j=p.type,m=b.type;return(o.startsWith("stn")?p[j].names[0]:j)+" - "+(f.startsWith("stn")?b[m].names[0]:m)}},[i,a]=c.useState([]);c.useEffect(()=>{a(["station","misc-node","line"])},[l]);const[r,h]=c.useState(!1);return e.jsxs(z,{children:[e.jsxs(O,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",l.size]}),e.jsxs(me,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(O,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(be,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:i,multiSelect:!0,onChange:t=>a(t)})]}),i.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{width:"100%",size:"sm",onClick:()=>h(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(fe,{label:n("header.settings.pro"),children:e.jsx(xe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(ye,{})]}),[...l].filter(t=>i.includes("station")||!t.startsWith("stn")).filter(t=>i.includes("misc-node")||!t.startsWith("misc")).filter(t=>i.includes("line")||!t.startsWith("line")).map(t=>{var o;return e.jsxs(_,{width:"100%",children:[e.jsx(E,{width:"100%",size:"sm",variant:"solid",onClick:()=>s(Se(new Set([t]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(o=u(t))==null?void 0:o.replaceAll("\n","âŽ")}),e.jsx(E,{size:"sm",onClick:()=>s(we(t)),children:e.jsx(je,{})})]},t)})]}),e.jsx(Be,{isOpen:r,onClose:()=>h(!1),isSelect:!0,filter:i})]})}function Xe(){var q,Z;const{i18n:n,t:s}=R(),l=P(),d=c.useCallback(()=>{l(A(t.current.export())),l(v())},[l,v,A]),{preference:{autoParallel:u,disableWarning:i}}=C(y=>y.app),{selected:a,theme:r}=C(y=>y.runtime),[h]=a,t=c.useRef(window.graph),[o,f]=c.useState(!1),p=c.useRef(null),[b,j]=c.useState(!1),m=Object.fromEntries(Object.entries(I).map(([y,ge])=>[y,s(ge.metadata.displayName).toString()])),[g,w]=c.useState(t.current.getEdgeAttribute(h,"type")),[S,N]=c.useState(void 0),T=Object.fromEntries((Z=(q=Fe[n.language])==null?void 0:q.map(y=>[y,s(W[y].metadata.displayName).toString()]))!=null?Z:[]),[x,k]=c.useState(t.current.getEdgeAttribute(h,"style")),[X,G]=c.useState(void 0);c.useEffect(()=>{w(t.current.getEdgeAttribute(h,"type")),k(t.current.getEdgeAttribute(h,"style"))},[h]);const pe=Object.values(ce).filter(y=>!W[x].metadata.supportLinePathType.includes(y)),he=Object.values(Ce).filter(y=>!W[y].metadata.supportLinePathType.includes(g)),J=y=>{y&&(Ie(t.current,h,y,u),w(t.current.getEdgeAttribute(h,"type")),d())},$=y=>{y&&(De(t.current,h,y,r),k(t.current.getEdgeAttribute(h,"style")),d())},M=y=>{y&&(S?(J(S),N(void 0)):X&&($(X),G(void 0)),b&&l(de(!0))),j(!1),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:m,disabledOptions:pe,defaultValue:g,value:g,onChange:({target:{value:y}})=>{i.changeType?J(y):(N(y),f(!0))}})}),e.jsx(F,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:T,disabledOptions:he,defaultValue:x,value:x,onChange:({target:{value:y}})=>{i.changeType?$(y):(G(y),f(!0))}})}),e.jsx(Ue,{type:"line",expand:!0}),e.jsx(ne,{isOpen:o,leastDestructiveRef:p,onClose:()=>M(!1),children:e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(ie,{children:s("warning")}),e.jsxs(re,{children:[s("panel.details.changeLineTypeContent"),e.jsx(le,{mt:4,isChecked:b,onChange:y=>j(y.target.checked),width:"100%",children:s("noShowAgain")})]}),e.jsxs(oe,{children:[e.jsx(E,{ref:p,onClick:()=>M(!1),children:s("cancel")}),e.jsx(E,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:s("panel.details.changeType")})]})]})})})]})}function Ge(){const{t:n}=R(),s=P(),l=c.useCallback(()=>{s(A(h.current.export())),s(L())},[s,L,A]),{selected:d,refresh:{nodes:u}}=C(x=>x.runtime),{preference:{autoChangeStationType:i,disableWarning:a}}=C(x=>x.app),[r]=d,h=c.useRef(window.graph),[t,o]=c.useState(!1),f=c.useRef(null),[p,b]=c.useState(void 0),[j,m]=c.useState(!1),[g,w]=c.useState(Ae.ShmetroBasic);c.useEffect(()=>{if(r!=null&&r.startsWith("stn")){const x=h.current.getNodeAttribute(r,"type");w(x)}},[u,d]);const S=Object.fromEntries(Object.entries(V).map(([x,k])=>[x,n(k.metadata.displayName).toString()])),N=x=>{x&&(Me(h.current,r,x),i&&r.startsWith("stn")&&_e(h.current,r),l())},T=x=>{x&&p&&(N(p),j&&s(de(!0))),b(void 0),m(!1),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:S,disabledOptions:[g],value:g,onChange:({target:{value:x}})=>{a.changeType?N(x):(b(x),o(!0))}})}),e.jsx(ne,{isOpen:t,leastDestructiveRef:f,onClose:()=>T(!1),children:e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(ie,{children:n("warning")}),e.jsxs(re,{children:[n("panel.details.changeStationTypeContent"),e.jsx(le,{mt:4,isChecked:j,onChange:x=>m(x.target.checked),width:"100%",children:n("noShowAgain")})]}),e.jsxs(oe,{children:[e.jsx(E,{ref:f,onClick:()=>T(!1),children:n("cancel")}),e.jsx(E,{ml:"2",colorScheme:"red",onClick:()=>T(!0),children:n("panel.details.changeType")})]})]})})})]})}function Je(){const{t:n}=R(),s=P(),l=c.useCallback(()=>{s(A(r.current.export())),s(L()),s(v())},[s,L,v,A]),{activeSubscriptions:d}=C(p=>p.account),{selected:u,count:{parallel:i}}=C(p=>p.runtime),[a]=u,r=c.useRef(window.graph),h=p=>{const b=Math.min(Math.max(p,-10),10);r.current.hasNode(a)&&r.current.setNodeAttribute(a,"zIndex",b),r.current.hasEdge(a)&&r.current.setEdgeAttribute(a,"zIndex",b),l()},t=(p,b)=>{let j=-1;if(p){const m=r.current.getEdgeAttributes(a),[g,w]=r.current.extremities(a);j=ue(r.current,m.type,g,w,b)}o(j)},o=p=>{r.current.setEdgeAttribute(a,"parallelIndex",p),s(A(r.current.export())),s(v())},f=[];if(u.size!==0)if(u.size===1){if(f.push({type:"input",label:n("panel.details.info.id"),value:a,minW:276}),f.push({type:"select",label:n("panel.details.info.zIndex"),value:a?r.current.hasNode(a)?r.current.getNodeAttribute(a,"zIndex"):r.current.hasEdge(a)?r.current.getEdgeAttribute(a,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(p,b)=>[b-10,(b-10).toString()])),onChange:p=>h(Number(p))}),r.current.hasEdge(a)){const p=r.current.getEdgeAttributes(a),{parallelIndex:b,type:j}=p,m=d.RMP_CLOUD?Ne:Te,g=i>m&&b<0||j===ce.Simple,w=i>m&&b>=0;f.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:g,isChecked:b>=0,onChange:S=>t(S,p[p.type].startFrom),oneLine:!0,minW:276}),b>=0&&f.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:w,value:p.parallelIndex.toString(),onChange:S=>o(Number(S)),minW:276})}}else u.size>1&&f.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(z,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(H,{fields:f,minW:130}),u.size===1&&a.startsWith("stn")&&r.current.hasNode(a)&&r.current.getNodeAttribute(a,"type")in V&&e.jsx(Ge,{}),u.size===1&&a.startsWith("line")&&r.current.hasEdge(a)&&r.current.getEdgeAttribute(a,"type")in I&&r.current.getEdgeAttribute(a,"style")in W&&e.jsx(Xe,{}),u.size>1&&e.jsx(Ve,{})]})}function $e(){const{t:n}=R(),s=P(),{selected:l}=C(g=>g.runtime),[d]=l,u=c.useRef(window.graph),[i,a]=c.useState("undefined"),[r,h]=c.useState("undefined"),[t,o]=c.useState("undefined"),[f,p]=c.useState("undefined");c.useEffect(()=>{var g,w,S,N;if(d!=null&&d.startsWith("line")){const[T,x]=u.current.extremities(d);if(a(T),h(x),T.startsWith("stn")){const k=u.current.getNodeAttribute(T,"type");o((w=(g=u.current.getNodeAttribute(T,k))==null?void 0:g.names.at(0))!=null?w:"undefined")}if(x.startsWith("stn")){const k=u.current.getNodeAttribute(x,"type");p((N=(S=u.current.getNodeAttribute(x,k))==null?void 0:S.names.at(0))!=null?N:"undefined")}}},[l]);const b=ee(()=>{s(D()),s(K(i))}),j=ee(()=>{s(D()),s(K(r))}),m=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(E,{ml:"auto",size:"sm",variant:"link",onClick:b,children:i}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:t,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(E,{ml:"auto",size:"sm",variant:"link",onClick:j,children:r}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:f,minW:"full"}];return e.jsxs(z,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(H,{fields:m,minW:130})]})}function qe(){const{t:n}=R(),s=P(),l=c.useCallback(()=>{s(A(a.current.export())),s(L()),s(v())},[s,L,v,A]),{selected:d,refresh:{nodes:u}}=C(o=>o.runtime),[i]=d,a=c.useRef(window.graph),[r,h]=c.useState({x:0,y:0});c.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const o=a.current.getNodeAttribute(i,"x"),f=a.current.getNodeAttribute(i,"y");h({x:o,y:f})}},[u,d]);const t=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:r.x.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{a.current.mergeNodeAttributes(i,{x:Number(o)}),l()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:r.y.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{a.current.mergeNodeAttributes(i,{y:Number(o)}),l()}}];return e.jsxs(z,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(H,{fields:t,minW:130})]})}const te={...V,...He},Ze=()=>{var h;const n=P(),{selected:s}=C(t=>t.runtime),{t:l}=R(),[d]=s,u=window.graph.getNodeAttribute(d,"type"),i=u in te&&te[u].attrsComponent,a=(h=window.graph.getNodeAttribute(d,u))!=null?h:{},r=(t,o)=>{const f=window.graph.getNodeAttribute(t,"type");window.graph.mergeNodeAttributes(t,{[f]:o}),n(A(window.graph.export())),n(L())};return i?e.jsx(i,{id:d,attrs:a,handleAttrsUpdate:r}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:l("panel.details.unknown.error",{category:l("panel.details.unknown.node")})})},Ke=()=>{var g,w;const n=P(),{preference:{autoParallel:s}}=C(S=>S.app),{selected:l}=C(S=>S.runtime),{t:d}=R(),[u]=l,{type:i,style:a,parallelIndex:r,reconcileId:h}=window.graph.getEdgeAttributes(u),t=(g=window.graph.getEdgeAttribute(u,i))!=null?g:{},o=i in I&&I[i].attrsComponent,f=(w=window.graph.getEdgeAttribute(u,a))!=null?w:{},p=a in W&&W[a].attrsComponent,b=(S,N)=>{let T=-1;if(s){const[x,k]=window.graph.extremities(S);T=ue(window.graph,i,x,k,N)}window.graph.setEdgeAttribute(S,"parallelIndex",T)},j=(S,N)=>{window.graph.mergeEdgeAttributes(S,{[i]:N}),n(A(window.graph.export())),n(v())},m=(S,N)=>{window.graph.mergeEdgeAttributes(S,{[a]:N}),n(A(window.graph.export())),n(v())};return e.jsxs(e.Fragment,{children:[o?e.jsx(o,{id:u,attrs:t,recalculateParallelIndex:b,handleAttrsUpdate:j,parallelIndex:r}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.linePath")})}),p?e.jsx(p,{id:u,attrs:f,handleAttrsUpdate:m,reconcileId:h}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.lineStyle")})})]})},lt=()=>{const{t:n}=R(),s=P(),l=c.useRef(window.graph),d=c.useCallback(()=>{s(A(l.current.export())),s(L()),s(v())},[s,L,v,A]),{activeSubscriptions:u}=C(m=>m.account),{selected:i,isDetailsOpen:a,count:{masters:r}}=C(m=>m.runtime),{preference:{autoChangeStationType:h}}=C(m=>m.app),[t]=i,o=!u.RMP_CLOUD&&r+1>Ee,f=()=>{We()?s(Oe()):s(D())},p=m=>{const g=structuredClone(l.current.getNodeAttributes(m));g.x+=50,g.y+=50;const w=m.startsWith("stn")?"stn_".concat(Q(10)):"misc_node_".concat(Q(10));l.current.addNode(w,g),s(A(l.current.export())),s(L())},b=m=>{const g=ze(l.current,m);navigator.clipboard.writeText(g)},j=m=>{s(D()),m.forEach(g=>{if(l.current.hasNode(g))l.current.dropNode(g);else if(l.current.hasEdge(g)){const[w,S]=l.current.extremities(g);l.current.dropEdge(g),h&&w.startsWith("stn")&&Y(l.current,w),h&&S.startsWith("stn")&&Y(l.current,S)}}),d()};return e.jsxs(ve,{isOpen:a==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ke,{onClose:f,children:n("panel.details.header")}),e.jsxs(Le,{children:[e.jsx(Je,{}),i.size===1&&l.current.hasNode(t)&&e.jsx(qe,{}),i.size===1&&l.current.hasEdge(t)&&e.jsx($e,{}),i.size===1&&e.jsxs(z,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(t)&&e.jsx(Ze,{}),window.graph.hasEdge(t)&&e.jsx(Ke,{})]})]}),e.jsx(Pe,{children:e.jsxs(_,{children:[i.size===1&&l.current.hasNode(t)&&e.jsx(E,{size:"sm",variant:"outline",onClick:()=>p(t),isDisabled:l.current.getNodeAttributes(t).type===Re.Master&&o,children:n("panel.details.footer.duplicate")}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>b(i),children:n("panel.details.footer.copy")}),e.jsx(E,{size:"sm",variant:"outline",onClick:()=>j(i),children:n("panel.details.footer.remove")})]})})]})};export{lt as default};
