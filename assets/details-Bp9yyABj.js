import{j as e,B as W,aj as z,ak as ce,av as _,t as C,aw as de,x as ue,D as pe,G as K,M as Q,H as Y,J as ee,L as te,O as ne,N as B}from"./chakra-C1zJvDsN.js";import{c as P,e as A,b8 as he,X as ge,b9 as me,aR as fe,w,y as v,q as I,aP as O,L as se,p as xe,V as F,ba as H,x as T,S as ye,a3 as be,a4 as Se,k as U,o as ae,F as D,aS as $,aA as je,bb as we,bc as Ae,bd as Ce,be as Ne,aH as Ee,b3 as ve,bf as Te,n as q,aB as Le}from"./index-DJ61dkMJ.js";import{u as R,b as d}from"./react-BpF4RbzH.js";import{s as V}from"./master-manager-Mny4XfjO.js";import{C as Pe,c as Re,a as ke,b as Oe}from"./change-type-modal-C7NQ1oKm.js";import{l as ze,L as We}from"./tools-CbUfhxUZ.js";import{u as J}from"./useEvent-LzhclC4A.js";import{m as Ie}from"./misc-nodes-DzoZZONf.js";function De(){const{t}=R(),i=P(),{selected:o}=A(r=>r.runtime),u=d.useRef(window.graph),p=r=>{if(u.current.hasNode(r)){const l=u.current.getNodeAttributes(r),m=l.type;return r.startsWith("stn")?l[m].names.join("/"):m}else if(u.current.hasEdge(r)){const[l,m]=u.current.extremities(r),h=u.current.getSourceAttributes(r),f=u.current.getTargetAttributes(r),x=h.type,g=f.type;return(l.startsWith("stn")?h[x].names[0]:x)+" - "+(m.startsWith("stn")?f[g].names[0]:g)}},[n,s]=d.useState([]);d.useEffect(()=>{s(["station","misc-node","line"])},[o]);const[a,c]=d.useState(!1);return e.jsxs(W,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[t("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(ce,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(z,{as:"h5",size:"xs",w:"100%",children:t("panel.details.multipleSelection.show")}),e.jsx(he,{selections:[{label:t("panel.details.multipleSelection.station"),value:"station"},{label:t("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:t("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:n,multiSelect:!0,onChange:r=>s(r)})]}),n.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{width:"100%",size:"sm",onClick:()=>c(!0),children:[t("panel.details.multipleSelection.change"),e.jsx(de,{label:t("header.settings.pro"),children:e.jsx(ue,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(pe,{})]}),[...o].filter(r=>n.includes("station")||!r.startsWith("stn")).filter(r=>n.includes("misc-node")||!r.startsWith("misc")).filter(r=>n.includes("line")||!r.startsWith("line")).map(r=>{var l;return e.jsxs(_,{width:"100%",children:[e.jsx(C,{width:"100%",size:"sm",variant:"solid",onClick:()=>i(ge(new Set([r]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=p(r))==null?void 0:l.replaceAll("\n","⏎")}),e.jsx(C,{size:"sm",onClick:()=>i(fe(r)),children:e.jsx(me,{})})]},r)})]}),e.jsx(Pe,{isOpen:a,onClose:()=>c(!1),isSelect:!0,filter:n})]})}function Me(){var X,G;const{i18n:t,t:i}=R(),o=P(),u=d.useCallback(()=>{o(w(c.current.export())),o(v())},[o,v,w]),{preference:{autoParallel:p}}=A(j=>j.app),{selected:n,theme:s}=A(j=>j.runtime),[a]=n,c=d.useRef(window.graph),[r,l]=d.useState(!1),m=d.useRef(null),h=Object.fromEntries(Object.entries(I).map(([j,oe])=>[j,i(oe.metadata.displayName).toString()])),[f,x]=d.useState(c.current.getEdgeAttribute(a,"type")),[g,S]=d.useState(void 0),b=Object.fromEntries((G=(X=ze[t.language])==null?void 0:X.map(j=>[j,i(O[j].metadata.displayName).toString()]))!=null?G:[]),[y,N]=d.useState(c.current.getEdgeAttribute(a,"style")),[E,L]=d.useState(void 0);d.useEffect(()=>{x(c.current.getEdgeAttribute(a,"type")),N(c.current.getEdgeAttribute(a,"style"))},[a]);const k=Object.values(se).filter(j=>!O[y].metadata.supportLinePathType.includes(j)),ie=Object.values(xe).filter(j=>!O[j].metadata.supportLinePathType.includes(f)),re=()=>{g&&(Re(c.current,a,g,p),x(c.current.getEdgeAttribute(a,"type")),u())},le=()=>{E&&(ke(c.current,a,E,s),N(c.current.getEdgeAttribute(a,"style")),u())},M=j=>{j&&(g?(re(),S(void 0)):E&&(le(),L(void 0))),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:i("panel.details.info.linePathType"),minW:"276",children:e.jsx(H,{options:h,disabledOptions:k,defaultValue:f,value:f,onChange:({target:{value:j}})=>{S(j),l(!0)}})}),e.jsx(F,{label:i("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(H,{options:b,disabledOptions:ie,defaultValue:y,value:y,onChange:({target:{value:j}})=>{L(j),l(!0)}})}),e.jsx(We,{type:"line",expand:!0}),e.jsx(K,{isOpen:r,leastDestructiveRef:m,onClose:()=>M(!1),children:e.jsx(Q,{children:e.jsxs(Y,{children:[e.jsx(ee,{children:i("warning")}),e.jsx(te,{children:i("panel.details.changeLineTypeContent")}),e.jsxs(ne,{children:[e.jsx(C,{ref:m,onClick:()=>M(!1),children:i("cancel")}),e.jsx(C,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:i("panel.details.changeType")})]})]})})})]})}function _e(){const{t}=R(),i=P(),o=d.useCallback(()=>{i(w(s.current.export())),i(T())},[i,T,w]),{selected:u,refresh:{nodes:p}}=A(b=>b.runtime),[n]=u,s=d.useRef(window.graph),[a,c]=d.useState(!1),r=d.useRef(null),[l,m]=d.useState(void 0),[h,f]=d.useState(ye.ShmetroBasic);d.useEffect(()=>{if(n!=null&&n.startsWith("stn")){const b=s.current.getNodeAttribute(n,"type");f(b)}},[p,u]);const x=Object.fromEntries(Object.entries(V).map(([b,y])=>[b,t(y.metadata.displayName).toString()])),g=()=>{l&&(Oe(s.current,n,l),o())},S=b=>{b&&g(),m(void 0),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:t("panel.details.info.stationType"),minW:"276",children:e.jsx(H,{options:x,disabledOptions:[h],value:h,onChange:({target:{value:b}})=>{m(b),c(!0)}})}),e.jsx(K,{isOpen:a,leastDestructiveRef:r,onClose:()=>S(!1),children:e.jsx(Q,{children:e.jsxs(Y,{children:[e.jsx(ee,{children:t("warning")}),e.jsx(te,{children:t("panel.details.changeStationTypeContent")}),e.jsxs(ne,{children:[e.jsx(C,{ref:r,onClick:()=>S(!1),children:t("cancel")}),e.jsx(C,{ml:"2",colorScheme:"red",onClick:()=>S(!0),children:t("panel.details.changeType")})]})]})})})]})}function Be(){const{t}=R(),i=P(),o=d.useCallback(()=>{i(w(a.current.export())),i(T()),i(v())},[i,T,v,w]),{activeSubscriptions:u}=A(h=>h.account),{selected:p,count:{parallel:n}}=A(h=>h.runtime),[s]=p,a=d.useRef(window.graph),c=h=>{const f=Math.min(Math.max(h,-10),10);a.current.hasNode(s)&&a.current.setNodeAttribute(s,"zIndex",f),a.current.hasEdge(s)&&a.current.setEdgeAttribute(s,"zIndex",f),o()},r=(h,f)=>{let x=-1;if(h){const g=a.current.getEdgeAttributes(s),[S,b]=a.current.extremities(s);x=ae(a.current,g.type,S,b,f)}l(x)},l=h=>{a.current.setEdgeAttribute(s,"parallelIndex",h),i(w(a.current.export())),i(v())},m=[];if(p.size!==0)if(p.size===1){if(m.push({type:"input",label:t("panel.details.info.id"),value:s,minW:276}),m.push({type:"select",label:t("panel.details.info.zIndex"),value:s?a.current.hasNode(s)?a.current.getNodeAttribute(s,"zIndex"):a.current.hasEdge(s)?a.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(h,f)=>[f-10,(f-10).toString()])),onChange:h=>c(Number(h))}),a.current.hasEdge(s)){const h=a.current.getEdgeAttributes(s),{parallelIndex:f,type:x}=h,g=u.RMP_CLOUD?be:Se,S=n>g&&f<0||x===se.Simple,b=n>g&&f>=0;m.push({type:"switch",label:t("panel.details.info.parallel"),isDisabled:S,isChecked:f>=0,onChange:y=>r(y,h[h.type].startFrom),oneLine:!0,minW:276}),f>=0&&m.push({type:"input",label:t("panel.details.info.parallelIndex"),variant:"number",isDisabled:b,value:h.parallelIndex.toString(),onChange:y=>l(Number(y)),minW:276})}}else p.size>1&&m.push({type:"input",label:t("panel.details.info.type"),value:t("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.info.title")}),e.jsx(U,{fields:m,minW:130}),p.size===1&&s.startsWith("stn")&&a.current.hasNode(s)&&a.current.getNodeAttribute(s,"type")in V&&e.jsx(_e,{}),p.size===1&&s.startsWith("line")&&a.current.hasEdge(s)&&a.current.getEdgeAttribute(s,"type")in I&&a.current.getEdgeAttribute(s,"style")in O&&e.jsx(Me,{}),p.size>1&&e.jsx(De,{})]})}function Fe(){const{t}=R(),i=P(),{selected:o}=A(S=>S.runtime),[u]=o,p=d.useRef(window.graph),[n,s]=d.useState("undefined"),[a,c]=d.useState("undefined"),[r,l]=d.useState("undefined"),[m,h]=d.useState("undefined");d.useEffect(()=>{var S,b,y,N;if(u!=null&&u.startsWith("line")){const[E,L]=p.current.extremities(u);if(s(E),c(L),E.startsWith("stn")){const k=p.current.getNodeAttribute(E,"type");l((b=(S=p.current.getNodeAttribute(E,k))==null?void 0:S.names.at(0))!=null?b:"undefined")}if(L.startsWith("stn")){const k=p.current.getNodeAttribute(L,"type");h((N=(y=p.current.getNodeAttribute(L,k))==null?void 0:y.names.at(0))!=null?N:"undefined")}}},[o]);const f=J(()=>{i(D()),i($(n))}),x=J(()=>{i(D()),i($(a))}),g=[{type:"custom",label:t("panel.details.lineExtremities.source"),component:e.jsx(C,{ml:"auto",size:"sm",variant:"link",onClick:f,children:n}),oneLine:!0,minW:"full"},{type:"input",label:t("panel.details.lineExtremities.sourceName"),value:r,minW:"full"},{type:"custom",label:t("panel.details.lineExtremities.target"),component:e.jsx(C,{ml:"auto",size:"sm",variant:"link",onClick:x,children:a}),oneLine:!0,minW:"full"},{type:"input",label:t("panel.details.lineExtremities.targetName"),value:m,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.lineExtremities.title")}),e.jsx(U,{fields:g,minW:130})]})}function He(){const{t}=R(),i=P(),o=d.useCallback(()=>{i(w(s.current.export())),i(T()),i(v())},[i,T,v,w]),{selected:u,refresh:{nodes:p}}=A(l=>l.runtime),[n]=u,s=d.useRef(window.graph),[a,c]=d.useState({x:0,y:0});d.useEffect(()=>{if(n!=null&&n.startsWith("stn")||n!=null&&n.startsWith("misc_node_")){const l=s.current.getNodeAttribute(n,"x"),m=s.current.getNodeAttribute(n,"y");c({x:l,y:m})}},[p,u]);const r=[{type:"input",label:t("panel.details.nodePosition.pos.x"),value:a.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{s.current.mergeNodeAttributes(n,{x:Number(l)}),o()}},{type:"input",label:t("panel.details.nodePosition.pos.y"),value:a.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{s.current.mergeNodeAttributes(n,{y:Number(l)}),o()}}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.nodePosition.title")}),e.jsx(U,{fields:r,minW:130})]})}const Z={...V,...Ie},Ue=()=>{var c;const t=P(),{selected:i}=A(r=>r.runtime),{t:o}=R(),[u]=i,p=window.graph.getNodeAttribute(u,"type"),n=p in Z&&Z[p].attrsComponent,s=(c=window.graph.getNodeAttribute(u,p))!=null?c:{},a=(r,l)=>{const m=window.graph.getNodeAttribute(r,"type");window.graph.mergeNodeAttributes(r,{[m]:l}),t(w(window.graph.export())),t(T())};return n?e.jsx(n,{id:u,attrs:s,handleAttrsUpdate:a}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Ve=()=>{var S,b;const t=P(),{preference:{autoParallel:i}}=A(y=>y.app),{selected:o}=A(y=>y.runtime),{t:u}=R(),[p]=o,{type:n,style:s,parallelIndex:a,reconcileId:c}=window.graph.getEdgeAttributes(p),r=(S=window.graph.getEdgeAttribute(p,n))!=null?S:{},l=n in I&&I[n].attrsComponent,m=(b=window.graph.getEdgeAttribute(p,s))!=null?b:{},h=s in O&&O[s].attrsComponent,f=(y,N)=>{let E=-1;if(i){const[L,k]=window.graph.extremities(y);E=ae(window.graph,n,L,k,N)}window.graph.setEdgeAttribute(y,"parallelIndex",E)},x=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[n]:N}),t(w(window.graph.export())),t(v())},g=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[s]:N}),t(w(window.graph.export())),t(v())};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:p,attrs:r,recalculateParallelIndex:f,handleAttrsUpdate:x,parallelIndex:a}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:u("panel.details.unknown.error",{category:u("panel.details.unknown.linePath")})}),h?e.jsx(h,{id:p,attrs:m,handleAttrsUpdate:g,reconcileId:c}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:u("panel.details.unknown.error",{category:u("panel.details.unknown.lineStyle")})})]})},Ye=()=>{const{t}=R(),i=P(),o=d.useRef(window.graph),u=d.useCallback(()=>{i(w(o.current.export())),i(T()),i(v())},[i,T,v,w]),{activeSubscriptions:p}=A(x=>x.account),{selected:n,isDetailsOpen:s,count:{masters:a}}=A(x=>x.runtime),[c]=n,r=!p.RMP_CLOUD&&a+1>je,l=()=>{ve()?i(Te()):i(D())},m=x=>{const g=structuredClone(o.current.getNodeAttributes(x));g.x+=50,g.y+=50;const S=x.startsWith("stn")?"stn_".concat(q(10)):"misc_node_".concat(q(10));o.current.addNode(S,g),i(w(o.current.export())),i(T())},h=x=>{const g=Le(o.current,x);navigator.clipboard.writeText(g)},f=x=>{i(D()),x.forEach(g=>{o.current.hasNode(g)?o.current.dropNode(g):o.current.hasEdge(g)&&o.current.dropEdge(g)}),u()};return e.jsxs(we,{isOpen:s==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(Ae,{onClose:l,children:t("panel.details.header")}),e.jsxs(Ce,{children:[e.jsx(Be,{}),n.size===1&&o.current.hasNode(c)&&e.jsx(He,{}),n.size===1&&o.current.hasEdge(c)&&e.jsx(Fe,{}),n.size===1&&e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.specificAttrsTitle")}),window.graph.hasNode(c)&&e.jsx(Ue,{}),window.graph.hasEdge(c)&&e.jsx(Ve,{})]})]}),e.jsx(Ne,{children:e.jsxs(_,{children:[n.size===1&&o.current.hasNode(c)&&e.jsx(C,{size:"sm",variant:"outline",onClick:()=>m(c),isDisabled:o.current.getNodeAttributes(c).type===Ee.Master&&r,children:t("panel.details.footer.duplicate")}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>h(n),children:t("panel.details.footer.copy")}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>f(n),children:t("panel.details.footer.remove")})]})})]})};export{Ye as default};
