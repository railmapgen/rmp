import{j as e,ag as Q,M as Z,ah as ee,J,K as se,L as X,h as Rs,ai as ft,N as m,B as k,aj as _e,ak as De,T as oe,al as ie,b as ae,q as ns,t as E,O as ue,am as jt,an as wt,ao as Ce,R as I,ap as P,Q as Zs,aq as ys,ar as Cs,a2 as ne,as as vs,at as he,x as de,au as rs,U as ps,V as us,X as Es,Y as Ns,av as bt,G as St,H as yt,n as Js,a8 as Xs,e as qs,w as Qs,m as et,E as st,aw as ke,ax as Ct,a7 as ve,a1 as vt,ay as _t,az as kt,aA as V,aB as Is,aC as Ot,aD as R,aE as M,aF as Mt,k as At,W as le}from"./chakra-BSDUEdZw.js";import{u as Tt,r as z,C as zt,M as _s,d as tt,n as xs,S as W,R as Ls,a as nt,b as L,c as H,e as $,f as Rt,g as Et,h as Nt,i as It,j as Ie,k as Me,E as be,s as Lt,l as Ze,L as os,m as Dt,o as Ds,p as Pt,q as ks,t as Os,v as q,w as K,x as re,y as rt,z as Bt,A as ot,B as gs,D as Ae,F as We,G as Ps,H as Bs,I as Wt,J as Gt,K as Ut,N as Ws,O as $t,P as Gs,Q as Ht,T as Ft,U as Vt,V as Yt,W as Kt,X as Zt,Y as Jt,Z as Xt,_ as qt,$ as Qt,a0 as en,a1 as sn,a2 as tn,a3 as nn,a4 as rn,a5 as on,a6 as Ve,a7 as an,a8 as ln,a9 as fe,aa as cn,ab as dn,ac as hn,ad as pn,ae as xe,af as un,ag as xn,ah as Us,ai as gn,aj as is,ak as mn,al as fn,am as jn,an as wn,ao as bn,ap as Sn,aq as yn,ar as Cn,as as vn,at as _n,au as kn}from"./index-xHipk43R.js";import{u as G,b as f,a as Ye,T as $s}from"./react-BsdiJPLR.js";import{d as ms,m as On,a as Mn,i as An,s as Tn,M as zn}from"./master-manager-0jpqj3uV.js";import{C as Rn}from"./change-type-modal-MdajiAji.js";var Hs=function(s){return Tt(z.ready(),s)};const En=s=>{const{isOpen:l,onClose:a}=s,{t:n}=G(),r=z.getAppVersion();return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:n("header.about.title")}),e.jsx(se,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(Rs,{direction:"row",children:[e.jsx(ft,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(Rs,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(m,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),e.jsx(m,{children:r}),e.jsx(m,{}),e.jsx(m,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(k,{margin:5,children:e.jsx(m,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(_e,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(_e,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),e.jsxs(De,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(m,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(m,{fontSize:"sm",children:n("header.about.langonginc")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(_e,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),e.jsxs(De,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.Swiftiecott")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(m,{fontSize:"sm",mb:1,children:n("header.about.Minwtraft")})]})]})]}),e.jsx(_e,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(De,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(m,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(m,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(_e,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs(De,{children:[e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(m,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(oe,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(ie,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ae,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(m,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Ge(s){const l=s.sizes.shift(),a=Math.max(Math.ceil(l[0]),1),n=Math.max(Math.ceil(l[1]),1),r=[a-1,n-1,1,1],i=performance.now(),t=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let c,d;t?(c=new OffscreenCanvas(1,1),d=new OffscreenCanvas(a,n)):(c=document.createElement("canvas"),c.width=1,c.height=1,d=document.createElement("canvas"),d.width=a,d.height=n);const g=c.getContext("2d"),j=d.getContext("2d");j&&(j.fillRect.apply(j,r),g.drawImage(d,a-1,n-1,1,1,0,0,1,1));const u=g&&g.getImageData(0,0,1,1).data[3]!==0,o=parseInt(performance.now()-i);return[c,d].forEach(p=>{p.height=0,p.width=0}),t?(postMessage({width:a,height:n,testTime:o,isTestPass:u}),!u&&s.sizes.length&&setTimeout(()=>{Ge(s)},0)):u?s.onSuccess({width:a,height:n,testTime:o}):(s.onError({width:a,height:n,testTime:o}),s.sizes.length&&setTimeout(()=>{Ge(s)},0)),u}const as={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Oe={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Le={};function ls(s){const l=s.width===s.height,a=s.height===1,n=s.width===1,r=[];if(!s.width||!s.height)s.sizes.forEach(i=>{const t=l||a?i:1,c=l||n?i:1;r.push([t,c])});else{const i=s.min||Oe.min,t=s.step||Oe.step;let c=Math.max(s.width,s.height);for(;c>=i;){const d=l||a?c:1,g=l||n?c:1;r.push([d,g]),c-=t}}return r}function Ke(s){const l=typeof window<"u",a=l&&"Promise"in window,n=l&&"HTMLCanvasElement"in window,r=l&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),t=performance.now(),{onError:c,onSuccess:d,...g}=s,j=()=>parseInt(performance.now()-t);let u=null;if(!n)return!1;if(s.useWorker&&r){const o="\n            var canvasTest = ".concat(Ge.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),p=new Blob([o],{type:"application/javascript"}),h=URL.createObjectURL(p);u=new Worker(h),URL.revokeObjectURL(h),u.onmessage=function(x){const{width:b,height:y,testTime:w,isTestPass:S}=x.data,_={width:b,height:y,testTime:w,totalTime:j()};S?(Le[i].onSuccess(_),delete Le[i]):Le[i].onError(_)}}if(a)return new Promise(o=>{const p={...s,onError(h){let{width:x,height:b,testTime:y}=h;const w={width:x,height:b,testTime:y,totalTime:j()};let S;if(s.sizes.length===0)S=!0;else{const[[_,C]]=s.sizes.slice(-1);S=x===_&&b===C}c(w),S&&o({...w,success:!1})},onSuccess(h){let{width:x,height:b,testTime:y}=h;const w={width:x,height:b,testTime:y,totalTime:j()};d(w),o({...w,success:!0})}};if(u){const{onError:h,onSuccess:x}=p;Le[i]={onError:h,onSuccess:x},u.postMessage(g)}else Ge(p)});if(u)Le[i]={onError:c,onSuccess:d},u.postMessage(g);else return Ge(s)}const Nn={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=ls({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...as.area]}),a={...Oe,...s,sizes:l};return Ke(a)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=ls({width:1,height:s.max,min:s.min,step:s.step,sizes:[...as.height]}),a={...Oe,...s,sizes:l};return Ke(a)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=ls({width:s.max,height:1,min:s.min,step:s.step,sizes:[...as.width]}),a={...Oe,...s,sizes:l};return Ke(a)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l={...Oe,...s};return l.sizes=[...l.sizes],l.width&&l.height&&(l.sizes=[[l.width,l.height]]),Ke(l)}};var Ue=(s=>(s.left="l",s.right="r",s))(Ue||{}),we=(s=>(s.through="through",s.nonThrough="nonthrough",s))(we||{}),Je=(s=>(s.local="local",s.express="express",s.direct="direct",s))(Je||{}),ge=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(ge||{}),Ms=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Ms||{});const pe=new Set,fs=new Set,js=new Set,ws=new Set,it=new Map,me=new Map,cs=new Set,ds=new Map,Y=new Map;let D=[],Pe=0;const Be=new Map,hs=new Map,bs=new Set,In={localisedName:{en:"LEFT END"},num:"00",services:[Je.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:Ue.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Ln={localisedName:{en:"RIGHT END"},num:"00",services:[Je.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ue.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Dn={},at={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:ge.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Ue.right,platform_num:"1",theme:[zt.Shanghai,"sh1","#E3002B",_s.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Dn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Ms.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Pn={localisedName:{},num:"",services:[Je.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ue.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},T=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),As=s=>tt.has(s),Bn=s=>{if(As(s.style))return structuredClone(s[s.style].color)},Wn=(s,l)=>{const[a,n]=s.extremities(l),r=s.getEdgeAttributes(l),i=r.style;if(a!=n&&As(i)){const t=Bn(r);ws.has(T(t))||(js.add(t),ws.add(T(t)),it.set(t,a),me.set(T(t),new Set)),me.get(T(t)).add(a),me.get(T(t)).add(n),Y.has(a)?D.push({target:n,next:Y.get(a),color:t}):D.push({target:n,next:-1,color:t}),Y.set(a,Pe),Pe++,Y.has(n)?D.push({target:a,next:Y.get(n),color:t}):D.push({target:a,next:-1,color:t}),Y.set(n,Pe),Pe++}},lt=(s,l,a)=>{if(me.get(T(a)).has(s)){me.get(T(a)).delete(s);for(let n=Y.get(s);n!=-1;n=D[n].next){const r=D[n].target,i=D[n].color;T(i)==T(a)&&lt(r,s,a)}}},ct=(s,l,a)=>{if(pe.has(s))return;pe.add(s);let n=0;const r=new Set;for(let i=Y.get(s);i!=-1;i=D[i].next){const t=D[i].target,c=D[i].color;T(c)==T(a)&&(r.has(t)||(r.add(t),n++,t!=l&&ct(t,s,a)))}Be.set(s,n)},Fs=(s,l)=>{const a=s.stn_list.lineend.parents;a.push(l),s.stn_list.lineend.parents=structuredClone(a).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[we.through,a[1]]:void 0}},Gn=(s,l)=>{let a=0;for(let n=Y.get(s);n!=-1;n=D[n].next){D[n].target;const r=D[n].color;T(r)==T(l)&&a++}return a},dt=(s,l,a)=>{if(bs.has(s))return[];bs.add(s);const n=[];for(let r=Y.get(s);r!=-1;r=D[r].next){const i=D[r].target,t=D[r].color;i!=l&&T(t)==T(a)&&(i.startsWith("stn")?n.push(i):n.push(...dt(i,s,a)))}return n},Ss=(s,l,a,n,r,i,t)=>{var o;if(pe.has(s)&&(!s.startsWith("misc_node_")&&t.stn_list[s]==null||s.startsWith("misc_node_")&&!fs.has(s)||t.loop))return[];if(pe.has(s)&&t.stn_list[s]!=null&&Gn(s,i)-1>=2){const p=[...t.stn_list[s].parents,l];if(t.stn_list[p[1]]==null){const b=p[0];p[0]=p[1],p[1]=b}t.stn_list[s].parents=structuredClone(p).reverse(),t.stn_list[s].branch={...t.stn_list[s].branch,left:[we.through,p[1]]};const h=[];for(const b of t.stn_list[s].children)b!=l&&h.push(b);t.stn_list[s].children=structuredClone(h),(o=t.stn_list[s].branch)==null||delete o.right;const x=[];for(const b of t.stn_list.lineend.parents)b!=s&&x.push(b);return t.stn_list.lineend.parents=structuredClone(x).reverse(),t.stn_list.lineend.branch={...t.stn_list.lineend.branch,left:t.stn_list.lineend.parents.length==2?[we.through,x[1]]:void 0},h.length==0&&(t.stn_list[s].children=["lineend"],Fs(t,s)),[s]}pe.add(s);const c=[],d=[],g=[],j=new Set,u=new Set;for(let p=Y.get(s);p!=-1;p=D[p].next){const h=D[p].target,x=D[p].color;if(h!=a){if(T(x)==T(i)){if(u.has(h))continue;if(u.add(h),s.startsWith("misc_node_")){const b=Ss(h,l,s,n+1,r,i,t);b.length!=0&&c.push(...b)}else{const b=Ss(h,s,s,n+1,r,i,t);b.length!=0&&c.push(...b)}}if(!j.has(T(x))&&T(x)!=T(i)){j.add(T(x));const b={theme:x,name:["ch_".concat(T(x)),"en_".concat(T(x))]};g.push(b)}}}if(c.length==2){for(let p=0;p<2;p++)c[p]=="lineend"&&c.splice(p,1);if(t.stn_list[c[1]].parents.length>=2){const p=c[0];c[0]=c[1],c[1]=p}}if(pe.has(s)&&t.stn_list[s]!=null){const p=[];for(const h of t.stn_list.lineend.parents)h!=s&&p.push(h);t.stn_list.lineend.parents=structuredClone(p).reverse(),t.stn_list.lineend.branch={...t.stn_list.lineend.branch,left:t.stn_list.lineend.parents.length==2?[we.through,p[1]]:void 0},c.length==0&&(bs.clear(),d.push(...dt(s,l,i)))}if(s.startsWith("misc_node_"))return fs.add(s),c;{const p=r.getNodeAttributes(s).type,h=r.getNodeAttributes(s)[p];if(t.stn_list[s]=structuredClone(Pn),t.stn_list[s].localisedName={zh:h.names[0],en:h.names[1]},t.stn_list[s].num=String(n),r.getNodeAttributes(s).type==W.GzmtrBasic){const x=h;t.stn_list[s].num=x.stationCode,(x.secondaryNames[0]!==""||x.secondaryNames[1]!=="")&&(t.stn_list[s].localisedSecondaryName={zh:x.secondaryNames[0],en:x.secondaryNames[1]})}if(r.getNodeAttributes(s).type==W.GzmtrInt){const x=h,b=x.transfer[0];for(const y of b)if(T(y)==T(i)){t.stn_list[s].num=String(y[5]);break}(x.secondaryNames[0]!==""||x.secondaryNames[1]!=="")&&(t.stn_list[s].localisedSecondaryName={zh:x.secondaryNames[0],en:x.secondaryNames[1]})}return c.length!=0?(t.stn_list[s].children=structuredClone(c).reverse(),c.length==2&&(t.stn_list[s].branch={...t.stn_list[s].branch,right:[we.through,c[1]]})):(t.stn_list[s].children=["lineend"],Fs(t,s)),d.push(l),t.stn_list[s].parents=structuredClone(d).reverse(),d.length==2&&(t.stn_list[s].branch={...t.stn_list[s].branch,left:[we.through,d[1]]}),g.length!=0&&(t.stn_list[s].transfer.groups[0].lines=structuredClone(g)),[s]}},Un=(s,l,a,n)=>{const r=structuredClone(at);n=="LOOP"&&(r.loop=!0);let i;switch(s.getNodeAttributes(a).type){case W.GzmtrBasic:case W.GzmtrInt:i=ge.GZMTR;break;case W.MTR:i=ge.MTR;break;default:i=ge.SHMetro;break}r.theme=structuredClone(l),r.style=i,r.stn_list.linestart=structuredClone(In),r.stn_list.lineend=structuredClone(Ln),pe.clear(),fs.clear();const t=Ss(a,"linestart","linestart",1,s,l,r);if(r.current_stn_idx=t[0],r.stn_list.linestart.children=[t[0]],!(Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3))return structuredClone(r)},$n=s=>{var n,r;pe.clear(),js.clear(),ws.clear(),it.clear(),me.clear(),cs.clear(),ds.clear(),Y.clear(),D=[],Pe=0,Be.clear(),hs.clear(),s.filterEdges(i=>i.startsWith("line")).forEach(i=>{As(s.getEdgeAttributes(i).style)&&Wn(s,i)});let l=0;s.forEachNode(i=>{hs.set(i,++l)}),hs.set("lineend",++l);const a=[];for(const i of js){let t=0;for(;me.get(T(i)).size!=0;){let c="line_root";me.get(T(i)).forEach(g=>{c=="line_root"&&(c=g)}),lt(c,"line_root",i);const d={theme:i,index:++t};cs.add(d),ds.set(d,c)}}for(const i of cs){const{theme:t}=i;pe.clear(),Be.clear(),ct(ds.get(i),"line_root",t);let c=!0,d="LINE";const g=[];for(const[u,o]of Be)o==1&&g.push(u),o==3&&(d="BRANCH"),o>3&&(c=!1);if(!c)continue;g.length==0&&(d="LOOP",Be.forEach((u,o)=>{g.push(o)}));const j=[];for(const u of g){const o=Un(s,t,u,d);o!=null&&j.push([o,(n=o.stn_list[o.current_stn_idx].localisedName.zh)!=null?n:"",(r=o.stn_list[o.current_stn_idx].localisedName.en)!=null?r:""])}j.length!=0&&a.push({id:xs(10),theme:t,param:structuredClone(j),type:d})}return a},Hn=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),Fn=(s,l)=>{let a=s;return l.forEach((n,r)=>{const i=new RegExp("ch_".concat(r),"g"),t=new RegExp("en_".concat(r),"g");a=a.replace(i,n[0]),a=a.replace(t,n[1])}),a},Vn=(s,l,a,n)=>{s.line_name=l,s.line_num=String(a),ms("RMG_".concat(Hn(l),".json"),"application/json",Fn(JSON.stringify(s),n))},Yn={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Kn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=G(),r=f.useRef(window.graph),[i,t]=f.useState(!1),[c,d]=f.useState([[at,"",""]]),[g,j]=f.useState(["","",""]),[u,o]=f.useState(new Map),[p,h]=f.useState(new Map),[x,b]=f.useState([]);f.useEffect(()=>{if(l){const w=$n(r.current),S=new Map;w.forEach(({id:_,theme:C})=>{S.set(T(C),_)}),b(w),o(S)}},[l]);const y=(w,S)=>document.getElementById("2RMG_"+S+"_"+w).value.trim();return e.jsxs(Q,{isOpen:l,onClose:a,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:e.jsx(m,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")})}),e.jsx(se,{}),e.jsxs(X,{children:[e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info1")}),e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info2")}),e.jsx("br",{}),x.length===0?e.jsx(m,{fontSize:"md",children:n("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:x.map(({id:w,theme:S,param:_,type:C})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Ls,{name:S[0]=="other"&&S[1]=="other"?S[2]:S[1],bg:S[2],fg:S[3]})}),e.jsx("td",{children:e.jsx(ns,{placeholder:n("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(ns,{placeholder:n("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(ns,{placeholder:n("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(w),size:"sm"})}),e.jsx("td",{children:e.jsx(Ls,{name:n("header.download.2rmg.type.".concat(C.toLowerCase())),bg:Yn[C],fg:_s.white})}),e.jsx("td",{children:e.jsx(E,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const v=y(w,"nameCh"),A=y(w,"nameEn"),B=y(w,"lineNum"),U=new Map;u.forEach((F,te)=>{U.set(te,[y(F,"nameCh"),y(F,"nameEn")])}),d(_),j([v,A,B]),h(U),t(!0)},size:"sm",children:e.jsx(nt,{})})})]},w))})})]}),e.jsx(ue,{children:e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:n("close")})})]}),e.jsx(Zn,{isOpen:i,onClose:()=>t(!1),param:c,nameList:g,interchangeName:p})]})},Zn=s=>{const{isOpen:l,onClose:a,param:n,nameList:r,interchangeName:i}=s,{t}=G(),[c,d]=f.useState("");return f.useEffect(()=>{r[0]!=""&&r[1]!=""?d(r[0]+"/"+r[1]):r[0]!=""?d(r[0]):r[1]!=""?d(r[1]):d("")},[...r]),e.jsxs(Q,{isOpen:l,onClose:a,size:"md",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:e.jsxs(m,{as:"b",fontSize:"xl",children:[t("header.download.2rmg.download")," ",c]})}),e.jsx(se,{}),e.jsx(X,{children:e.jsxs(jt,{children:[e.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:t("header.download.2rmg.downloadInfo")}),n.map(([g,j,u])=>e.jsxs(E,{onClick:()=>{Vn(g,[r[0],r[1]],r[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[j.replaceAll("\n","⏎"),"/",u.replaceAll("\n","⏎")]},"".concat(j).concat(u)))]})}),e.jsx(ue,{children:e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:t("close")})})]})]})},Jn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=G();return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:n("header.download.termsAndConditions")}),e.jsx(se,{}),e.jsx(X,{children:e.jsxs(wt,{children:[e.jsxs(Ce,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(I,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(P,{as:L})]}),", ",e.jsxs(I,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(P,{as:L})]})," or ",e.jsxs(I,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(P,{as:L})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(I,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(P,{as:L})]}),"，",e.jsxs(I,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(P,{as:L})]}),"或",e.jsxs(I,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(P,{as:L})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(Ce,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(I,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(P,{as:L})]})," and ",e.jsxs(I,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(P,{as:L})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(I,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(P,{as:L})]}),"及",e.jsxs(I,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(P,{as:L})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(Ce,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(I,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(P,{as:L})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(I,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(P,{as:L})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(Ce,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(Ce,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(I,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(P,{as:L})]})," ","– the open-source emoji and icon project. License:",e.jsxs(I,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(P,{as:L})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(I,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(P,{as:L})]}),"所设计。许可证：",e.jsxs(I,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(P,{as:L})]})]}),e.jsxs(Ce,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Xn(){const s=Zs("white","var(--chakra-colors-gray-800)"),l=H(),{activeSubscriptions:{RMP_EXPORT:a}}=$(O=>O.account),{telemetry:{project:n}}=$(O=>O.app),r=$(O=>O.param),i=z.isAllowAnalytics(),{t}=G(),c=f.useRef(window.graph),[d,g]=f.useState("png"),j={png:t("header.download.png"),svg:t("header.download.svg")},[u,o]=f.useState(2),[p,h]=f.useState({width:1,height:1,benchmark:.001}),[x,b]=f.useState(200),y=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],w=Object.fromEntries(y.map(O=>[O,"".concat(O,"%")])),[S,_]=f.useState([]),[C,v]=f.useState(!1),A=[{type:"select",label:t("header.download.format"),value:d,options:j,onChange:O=>g(O==="png"?"png":"svg")}],B=[{type:"select",label:t("header.download.svgVersion"),value:u,options:{1.1:t("header.download.svg1.1"),2:t("header.download.svg2")},onChange:O=>{o(O),O===1.1&&He(!0)}}],U=[{type:"select",label:t("header.download.scale"),value:x,options:w,onChange:O=>b(O)},{type:"switch",label:t("header.download.transparent"),isChecked:C,onChange:v}],[F,te]=f.useState(!1),[Xe,$e]=f.useState(!1),[Te,He]=f.useState(!1),[ze,qe]=f.useState(!1),[N,pt]=f.useState(!1),[ut,Fe]=f.useState(!1),[xt,Ts]=f.useState(!1);f.useEffect(()=>{(async()=>{const Re=await Nn.maxArea({usePromise:!0,useWorker:!0});h(Re)})()},[]),f.useEffect(()=>{if(F){const{xMin:O,yMin:Re,xMax:Qe,yMax:Ee}=Rt(c.current),[es,Se]=[Qe-O,Ee-Re],Ne=y.filter(ye=>es*ye/100>p.width&&Se*ye/100>p.height);_(Ne)}},[F]);const gt=()=>{i&&z.event(be.DOWNLOAD_PARAM,n?{"#nodes":c.current.order,"#edges":c.current.size}:{}),ms("RMP_".concat(new Date().valueOf(),".json"),"application/json",Lt(r))},mt=async()=>{Fe(!0),i&&z.event(be.DOWNLOAD_IMAGES,n?{numberOfNodes:c.current.order,numberOfEdges:c.current.size}:{});const{elem:O,width:Re,height:Qe}=await On(c.current,ze,Te,u),Ee=O.outerHTML.replace(/&nbsp;/g," ");if(d==="svg"){ms("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Ee),Fe(!1);return}if(Ie){window.parent.__TAURI__.core.invoke("render_image",{svgString:Ee,scale:x,isTransparent:C,isSystemFontsOnly:Te}).then(()=>Fe(!1));return}document.body.appendChild(O);const es="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Ee)));document.body.removeChild(O),O.remove();const Se=document.createElement("canvas"),[Ne,ye]=[Re*x/100,Qe*x/100];Se.width=Ne,Se.height=ye;const ss=Se.getContext("2d");C||(ss.fillStyle=s,ss.fillRect(0,0,Ne,ye));const ts=new Image;ts.onload=()=>{setTimeout(()=>{ss.drawImage(ts,0,0,Ne,ye),Se.toBlob(zs=>{if(Fe(!1),!zs){l(Ze({status:"error",message:t("header.download.imageTooBig")}));return}Mn("RMP_".concat(new Date().valueOf(),".png"),zs)},"image/png")},An()?2e3:0)},ts.src=es};return e.jsxs(ys,{id:"download",children:[e.jsx(Cs,{as:ne,size:"sm",variant:"ghost",icon:e.jsx(nt,{})}),e.jsxs(vs,{children:[e.jsx(he,{icon:e.jsx(Et,{}),onClick:gt,children:t("header.download.config")}),e.jsxs(he,{icon:e.jsx(Nt,{}),onClick:()=>Ts(!0),children:[t("header.download.2rmg.title"),e.jsx(de,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(he,{icon:e.jsx(It,{}),onClick:()=>te(!0),children:t("header.download.image")})]}),e.jsxs(Q,{size:"xl",isOpen:F,onClose:()=>te(!1),children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:t("header.download.image")}),e.jsx(se,{}),e.jsxs(X,{children:[e.jsx(Me,{fields:A}),d==="svg"&&e.jsx(Me,{fields:B}),d==="png"&&e.jsx(Me,{fields:U}),e.jsx("br",{}),e.jsx(rs,{isChecked:Te,isDisabled:d==="svg"&&u===1.1,onChange:O=>He(O.target.checked),children:e.jsx(m,{children:t("header.download.isSystemFontsOnly")})}),e.jsx(rs,{id:"share_info",isChecked:ze,onChange:O=>qe(O.target.checked),children:e.jsxs(m,{children:[t("header.download.shareInfo1"),e.jsxs(I,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(P,{as:L})]}),t("header.download.shareInfo2")]})}),e.jsx(rs,{id:"agree_terms",isChecked:N,onChange:O=>pt(O.target.checked),children:e.jsxs(m,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(I,{color:"teal.500",onClick:()=>$e(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(P,{as:L})]}),t("header.download.period")]})}),d==="png"&&S.includes(x)&&!Ie&&e.jsxs(ps,{status:"error",mt:"4",children:[e.jsx(us,{}),e.jsxs(k,{children:[e.jsx(Es,{children:t("header.download.disabledScaleOptions")}),e.jsx(Ns,{children:t("header.download.disabledScaleOptionsSolution")})]})]}),d==="png"&&S.includes(x)&&Ie&&!a&&e.jsxs(ps,{status:"error",mt:"4",children:[e.jsx(us,{}),e.jsxs(k,{children:[e.jsx(Es,{children:t("header.download.disabledScaleOptions")}),e.jsx(Ns,{children:t("header.settings.pro")})]})]})]}),e.jsx(ue,{children:e.jsx(bt,{children:e.jsx(E,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!N||d==="png"&&S.includes(x)&&!Ie||d==="png"&&S.includes(x)&&Ie&&!a,isLoading:ut,onClick:mt,children:t("header.download.confirm")})})}),e.jsx(Jn,{isOpen:Xe,onClose:()=>$e(!1)})]})]}),e.jsx(Kn,{isOpen:xt,onClose:()=>Ts(!1)})]})}function ht(s){const{isOpen:l,onClose:a,onConfirm:n}=s,{t:r}=G(),i=f.useRef(null);return e.jsx(St,{isOpen:l,leastDestructiveRef:i,onClose:a,children:e.jsx(Z,{children:e.jsxs(yt,{children:[e.jsx(J,{fontSize:"lg",fontWeight:"bold",children:r("header.open.confirmOverwrite.title")}),e.jsx(X,{children:r("header.open.confirmOverwrite.body")}),e.jsxs(ue,{children:[e.jsx(E,{ref:i,onClick:a,children:r("cancel")}),e.jsx(E,{id:"confirm_overwrite",colorScheme:"red",onClick:n,ml:3,children:r("header.open.confirmOverwrite.overwrite")})]})]})})})}const qn=(s,{info_panel_type:l,line_num:a,stn_list:n,style:r,theme:i},t,c,d)=>{const g=Object.fromEntries(Object.keys(n).filter(o=>!["linestart","lineend"].includes(o)).map(o=>[o,"stn_".concat(xs(10))]));Object.entries(n).filter(([o,p])=>!["linestart","lineend"].includes(o)).forEach(([o,p])=>{const h=s.filterNodes((x,b)=>Object.values(W).includes(b.type)&&b[b.type].names[0]===p.localisedName.zh);h.length!==0&&(g[o]=h[0])});const j=[["linestart",-1,0]],u={};for(;j.length;){const[o,p,h]=j.shift();n[o].children.filter(b=>b!="lineend").forEach((b,y)=>{const w=Math.max(y,h+y);u[b]={x:p*150,y:w*75},j.push([b,p+1,w])})}Object.entries(n).filter(([o,p])=>!["linestart","lineend"].includes(o)).filter(([o,p])=>s.filterNodes((h,x)=>Object.values(W).includes(x.type)&&x[x.type].names[0]===p.localisedName.zh).length===0).map(([o,p])=>{var w,S,_;let h=W.ShmetroBasic;const x=p.transfer.groups,b=x.map(C=>{var v;return(v=C.lines)!=null?v:[]}).flat();r===ge.SHMetro?b.length>0?h=W.ShmetroInt:l===Ms.sh2020?h=W.ShmetroBasic2020:h=W.ShmetroBasic:r===ge.GZMTR?b.length>0?h=W.GzmtrInt:h=W.GzmtrBasic:r===ge.MTR&&(h=W.MTR);const y={...structuredClone(Tn[h].defaultAttrs),names:[(w=p.localisedName.zh)!=null?w:"",(S=p.localisedName.en)!=null?S:""]};return h===W.ShmetroBasic2020?y.color=i:h===W.GzmtrBasic?(y.color=i,y.lineCode=a,y.stationCode=p.num):h===W.GzmtrInt?y.transfer=x.map((C,v)=>{var B,U;const A=(U=(B=C.lines)==null?void 0:B.map(F=>{var te;return[...(te=F.theme)!=null?te:i,"1","01"]}))!=null?U:[];return v===0?[[...i,a,p.num],...A]:A}):h===W.MTR&&((_=x[0].lines)!=null&&_.length?y.transfer=[[[...i,"",""],...x[0].lines.map(C=>{var v;return[...(v=C.theme)!=null?v:i,"",""]})]]:y.transfer=[[]]),{node:g[o],attr:{visible:!0,zIndex:0,x:t+u[o].x,y:c+u[o].y,type:h,[h]:y}}}).forEach(({node:o,attr:p})=>s.addNode(o,p)),Object.entries(n).filter(([o,p])=>!["linestart","lineend"].includes(o)).forEach(([o,p])=>{p.children.filter(h=>!["linestart","lineend"].includes(h)).forEach(h=>{const x=os.Diagonal,[b,y]=[g[o],g[h]],w=d?Dt(s,x,b,y,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(xs(10)),b,y,{visible:!0,zIndex:0,type:x,[os.Diagonal]:structuredClone(Pt[os.Diagonal].defaultAttrs),style:Ds.SingleColor,[Ds.SingleColor]:{color:i},reconcileId:"",parallelIndex:w})})})},Qn="rmg-bridge--",er={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function sr(s){const{isOpen:l,onClose:a}=s,{t:n}=G(),{preference:{autoParallel:r}}=$(y=>y.app),{svgViewBoxZoom:i,svgViewBoxMin:t}=$(y=>y.param),c=H(),d=z.isAllowAnalytics(),g=ks(),{height:j,width:u}=Os(g),o=Ye.useRef(window.graph),[p]=Ye.useState(crypto.randomUUID()),h="/rmg/#/import?"+new URLSearchParams({parentComponent:z.getAppName(),parentId:p}),x=Ye.useCallback(()=>{c(q()),c(K()),c(re(o.current.export()))},[c,q,K,re,o]),b=y=>{try{d&&z.event(be.IMPORT_RMG_PARAM,{});const w=t.x+u*i/100/3,S=t.y+j*i/100/3;qn(o.current,y,w,S,r),x()}catch(w){c(Ze({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",w)}finally{a()}};return Ye.useEffect(()=>{const y=new BroadcastChannel(Qn+p);return y.onmessage=w=>{const{event:S,data:_}=w.data;console.log("[rmp] Received event from RMG app clip:",S),S==="CLOSE"?a():S==="IMPORT"&&b(_)},()=>y.close()},[t.x,t.y,i,j,u,r]),e.jsx(rt,{isOpen:l,onClose:a,sx:er,children:e.jsx("iframe",{src:h,loading:"lazy"})})}const tr="RMP_GALLERY_CHANNEL",nr="OPEN_TEMPLATE",Vs=new BroadcastChannel(tr),rr={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function or(s){const{isOpen:l,onClose:a}=s,{t:n}=G(),r=H(),{isOpen:i,onOpen:t,onClose:c}=Js(),[d,g]=f.useState(null),{telemetry:{project:j}}=$(w=>w.app),u=z.isAllowAnalytics(),o=f.useRef(window.graph),p=f.useCallback(()=>{r(q()),r(K()),r(re(o.current.export()))},[r,q,K,re,o]),h=async w=>{const{version:S,..._}=JSON.parse(await ot(JSON.stringify(w)));r(gs()),o.current.clear(),o.current.import(_.graph),p();const{svgViewBoxZoom:C,svgViewBoxMin:v}=_;typeof C=="number"&&r(Ae(C)),typeof v.x=="number"&&typeof v.y=="number"&&r(We(v))},x=async()=>{d&&await h(d),c(),g(null)},b=async(w,S)=>{var v;const _=S?"https://".concat(S):"",C=await((v=(await Promise.allSettled([fetch("".concat(_,"/rmp-gallery/resources/real_world/").concat(w,".json")),fetch("".concat(_,"/rmp-gallery/resources/fantasy/").concat(w,".json"))])).filter(A=>A.status==="fulfilled").find(A=>A.value.status===200))==null?void 0:v.value.json());if(C){if(g(C),t(),u){const A={id:w};j&&S&&(A.host=S),z.event(be.IMPORT_WORK_FROM_GALLERY,A)}z.sendNotification({title:n("header.open.importOK",{id:w}),message:n("header.open.importOKContent"),type:"success",duration:9e3})}else z.sendNotification({title:n("header.open.importFail",{id:w}),message:n("header.open.importFailContent"),type:"error",duration:9e3})},y=async w=>{try{const S=await fetch("".concat(Bt,"/").concat(w));if(S.status!==200)throw new Error(n("header.open.importFailContent"));const _=await S.json();g(_),t(),u&&z.event(be.IMPORT_WORK_FROM_SHARE,{share:w}),z.sendNotification({title:n("header.open.importOK",{id:w}),message:n("header.open.importOKContent"),type:"success",duration:9e3})}catch(S){z.sendNotification({title:n("header.open.importFail",{id:w}),message:S.message,type:"error",duration:9e3})}};return f.useEffect(()=>{const S=new URL(window.location.href).searchParams;if(S.size>0){const _=S.keys().next().value,C=_.indexOf("."),v=_.substring(0,C===-1?void 0:C);let A;C!==-1&&(A=_.substring(C+1)),A==="org"?y(v):b(v,A),z.updateAppMetadata({search:""})}},[]),f.useEffect(()=>(Vs.onmessage=w=>{const{event:S,data:_}=w.data;S===nr&&(b(_),a())},()=>Vs.close()),[]),e.jsxs(e.Fragment,{children:[e.jsxs(rt,{isOpen:l,onClose:a,size:"full",sx:rr,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(Xs,{onClick:a,position:"fixed",top:"5px",right:"15px"})]}),e.jsx(ht,{isOpen:i,onClose:c,onConfirm:x})]})}function ir(){const s=H(),{t:l}=G(),{isOpen:a,onOpen:n,onClose:r}=Js(),[i,t]=f.useState(null),c=ks(),{height:d}=Os(c),g=f.useRef(window.graph),j=f.useRef(null),[u,o]=f.useState(!1),[p,h]=f.useState(!1),x=f.useCallback(()=>{s(q()),s(K()),s(re(g.current.export()))},[s,q,K,re,g]),b=()=>{s(gs()),g.current.clear(),s(Ae(100)),s(We({x:0,y:0})),x()},y=async C=>{const{version:v,...A}=JSON.parse(await ot(C));s(gs()),g.current.clear(),g.current.import(A.graph),x();const{svgViewBoxZoom:B,svgViewBoxMin:U}=A;typeof B=="number"&&s(Ae(B)),typeof U.x=="number"&&typeof U.y=="number"&&s(We(U))},w=async()=>{if(i){await y(i);const C=await Ws();if(i.length===C.length){s(We({x:-10,y:-13}));const v=Math.max(0,Math.min(400,-.132*d+117.772));s(Ae(v)),z.event(be.LOAD_TUTORIAL,{})}}r(),t(null)},S=async C=>{var A;const v=(A=C.target.files)==null?void 0:A[0];if(console.log("OpenActions.handleUpload():: received file",v),(v==null?void 0:v.type)!=="application/json")s(Ze({status:"error",message:l("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const B=await ar(v);t(B),n()}catch(B){s(Ze({status:"error",message:l("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",B)}C.target.value=""},_=async()=>{const C=await Ws();t(C),n()};return f.useEffect(()=>{const C=async v=>{const{type:A,key:B,from:U}=v.data;if(A===$t.SAVE_CHANGED&&B===Gs.PARAM&&U==="rmt"){Ht.debug("Received save changed event on key: ".concat(B));const F=localStorage.getItem(Gs.PARAM);if(!F)return;await y(F)}};return Ps.addEventListener("message",C),()=>Ps.removeEventListener("message",C)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(ys,{children:[e.jsx(Cs,{as:ne,size:"sm",variant:"ghost",icon:e.jsx(Bs,{})}),e.jsxs(vs,{children:[e.jsx(he,{icon:e.jsx(Wt,{}),onClick:b,children:l("header.open.new")}),e.jsx("input",{id:"upload_project",ref:j,type:"file",accept:".json",hidden:!0,onChange:S,"data-testid":"file-upload"}),e.jsx(he,{icon:e.jsx(Bs,{}),onClick:()=>{var C;return(C=j==null?void 0:j.current)==null?void 0:C.click()},children:l("header.open.config")}),e.jsx(he,{icon:e.jsx(Gt,{}),onClick:()=>o(!0),children:l("header.open.projectRMG")}),e.jsxs(he,{icon:e.jsx(L,{}),onClick:()=>h(!0),children:[l("header.open.gallery"),e.jsx(de,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(he,{icon:e.jsx(Ut,{}),onClick:_,children:l("header.open.tutorial")})]}),e.jsx(sr,{isOpen:u,onClose:()=>o(!1)}),e.jsx(or,{isOpen:p,onClose:()=>h(!1)})]}),e.jsx(ht,{isOpen:a,onClose:r,onConfirm:w})]})}const ar=s=>new Promise(l=>{const a=new FileReader;a.onloadend=()=>l(a.result),a.readAsText(s)}),lr=()=>{const[s,l]=f.useState(!1),{t:a}=G(),n=H(),r=f.useRef(window.graph),i=ks(),{width:t,height:c}=Os(i),[d,g]=f.useState([]);f.useEffect(()=>{s&&g(r.current.nodes().filter(u=>u.startsWith("stn")).map(u=>{const o=r.current.getNodeAttributes(u),p=o.type,h=o[p].names.join("/");return{id:u,value:h}}))},[s]);const j=u=>{n(Kt(new Set([u])));const o=Math.max(0,Math.min(400,-.132*c+117.772)),{x:p,y:h}=Zt((t-300)/2,c/2,o,{x:-r.current.getNodeAttribute(u,"x"),y:-r.current.getNodeAttribute(u,"y")});n(Ae(o)),n(We({x:-p,y:-h}))};return e.jsxs(qs,{isOpen:s,onOpen:()=>l(!0),onClose:()=>l(!1),children:[e.jsx(Qs,{children:e.jsx(ne,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Ft,{}),onClick:()=>l(!s)})}),e.jsx(et,{children:e.jsx(st,{children:e.jsx(Vt,{label:a("header.search"),children:e.jsx(Yt,{data:d,displayHandler:u=>e.jsx(de,{children:u.value}),filter:(u,o)=>o.value.toLowerCase().includes(u.toLowerCase())||Object.values(o.value).some(p=>p.toLowerCase().includes(u.toLowerCase())),value:"",onChange:u=>j(u.id)})})})})]})},cr=s=>{const{isOpen:l,onClose:a}=s,n=H(),{t:r}=G(),i=f.useRef(window.graph),{theme:t,requestThemeChange:c}=Jt(),d=()=>{i.current.filterEdges((g,j,u,o,p,h,x)=>tt.has(j.style)&&JSON.stringify(j[j.style].color)===JSON.stringify(t)).forEach(g=>i.current.dropEdge(g)),n(K()),n(re(i.current.export())),a()};return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(se,{}),e.jsxs(X,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(Xt,{theme:t,onClick:c})]}),e.jsxs(ue,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:r("cancel")}),e.jsx(E,{colorScheme:"red",onClick:d,children:r("remove")})]})]})]})},dr=s=>{const{isOpen:l,onClose:a}=s,n=H(),{t:r}=G(),i=f.useRef(window.graph),[t,c]=f.useState(1),d=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:t.toString(),variant:"number",onChange:j=>c(Number(j)),minW:"full"}],g=()=>{i.current.forEachNode((j,u)=>{i.current.updateNodeAttribute(j,"x",o=>(o!=null?o:0)*t),i.current.updateNodeAttribute(j,"y",o=>(o!=null?o:0)*t)}),n(q()),n(K()),n(re(i.current.export())),a()};return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:r("header.settings.procedures.scale.title")}),e.jsx(se,{}),e.jsxs(X,{children:[r("header.settings.procedures.scale.content"),e.jsx(Me,{fields:d})]}),e.jsxs(ue,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:r("cancel")}),e.jsx(E,{colorScheme:"red",onClick:g,children:r("apply")})]})]})]})},hr=s=>{const{isOpen:l,onClose:a}=s,n=H(),{t:r}=G(),i=f.useRef(window.graph),[t,c]=f.useState(0),[d,g]=f.useState(0),j=[{type:"input",label:r("header.settings.procedures.translate.x"),value:t.toString(),variant:"number",onChange:o=>c(Number(o)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:d.toString(),variant:"number",onChange:o=>g(Number(o)),minW:"full"}],u=()=>{i.current.forEachNode((o,p)=>{i.current.updateNodeAttribute(o,"x",h=>(h!=null?h:0)+t),i.current.updateNodeAttribute(o,"y",h=>(h!=null?h:0)+d)}),n(q()),n(K()),n(re(i.current.export())),a()};return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:r("header.settings.procedures.translate.title")}),e.jsx(se,{}),e.jsxs(X,{children:[r("header.settings.procedures.translate.content"),e.jsx(Me,{fields:j})]}),e.jsxs(ue,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:r("cancel")}),e.jsx(E,{colorScheme:"red",onClick:u,children:r("apply")})]})]})]})},pr=s=>{const{isOpen:l,onClose:a}=s,n=H(),{preference:{unlockSimplePathAttempts:r}}=$(d=>d.app),{activeSubscriptions:i}=$(d=>d.account),{t}=G(),c=()=>{n(qt(-1))};return e.jsxs(Q,{isOpen:l,onClose:a,size:"5xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:t("header.settings.procedures.unlockSimplePath.title")}),e.jsx(se,{}),e.jsxs(X,{children:[e.jsx(m,{mb:"2",children:t("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(m,{mb:"2",children:t("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(m,{mb:"2",children:t("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(ue,{children:e.jsx(ke,{label:t("header.settings.pro"),isOpen:!i.RMP_CLOUD&&r>=0,children:e.jsx(E,{onClick:c,isDisabled:!i.RMP_CLOUD||r<0,children:r>=0?t("header.settings.procedures.unlockSimplePath.check"):t("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},ur=s=>{const{isOpen:l,onClose:a}=s,n=H(),r=Ct(),{t:i}=G(),t=f.useRef(window.graph),[c,d]=f.useState(!1),g=async()=>{d(!0);const j=JSON.stringify(t.current.export());try{const u=await mr(j);t.current.clear(),t.current.import(u),n(q()),n(K()),n(re(t.current.export())),r({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(u){console.error("[rmp] Error in updating all colors: ".concat(u)),r({title:i("header.settings.procedures.updateColor.error",{e:u}),status:"error",duration:9e3,isClosable:!0})}d(!1),a()};return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:i("header.settings.procedures.updateColor.title")}),e.jsx(se,{}),e.jsx(X,{children:e.jsx(m,{children:i("header.settings.procedures.updateColor.content")})}),e.jsxs(ue,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:i("cancel")}),e.jsx(E,{colorScheme:"red",onClick:g,isLoading:c,children:i("apply")})]})]})]})},Ys=s=>s.length>=4&&s.every(l=>typeof l=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(_s).includes(s[3]),xr=s=>{const l=[],a=(n,r)=>{if(Array.isArray(n)&&Ys(n)){l.push({path:r||"",value:n});return}for(const i in n){const t=n[i],c=r?"".concat(r,".").concat(i):i;Array.isArray(t)?Ys(t)?l.push({path:c,value:t}):t.forEach((d,g)=>a(d,"".concat(c,".").concat(g))):t&&typeof t=="object"&&a(t,c)}};return a(s),l},gr=(s,l,a)=>{const n=l.split(".");let r=s;for(let i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=a},mr=async s=>{const l=JSON.parse(s),a=new Date().getTime(),n=xr(l);console.log("[rmp] Found all themes pending for update",n);const r=1e4;let i,t=!1;const c=new Promise((d,g)=>{i=setTimeout(()=>{t=!0,g("Executing time exceeds ".concat(r,"ms"))},r),(async()=>{for(const{path:j,value:u}of n){if(t)throw new Error("Update aborted");const[o,p,h,x,...b]=u,y=await Qt([o,p,h,x]);gr(l,j,[...y,...b])}})().then(d).catch(g)});try{return await c,console.log("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-a)/1e3," sec")),l}finally{clearTimeout(i)}},Ks=1,fr=()=>{const s=H(),{state:l,token:a}=$(x=>x.account),{count:{stations:n,miscNodes:r,masters:i,lines:t,parallel:c}}=$(x=>x.runtime),{t:d}=G(),[g,j]=f.useState(!1),[u,o]=f.useState(Ks);f.useEffect(()=>{let x;return g&&u>0?x=window.setTimeout(()=>{o(u-1)},1e3):u===0&&j(!1),()=>clearTimeout(x)},[g,u]);const p=()=>{j(!0),o(Ks),a&&sn(s,a)},h={"logged-out":d("header.settings.status.subscription.logged-out"),free:d("header.settings.status.subscription.free"),subscriber:d("header.settings.status.subscription.subscriber"),expired:d("header.settings.status.subscription.expired")};return e.jsxs(k,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:d("header.settings.status.title")}),e.jsxs(k,{mt:"3",children:[e.jsxs(k,{mb:"1",children:[e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:d("header.settings.status.count.stations")}),e.jsx(m,{children:n})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:d("header.settings.status.count.miscNodes")}),e.jsx(m,{children:r})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:d("header.settings.status.count.masters")}),e.jsx(m,{children:i})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:d("header.settings.status.count.lines")}),e.jsx(m,{children:t})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:d("header.settings.status.count.parallel")}),e.jsx(m,{children:c})]})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsxs(m,{flex:"1",children:[d("header.settings.status.subscription.content")," ",h[l]]}),e.jsx(ne,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(en,{}),isDisabled:g,onClick:()=>p()})]})]})]})},je={width:"100%",justifyContent:"space-between"},ce={fontFamily:"-apple-system"},jr=s=>{const{isOpen:l,onClose:a}=s,{activeSubscriptions:n}=$(N=>N.account),{telemetry:{project:r},preference:{autoParallel:i,randomStationsNames:t,gridLines:c,snapLines:d}}=$(N=>N.app),{keepLastPath:g,count:{parallel:j}}=$(N=>N.runtime),u=H(),{t:o}=G(),p=Zs("primary.500","primary.300"),[h,x]=f.useState(!1),[b,y]=f.useState(!1),[w,S]=f.useState(!1),[_,C]=f.useState(!1),[v,A]=f.useState(!1),[B,U]=f.useState(!1),[F,te]=f.useState(!1),Xe=z.isAllowAnalytics(),$e=N=>{u(xn(N))},Te=n.RMP_CLOUD?tn:nn,He=j>=Te,ze=!n.RMP_CLOUD,qe=N=>{u(un(N.target.value))};return e.jsxs(Q,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Z,{}),e.jsxs(ee,{children:[e.jsx(J,{children:o("header.settings.title")}),e.jsx(se,{}),e.jsx(X,{children:e.jsxs(De,{divider:e.jsx(Mt,{borderColor:"gray.200"}),children:[e.jsx(fr,{}),e.jsxs(k,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:o("header.settings.preference.title")}),e.jsxs(k,{mt:"3",children:[e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:o("header.settings.preference.keepLastPath")}),e.jsx(ve,{isChecked:g,onChange:({target:{checked:N}})=>u(rn(N))})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{children:o("header.settings.preference.autoParallel")}),e.jsx(de,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ke,{label:o("header.settings.proWithTrial"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(ve,{ml:"1",isDisabled:He,isChecked:i,onChange:({target:{checked:N}})=>u(on(N))})]}),e.jsxs(k,{mb:"1",display:"flex",children:[e.jsx(m,{flex:"1",children:o("header.settings.preference.randomStationNames.title")}),e.jsx(de,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ke,{label:o("header.settings.pro"),children:e.jsx(de,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(vt,{size:"xs",width:"auto",ml:"1",value:t,onChange:qe,children:[e.jsx("option",{value:"none",children:o("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:Ve.Shmetro,disabled:ze,children:o("header.settings.preference.randomStationNames.".concat(Ve.Shmetro))}),e.jsx("option",{value:Ve.Bjsubway,disabled:ze,children:o("header.settings.preference.randomStationNames.".concat(Ve.Bjsubway))})]})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:o("header.settings.preference.gridline")}),e.jsx(ve,{isChecked:c,onChange:({target:{checked:N}})=>u(an(N))})]}),e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:o("header.settings.preference.snapline")}),e.jsx(ve,{isChecked:d,onChange:({target:{checked:N}})=>u(ln(N))})]})]})]}),e.jsxs(k,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:o("header.settings.procedures.title")}),e.jsxs(k,{mt:"3",children:[e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>x(!0),children:o("header.settings.procedures.translate.title")}),e.jsx(hr,{isOpen:h,onClose:()=>x(!1)}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>y(!0),children:o("header.settings.procedures.scale.title")}),e.jsx(dr,{isOpen:b,onClose:()=>y(!1)}),e.jsxs(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>S(!0),children:[o("header.settings.procedures.changeType.title"),e.jsx(ke,{label:o("header.settings.pro"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(Rn,{isOpen:w,onClose:()=>S(!1),isSelect:!1}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>C(!0),children:o("header.settings.procedures.removeLines.title")}),e.jsx(cr,{isOpen:_,onClose:()=>C(!1)}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>A(!0),children:o("header.settings.procedures.updateColor.title")}),e.jsx(ur,{isOpen:v,onClose:()=>A(!1)}),e.jsxs(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>U(!0),children:[o("header.settings.procedures.unlockSimplePath.title"),e.jsx(ke,{label:o("header.settings.pro"),children:e.jsx(de,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(pr,{isOpen:B,onClose:()=>U(!1)}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>te(!0),children:o("header.settings.procedures.masterManager.title")}),e.jsx(zn,{isOpen:F,onClose:()=>te(!1)})]})]}),e.jsxs(k,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:o("header.settings.shortcuts.title")}),e.jsx(k,{mt:"3",children:e.jsxs(_t,{children:[e.jsx(kt,{children:e.jsxs(V,{children:[e.jsx(Is,{children:o("header.settings.shortcuts.keys")}),e.jsx(Is,{children:o("header.settings.shortcuts.description")})]})}),e.jsxs(Ot,{children:[e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(M,{children:"f"})}),e.jsx(R,{children:o("header.settings.shortcuts.f")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(M,{children:"s"})}),e.jsx(R,{children:o("header.settings.shortcuts.s")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(k,{display:"flex",flexDirection:"row",children:[e.jsx(cn,{}),e.jsx(dn,{}),e.jsx(hn,{}),e.jsx(pn,{})]})}),e.jsx(R,{children:o("header.settings.shortcuts.arrows")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(k,{display:"flex",flexDirection:"row",children:[e.jsx(M,{children:"i"}),e.jsx(M,{children:"j"}),e.jsx(M,{children:"k"}),e.jsx(M,{children:"l"})]})}),e.jsx(R,{children:o("header.settings.shortcuts.ijkl")})]}),e.jsxs(V,{children:[e.jsx(R,{children:xe?e.jsx(M,{sx:ce,children:"⇧"}):e.jsx(M,{children:"shift"})}),e.jsx(R,{children:o("header.settings.shortcuts.shift")})]}),e.jsxs(V,{children:[e.jsx(R,{children:xe?e.jsx(M,{sx:ce,children:"⌥"}):e.jsx(M,{children:"alt"})}),e.jsx(R,{children:o("header.settings.shortcuts.alt")})]}),e.jsxs(V,{children:[e.jsx(R,{children:xe?e.jsx(M,{sx:ce,children:"⌫"}):e.jsx(M,{children:"delete"})}),e.jsx(R,{children:o("header.settings.shortcuts.delete")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[xe?e.jsx(M,{sx:ce,children:"⌘"}):e.jsx(M,{children:"ctrl"})," + ",e.jsx(M,{children:"x"})]}),e.jsx(R,{children:o("header.settings.shortcuts.cut")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[xe?e.jsx(M,{sx:ce,children:"⌘"}):e.jsx(M,{children:"ctrl"})," + ",e.jsx(M,{children:"c"})]}),e.jsx(R,{children:o("header.settings.shortcuts.copy")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[xe?e.jsx(M,{sx:ce,children:"⌘"}):e.jsx(M,{children:"ctrl"})," + ",e.jsx(M,{children:"v"})]}),e.jsx(R,{children:o("header.settings.shortcuts.paste")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[xe?e.jsx(M,{sx:ce,children:"⌘"}):e.jsx(M,{children:"ctrl"})," + ",e.jsx(M,{children:"z"})]}),e.jsx(R,{children:o("header.settings.shortcuts.undo")})]}),e.jsxs(V,{children:[e.jsx(R,{children:xe?e.jsxs(e.Fragment,{children:[e.jsx(M,{sx:ce,children:"⇧"})," + ",e.jsx(M,{sx:ce,children:"⌘"})," + ",e.jsx(M,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{children:"ctrl"})," + ",e.jsx(M,{children:"y"})]})}),e.jsx(R,{children:o("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(k,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:o("header.settings.telemetry.title")}),e.jsxs(k,{mt:"3",children:[e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.info")}),e.jsxs(k,{mt:"3",mb:"1",children:[e.jsxs(k,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:o("header.settings.telemetry.essential")}),e.jsx(ke,{label:o("header.settings.telemetry.essentialTooltip"),children:e.jsx(ve,{isChecked:Xe,isDisabled:!0})})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.essentialInfo")}),e.jsxs(I,{color:p,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[o("header.settings.telemetry.essentialLink")," ",e.jsx(P,{as:L})]})]}),e.jsxs(k,{mt:"1",mb:"1",children:[e.jsxs(k,{display:"flex",children:[e.jsx(m,{flex:"1",children:o("header.settings.telemetry.additional")}),e.jsx(ve,{isChecked:r,onChange:({target:{checked:N}})=>$e(N)})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},wr=()=>{const[s,l]=f.useState(!1),{svgViewBoxZoom:a}=$(i=>i.param),n=H(),r=[{type:"slider",label:"",value:400-a,min:10,max:390,step:1,onChange:i=>n(Ae(400-i)),leftIcon:e.jsx(gn,{}),rightIcon:e.jsx(Us,{}),minW:160}];return e.jsxs(qs,{isOpen:s,onOpen:()=>l(!0),onClose:()=>l(!1),children:[e.jsx(Qs,{children:e.jsx(ne,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Us,{}),onClick:()=>l(!s)})}),e.jsx(et,{children:e.jsx(st,{children:e.jsx(Me,{fields:r,noLabel:!0})})})]})};function br(){const{t:s}=G(),l=H(),{past:a,future:n}=$(h=>h.param),r=z.isAllowAnalytics(),[i,t]=f.useState(!1),[c,d]=f.useState(!1),g=Hs(z.getEnv),j=Hs(z.getAppVersion);f.useEffect(()=>{r&&g!==is.DEV&&z.event(be.APP_LOAD,{isStandaloneWindow:z.isStandaloneWindow()})},[g]);const u=h=>{z.getI18nInstance().changeLanguage(h)},o=()=>{l(vn()),l(q()),l(K())},p=()=>{l(_n()),l(q()),l(K())};return e.jsxs(mn,{children:[e.jsx(_e,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(fn,{environment:g,version:j,popoverHeader:g===is.PRD?void 0:e.jsxs($s,{i18nKey:"header.popoverHeader",environment:g,children:["You're on ",{environment:g}," environment!"]}),popoverBody:g===is.PRD?void 0:e.jsx($s,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(At,{ml:"auto",children:[e.jsx(le,{children:e.jsx(lr,{})}),e.jsx(le,{children:e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(jn,{}),isDisabled:a.length===0,onClick:o})}),e.jsx(le,{children:e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(wn,{}),isDisabled:n.length===0,onClick:p})}),e.jsx(le,{children:e.jsx(wr,{})}),e.jsx(le,{children:e.jsx(ir,{})}),e.jsx(le,{children:e.jsx(Xn,{})}),z.isStandaloneWindow()&&e.jsx(le,{children:e.jsxs(ys,{children:[e.jsx(Cs,{as:ne,icon:e.jsx(bn,{}),variant:"ghost",size:"sm"}),e.jsx(vs,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(h=>e.jsx(he,{onClick:()=>u(h),children:Sn[h][h]},h))})]})}),e.jsx(le,{children:e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(yn,{}),onClick:()=>t(!0)})}),e.jsx(le,{children:e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(Cn,{}),onClick:()=>d(!0)})})]}),e.jsx(jr,{isOpen:i,onClose:()=>t(!1)}),e.jsx(En,{isOpen:c,onClose:()=>d(!1)})]})}function Sr(){const s=H(),l=$(n=>n.runtime.globalAlerts),a=n=>{z.isStandaloneWindow()?window.open("/".concat(n),"_blank"):z.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(l).map(([n,{message:r,url:i,linkedApp:t}])=>e.jsxs(ps,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(us,{}),t?e.jsx(I,{onClick:()=>a(t),children:r}):i?e.jsx(I,{href:i,target:"_blank",children:r}):r,e.jsx(Xs,{ml:"auto",onClick:()=>s(kn(n))})]},n))})}function Or(){return e.jsxs(e.Fragment,{children:[e.jsx(br,{}),e.jsx(Sr,{})]})}export{Or as default};
