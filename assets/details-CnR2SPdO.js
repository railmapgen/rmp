import{j as e,B as W,aj as z,ak as de,av as _,t as A,aw as ue,x as pe,D as he,G as K,M as Y,H as ee,J as te,L as ne,O as se,N as B}from"./chakra-C1zJvDsN.js";import{c as P,e as C,b9 as ge,X as me,ba as fe,aS as xe,w,y as T,q as I,aQ as O,L as ae,p as ye,V as F,bb as U,x as v,S as be,a3 as Se,a4 as je,k as H,o as re,F as D,aT as $,aB as we,bc as Ce,bd as Ae,be as Ne,bf as Ee,aI as Te,b4 as ve,bg as Le,n as q,aC as Pe}from"./index-C1Aha3WL.js";import{u as R,b as c}from"./react-BpF4RbzH.js";import{a as Re,b as ke,d as Oe,c as J}from"./change-types-D9pEw3tP.js";import{s as V}from"./master-manager-DEW_aLj9.js";import{C as ze}from"./change-type-modal-CJSLNF-a.js";import{l as We,L as Ie}from"./tools-CIQFucgI.js";import{u as Q}from"./useEvent-LzhclC4A.js";import{m as De}from"./misc-nodes-CGKtUp_d.js";function Me(){const{t}=R(),i=P(),{selected:l}=C(a=>a.runtime),d=c.useRef(window.graph),u=a=>{if(d.current.hasNode(a)){const o=d.current.getNodeAttributes(a),f=o.type;return a.startsWith("stn")?o[f].names.join("/"):f}else if(d.current.hasEdge(a)){const[o,f]=d.current.extremities(a),p=d.current.getSourceAttributes(a),x=d.current.getTargetAttributes(a),S=p.type,h=x.type;return(o.startsWith("stn")?p[S].names[0]:S)+" - "+(f.startsWith("stn")?x[h].names[0]:h)}},[n,s]=c.useState([]);c.useEffect(()=>{s(["station","misc-node","line"])},[l]);const[r,m]=c.useState(!1);return e.jsxs(W,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[t("panel.details.multipleSelection.selected")," ",l.size]}),e.jsxs(de,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(z,{as:"h5",size:"xs",w:"100%",children:t("panel.details.multipleSelection.show")}),e.jsx(ge,{selections:[{label:t("panel.details.multipleSelection.station"),value:"station"},{label:t("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:t("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:n,multiSelect:!0,onChange:a=>s(a)})]}),n.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{width:"100%",size:"sm",onClick:()=>m(!0),children:[t("panel.details.multipleSelection.change"),e.jsx(ue,{label:t("header.settings.pro"),children:e.jsx(pe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(he,{})]}),[...l].filter(a=>n.includes("station")||!a.startsWith("stn")).filter(a=>n.includes("misc-node")||!a.startsWith("misc")).filter(a=>n.includes("line")||!a.startsWith("line")).map(a=>{var o;return e.jsxs(_,{width:"100%",children:[e.jsx(A,{width:"100%",size:"sm",variant:"solid",onClick:()=>i(me(new Set([a]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(o=u(a))==null?void 0:o.replaceAll("\n","⏎")}),e.jsx(A,{size:"sm",onClick:()=>i(xe(a)),children:e.jsx(fe,{})})]},a)})]}),e.jsx(ze,{isOpen:r,onClose:()=>m(!1),isSelect:!0,filter:n})]})}function _e(){var X,G;const{i18n:t,t:i}=R(),l=P(),d=c.useCallback(()=>{l(w(m.current.export())),l(T())},[l,T,w]),{preference:{autoParallel:u}}=C(j=>j.app),{selected:n,theme:s}=C(j=>j.runtime),[r]=n,m=c.useRef(window.graph),[a,o]=c.useState(!1),f=c.useRef(null),p=Object.fromEntries(Object.entries(I).map(([j,ce])=>[j,i(ce.metadata.displayName).toString()])),[x,S]=c.useState(m.current.getEdgeAttribute(r,"type")),[h,g]=c.useState(void 0),y=Object.fromEntries((G=(X=We[t.language])==null?void 0:X.map(j=>[j,i(O[j].metadata.displayName).toString()]))!=null?G:[]),[b,N]=c.useState(m.current.getEdgeAttribute(r,"style")),[E,L]=c.useState(void 0);c.useEffect(()=>{S(m.current.getEdgeAttribute(r,"type")),N(m.current.getEdgeAttribute(r,"style"))},[r]);const k=Object.values(ae).filter(j=>!O[b].metadata.supportLinePathType.includes(j)),ie=Object.values(ye).filter(j=>!O[j].metadata.supportLinePathType.includes(x)),le=()=>{h&&(Re(m.current,r,h,u),S(m.current.getEdgeAttribute(r,"type")),d())},oe=()=>{E&&(ke(m.current,r,E,s),N(m.current.getEdgeAttribute(r,"style")),d())},M=j=>{j&&(h?(le(),g(void 0)):E&&(oe(),L(void 0))),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:i("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:p,disabledOptions:k,defaultValue:x,value:x,onChange:({target:{value:j}})=>{g(j),o(!0)}})}),e.jsx(F,{label:i("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:y,disabledOptions:ie,defaultValue:b,value:b,onChange:({target:{value:j}})=>{L(j),o(!0)}})}),e.jsx(Ie,{type:"line",expand:!0}),e.jsx(K,{isOpen:a,leastDestructiveRef:f,onClose:()=>M(!1),children:e.jsx(Y,{children:e.jsxs(ee,{children:[e.jsx(te,{children:i("warning")}),e.jsx(ne,{children:i("panel.details.changeLineTypeContent")}),e.jsxs(se,{children:[e.jsx(A,{ref:f,onClick:()=>M(!1),children:i("cancel")}),e.jsx(A,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:i("panel.details.changeType")})]})]})})})]})}function Be(){const{t}=R(),i=P(),l=c.useCallback(()=>{i(w(s.current.export())),i(v())},[i,v,w]),{selected:d,refresh:{nodes:u}}=C(y=>y.runtime),[n]=d,s=c.useRef(window.graph),[r,m]=c.useState(!1),a=c.useRef(null),[o,f]=c.useState(void 0),[p,x]=c.useState(be.ShmetroBasic);c.useEffect(()=>{if(n!=null&&n.startsWith("stn")){const y=s.current.getNodeAttribute(n,"type");x(y)}},[u,d]);const S=Object.fromEntries(Object.entries(V).map(([y,b])=>[y,t(b.metadata.displayName).toString()])),h=()=>{o&&(Oe(s.current,n,o),l())},g=y=>{y&&h(),f(void 0),m(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:t("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:S,disabledOptions:[p],value:p,onChange:({target:{value:y}})=>{f(y),m(!0)}})}),e.jsx(K,{isOpen:r,leastDestructiveRef:a,onClose:()=>g(!1),children:e.jsx(Y,{children:e.jsxs(ee,{children:[e.jsx(te,{children:t("warning")}),e.jsx(ne,{children:t("panel.details.changeStationTypeContent")}),e.jsxs(se,{children:[e.jsx(A,{ref:a,onClick:()=>g(!1),children:t("cancel")}),e.jsx(A,{ml:"2",colorScheme:"red",onClick:()=>g(!0),children:t("panel.details.changeType")})]})]})})})]})}function Fe(){const{t}=R(),i=P(),l=c.useCallback(()=>{i(w(r.current.export())),i(v()),i(T())},[i,v,T,w]),{activeSubscriptions:d}=C(p=>p.account),{selected:u,count:{parallel:n}}=C(p=>p.runtime),[s]=u,r=c.useRef(window.graph),m=p=>{const x=Math.min(Math.max(p,-10),10);r.current.hasNode(s)&&r.current.setNodeAttribute(s,"zIndex",x),r.current.hasEdge(s)&&r.current.setEdgeAttribute(s,"zIndex",x),l()},a=(p,x)=>{let S=-1;if(p){const h=r.current.getEdgeAttributes(s),[g,y]=r.current.extremities(s);S=re(r.current,h.type,g,y,x)}o(S)},o=p=>{r.current.setEdgeAttribute(s,"parallelIndex",p),i(w(r.current.export())),i(T())},f=[];if(u.size!==0)if(u.size===1){if(f.push({type:"input",label:t("panel.details.info.id"),value:s,minW:276}),f.push({type:"select",label:t("panel.details.info.zIndex"),value:s?r.current.hasNode(s)?r.current.getNodeAttribute(s,"zIndex"):r.current.hasEdge(s)?r.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(p,x)=>[x-10,(x-10).toString()])),onChange:p=>m(Number(p))}),r.current.hasEdge(s)){const p=r.current.getEdgeAttributes(s),{parallelIndex:x,type:S}=p,h=d.RMP_CLOUD?Se:je,g=n>h&&x<0||S===ae.Simple,y=n>h&&x>=0;f.push({type:"switch",label:t("panel.details.info.parallel"),isDisabled:g,isChecked:x>=0,onChange:b=>a(b,p[p.type].startFrom),oneLine:!0,minW:276}),x>=0&&f.push({type:"input",label:t("panel.details.info.parallelIndex"),variant:"number",isDisabled:y,value:p.parallelIndex.toString(),onChange:b=>o(Number(b)),minW:276})}}else u.size>1&&f.push({type:"input",label:t("panel.details.info.type"),value:t("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.info.title")}),e.jsx(H,{fields:f,minW:130}),u.size===1&&s.startsWith("stn")&&r.current.hasNode(s)&&r.current.getNodeAttribute(s,"type")in V&&e.jsx(Be,{}),u.size===1&&s.startsWith("line")&&r.current.hasEdge(s)&&r.current.getEdgeAttribute(s,"type")in I&&r.current.getEdgeAttribute(s,"style")in O&&e.jsx(_e,{}),u.size>1&&e.jsx(Me,{})]})}function Ue(){const{t}=R(),i=P(),{selected:l}=C(g=>g.runtime),[d]=l,u=c.useRef(window.graph),[n,s]=c.useState("undefined"),[r,m]=c.useState("undefined"),[a,o]=c.useState("undefined"),[f,p]=c.useState("undefined");c.useEffect(()=>{var g,y,b,N;if(d!=null&&d.startsWith("line")){const[E,L]=u.current.extremities(d);if(s(E),m(L),E.startsWith("stn")){const k=u.current.getNodeAttribute(E,"type");o((y=(g=u.current.getNodeAttribute(E,k))==null?void 0:g.names.at(0))!=null?y:"undefined")}if(L.startsWith("stn")){const k=u.current.getNodeAttribute(L,"type");p((N=(b=u.current.getNodeAttribute(L,k))==null?void 0:b.names.at(0))!=null?N:"undefined")}}},[l]);const x=Q(()=>{i(D()),i($(n))}),S=Q(()=>{i(D()),i($(r))}),h=[{type:"custom",label:t("panel.details.lineExtremities.source"),component:e.jsx(A,{ml:"auto",size:"sm",variant:"link",onClick:x,children:n}),oneLine:!0,minW:"full"},{type:"input",label:t("panel.details.lineExtremities.sourceName"),value:a,minW:"full"},{type:"custom",label:t("panel.details.lineExtremities.target"),component:e.jsx(A,{ml:"auto",size:"sm",variant:"link",onClick:S,children:r}),oneLine:!0,minW:"full"},{type:"input",label:t("panel.details.lineExtremities.targetName"),value:f,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.lineExtremities.title")}),e.jsx(H,{fields:h,minW:130})]})}function He(){const{t}=R(),i=P(),l=c.useCallback(()=>{i(w(s.current.export())),i(v()),i(T())},[i,v,T,w]),{selected:d,refresh:{nodes:u}}=C(o=>o.runtime),[n]=d,s=c.useRef(window.graph),[r,m]=c.useState({x:0,y:0});c.useEffect(()=>{if(n!=null&&n.startsWith("stn")||n!=null&&n.startsWith("misc_node_")){const o=s.current.getNodeAttribute(n,"x"),f=s.current.getNodeAttribute(n,"y");m({x:o,y:f})}},[u,d]);const a=[{type:"input",label:t("panel.details.nodePosition.pos.x"),value:r.x.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{s.current.mergeNodeAttributes(n,{x:Number(o)}),l()}},{type:"input",label:t("panel.details.nodePosition.pos.y"),value:r.y.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{s.current.mergeNodeAttributes(n,{y:Number(o)}),l()}}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.nodePosition.title")}),e.jsx(H,{fields:a,minW:130})]})}const Z={...V,...De},Ve=()=>{var m;const t=P(),{selected:i}=C(a=>a.runtime),{t:l}=R(),[d]=i,u=window.graph.getNodeAttribute(d,"type"),n=u in Z&&Z[u].attrsComponent,s=(m=window.graph.getNodeAttribute(d,u))!=null?m:{},r=(a,o)=>{const f=window.graph.getNodeAttribute(a,"type");window.graph.mergeNodeAttributes(a,{[f]:o}),t(w(window.graph.export())),t(v())};return n?e.jsx(n,{id:d,attrs:s,handleAttrsUpdate:r}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:l("panel.details.unknown.error",{category:l("panel.details.unknown.node")})})},Xe=()=>{var g,y;const t=P(),{preference:{autoParallel:i}}=C(b=>b.app),{selected:l}=C(b=>b.runtime),{t:d}=R(),[u]=l,{type:n,style:s,parallelIndex:r,reconcileId:m}=window.graph.getEdgeAttributes(u),a=(g=window.graph.getEdgeAttribute(u,n))!=null?g:{},o=n in I&&I[n].attrsComponent,f=(y=window.graph.getEdgeAttribute(u,s))!=null?y:{},p=s in O&&O[s].attrsComponent,x=(b,N)=>{let E=-1;if(i){const[L,k]=window.graph.extremities(b);E=re(window.graph,n,L,k,N)}window.graph.setEdgeAttribute(b,"parallelIndex",E)},S=(b,N)=>{window.graph.mergeEdgeAttributes(b,{[n]:N}),t(w(window.graph.export())),t(T())},h=(b,N)=>{window.graph.mergeEdgeAttributes(b,{[s]:N}),t(w(window.graph.export())),t(T())};return e.jsxs(e.Fragment,{children:[o?e.jsx(o,{id:u,attrs:a,recalculateParallelIndex:x,handleAttrsUpdate:S,parallelIndex:r}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.linePath")})}),p?e.jsx(p,{id:u,attrs:f,handleAttrsUpdate:h,reconcileId:m}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:d("panel.details.unknown.error",{category:d("panel.details.unknown.lineStyle")})})]})},tt=()=>{const{t}=R(),i=P(),l=c.useRef(window.graph),d=c.useCallback(()=>{i(w(l.current.export())),i(v()),i(T())},[i,v,T,w]),{activeSubscriptions:u}=C(h=>h.account),{selected:n,isDetailsOpen:s,count:{masters:r}}=C(h=>h.runtime),{preference:{autoChangeStationType:m}}=C(h=>h.app),[a]=n,o=!u.RMP_CLOUD&&r+1>we,f=()=>{ve()?i(Le()):i(D())},p=h=>{const g=structuredClone(l.current.getNodeAttributes(h));g.x+=50,g.y+=50;const y=h.startsWith("stn")?"stn_".concat(q(10)):"misc_node_".concat(q(10));l.current.addNode(y,g),i(w(l.current.export())),i(v())},x=h=>{const g=Pe(l.current,h);navigator.clipboard.writeText(g)},S=h=>{i(D()),h.forEach(g=>{if(l.current.hasNode(g))l.current.dropNode(g);else if(l.current.hasEdge(g)){const[y,b]=l.current.extremities(g);l.current.dropEdge(g),m&&y.startsWith("stn")&&J(l.current,y),m&&b.startsWith("stn")&&J(l.current,b)}}),d()};return e.jsxs(Ce,{isOpen:s==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(Ae,{onClose:f,children:t("panel.details.header")}),e.jsxs(Ne,{children:[e.jsx(Fe,{}),n.size===1&&l.current.hasNode(a)&&e.jsx(He,{}),n.size===1&&l.current.hasEdge(a)&&e.jsx(Ue,{}),n.size===1&&e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.specificAttrsTitle")}),window.graph.hasNode(a)&&e.jsx(Ve,{}),window.graph.hasEdge(a)&&e.jsx(Xe,{})]})]}),e.jsx(Ee,{children:e.jsxs(_,{children:[n.size===1&&l.current.hasNode(a)&&e.jsx(A,{size:"sm",variant:"outline",onClick:()=>p(a),isDisabled:l.current.getNodeAttributes(a).type===Te.Master&&o,children:t("panel.details.footer.duplicate")}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>x(n),children:t("panel.details.footer.copy")}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>S(n),children:t("panel.details.footer.remove")})]})})]})};export{tt as default};
