import{j as e,B as D,ak as z,al as be,aw as U,v,az as ye,y as Se,D as je,H as re,M as le,J as oe,K as ce,N as de,av as ue,Q as pe,O as B}from"./chakra-BZH9ddpD.js";import{c as k,e as C,bi as we,a0 as Ce,bj as Ae,b0 as Ne,w as A,y as P,q as I,aK as W,L as H,t as O,_ as F,bk as V,ag as he,x as R,S as Ee,a7 as Te,a8 as ve,k as G,F as ge,z as M,b1 as ee,aG as Pe,bl as Re,bm as ke,bn as Le,bo as Oe,p as We,bf as ze,bp as Ie,n as te,aP as De}from"./index-D02JJVEe.js";import{u as L,b as c}from"./react-CLIJjNOF.js";import{f as Me,g as _e,h as Ue,b as Be,e as ne}from"./change-types-D4BQj9mQ.js";import{s as X,b as Fe}from"./misc-nodes-Cha3-rp5.js";import{C as Ve}from"./change-type-modal-mvsOxlcr.js";import{b as He}from"./localized-order-BEQhECIs.js";import{u as se}from"./useEvent-D-PagYbH.js";function Ge(){const{t:n}=L(),s=k(),{selected:o}=C(t=>t.runtime),h=c.useRef(window.graph),d=t=>{if(h.current.hasNode(t)){const l=h.current.getNodeAttributes(t),x=l.type;return t.startsWith("stn")?l[x].names.join("/"):x}else if(h.current.hasEdge(t)){const[l,x]=h.current.extremities(t),u=h.current.getSourceAttributes(t),f=h.current.getTargetAttributes(t),w=u.type,g=f.type;return(l.startsWith("stn")?u[w].names[0]:w)+" - "+(x.startsWith("stn")?f[g].names[0]:g)}},[r,a]=c.useState([]);c.useEffect(()=>{a(["station","misc-node","line"])},[o]);const[i,S]=c.useState(!1);return e.jsxs(D,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(be,{m:"var(--chakra-space-1)",children:[e.jsxs(U,{w:"100%",children:[e.jsx(z,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(we,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:r,multiSelect:!0,onChange:t=>a(t)})]}),r.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{width:"100%",size:"sm",onClick:()=>S(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(ye,{label:n("header.settings.pro"),children:e.jsx(Se,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(je,{})]}),[...o].filter(t=>r.includes("station")||!t.startsWith("stn")).filter(t=>r.includes("misc-node")||!t.startsWith("misc")).filter(t=>r.includes("line")||!t.startsWith("line")).map(t=>{var l;return e.jsxs(U,{width:"100%",children:[e.jsx(v,{width:"100%",size:"sm",variant:"solid",onClick:()=>s(Ce(new Set([t]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=d(t))==null?void 0:l.replaceAll("\n","âŽ")}),e.jsx(v,{size:"sm",onClick:()=>s(Ne(t)),children:e.jsx(Ae,{})})]},t)})]}),e.jsx(Ve,{isOpen:i,onClose:()=>S(!1),isSelect:!0,filter:r})]})}const ae=(n,s)=>{const o=[O.ShmetroVirtualInt,O.GzmtrVirtualInt,O.River,O.MTRPaidArea,O.MTRUnpaidArea,O.MRTTapeOut];return!!(n===H.Simple&&o.includes(s))};function Xe(){var Z,Y;const{i18n:n,t:s}=L(),o=k(),h=c.useCallback(()=>{o(A(l.current.export())),o(P())},[o,P,A]),{activeSubscriptions:d}=C(p=>p.account),{preference:{autoParallel:r,disableWarning:a}}=C(p=>p.app),{selected:i,theme:S}=C(p=>p.runtime),[t]=i,l=c.useRef(window.graph),[x,u]=c.useState(!1),f=c.useRef(null),[w,g]=c.useState(!1),m=Object.fromEntries(Object.entries(I).map(([p,xe])=>[p,s(xe.metadata.displayName).toString()])),[j,y]=c.useState(l.current.getEdgeAttribute(t,"type")),[N,E]=c.useState(void 0),b=Object.fromEntries((Y=(Z=He[n.language])==null?void 0:Z.map(p=>[p,s(W[p].metadata.displayName).toString()]))!=null?Y:[]),[T,K]=c.useState(l.current.getEdgeAttribute(t,"style")),[$,q]=c.useState(void 0);c.useEffect(()=>{y(l.current.getEdgeAttribute(t,"type")),K(l.current.getEdgeAttribute(t,"style"))},[t]);const me=Object.values(H).filter(p=>!ae(p,T)&&(!W[T].metadata.supportLinePathType.includes(p)||I[p].isPro&&!d.RMP_CLOUD)),fe=Object.values(O).filter(p=>!ae(j,p)&&(!W[p].metadata.supportLinePathType.includes(j)||W[p].isPro&&!d.RMP_CLOUD)),J=p=>{p&&(Me(l.current,t,p,r),y(l.current.getEdgeAttribute(t,"type")),h())},Q=p=>{p&&(_e(l.current,t,p,S),K(l.current.getEdgeAttribute(t,"style")),h())},_=p=>{p&&(N?(J(N),E(void 0)):$&&(Q($),q(void 0)),w&&o(he(!0))),g(!1),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(V,{options:m,disabledOptions:me,defaultValue:j,value:j,onChange:({target:{value:p}})=>{a.changeType?J(p):(E(p),u(!0))}})}),e.jsx(F,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(V,{options:b,disabledOptions:fe,defaultValue:T,value:T,onChange:({target:{value:p}})=>{a.changeType?Q(p):(q(p),u(!0))}})}),e.jsx(re,{isOpen:x,leastDestructiveRef:f,onClose:()=>_(!1),children:e.jsx(le,{children:e.jsxs(oe,{children:[e.jsx(ce,{children:s("warning")}),e.jsxs(de,{children:[s("panel.details.changeLineTypeContent"),e.jsx(ue,{mt:4,isChecked:w,onChange:p=>g(p.target.checked),width:"100%",children:s("noShowAgain")})]}),e.jsxs(pe,{children:[e.jsx(v,{ref:f,onClick:()=>_(!1),children:s("cancel")}),e.jsx(v,{ml:"2",colorScheme:"red",onClick:()=>_(!0),children:s("panel.details.changeType")})]})]})})})]})}function Ke(){const{t:n}=L(),s=k(),o=c.useCallback(()=>{s(A(S.current.export())),s(R())},[s,R,A]),{selected:h,refresh:{nodes:d}}=C(b=>b.runtime),{preference:{autoChangeStationType:r,disableWarning:a}}=C(b=>b.app),[i]=h,S=c.useRef(window.graph),[t,l]=c.useState(!1),x=c.useRef(null),[u,f]=c.useState(void 0),[w,g]=c.useState(!1),[m,j]=c.useState(Ee.ShmetroBasic);c.useEffect(()=>{if(i!=null&&i.startsWith("stn")){const b=S.current.getNodeAttribute(i,"type");j(b)}},[d,h]);const y=Object.fromEntries(Object.entries(X).map(([b,T])=>[b,n(T.metadata.displayName).toString()])),N=b=>{b&&(Ue(S.current,i,b),r&&i.startsWith("stn")&&Be(S.current,i),o())},E=b=>{b&&u&&(N(u),w&&s(he(!0))),f(void 0),g(!1),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(V,{options:y,disabledOptions:[m],value:m,onChange:({target:{value:b}})=>{a.changeType?N(b):(f(b),l(!0))}})}),e.jsx(re,{isOpen:t,leastDestructiveRef:x,onClose:()=>E(!1),children:e.jsx(le,{children:e.jsxs(oe,{children:[e.jsx(ce,{children:n("warning")}),e.jsxs(de,{children:[n("panel.details.changeStationTypeContent"),e.jsx(ue,{mt:4,isChecked:w,onChange:b=>g(b.target.checked),width:"100%",children:n("noShowAgain")})]}),e.jsxs(pe,{children:[e.jsx(v,{ref:x,onClick:()=>E(!1),children:n("cancel")}),e.jsx(v,{ml:"2",colorScheme:"red",onClick:()=>E(!0),children:n("panel.details.changeType")})]})]})})})]})}function $e(){const{t:n}=L(),s=k(),o=c.useCallback(()=>{s(A(i.current.export())),s(R()),s(P())},[s,R,P,A]),{activeSubscriptions:h}=C(u=>u.account),{selected:d,count:{parallel:r}}=C(u=>u.runtime),[a]=d,i=c.useRef(window.graph),S=u=>{const f=Math.min(Math.max(u,-10),10);i.current.hasNode(a)&&i.current.setNodeAttribute(a,"zIndex",f),i.current.hasEdge(a)&&i.current.setEdgeAttribute(a,"zIndex",f),o()},t=(u,f)=>{let w=-1;if(u){const g=i.current.getEdgeAttributes(a),[m,j]=i.current.extremities(a);w=ge(i.current,g.type,m,j,f)}l(w)},l=u=>{i.current.setEdgeAttribute(a,"parallelIndex",u),s(A(i.current.export())),s(P())},x=[];if(d.size!==0)if(d.size===1){if(x.push({type:"input",label:n("panel.details.info.id"),value:a,minW:276}),x.push({type:"select",label:n("panel.details.info.zIndex"),value:a?i.current.hasNode(a)?i.current.getNodeAttribute(a,"zIndex"):i.current.hasEdge(a)?i.current.getEdgeAttribute(a,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(u,f)=>[f-10,(f-10).toString()])),onChange:u=>S(Number(u))}),i.current.hasEdge(a)){const u=i.current.getEdgeAttributes(a),{parallelIndex:f,type:w}=u,g=h.RMP_CLOUD?Te:ve,m=r>g&&f<0||w===H.Simple,j=r>g&&f>=0;x.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:m,isChecked:f>=0,onChange:y=>t(y,u[u.type].startFrom),oneLine:!0,minW:276}),f>=0&&x.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:j,value:u.parallelIndex.toString(),onChange:y=>l(Number(y)),minW:276})}}else d.size>1&&x.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(D,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(G,{fields:x,minW:130}),d.size===1&&a.startsWith("stn")&&i.current.hasNode(a)&&i.current.getNodeAttribute(a,"type")in X&&e.jsx(Ke,{}),d.size===1&&a.startsWith("line")&&i.current.hasEdge(a)&&i.current.getEdgeAttribute(a,"type")in I&&i.current.getEdgeAttribute(a,"style")in W&&e.jsx(Xe,{}),d.size>1&&e.jsx(Ge,{})]})}function qe(){const{t:n}=L(),s=k(),{selected:o}=C(m=>m.runtime),[h]=o,d=c.useRef(window.graph),[r,a]=c.useState("undefined"),[i,S]=c.useState("undefined"),[t,l]=c.useState("undefined"),[x,u]=c.useState("undefined");c.useEffect(()=>{var m,j,y,N;if(h!=null&&h.startsWith("line")){const[E,b]=d.current.extremities(h);if(a(E),S(b),E.startsWith("stn")){const T=d.current.getNodeAttribute(E,"type");l((j=(m=d.current.getNodeAttribute(E,T))==null?void 0:m.names.at(0))!=null?j:"undefined")}if(b.startsWith("stn")){const T=d.current.getNodeAttribute(b,"type");u((N=(y=d.current.getNodeAttribute(b,T))==null?void 0:y.names.at(0))!=null?N:"undefined")}}},[o]);const f=se(()=>{s(M()),s(ee(r))}),w=se(()=>{s(M()),s(ee(i))}),g=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(v,{ml:"auto",size:"sm",variant:"link",onClick:f,children:r}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:t,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(v,{ml:"auto",size:"sm",variant:"link",onClick:w,children:i}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:x,minW:"full"}];return e.jsxs(D,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(G,{fields:g,minW:130})]})}function Je(){const{t:n}=L(),s=k(),o=c.useCallback(()=>{s(A(a.current.export())),s(R()),s(P())},[s,R,P,A]),{selected:h,refresh:{nodes:d}}=C(l=>l.runtime),[r]=h,a=c.useRef(window.graph),[i,S]=c.useState({x:0,y:0});c.useEffect(()=>{if(r!=null&&r.startsWith("stn")||r!=null&&r.startsWith("misc_node_")){const l=a.current.getNodeAttribute(r,"x"),x=a.current.getNodeAttribute(r,"y");S({x:l,y:x})}},[d,h]);const t=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:i.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{a.current.mergeNodeAttributes(r,{x:Number(l)}),o()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:i.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{a.current.mergeNodeAttributes(r,{y:Number(l)}),o()}}];return e.jsxs(D,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(G,{fields:t,minW:130})]})}const ie={...X,...Fe},Qe=()=>{var S;const n=k(),{selected:s}=C(t=>t.runtime),{t:o}=L(),[h]=s,d=window.graph.getNodeAttribute(h,"type"),r=d in ie&&ie[d].attrsComponent,a=(S=window.graph.getNodeAttribute(h,d))!=null?S:{},i=(t,l)=>{const x=window.graph.getNodeAttribute(t,"type");window.graph.mergeNodeAttributes(t,{[x]:l}),n(A(window.graph.export())),n(R())};return r?e.jsx(r,{id:h,attrs:a,handleAttrsUpdate:i}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Ze=()=>{var m,j;const n=k(),{preference:{autoParallel:s}}=C(y=>y.app),{selected:o}=C(y=>y.runtime),{t:h}=L(),[d]=o,{type:r,style:a,parallelIndex:i,reconcileId:S}=window.graph.getEdgeAttributes(d),t=(m=window.graph.getEdgeAttribute(d,r))!=null?m:{},l=r in I&&I[r].attrsComponent,x=(j=window.graph.getEdgeAttribute(d,a))!=null?j:{},u=a in W&&W[a].attrsComponent,f=(y,N)=>{let E=-1;if(s){const[b,T]=window.graph.extremities(y);E=ge(window.graph,r,b,T,N)}window.graph.setEdgeAttribute(y,"parallelIndex",E)},w=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[r]:N}),n(A(window.graph.export())),n(P())},g=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[a]:N}),n(A(window.graph.export())),n(P())};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:d,attrs:t,recalculateParallelIndex:f,handleAttrsUpdate:w,parallelIndex:i}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:h("panel.details.unknown.error",{category:h("panel.details.unknown.linePath")})}),u?e.jsx(u,{id:d,attrs:x,handleAttrsUpdate:g,reconcileId:S}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:h("panel.details.unknown.error",{category:h("panel.details.unknown.lineStyle")})})]})},lt=()=>{const{t:n}=L(),s=k(),o=c.useRef(window.graph),h=c.useCallback(()=>{s(A(o.current.export())),s(R()),s(P())},[s,R,P,A]),{activeSubscriptions:d}=C(g=>g.account),{selected:r,isDetailsOpen:a,count:{masters:i}}=C(g=>g.runtime),{preference:{autoChangeStationType:S}}=C(g=>g.app),[t]=r,l=!d.RMP_CLOUD&&i+1>Pe,x=()=>{ze()?s(Ie()):s(M())},u=g=>{const m=structuredClone(o.current.getNodeAttributes(g));m.x+=50,m.y+=50;const j=g.startsWith("stn")?"stn_".concat(te(10)):"misc_node_".concat(te(10));o.current.addNode(j,m),s(A(o.current.export())),s(R())},f=g=>{const m=De(o.current,g);navigator.clipboard.writeText(m)},w=g=>{s(M()),g.forEach(m=>{if(o.current.hasNode(m))o.current.dropNode(m);else if(o.current.hasEdge(m)){const[j,y]=o.current.extremities(m);o.current.dropEdge(m),S&&j.startsWith("stn")&&ne(o.current,j),S&&y.startsWith("stn")&&ne(o.current,y)}}),h()};return e.jsxs(Re,{isOpen:a==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ke,{onClose:x,children:n("panel.details.header")}),e.jsxs(Le,{children:[e.jsx($e,{}),r.size===1&&o.current.hasNode(t)&&e.jsx(Je,{}),r.size===1&&o.current.hasEdge(t)&&e.jsx(qe,{}),r.size===1&&e.jsxs(D,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(t)&&e.jsx(Qe,{}),window.graph.hasEdge(t)&&e.jsx(Ze,{})]})]}),e.jsx(Oe,{children:e.jsxs(U,{children:[r.size===1&&o.current.hasNode(t)&&e.jsx(v,{size:"sm",variant:"outline",onClick:()=>u(t),isDisabled:o.current.getNodeAttributes(t).type===We.Master&&l,children:n("panel.details.footer.duplicate")}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>f(r),children:n("panel.details.footer.copy")}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>w(r),children:n("panel.details.footer.remove")})]})})]})};export{lt as default};
