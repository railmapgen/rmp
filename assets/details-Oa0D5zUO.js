import{j as e,B as P,aw as k,ax as se,aK as _,O as b,aV as ae,U as ie,D as re,_ as J,$ as Q,a0 as X,a1 as Y,a3 as ee,a5 as te,a4 as F}from"./chakra-sjIlidOs.js";import{f as C,a as A,ah as oe,$ as le,af as ce,ai as de,t as w,v as j,m as I,ac as R,l as ue,o as pe,Z as U,aj as H,q as N,j as V,x as D,ag as G,ak as he,al as ge,am as me,an as fe,n as Z}from"./index-7lORjRac.js";import{u as v,b as d}from"./react-hBmrxY6U.js";import{u as q,e as xe}from"./clipboard-dOKc-Ac-.js";import{s as $}from"./stations-RfBpUMgw.js";import{C as ye,c as je,a as be,b as Se}from"./change-type-modal-4UqnGQ1r.js";import{LearnHowToAdd as we}from"./tools-8VWHUkDT.js";import{m as Ne}from"./misc-nodes-pGp7hb3T.js";import"./graph-CRK2VLkH.js";import"./index.esm-mpiRtYyw.js";function Ce(){const{t}=v(),r=C(),{selected:o}=A(a=>a.runtime),i=d.useRef(window.graph),s=a=>{if(i.current.hasNode(a)){const c=i.current.getNodeAttributes(a),u=c.type;return a.startsWith("stn")?c[u].names.join("/"):u}else if(i.current.hasEdge(a)){const[c,u]=i.current.extremities(a),g=i.current.getSourceAttributes(a),x=i.current.getTargetAttributes(a),f=g.type,m=x.type;return(c.startsWith("stn")?g[f].names[0]:f)+" - "+(u.startsWith("stn")?x[m].names[0]:m)}},[n,l]=d.useState([]);d.useEffect(()=>{l(["station","misc-node","line"])},[o]);const[h,p]=d.useState(!1);return e.jsxs(P,{children:[e.jsxs(k,{as:"h5",size:"sm",children:[t("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(se,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(k,{as:"h5",size:"xs",w:"100%",children:t("panel.details.multipleSelection.show")}),e.jsx(oe,{selections:[{label:t("panel.details.multipleSelection.station"),value:"station"},{label:t("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:t("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:n,multiSelect:!0,onChange:a=>l(a)})]}),n.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{width:"100%",size:"sm",onClick:()=>p(!0),children:[t("panel.details.multipleSelection.change"),e.jsx(ae,{label:t("header.settings.pro"),children:e.jsx(ie,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(re,{})]}),[...o].filter(a=>n.includes("station")||!a.startsWith("stn")).filter(a=>n.includes("misc-node")||!a.startsWith("misc")).filter(a=>n.includes("line")||!a.startsWith("line")).map(a=>{var c;return e.jsxs(_,{width:"100%",children:[e.jsx(b,{width:"100%",size:"sm",variant:"solid",onClick:()=>r(le(new Set([a]))),overflow:"hidden",maxW:"270",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(c=s(a))==null?void 0:c.replaceAll("\\","âŽ")}),e.jsx(b,{size:"sm",onClick:()=>r(ce(a)),children:e.jsx(de,{})})]},a)})]}),e.jsx(ye,{isOpen:h,onClose:()=>p(!1),isSelect:!0,filter:n})]})}function Ae(){const{t}=v(),r=C(),o=d.useCallback(()=>{r(w()),r(j(l.current.export()))},[r,w,j]),{selected:i,theme:s}=A(y=>y.runtime),[n]=i,l=d.useRef(window.graph),[h,p]=d.useState(!1),a=d.useRef(null),c=Object.fromEntries(Object.entries(I).map(([y,B])=>[y,t(B.metadata.displayName).toString()])),[u,g]=d.useState(l.current.getEdgeAttribute(n,"type")),[x,f]=d.useState(void 0),m=Object.fromEntries(Object.entries(R).map(([y,B])=>[y,t(B.metadata.displayName).toString()])),[S,L]=d.useState(l.current.getEdgeAttribute(n,"style")),[T,O]=d.useState(void 0),E=Object.values(ue).filter(y=>!R[S].metadata.supportLinePathType.includes(y)),z=Object.values(pe).filter(y=>!R[y].metadata.supportLinePathType.includes(u)),W=()=>{x&&(je(l.current,n,x),g(l.current.getEdgeAttribute(n,"type")),o())},ne=()=>{T&&(be(l.current,n,T,s),L(l.current.getEdgeAttribute(n,"style")),o())},M=y=>{y&&(x?(W(),f(void 0)):T&&(ne(),O(void 0))),p(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{label:t("panel.details.info.linePathType"),minW:"276",children:e.jsx(H,{options:c,disabledOptions:E,defaultValue:u,value:u,onChange:({target:{value:y}})=>{f(y),p(!0)}})}),e.jsx(U,{label:t("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(H,{options:m,disabledOptions:z,defaultValue:S,value:S,onChange:({target:{value:y}})=>{O(y),p(!0)}})}),e.jsx(we,{type:"line",expand:!0}),e.jsx(J,{isOpen:h,leastDestructiveRef:a,onClose:()=>M(!1),children:e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Y,{children:t("warning")}),e.jsx(ee,{children:t("panel.details.changeLineTypeContent")}),e.jsxs(te,{children:[e.jsx(b,{ref:a,onClick:()=>M(!1),children:t("cancel")}),e.jsx(b,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:t("panel.details.changeType")})]})]})})})]})}function ve(){const{t}=v(),r=C(),o=d.useCallback(()=>{r(N()),r(j(n.current.export()))},[r,N,j]),{selected:i}=A(m=>m.runtime),[s]=i,n=d.useRef(window.graph),[l,h]=d.useState(!1),p=d.useRef(null),[a,c]=d.useState(void 0),u=n.current.getNodeAttribute(s,"type"),g=Object.fromEntries(Object.entries($).map(([m,S])=>[m,t(S.metadata.displayName).toString()])),x=()=>{a&&(Se(n.current,s,a),o())},f=m=>{m&&x(),c(void 0),h(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(U,{label:t("panel.details.info.stationType"),minW:"276",children:e.jsx(H,{options:g,disabledOptions:[u],value:u,onChange:({target:{value:m}})=>{c(m),h(!0)}})}),e.jsx(J,{isOpen:l,leastDestructiveRef:p,onClose:()=>f(!1),children:e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Y,{children:t("warning")}),e.jsx(ee,{children:t("panel.details.changeStationTypeContent")}),e.jsxs(te,{children:[e.jsx(b,{ref:p,onClick:()=>f(!1),children:t("cancel")}),e.jsx(b,{ml:"2",colorScheme:"red",onClick:()=>f(!0),children:t("panel.details.changeType")})]})]})})})]})}function Te(){const{t}=v(),r=C(),o=d.useCallback(()=>{r(N()),r(w()),r(j(n.current.export()))},[r,w,j]),{selected:i}=A(p=>p.runtime),[s]=i,n=d.useRef(window.graph),l=p=>{const a=Math.min(Math.max(p,-5),5);n.current.hasNode(s)&&n.current.setNodeAttribute(s,"zIndex",a),n.current.hasEdge(s)&&n.current.setEdgeAttribute(s,"zIndex",a),o()},h=[];return i.size===0||(i.size===1?(h.push({type:"input",label:t("panel.details.info.id"),value:s,minW:276}),h.push({type:"select",label:t("panel.details.info.zIndex"),value:s?n.current.hasNode(s)?n.current.getNodeAttribute(s,"zIndex"):n.current.hasEdge(s)?n.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(p,a)=>[a-5,(a-5).toString()])),onChange:p=>l(Number(p))})):i.size>1&&h.push({type:"input",label:t("panel.details.info.type"),value:t("panel.details.multipleSelection.title"),minW:276})),e.jsxs(P,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:t("panel.details.info.title")}),e.jsx(V,{fields:h,minW:130}),i.size===1&&s.startsWith("stn")&&n.current.hasNode(s)&&n.current.getNodeAttribute(s,"type")in $&&e.jsx(ve,{}),i.size===1&&s.startsWith("line")&&n.current.hasEdge(s)&&n.current.getEdgeAttribute(s,"type")in I&&n.current.getEdgeAttribute(s,"style")in R&&e.jsx(Ae,{}),i.size>1&&e.jsx(Ce,{})]})}function Ee(){const{t}=v(),r=C(),{selected:o}=A(S=>S.runtime),[i]=o,s=d.useRef(window.graph),[n,l]=d.useState("undefined"),[h,p]=d.useState("undefined"),[a,c]=d.useState("undefined"),[u,g]=d.useState("undefined");d.useEffect(()=>{var S,L,T,O;if(i!=null&&i.startsWith("line")){const[E,z]=s.current.extremities(i);if(l(E),p(z),E.startsWith("stn")){const W=s.current.getNodeAttribute(E,"type");c((L=(S=s.current.getNodeAttribute(E,W))==null?void 0:S.names.at(0))!=null?L:"undefined")}if(z.startsWith("stn")){const W=s.current.getNodeAttribute(z,"type");g((O=(T=s.current.getNodeAttribute(z,W))==null?void 0:T.names.at(0))!=null?O:"undefined")}}},[o]);const x=q(()=>{r(D()),r(G(n))}),f=q(()=>{r(D()),r(G(h))}),m=[{type:"custom",label:t("panel.details.lineExtremities.source"),component:e.jsx(b,{flex:1,size:"sm",variant:"link",onClick:x,children:n}),minW:"full"},{type:"input",label:t("panel.details.lineExtremities.sourceName"),value:a,minW:"full"},{type:"custom",label:t("panel.details.lineExtremities.target"),component:e.jsx(b,{flex:1,size:"sm",variant:"link",onClick:f,children:h}),minW:"full"},{type:"input",label:t("panel.details.lineExtremities.targetName"),value:u,minW:"full"}];return e.jsxs(P,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:t("panel.details.lineExtremities.title")}),e.jsx(V,{fields:m,minW:130})]})}function ze(){const{t}=v(),r=C(),o=d.useCallback(()=>{r(N()),r(w()),r(j(l.current.export()))},[r,N,w,j]),{selected:i,refresh:{nodes:s}}=A(c=>c.runtime),[n]=i,l=d.useRef(window.graph),[h,p]=d.useState({x:0,y:0});d.useEffect(()=>{if(n!=null&&n.startsWith("stn")||n!=null&&n.startsWith("misc_node_")){const c=l.current.getNodeAttribute(n,"x"),u=l.current.getNodeAttribute(n,"y");p({x:c,y:u})}},[s,i]);const a=[{type:"input",label:t("panel.details.nodePosition.pos.x"),value:h.x.toString(),validator:c=>!Number.isNaN(c),onChange:c=>{l.current.mergeNodeAttributes(n,{x:Number(c)}),o()}},{type:"input",label:t("panel.details.nodePosition.pos.y"),value:h.y.toString(),validator:c=>!Number.isNaN(c),onChange:c=>{l.current.mergeNodeAttributes(n,{y:Number(c)}),o()}}];return e.jsxs(P,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:t("panel.details.nodePosition.title")}),e.jsx(V,{fields:a,minW:130})]})}const K={...$,...Ne},Re=()=>{var p;const t=C(),{selected:r}=A(a=>a.runtime),{t:o}=v(),[i]=r,s=window.graph.getNodeAttribute(i,"type"),n=s in K&&K[s].attrsComponent,l=(p=window.graph.getNodeAttribute(i,s))!=null?p:{},h=(a,c)=>{const u=window.graph.getNodeAttribute(a,"type");window.graph.mergeNodeAttributes(a,{[u]:c}),t(N()),t(j(window.graph.export()))};return n?e.jsx(n,{id:i,attrs:l,handleAttrsUpdate:h}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},ke=()=>{var g,x;const t=C(),{selected:r}=A(f=>f.runtime),{t:o}=v(),[i]=r,s=window.graph.getEdgeAttribute(i,"type"),n=(g=window.graph.getEdgeAttribute(i,s))!=null?g:{},l=s in I&&I[s].attrsComponent,h=window.graph.getEdgeAttribute(i,"style"),p=(x=window.graph.getEdgeAttribute(i,h))!=null?x:{},a=h in R&&R[h].attrsComponent,c=(f,m)=>{window.graph.mergeEdgeAttributes(f,{[s]:m}),t(w()),t(j(window.graph.export()))},u=(f,m)=>{window.graph.mergeEdgeAttributes(f,{[h]:m}),t(w()),t(j(window.graph.export()))};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:i,attrs:n,handleAttrsUpdate:c}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.linePath")})}),a?e.jsx(a,{id:i,attrs:p,handleAttrsUpdate:u}):e.jsx(F,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.lineStyle")})})]})},Ue=()=>{const{t}=v(),r=C(),o=d.useRef(window.graph),i=d.useCallback(()=>{r(N()),r(w()),r(j(o.current.export()))},[r,N,w,j]),{selected:s,mode:n}=A(u=>u.runtime),[l]=s,h=()=>r(D()),p=u=>{const g=structuredClone(o.current.getNodeAttributes(u));g.x+=50,g.y+=50;const x=u.startsWith("stn")?"stn_".concat(Z(10)):"misc_node_".concat(Z(10));o.current.addNode(x,g),r(N()),r(j(o.current.export()))},a=u=>{const g=xe(o.current,u);navigator.clipboard.writeText(g)},c=u=>{r(D()),u.forEach(g=>{o.current.hasNode(g)?o.current.dropNode(g):o.current.hasEdge(g)&&o.current.dropEdge(g)}),i()};return e.jsxs(he,{isOpen:s.size>0&&!n.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ge,{onClose:h,children:t("panel.details.header")}),e.jsxs(me,{children:[e.jsx(Te,{}),s.size===1&&o.current.hasNode(l)&&e.jsx(ze,{}),s.size===1&&o.current.hasEdge(l)&&e.jsx(Ee,{}),s.size===1&&e.jsxs(P,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:t("panel.details.specificAttrsTitle")}),window.graph.hasNode(l)&&e.jsx(Re,{}),window.graph.hasEdge(l)&&e.jsx(ke,{})]})]}),e.jsx(fe,{children:e.jsxs(_,{children:[s.size===1&&o.current.hasNode([...s].at(0))&&e.jsx(b,{size:"sm",variant:"outline",onClick:()=>p([...s].at(0)),children:t("panel.details.footer.duplicate")}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>a(s),children:t("panel.details.footer.copy")}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>c(s),children:t("panel.details.footer.remove")})]})})]})};export{Ue as default};
