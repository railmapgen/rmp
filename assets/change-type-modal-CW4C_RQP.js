import{j as c,ag as ye,M as fe,ah as me,J as be,N as K,K as Se,L as xe,aG as Te,aH as Ce,aI as Ae,B as je,aJ as Ee,aK as Oe,O as Le,t as q,ax as ve}from"./chakra-CHkbW1Nc.js";import{L as S,S as x,aR as Q,ay as C,p as te,l as se,m as Ie,o as ne,c as Ne,d as W,v as V,w as $,x as F,C as Pe,M as Be,X as Me,U as Re,R as we,Y as We,j as ke}from"./index-DaU9j8Vt.js";import{u as ze,b as r}from"./react-3Z_4zUxA.js";import{s as T,n as _e}from"./master-manager-D2fxSZWT.js";const ee=[x.ShmetroBasic2020,x.LondonTubeBasic,x.ShanghaiSuburbanRailway],De=(n,s,o)=>{const i=n.getNodeAttribute(s,"type"),a=structuredClone(n.getNodeAttribute(s,i).names);for(let l=0;l<Math.abs(T[o].defaultAttrs.names.length-a.length);l++)T[o].defaultAttrs.names.length>a.length?a.push("Stn"):a.pop();const e={...T[o].defaultAttrs,names:a};(!Object.values(ee).includes(i)||!Object.values(ee).includes(o))&&(e.nameOffsetX=n.getNodeAttribute(s,i).nameOffsetX,e.nameOffsetY=n.getNodeAttribute(s,i).nameOffsetY),Q.includes(o)&&Q.includes(i)&&(e.color=structuredClone(n.getNodeAttribute(s,i).color)),n.removeNodeAttribute(s,i),n.mergeNodeAttributes(s,{type:o,[o]:e})},Ze=(n,s,o,i)=>i.filter(a=>s==="any"||n.getNodeAttribute(a,"type")===s).forEach(a=>{De(n,a,o)}),He=(n,s,o,i)=>{const a=n.getEdgeAttribute(s,"type"),e=n.getEdgeAttribute(s,"style");if(C[e].metadata.supportLinePathType.includes(o)){const l=structuredClone(te[o].defaultAttrs);let d=-1;if(i&&o!==se.Simple){const[g,m]=n.extremities(s),A=l.startFrom;d=Ie(n,o,g,m,A)}n.setEdgeAttribute(s,"parallelIndex",d),n.removeEdgeAttribute(s,a),n.mergeEdgeAttributes(s,{type:o,[o]:l})}},Ue=(n,s,o,i,a)=>i.filter(e=>s==="any"||n.getEdgeAttribute(e,"type")===s).forEach(e=>{He(n,e,o,a)}),Xe=(n,s,o,i)=>{const a=n.getEdgeAttribute(s,"type"),e=n.getEdgeAttribute(s,"style");if(C[o].metadata.supportLinePathType.includes(a)){const l=n.getEdgeAttribute(s,"zIndex"),d=n.getEdgeAttribute(s,e);n.removeEdgeAttribute(s,e);const g=structuredClone(C[o].defaultAttrs);S.has(e)&&S.has(o)?g.color=d.color:S.has(o)&&i&&(g.color=i),n.mergeEdgeAttributes(s,{style:o,[o]:g}),o===ne.River?n.setEdgeAttribute(s,"zIndex",-5):n.setEdgeAttribute(s,"zIndex",l!=null?l:0)}},Ye=(n,s,o,i,a)=>a.filter(e=>s==="any"||n.getEdgeAttribute(e,"style")===s).forEach(e=>{Xe(n,e,o,i)}),Ge=(n,s,o,i)=>i.filter(a=>S.has(n.getEdgeAttribute(a,"style"))).forEach(a=>{const e=n.getEdgeAttributes(a),l=e[e.style].color;(s==="any"||l[0]==s[0]&&l[1]==s[1]&&l[2]==s[2]&&l[3]==s[3])&&n.mergeEdgeAttributes(a,{[e.style]:{color:o}})}),Je=(n,s,o,i,a)=>{[...i,...a].forEach(e=>{const l=n.getNodeAttributes(e).type,d=n.getNodeAttribute(e,l);if(d.color!==void 0){const g=d.color;(s==="any"||g[0]==s[0]&&g[1]==s[1]&&g[2]==s[2]&&g[3]==s[3])&&(d.color=o)}n.mergeNodeAttributes(e,{[l]:d})})},Ke=(n,s,o,i,a)=>{[...s,...o].forEach(e=>{n.setNodeAttribute(e,"zIndex",a)}),i.forEach(e=>{n.setEdgeAttribute(e,"zIndex",a)})},Fe=n=>{const{isOpen:s,onClose:o,isSelect:i,filter:a}=n,{t:e}=ze(),l=Ne(),{selected:d}=W(t=>t.runtime),{preference:{autoParallel:g}}=W(t=>t.app),{activeSubscriptions:m}=W(t=>t.account),A=r.useCallback(()=>{l(V()),l($()),l(F(h.current.export()))},[l,V,$,F]),h=r.useRef(window.graph),k={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(te).map(([t,u])=>[t,e(u.metadata.displayName).toString()]))},z={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(C).map(([t,u])=>[t,e(u.metadata.displayName).toString()]))},_={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(T).map(([t,u])=>[t,e(u.metadata.displayName).toString()]))},j={id:"any",theme:[Pe.Other,"other","#ffffff",Be.black],value:e("header.settings.procedures.changeType.any")},[E,D]=r.useState(!1),[Z,H]=r.useState(0),[O,U]=r.useState(!1),[L,ae]=r.useState("any"),[v,oe]=r.useState(x.ShmetroBasic),[I,X]=r.useState(!1),[N,ie]=r.useState("any"),[P,le]=r.useState(ne.SingleColor),[B,Y]=r.useState(!1),[M,ce]=r.useState("any"),[R,re]=r.useState(se.Diagonal),[w,G]=r.useState(!1),[f,J]=r.useState(j),{theme:b,requestThemeChange:de}=Me(),[ue,he]=r.useState([]),ge=[{id:"changeZIndex",title:e("header.settings.procedures.changeZIndex"),onClose:()=>D(!E),field:[{type:"select",label:e("panel.details.info.zIndex"),value:Z,options:Object.fromEntries(Array.from({length:11},(t,u)=>[u-5,(u-5).toString()])),onChange:t=>H(Number(t))}]},{id:"changeStationType",title:e("header.settings.procedures.changeStationType.title"),onClose:()=>U(!O),field:[{type:"select",label:e("header.settings.procedures.changeStationType.changeFrom"),options:_,value:L,disabledOptions:[v],onChange:t=>ae(t)},{type:"select",label:e("header.settings.procedures.changeStationType.changeTo"),options:_,value:v,disabledOptions:["any",L],onChange:t=>oe(t)}]},{id:"changeLineStyleType",title:e("header.settings.procedures.changeLineStyleType.title"),onClose:()=>X(!I),field:[{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeFrom"),options:z,value:N,disabledOptions:[P],onChange:t=>ie(t)},{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeTo"),options:z,value:P,disabledOptions:["any",N],onChange:t=>le(t)}]},{id:"changeLinePathType",title:e("header.settings.procedures.changeLinePathType.title"),onClose:()=>Y(!B),field:[{type:"select",label:e("header.settings.procedures.changeLinePathType.changeFrom"),options:k,value:M,disabledOptions:[R],onChange:t=>ce(t)},{type:"select",label:e("header.settings.procedures.changeLinePathType.changeTo"),options:k,value:R,disabledOptions:["any","simple",M],onChange:t=>re(t)}]},{id:"changeColor",title:e("header.settings.procedures.changeColor.title"),onClose:()=>G(!w),field:[{type:"custom",label:e("header.settings.procedures.changeColor.changeFrom"),component:c.jsx(Re,{data:ue,displayHandler:t=>c.jsx(we,{name:t.value,fg:t.theme[3],bg:t.theme[2],title:t.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(t,u)=>u.id.toLowerCase().includes(t.toLowerCase())||Object.values(u.id).some(y=>y.toLowerCase().includes(t.toLowerCase())),value:f.value,onChange:t=>J(t)})},{type:"custom",label:e("header.settings.procedures.changeColor.changeTo"),component:c.jsx(We,{theme:b,onClick:de})}]}];r.useEffect(()=>{s&&(D(!1),U(!1),X(!1),Y(!1),G(!1),H(0),he([j,..._e(h.current,i?[...d].filter(t=>t.startsWith("stn")||t.startsWith("misc_node")):h.current.nodes(),i?[...d].filter(t=>t.startsWith("line")):h.current.edges()).map(t=>({id:t.toString(),theme:t,value:t[1]==="other"?t[2]:t[1]}))]),J(j))},[s]);const pe=()=>{const t=a!=null&&a.includes("station")?[...d].filter(p=>p.startsWith("stn")):i?[]:h.current.filterNodes(p=>p.startsWith("stn")),u=a!=null&&a.includes("misc-node")?[...d].filter(p=>p.startsWith("misc_node")):i?[]:h.current.filterNodes(p=>p.startsWith("misc_node")),y=i?[...d].filter(p=>p.startsWith("line")):h.current.edges();(!a||a.includes("station"))&&O&&Ze(h.current,L,v,t),(!a||a.includes("line"))&&I&&Ye(h.current,N,P,b,y),(!a||a.includes("line"))&&B&&Ue(h.current,M,R,y,g),w&&((!a||a.includes("line"))&&Ge(h.current,f.id==="any"?"any":f.theme,b,y),(!a||a.includes("misc-node")||a.includes("station"))&&Je(h.current,f.id==="any"?"any":f.theme,b,t,u)),E&&Ke(h.current,t,u,y,Z),A(),o()};return c.jsxs(ye,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[c.jsx(fe,{}),c.jsxs(me,{children:[c.jsxs(be,{children:[c.jsx(K,{as:"b",fontSize:"xl",children:e(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),c.jsx(Se,{})]}),c.jsx(xe,{children:c.jsx(Te,{allowMultiple:!0,children:ge.map(t=>c.jsxs(Ce,{children:[c.jsxs(Ae,{onClick:t.onClose,children:[c.jsx(je,{as:"span",flex:"1",textAlign:"left",children:c.jsx(K,{as:"b",fontSize:"md",children:t.title})}),c.jsx(Ee,{})]}),c.jsx(Oe,{pb:4,children:c.jsx(ke,{fields:t.field,minW:270})})]},t.id))})}),c.jsxs(Le,{children:[c.jsx(q,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:e("cancel")}),c.jsx(ve,{label:e("header.settings.pro"),isOpen:!m.RMP_CLOUD,children:c.jsx(q,{colorScheme:"red",mr:"1",onClick:pe,isDisabled:!m.RMP_CLOUD||!E&&!O&&!I&&!B&&!w,children:e("apply")})})]})]})]})};export{Fe as C,Xe as a,De as b,He as c};
