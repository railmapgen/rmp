import{j as l,at as de,$ as ue,au as he,a1 as pe,a4 as q,a2 as ge,a3 as ye,aM as fe,aN as me,aO as be,B as Se,aP as Te,aQ as Ce,a5 as Ae,O as X}from"./chakra-sjIlidOs.js";import{S as J,ac as T,m as K,L as b,o as U,f as xe,a as je,q as Y,t as G,v as Q,C as ve,c as Ee,l as Le,_ as Oe,R as Ne,T as Pe,H as we,j as Be}from"./index-7lORjRac.js";import{u as Re,b as r}from"./react-hBmrxY6U.js";import{c as Ie}from"./graph-CRK2VLkH.js";import{s as S}from"./stations-RfBpUMgw.js";const $=[J.ShmetroBasic2020],Me=(a,t,o)=>{const i=a.getNodeAttribute(t,"type"),n=structuredClone(a.getNodeAttribute(t,i).names);for(let c=0;c<Math.abs(S[o].defaultAttrs.names.length-n.length);c++)S[o].defaultAttrs.names.length>n.length?n.push("Stn"):n.pop();const s={...S[o].defaultAttrs,names:n};(!Object.values($).includes(i)||!Object.values($).includes(o))&&(s.nameOffsetX=a.getNodeAttribute(t,i).nameOffsetX,s.nameOffsetY=a.getNodeAttribute(t,i).nameOffsetY),a.removeNodeAttribute(t,i),a.mergeNodeAttributes(t,{type:o,[o]:s})},We=(a,t,o,i)=>i.filter(n=>t==="any"||a.getNodeAttribute(n,"type")===t).forEach(n=>{Me(a,n,o)}),ke=(a,t,o)=>{const i=a.getEdgeAttribute(t,"type"),n=a.getEdgeAttribute(t,"style");if(T[n].metadata.supportLinePathType.includes(o)){a.removeEdgeAttribute(t,i);const s=structuredClone(K[o].defaultAttrs);a.mergeEdgeAttributes(t,{type:o,[o]:s})}},ze=(a,t,o,i)=>i.filter(n=>t==="any"||a.getEdgeAttribute(n,"type")===t).forEach(n=>{ke(a,n,o)}),_e=(a,t,o,i)=>{const n=a.getEdgeAttribute(t,"type"),s=a.getEdgeAttribute(t,"style");if(T[o].metadata.supportLinePathType.includes(n)){const c=a.getEdgeAttribute(t,"zIndex"),d=a.getEdgeAttribute(t,s);a.removeEdgeAttribute(t,s);const u=structuredClone(T[o].defaultAttrs);b.includes(s)&&b.includes(o)?u.color=d.color:b.includes(o)&&i&&(u.color=i),a.mergeEdgeAttributes(t,{style:o,[o]:u}),o===U.River?a.setEdgeAttribute(t,"zIndex",-5):a.setEdgeAttribute(t,"zIndex",c!=null?c:0)}},De=(a,t,o,i,n)=>n.filter(s=>t==="any"||a.getEdgeAttribute(s,"style")===t).forEach(s=>{_e(a,s,o,i)}),He=(a,t,o,i)=>i.filter(n=>b.includes(a.getEdgeAttribute(n,"style"))).forEach(n=>{const s=a.getEdgeAttributes(n),c=s[s.style].color;(t==="any"||c[0]==t[0]&&c[1]==t[1]&&c[2]==t[2]&&c[3]==t[3])&&a.mergeEdgeAttributes(n,{[s.style]:{color:o}})}),qe=(a,t,o,i,n)=>{[...i,...n].forEach(s=>{const c=a.getNodeAttributes(s).type,d=a.getNodeAttribute(s,c);if(d.color!==void 0){const u=d.color;(t==="any"||u[0]==t[0]&&u[1]==t[1]&&u[2]==t[2]&&u[3]==t[3])&&(d.color=o)}a.mergeNodeAttributes(s,{[c]:d})})},Je=a=>{const{isOpen:t,onClose:o,isSelect:i,filter:n}=a,{t:s}=Re(),c=xe(),{selected:d,theme:u,paletteAppClip:{output:y}}=je(e=>e.runtime),V=r.useCallback(()=>{c(Y()),c(G()),c(Q(h.current.export()))},[c,Y,G,Q]),h=r.useRef(window.graph),R={any:s("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(K).map(([e,p])=>[e,s(p.metadata.displayName).toString()]))},I={any:s("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(T).map(([e,p])=>[e,s(p.metadata.displayName).toString()]))},M={any:s("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(S).map(([e,p])=>[e,s(p.metadata.displayName).toString()]))},C={id:"any",theme:[ve.Other,"other","#ffffff",Ee.black],value:s("header.settings.procedures.changeType.any")},[A,W]=r.useState(!1),[x,Z]=r.useState("any"),[j,F]=r.useState(J.ShmetroBasic),[v,k]=r.useState(!1),[E,ee]=r.useState("any"),[L,te]=r.useState(U.SingleColor),[O,z]=r.useState(!1),[N,se]=r.useState("any"),[P,ne]=r.useState(Le.Diagonal),[w,_]=r.useState(!1),[f,D]=r.useState(C),[B,ae]=r.useState(u),[oe,H]=r.useState(!1);r.useEffect(()=>{oe&&y&&(ae(y),H(!1))},[y==null?void 0:y.toString()]);const[ie,le]=r.useState([]),ce=[{id:"changeStationType",title:s("header.settings.procedures.changeStationType.title"),onClose:()=>W(!A),field:[{type:"select",label:s("header.settings.procedures.changeStationType.changeFrom"),options:M,value:x,disabledOptions:[j],onChange:e=>Z(e)},{type:"select",label:s("header.settings.procedures.changeStationType.changeTo"),options:M,value:j,disabledOptions:["any",x],onChange:e=>F(e)}]},{id:"changeLineStyleType",title:s("header.settings.procedures.changeLineStyleType.title"),onClose:()=>k(!v),field:[{type:"select",label:s("header.settings.procedures.changeLineStyleType.changeFrom"),options:I,value:E,disabledOptions:[L],onChange:e=>ee(e)},{type:"select",label:s("header.settings.procedures.changeLineStyleType.changeTo"),options:I,value:L,disabledOptions:["any",E],onChange:e=>te(e)}]},{id:"changeLinePathType",title:s("header.settings.procedures.changeLinePathType.title"),onClose:()=>z(!O),field:[{type:"select",label:s("header.settings.procedures.changeLinePathType.changeFrom"),options:R,value:N,disabledOptions:[P],onChange:e=>se(e)},{type:"select",label:s("header.settings.procedures.changeLinePathType.changeTo"),options:R,value:P,disabledOptions:["any","simple",N],onChange:e=>ne(e)}]},{id:"changeColor",title:s("header.settings.procedures.changeColor.title"),onClose:()=>_(!w),field:[{type:"custom",label:s("header.settings.procedures.changeColor.changeFrom"),component:l.jsx(Oe,{data:ie,displayHandler:e=>l.jsx(Ne,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,p)=>p.id.toLowerCase().includes(e.toLowerCase())||Object.values(p.id).some(m=>m.toLowerCase().includes(e.toLowerCase())),value:f.value,onChange:e=>D(e)})},{type:"custom",label:s("header.settings.procedures.changeColor.changeTo"),component:l.jsx(Pe,{theme:B,onClick:()=>{H(!0),c(we(u))}})}]}];r.useEffect(()=>{t&&(W(!1),k(!1),z(!1),_(!1),le([C,...Ie(h.current,i?[...d].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):h.current.nodes(),i?[...d].filter(e=>e.startsWith("line")):h.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),D(C))},[t]);const re=()=>{const e=n!=null&&n.includes("station")?[...d].filter(g=>g.startsWith("stn")):i?[]:h.current.filterNodes(g=>g.startsWith("stn")),p=n!=null&&n.includes("misc-node")?[...d].filter(g=>g.startsWith("misc_node")):i?[]:h.current.filterNodes(g=>g.startsWith("misc_node")),m=i?[...d].filter(g=>g.startsWith("line")):h.current.edges();(!n||n.includes("station"))&&A&&We(h.current,x,j,e),(!n||n.includes("line"))&&v&&De(h.current,E,L,u,m),(!n||n.includes("line"))&&O&&ze(h.current,N,P,m),w&&((!n||n.includes("line"))&&He(h.current,f.id==="any"?"any":f.theme,B,m),(!n||n.includes("misc-node")||n.includes("station"))&&qe(h.current,f.id==="any"?"any":f.theme,B,e,p)),V(),o()};return l.jsxs(de,{isOpen:t,onClose:o,size:"md",scrollBehavior:"inside",children:[l.jsx(ue,{}),l.jsxs(he,{children:[l.jsxs(pe,{children:[l.jsx(q,{as:"b",fontSize:"xl",children:s(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),l.jsx(ge,{})]}),l.jsx(ye,{children:l.jsx(fe,{allowMultiple:!0,children:ce.map(e=>l.jsxs(me,{children:[l.jsxs(be,{onClick:e.onClose,children:[l.jsx(Se,{as:"span",flex:"1",textAlign:"left",children:l.jsx(q,{as:"b",fontSize:"md",children:e.title})}),l.jsx(Te,{})]}),l.jsx(Ce,{pb:4,children:l.jsx(Be,{fields:e.field,minW:270})})]},e.id))})}),l.jsxs(Ae,{children:[l.jsx(X,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:s("cancel")}),l.jsx(X,{colorScheme:"red",mr:"1",onClick:re,isDisabled:!A&&!v&&!O&&!w,children:s("apply")})]})]})]})};export{Je as C,_e as a,Me as b,ke as c};
