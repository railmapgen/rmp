import{j as e,ag as Q,M as J,ah as ee,J as X,K as se,L as q,h as bs,ai as _t,N as m,B as E,aj as Te,ak as Re,T as ae,al as le,b as ce,q as cs,t as I,O as me,am as kt,an as Mt,ao as Ae,R as N,ap as B,Q as tt,aq as Ts,ar as zs,a2 as ne,as as Rs,at as pe,x as te,au as ds,av as K,U as ns,V as rs,X as hs,Y as Gs,G as Ot,H as At,n as nt,a8 as rt,e as it,w as ot,m as at,E as lt,aw as ze,ax as Tt,a7 as de,a1 as zt,ay as Rt,az as Et,aA as V,aB as $s,aC as Nt,aD as R,aE as O,aF as It}from"./chakra-C1zJvDsN.js";import{u as Lt,r as z,C as Dt,M as Es,d as ct,n as ws,S as W,R as Us,a as dt,b as L,c as F,e as G,f as Pt,g as Bt,h as Wt,i as Gt,j as Ge,k as Ne,E as _e,s as $t,l as is,m as Ut,L as ps,o as Ft,p as Fs,q as Ht,t as Ns,v as Is,w as re,x as xe,y as ie,z as ue,A as ht,B as Vt,D as pt,F as Ss,G as Ie,H as He,I as Hs,J as Vs,K as Yt,N as Kt,O as Zt,P as Ys,Q as Jt,T as Ks,U as Xt,V as qt,W as Qt,X as en,Y as sn,Z as tn,_ as nn,$ as rn,a0 as on,a1 as an,a2 as ln,a3 as cn,a4 as dn,a5 as hn,a6 as pn,a7 as es,a8 as un,a9 as gn,aa as xn,ab as mn,ac as fn,ad as ye,ae as jn,af as bn,ag as wn,ah as Sn,ai as je,aj as yn,ak as Cn,al as Zs,am as vn,an as _n,ao as us,ap as kn,aq as Mn,ar as On,as as An,at as Tn,au as zn,av as Rn,aw as En,ax as Nn,ay as In,az as Ln}from"./index-CFz1ouaQ.js";import{u as $,b as j,T as ys,r as ss}from"./react-BpF4RbzH.js";import{d as Cs,r as Dn,i as Js,m as Pn,a as Bn,s as Wn,b as ut,p as vs,M as Gn}from"./master-manager-BRCIFoXr.js";import{C as $n}from"./change-type-modal-DbQ7CrJg.js";import"./change-types-eOtJ3CrR.js";var Xs=function(s){return Lt(z.ready(),s)};const Un=s=>{const{isOpen:a,onClose:i}=s,{t}=$(),r=z.getAppVersion();return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:t("header.about.title")}),e.jsx(se,{}),e.jsxs(q,{paddingBottom:10,children:[e.jsxs(bs,{direction:"row",children:[e.jsx(_t,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(bs,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(m,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),e.jsx(m,{children:r}),e.jsx(m,{}),e.jsx(m,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e.jsx(E,{margin:5,children:e.jsx(m,{fontSize:"xl",children:t("header.about.desc")})}),e.jsx(Te,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e.jsx(Te,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e.jsxs(Re,{children:[e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(m,{fontSize:"sm",children:t("header.about.content1")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(m,{fontSize:"sm",children:t("header.about.langonginc")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Te,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),e.jsxs(Re,{children:[e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),e.jsx(Te,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),e.jsxs(Re,{children:[e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e.jsx(m,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e.jsx(m,{fontSize:"sm",children:t("header.about.slackContent")}),e.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Te,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),e.jsxs(Re,{children:[e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),e.jsx(m,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),e.jsxs(ae,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(le,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ce,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),e.jsx(m,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Ve(s){const a=s.sizes.shift(),i=Math.max(Math.ceil(a[0]),1),t=Math.max(Math.ceil(a[1]),1),r=[i-1,t-1,1,1],o=performance.now(),n=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let p,c;n?(p=new OffscreenCanvas(1,1),c=new OffscreenCanvas(i,t)):(p=document.createElement("canvas"),p.width=1,p.height=1,c=document.createElement("canvas"),c.width=i,c.height=t);const g=p.getContext("2d"),f=c.getContext("2d");f&&(f.fillRect.apply(f,r),g.drawImage(c,i-1,t-1,1,1,0,0,1,1));const x=g&&g.getImageData(0,0,1,1).data[3]!==0,d=parseInt(performance.now()-o);return[p,c].forEach((u=>{u.height=0,u.width=0})),n?(postMessage({width:i,height:t,testTime:d,isTestPass:x}),!x&&s.sizes.length&&setTimeout((()=>{Ve(s)}),0)):x?s.onSuccess({width:i,height:t,testTime:d}):(s.onError({width:i,height:t,testTime:d}),s.sizes.length&&setTimeout((()=>{Ve(s)}),0)),x}const gs={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Ee={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},$e={};function xs(s){const a=s.width===s.height,i=s.height===1,t=s.width===1,r=[];if(!s.width||!s.height)s.sizes.forEach((o=>{const n=a||i?o:1,p=a||t?o:1;r.push([n,p])}));else{const o=s.min||Ee.min,n=s.step||Ee.step;let p=Math.max(s.width,s.height);for(;p>=o;){const c=a||i?p:1,g=a||t?p:1;r.push([c,g]),p-=n}}return r}function ts(s){const a=typeof window<"u",i=a&&"Promise"in window,t=a&&"HTMLCanvasElement"in window,r=a&&"OffscreenCanvas"in window,o=URL.createObjectURL(new Blob([])).slice(-36),n=performance.now(),{onError:p,onSuccess:c,...g}=s,f=()=>parseInt(performance.now()-n);let x=null;if(!t)return!1;if(s.useWorker&&r){const d="\n            var canvasTest = ".concat(Ve.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),u=new Blob([d],{type:"application/javascript"}),h=URL.createObjectURL(u);x=new Worker(h),URL.revokeObjectURL(h),x.onmessage=function(l){const{width:S,height:w,testTime:b,isTestPass:y}=l.data,_={width:S,height:w,testTime:b,totalTime:f()};y?($e[o].onSuccess(_),delete $e[o]):$e[o].onError(_)}}if(i)return new Promise((d=>{const u={...s,onError(h){let{width:l,height:S,testTime:w}=h;const b={width:l,height:S,testTime:w,totalTime:f()};let y;if(s.sizes.length===0)y=!0;else{const[[_,C]]=s.sizes.slice(-1);y=l===_&&S===C}p(b),y&&d({...b,success:!1})},onSuccess(h){let{width:l,height:S,testTime:w}=h;const b={width:l,height:S,testTime:w,totalTime:f()};c(b),d({...b,success:!0})}};if(x){const{onError:h,onSuccess:l}=u;$e[o]={onError:h,onSuccess:l},x.postMessage(g)}else Ve(u)}));if(x)$e[o]={onError:p,onSuccess:c},x.postMessage(g);else return Ve(s)}const Fn={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=xs({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...gs.area]}),i={...Ee,...s,sizes:a};return ts(i)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=xs({width:1,height:s.max,min:s.min,step:s.step,sizes:[...gs.height]}),i={...Ee,...s,sizes:a};return ts(i)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=xs({width:s.max,height:1,min:s.min,step:s.step,sizes:[...gs.width]}),i={...Ee,...s,sizes:a};return ts(i)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={...Ee,...s};return a.sizes=[...a.sizes],a.width&&a.height&&(a.sizes=[[a.width,a.height]]),ts(a)}};var Ye=(s=>(s.left="l",s.right="r",s))(Ye||{}),ve=(s=>(s.through="through",s.nonThrough="nonthrough",s))(ve||{}),os=(s=>(s.local="local",s.express="express",s.direct="direct",s))(os||{}),be=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(be||{}),Ls=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Ls||{});const ge=new Set,_s=new Set,ks=new Set,Ms=new Set,gt=new Map,we=new Map,ms=new Set,fs=new Map,Z=new Map;let D=[],Ue=0;const Fe=new Map,js=new Map,Os=new Set,Hn={localisedName:{en:"LEFT END"},num:"00",services:[os.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Vn={localisedName:{en:"RIGHT END"},num:"00",services:[os.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Yn={},xt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:be.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Ye.right,platform_num:"1",theme:[Dt.Shanghai,"sh1","#E3002B",Es.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Yn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Ls.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Kn={localisedName:{},num:"",services:[os.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},T=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),Ds=s=>ct.has(s),Zn=s=>{if(Ds(s.style))return structuredClone(s[s.style].color)},Jn=(s,a)=>{const[i,t]=s.extremities(a),r=s.getEdgeAttributes(a),o=r.style;if(i!=t&&Ds(o)){const n=Zn(r);Ms.has(T(n))||(ks.add(n),Ms.add(T(n)),gt.set(n,i),we.set(T(n),new Set)),we.get(T(n)).add(i),we.get(T(n)).add(t),Z.has(i)?D.push({target:t,next:Z.get(i),color:n}):D.push({target:t,next:-1,color:n}),Z.set(i,Ue),Ue++,Z.has(t)?D.push({target:i,next:Z.get(t),color:n}):D.push({target:i,next:-1,color:n}),Z.set(t,Ue),Ue++}},mt=(s,a,i)=>{if(we.get(T(i)).has(s)){we.get(T(i)).delete(s);for(let t=Z.get(s);t!=-1;t=D[t].next){const r=D[t].target,o=D[t].color;T(o)==T(i)&&mt(r,s,i)}}},ft=(s,a,i)=>{if(ge.has(s))return;ge.add(s);let t=0;const r=new Set;for(let o=Z.get(s);o!=-1;o=D[o].next){const n=D[o].target,p=D[o].color;T(p)==T(i)&&(r.has(n)||(r.add(n),t++,n!=a&&ft(n,s,i)))}Fe.set(s,t)},qs=(s,a)=>{const i=s.stn_list.lineend.parents;i.push(a),s.stn_list.lineend.parents=structuredClone(i).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[ve.through,i[1]]:void 0}},Xn=(s,a)=>{let i=0;for(let t=Z.get(s);t!=-1;t=D[t].next){D[t].target;const r=D[t].color;T(r)==T(a)&&i++}return i},jt=(s,a,i)=>{if(Os.has(s))return[];Os.add(s);const t=[];for(let r=Z.get(s);r!=-1;r=D[r].next){const o=D[r].target,n=D[r].color;o!=a&&T(n)==T(i)&&(o.startsWith("stn")?t.push(o):t.push(...jt(o,s,i)))}return t},As=(s,a,i,t,r,o,n)=>{var d;if(ge.has(s)&&(!s.startsWith("misc_node_")&&n.stn_list[s]==null||s.startsWith("misc_node_")&&!_s.has(s)||n.loop))return[];if(ge.has(s)&&n.stn_list[s]!=null&&Xn(s,o)-1>=2){const u=[...n.stn_list[s].parents,a];if(n.stn_list[u[1]]==null){const S=u[0];u[0]=u[1],u[1]=S}n.stn_list[s].parents=structuredClone(u).reverse(),n.stn_list[s].branch={...n.stn_list[s].branch,left:[ve.through,u[1]]};const h=[];for(const S of n.stn_list[s].children)S!=a&&h.push(S);n.stn_list[s].children=structuredClone(h),(d=n.stn_list[s].branch)==null||delete d.right;const l=[];for(const S of n.stn_list.lineend.parents)S!=s&&l.push(S);return n.stn_list.lineend.parents=structuredClone(l).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[ve.through,l[1]]:void 0},h.length==0&&(n.stn_list[s].children=["lineend"],qs(n,s)),[s]}ge.add(s);const p=[],c=[],g=[],f=new Set,x=new Set;for(let u=Z.get(s);u!=-1;u=D[u].next){const h=D[u].target,l=D[u].color;if(h!=i){if(T(l)==T(o)){if(x.has(h))continue;if(x.add(h),s.startsWith("misc_node_")){const S=As(h,a,s,t+1,r,o,n);S.length!=0&&p.push(...S)}else{const S=As(h,s,s,t+1,r,o,n);S.length!=0&&p.push(...S)}}if(!f.has(T(l))&&T(l)!=T(o)){f.add(T(l));const S={theme:l,name:["ch_".concat(T(l)),"en_".concat(T(l))]};g.push(S)}}}if(p.length==2){for(let u=0;u<2;u++)p[u]=="lineend"&&p.splice(u,1);if(n.stn_list[p[1]].parents.length>=2){const u=p[0];p[0]=p[1],p[1]=u}}if(ge.has(s)&&n.stn_list[s]!=null){const u=[];for(const h of n.stn_list.lineend.parents)h!=s&&u.push(h);n.stn_list.lineend.parents=structuredClone(u).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[ve.through,u[1]]:void 0},p.length==0&&(Os.clear(),c.push(...jt(s,a,o)))}if(s.startsWith("misc_node_"))return _s.add(s),p;{const u=r.getNodeAttributes(s).type,h=r.getNodeAttributes(s)[u];if(n.stn_list[s]=structuredClone(Kn),n.stn_list[s].localisedName={zh:h.names[0],en:h.names[1]},n.stn_list[s].num=String(t),r.getNodeAttributes(s).type==W.GzmtrBasic){const l=h;n.stn_list[s].num=l.stationCode,(l.secondaryNames[0]!==""||l.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:l.secondaryNames[0],en:l.secondaryNames[1]})}if(r.getNodeAttributes(s).type==W.GzmtrInt){const l=h,S=l.transfer[0];for(const w of S)if(T(w)==T(o)){n.stn_list[s].num=String(w[5]);break}(l.secondaryNames[0]!==""||l.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:l.secondaryNames[0],en:l.secondaryNames[1]})}return p.length!=0?(n.stn_list[s].children=structuredClone(p).reverse(),p.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,right:[ve.through,p[1]]})):(n.stn_list[s].children=["lineend"],qs(n,s)),c.push(a),n.stn_list[s].parents=structuredClone(c).reverse(),c.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,left:[ve.through,c[1]]}),g.length!=0&&(n.stn_list[s].transfer.groups[0].lines=structuredClone(g)),[s]}},qn=(s,a,i,t)=>{const r=structuredClone(xt);t=="LOOP"&&(r.loop=!0);let o;switch(s.getNodeAttributes(i).type){case W.GzmtrBasic:case W.GzmtrInt:o=be.GZMTR;break;case W.MTR:o=be.MTR;break;default:o=be.SHMetro;break}r.theme=structuredClone(a),r.style=o,r.stn_list.linestart=structuredClone(Hn),r.stn_list.lineend=structuredClone(Vn),ge.clear(),_s.clear();const n=As(i,"linestart","linestart",1,s,a,r);if(r.current_stn_idx=n[0],r.stn_list.linestart.children=[n[0]],!(Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3))return structuredClone(r)},Qn=s=>{var t,r;ge.clear(),ks.clear(),Ms.clear(),gt.clear(),we.clear(),ms.clear(),fs.clear(),Z.clear(),D=[],Ue=0,Fe.clear(),js.clear(),s.filterEdges(o=>o.startsWith("line")).forEach(o=>{Ds(s.getEdgeAttributes(o).style)&&Jn(s,o)});let a=0;s.forEachNode(o=>{js.set(o,++a)}),js.set("lineend",++a);const i=[];for(const o of ks){let n=0;for(;we.get(T(o)).size!=0;){let p="line_root";we.get(T(o)).forEach(g=>{p=="line_root"&&(p=g)}),mt(p,"line_root",o);const c={theme:o,index:++n};ms.add(c),fs.set(c,p)}}for(const o of ms){const{theme:n}=o;ge.clear(),Fe.clear(),ft(fs.get(o),"line_root",n);let p=!0,c="LINE";const g=[];for(const[x,d]of Fe)d==1&&g.push(x),d==3&&(c="BRANCH"),d>3&&(p=!1);if(!p)continue;g.length==0&&(c="LOOP",Fe.forEach((x,d)=>{g.push(d)}));const f=[];for(const x of g){const d=qn(s,n,x,c);d!=null&&f.push([d,(t=d.stn_list[d.current_stn_idx].localisedName.zh)!=null?t:"",(r=d.stn_list[d.current_stn_idx].localisedName.en)!=null?r:""])}f.length!=0&&i.push({id:ws(10),theme:n,param:structuredClone(f),type:c})}return i},er=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),sr=(s,a)=>{let i=s;return a.forEach((t,r)=>{const o=new RegExp("ch_".concat(r),"g"),n=new RegExp("en_".concat(r),"g");i=i.replace(o,t[0]),i=i.replace(n,t[1])}),i},tr=(s,a,i,t)=>{s.line_name=a,s.line_num=String(i),Cs("RMG_".concat(er(a),".json"),"application/json",sr(JSON.stringify(s),t))},nr={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},rr=s=>{const{isOpen:a,onClose:i}=s,{t}=$(),r=j.useRef(window.graph),[o,n]=j.useState(!1),[p,c]=j.useState([[xt,"",""]]),[g,f]=j.useState(["","",""]),[x,d]=j.useState(new Map),[u,h]=j.useState(new Map),[l,S]=j.useState([]);j.useEffect(()=>{if(a){const b=Qn(r.current),y=new Map;b.forEach(({id:_,theme:C})=>{y.set(T(C),_)}),S(b),d(y)}},[a]);const w=(b,y)=>document.getElementById("2RMG_"+y+"_"+b).value.trim();return e.jsxs(Q,{isOpen:a,onClose:i,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:e.jsx(m,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),e.jsx(se,{}),e.jsxs(q,{children:[e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),e.jsx("br",{}),l.length===0?e.jsx(m,{fontSize:"md",children:t("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:l.map(({id:b,theme:y,param:_,type:C})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Us,{name:y[0]=="other"&&y[1]=="other"?y[2]:y[1],bg:y[2],fg:y[3]})}),e.jsx("td",{children:e.jsx(cs,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(b),size:"sm"})}),e.jsx("td",{children:e.jsx(cs,{placeholder:t("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(b),size:"sm"})}),e.jsx("td",{children:e.jsx(cs,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(b),size:"sm"})}),e.jsx("td",{children:e.jsx(Us,{name:t("header.download.2rmg.type.".concat(C.toLowerCase())),bg:nr[C],fg:Es.white})}),e.jsx("td",{children:e.jsx(I,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const k=w(b,"nameCh"),M=w(b,"nameEn"),P=w(b,"lineNum"),H=new Map;x.forEach((U,fe)=>{H.set(fe,[w(U,"nameCh"),w(U,"nameEn")])}),c(_),f([k,M,P]),h(H),n(!0)},size:"sm",children:e.jsx(dt,{})})})]},b))})})]}),e.jsx(me,{children:e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:t("close")})})]}),e.jsx(ir,{isOpen:o,onClose:()=>n(!1),param:p,nameList:g,interchangeName:u})]})},ir=s=>{const{isOpen:a,onClose:i,param:t,nameList:r,interchangeName:o}=s,{t:n}=$(),[p,c]=j.useState("");return j.useEffect(()=>{r[0]!=""&&r[1]!=""?c(r[0]+"/"+r[1]):r[0]!=""?c(r[0]):r[1]!=""?c(r[1]):c("")},[...r]),e.jsxs(Q,{isOpen:a,onClose:i,size:"md",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:e.jsxs(m,{as:"b",fontSize:"xl",children:[n("header.download.2rmg.download")," ",p]})}),e.jsx(se,{}),e.jsx(q,{children:e.jsxs(kt,{children:[e.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:n("header.download.2rmg.downloadInfo")}),t.map(([g,f,x])=>e.jsxs(I,{onClick:()=>{tr(g,[r[0],r[1]],r[2],o)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[f.replaceAll("\n","⏎"),"/",x.replaceAll("\n","⏎")]},"".concat(f).concat(x)))]})}),e.jsx(me,{children:e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:n("close")})})]})]})},or=s=>{const{isOpen:a,onClose:i}=s,{t}=$();return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:t("header.download.termsAndConditions")}),e.jsx(se,{}),e.jsx(q,{children:e.jsxs(Mt,{children:[e.jsxs(Ae,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(N,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(B,{as:L})]}),", ",e.jsxs(N,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(B,{as:L})]})," or ",e.jsxs(N,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(B,{as:L})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(N,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(B,{as:L})]}),"，",e.jsxs(N,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(B,{as:L})]}),"或",e.jsxs(N,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(B,{as:L})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(Ae,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(B,{as:L})]})," and ",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(B,{as:L})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(B,{as:L})]}),"及",e.jsxs(N,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(B,{as:L})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(Ae,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(N,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(B,{as:L})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(N,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(B,{as:L})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(Ae,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(Ae,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(N,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(B,{as:L})]})," ","– the open-source emoji and icon project. License:",e.jsxs(N,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(B,{as:L})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(N,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(B,{as:L})]}),"所设计。许可证：",e.jsxs(N,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(B,{as:L})]})]}),e.jsxs(Ae,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},ar=()=>{const s="https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download",a=new Date,i="".concat(a.getFullYear()).concat(String(a.getMonth()+1).padStart(2,"0"),"01"),t="".concat(String(a.getFullYear()).slice(-2),".").concat(a.getMonth()+1,".1"),r=navigator.platform,o=r.includes("Linux")?"amd64.AppImage":r.includes("Mac")?"aarch64.dmg":"x64-setup.exe";return s+"/tauri-".concat(i,"/Rail.Map.Toolkit_").concat(t,"_").concat(o)};function lr(){const s=tt("white","var(--chakra-colors-gray-800)"),a=F(),{activeSubscriptions:{RMP_EXPORT:i}}=G(v=>v.account),{telemetry:{project:t}}=G(v=>v.app),{languages:r}=G(v=>v.fonts),o=G(v=>v.param),{existsNodeTypes:n}=G(v=>v.runtime),p=z.isAllowAnalytics(),{t:c}=$(),g=j.useRef(window.graph),[f,x]=j.useState("png"),d={png:c("header.download.png"),svg:c("header.download.svg")},[u,h]=j.useState(2),[l,S]=j.useState({width:1,height:1,benchmark:.001}),[w,b]=j.useState(200),y=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],_=Object.fromEntries(y.map(v=>[v,"".concat(v,"%")])),[C,k]=j.useState([]),[M,P]=j.useState(!1),H=[{type:"select",label:c("header.download.format"),value:f,options:d,onChange:v=>x(v==="png"?"png":"svg")}],U=[{type:"select",label:c("header.download.svgVersion"),value:u,options:{1.1:c("header.download.svg1.1"),2:c("header.download.svg2")},onChange:v=>{h(v),v===1.1&&Xe(!0)}}],fe=[{type:"select",label:c("header.download.scale"),value:w,options:_,onChange:v=>b(v)},{type:"switch",label:c("header.download.transparent"),isChecked:M,onChange:P}],[ke,Ke]=j.useState(!1),[Ze,Je]=j.useState(!1),[Le,Xe]=j.useState(!1),[qe,De]=j.useState(!1),[Pe,A]=j.useState(!1),[Ps,wt]=j.useState(!1),[St,Qe]=j.useState(!1),[yt,Bs]=j.useState(!1);j.useEffect(()=>{(async()=>{const Se=await Fn.maxArea({usePromise:!0,useWorker:!0});S(Se)})()},[]),j.useEffect(()=>{if(ke){const{xMin:v,yMin:Se,xMax:Be,yMax:Y}=Pt(g.current),[Me,oe]=[Be-v,Y-Se],We=y.filter(Oe=>Me*Oe/100>l.width&&oe*Oe/100>l.height);k(We),Dn(n)?(De(!1),A(!0)):A(!1)}},[ke]);const Ct=async()=>{p&&z.event(_e.DOWNLOAD_PARAM,t?{"#nodes":g.current.order,"#edges":g.current.size}:{});const v=[];for(const Be of g.current.filterNodes((Y,Me)=>{var oe;return Y.startsWith("misc_node")&&Me.type==="image"&&((oe=Me.image)==null?void 0:oe.href)!==void 0})){const Y=g.current.getNodeAttributes(Be).image;Y.href&&Y.href.startsWith("img-l")&&await Js.has(Y.href)&&v.push({id:Y.href,base64:await Js.get(Y.href)})}const Se={...o,images:v};Cs("RMP_".concat(new Date().valueOf(),".json"),"application/json",$t(Se))},vt=async()=>{Qe(!0),p&&z.event(_e.DOWNLOAD_IMAGES,t?{numberOfNodes:g.current.order,numberOfEdges:g.current.size}:{});const{elem:v,width:Se,height:Be}=await Pn(g.current,qe,Le,r,n,u),Y=v.outerHTML.replace(/&nbsp;/g," ");if(f==="svg"){Cs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Y),Qe(!1);return}if(Ge){window.parent.__TAURI__.core.invoke("render_image",{svgString:Y,scale:w,isTransparent:M,isSystemFontsOnly:Le}).then(()=>Qe(!1));return}document.body.appendChild(v);const Me="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Y)));document.body.removeChild(v),v.remove();const oe=document.createElement("canvas"),[We,Oe]=[Se*w/100,Be*w/100];oe.width=We,oe.height=Oe;const as=oe.getContext("2d");M||(as.fillStyle=s,as.fillRect(0,0,We,Oe));const ls=new Image;ls.onload=()=>{setTimeout(()=>{as.drawImage(ls,0,0,We,Oe),oe.toBlob(Ws=>{if(Qe(!1),!Ws){a(is({status:"error",message:c("header.download.imageTooBig")}));return}Bn("RMP_".concat(new Date().valueOf(),".png"),Ws)},"image/png")},Ut()?2e3:0)},ls.src=Me};return e.jsxs(Ts,{id:"download",children:[e.jsx(zs,{as:ne,size:"sm",variant:"ghost",icon:e.jsx(dt,{})}),e.jsxs(Rs,{children:[e.jsx(pe,{icon:e.jsx(Bt,{}),onClick:()=>Ct(),children:c("header.download.config")}),e.jsxs(pe,{icon:e.jsx(Wt,{}),onClick:()=>Bs(!0),children:[c("header.download.2rmg.title"),e.jsx(te,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(pe,{icon:e.jsx(Gt,{}),onClick:()=>Ke(!0),children:c("header.download.image")})]}),e.jsxs(Q,{size:"2xl",isOpen:ke,onClose:()=>Ke(!1),children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:c("header.download.image")}),e.jsx(se,{}),e.jsxs(q,{children:[e.jsx(Ne,{fields:H}),f==="svg"&&e.jsx(Ne,{fields:U}),f==="png"&&e.jsx(Ne,{fields:fe}),e.jsx("br",{}),e.jsx(ds,{isChecked:Le,isDisabled:f==="svg"&&u===1.1,onChange:v=>Xe(v.target.checked),children:e.jsx(m,{children:c("header.download.isSystemFontsOnly")})}),e.jsxs(K,{children:[e.jsx(ds,{id:"share_info",isChecked:qe,isDisabled:Pe&&!i,onChange:v=>De(v.target.checked),children:e.jsxs(m,{children:[c("header.download.shareInfo1"),e.jsxs(N,{color:"teal.500",href:"https://railmapgen.org/rmp",children:[c("header.about.rmp")," ",e.jsx(B,{as:L})]}),c("header.download.shareInfo2")]})}),Pe&&e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})]}),e.jsx(ds,{id:"agree_terms",isChecked:Ps,onChange:v=>wt(v.target.checked),children:e.jsxs(m,{children:[c("header.download.termsAndConditionsInfo"),e.jsxs(N,{color:"teal.500",onClick:()=>Je(!0),children:[c("header.download.termsAndConditions")," ",e.jsx(B,{as:L})]}),c("header.download.period")]})}),Pe&&e.jsxs(ns,{status:"error",mt:"4",children:[e.jsx(rs,{}),e.jsx(E,{children:e.jsx(hs,{children:c("header.download.rmpInfoSpecificNodeExists")})})]}),f==="png"&&C.includes(w)&&!Ge&&e.jsxs(ns,{status:"error",mt:"4",children:[e.jsx(rs,{}),e.jsxs(E,{children:[e.jsx(hs,{children:c("header.download.disabledScaleOptions")}),e.jsx(Gs,{children:e.jsx(ys,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:e.jsx(N,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:e.jsx(N,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:ar()})}})})]})]}),f==="png"&&C.includes(w)&&Ge&&!i&&e.jsxs(ns,{status:"error",mt:"4",children:[e.jsx(rs,{}),e.jsxs(E,{children:[e.jsx(hs,{children:c("header.download.disabledScaleOptions")}),e.jsx(Gs,{children:c("header.settings.pro")})]})]})]}),e.jsx(me,{children:e.jsx(K,{children:e.jsx(I,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Ps||f==="png"&&C.includes(w)&&!Ge||f==="png"&&C.includes(w)&&Ge&&!i,isLoading:St,onClick:vt,children:c("header.download.confirm")})})}),e.jsx(or,{isOpen:Ze,onClose:()=>Je(!1)})]})]}),e.jsx(rr,{isOpen:yt,onClose:()=>Bs(!1)})]})}function bt(s){const{isOpen:a,onClose:i,onConfirm:t}=s,{t:r}=$(),o=j.useRef(null);return e.jsx(Ot,{isOpen:a,leastDestructiveRef:o,onClose:i,children:e.jsx(J,{children:e.jsxs(At,{children:[e.jsx(X,{fontSize:"lg",fontWeight:"bold",children:r("header.open.confirmOverwrite.title")}),e.jsx(q,{children:r("header.open.confirmOverwrite.body")}),e.jsxs(me,{children:[e.jsx(I,{ref:o,onClick:i,children:r("cancel")}),e.jsx(I,{id:"confirm_overwrite",colorScheme:"red",onClick:t,ml:3,children:r("header.open.confirmOverwrite.overwrite")})]})]})})})}const cr=(s,{info_panel_type:a,line_num:i,stn_list:t,style:r,theme:o},n,p,c)=>{const g=Object.fromEntries(Object.keys(t).filter(d=>!["linestart","lineend"].includes(d)).map(d=>[d,"stn_".concat(ws(10))]));Object.entries(t).filter(([d,u])=>!["linestart","lineend"].includes(d)).forEach(([d,u])=>{const h=s.filterNodes((l,S)=>Object.values(W).includes(S.type)&&S[S.type].names[0]===u.localisedName.zh);h.length!==0&&(g[d]=h[0])});const f=[["linestart",-1,0]],x={};for(;f.length;){const[d,u,h]=f.shift();t[d].children.filter(S=>S!="lineend").forEach((S,w)=>{const b=Math.max(w,h+w);x[S]={x:u*150,y:b*75},f.push([S,u+1,b])})}Object.entries(t).filter(([d,u])=>!["linestart","lineend"].includes(d)).filter(([d,u])=>s.filterNodes((h,l)=>Object.values(W).includes(l.type)&&l[l.type].names[0]===u.localisedName.zh).length===0).map(([d,u])=>{var b,y,_;let h=W.ShmetroBasic;const l=u.transfer.groups,S=l.map(C=>{var k;return(k=C.lines)!=null?k:[]}).flat();r===be.SHMetro?S.length>0?h=W.ShmetroInt:a===Ls.sh2020?h=W.ShmetroBasic2020:h=W.ShmetroBasic:r===be.GZMTR?S.length>0?h=W.GzmtrInt:h=W.GzmtrBasic:r===be.MTR&&(h=W.MTR);const w={...structuredClone(Wn[h].defaultAttrs),names:[(b=u.localisedName.zh)!=null?b:"",(y=u.localisedName.en)!=null?y:""]};return h===W.ShmetroBasic2020?w.color=o:h===W.GzmtrBasic?(w.color=o,w.lineCode=i,w.stationCode=u.num):h===W.GzmtrInt?w.transfer=l.map((C,k)=>{var P,H;const M=(H=(P=C.lines)==null?void 0:P.map(U=>{var fe;return[...(fe=U.theme)!=null?fe:o,"1","01"]}))!=null?H:[];return k===0?[[...o,i,u.num],...M]:M}):h===W.MTR&&((_=l[0].lines)!=null&&_.length?w.transfer=[[[...o,"",""],...l[0].lines.map(C=>{var k;return[...(k=C.theme)!=null?k:o,"",""]})]]:w.transfer=[[]]),{node:g[d],attr:{visible:!0,zIndex:0,x:n+x[d].x,y:p+x[d].y,type:h,[h]:w}}}).forEach(({node:d,attr:u})=>s.addNode(d,u)),Object.entries(t).filter(([d,u])=>!["linestart","lineend"].includes(d)).forEach(([d,u])=>{u.children.filter(h=>!["linestart","lineend"].includes(h)).forEach(h=>{const l=ps.Diagonal,[S,w]=[g[d],g[h]],b=c?Ft(s,l,S,w,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(ws(10)),S,w,{visible:!0,zIndex:0,type:l,[ps.Diagonal]:structuredClone(Ht[ps.Diagonal].defaultAttrs),style:Fs.SingleColor,[Fs.SingleColor]:{color:o},reconcileId:"",parallelIndex:b})})})},dr="rmg-bridge--",hr={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function pr(s){const{isOpen:a,onClose:i}=s,{t}=$(),{preference:{autoParallel:r}}=G(w=>w.app),{svgViewBoxZoom:o,svgViewBoxMin:n}=G(w=>w.param),p=F(),c=z.isAllowAnalytics(),g=Ns(),{height:f,width:x}=Is(g),d=ss.useRef(window.graph),[u]=ss.useState(crypto.randomUUID()),h="/rmg/#/import?"+new URLSearchParams({parentComponent:z.getAppName(),parentId:u}),l=ss.useCallback(()=>{p(re(d.current.export())),p(xe()),p(ie())},[p,xe,ie,re,d]),S=w=>{try{c&&z.event(_e.IMPORT_RMG_PARAM,{});const b=n.x+x*o/100/3,y=n.y+f*o/100/3;cr(d.current,w,b,y,r),l()}catch(b){p(is({status:"error",message:t("header.open.unknownError")})),ue.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",b)}finally{i()}};return ss.useEffect(()=>{const w=new BroadcastChannel(dr+u);return w.onmessage=b=>{const{event:y,data:_}=b.data;ue.debug("[rmp] Received event from RMG app clip:",y),y==="CLOSE"?i():y==="IMPORT"&&S(_)},()=>w.close()},[n.x,n.y,o,f,x,r]),e.jsx(ht,{isOpen:a,onClose:i,sx:hr,children:e.jsx("iframe",{src:h,loading:"lazy"})})}const ur="RMP_GALLERY_CHANNEL",gr="OPEN_TEMPLATE",Qs=new BroadcastChannel(ur),xr={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function mr(s){const{isOpen:a,onClose:i}=s,{t}=$(),r=F(),{isOpen:o,onOpen:n,onClose:p}=nt(),[c,g]=j.useState(null),{telemetry:{project:f}}=G(b=>b.app),x=z.isAllowAnalytics(),d=j.useRef(window.graph),u=j.useCallback(()=>{r(re(d.current.export())),r(xe()),r(ie())},[r,xe,ie,re,d]),h=async b=>{const{version:y,images:_,...C}=JSON.parse(await pt(JSON.stringify(b)));r(Ss()),d.current.clear(),d.current.import(C.graph),Array.isArray(_)&&_.length>0&&await ut(d.current,_),r(vs()),u();const{svgViewBoxZoom:k,svgViewBoxMin:M}=C;typeof k=="number"&&r(Ie(k)),typeof M.x=="number"&&typeof M.y=="number"&&r(He(M))},l=async()=>{c&&await h(c),p(),g(null)},S=async(b,y)=>{var k;const _=y?"https://".concat(y):"",C=await((k=(await Promise.allSettled([fetch("".concat(_,"/rmp-gallery/resources/real_world/").concat(b,".json")),fetch("".concat(_,"/rmp-gallery/resources/fantasy/").concat(b,".json"))])).filter(M=>M.status==="fulfilled").find(M=>M.value.status===200))==null?void 0:k.value.json());if(C){if(g(C),n(),x){const M={id:b};f&&y&&(M.host=y),z.event(_e.IMPORT_WORK_FROM_GALLERY,M)}z.sendNotification({title:t("header.open.importOK",{id:b}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}else z.sendNotification({title:t("header.open.importFail",{id:b}),message:t("header.open.importFailContent"),type:"error",duration:9e3})},w=async b=>{try{const y=await fetch("".concat(Vt,"/").concat(b));if(y.status!==200)throw new Error(t("header.open.importFailContent"));const _=await y.json();g(_),n(),x&&z.event(_e.IMPORT_WORK_FROM_SHARE,{share:b}),z.sendNotification({title:t("header.open.importOK",{id:b}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}catch(y){z.sendNotification({title:t("header.open.importFail",{id:b}),message:y.message,type:"error",duration:9e3})}};return j.useEffect(()=>{const y=new URL(window.location.href).searchParams;if(y.size>0){const _=y.keys().next().value,C=_.indexOf("."),k=_.substring(0,C===-1?void 0:C);let M;C!==-1&&(M=_.substring(C+1)),M==="org"?w(k):S(k,M),z.updateAppMetadata({search:""})}},[]),j.useEffect(()=>(Qs.onmessage=b=>{const{event:y,data:_}=b.data;y===gr&&(S(_),i())},()=>Qs.close()),[]),e.jsxs(e.Fragment,{children:[e.jsxs(ht,{isOpen:a,onClose:i,size:"full",sx:xr,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(rt,{onClick:i,position:"fixed",top:"5px",right:"15px"})]}),e.jsx(bt,{isOpen:o,onClose:p,onConfirm:l})]})}function fr(){const s=F(),{t:a}=$(),{isOpen:i,onOpen:t,onClose:r}=nt(),[o,n]=j.useState(null),p=Ns(),{height:c}=Is(p),g=j.useRef(window.graph),f=j.useRef(null),[x,d]=j.useState(!1),[u,h]=j.useState(!1),l=j.useCallback(()=>{s(re(g.current.export())),s(xe()),s(ie())},[s,xe,ie,re,g]),S=()=>{s(Ss()),g.current.clear(),s(Ie(100)),s(He({x:0,y:0})),l()},w=async C=>{const{version:k,images:M,...P}=JSON.parse(await pt(C));s(Ss()),g.current.clear(),g.current.import(P.graph),Array.isArray(M)&&M.length>0&&await ut(g.current,M),s(vs()),l();const{svgViewBoxZoom:H,svgViewBoxMin:U}=P;typeof H=="number"&&s(Ie(H)),typeof U.x=="number"&&typeof U.y=="number"&&s(He(U))},b=async()=>{if(o){await w(o);const C=await Ys();if(o.length===C.length){s(He({x:-10,y:-13}));const k=Math.max(0,Math.min(400,-.132*c+117.772));s(Ie(k)),await s(vs()),z.event(_e.LOAD_TUTORIAL,{})}}r(),n(null)},y=async C=>{var M;const k=(M=C.target.files)==null?void 0:M[0];if(ue.debug("OpenActions.handleUpload():: received file",k),(k==null?void 0:k.type)!=="application/json")s(is({status:"error",message:a("header.open.invalidType")})),ue.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const P=await jr(k);n(P),t()}catch(P){s(is({status:"error",message:a("header.open.unknownError")})),ue.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",P)}C.target.value=""},_=async()=>{const C=await Ys();n(C),t()};return j.useEffect(()=>{const C=async k=>{const{type:M,key:P,from:H}=k.data;if(M===Jt.SAVE_CHANGED&&P===Ks.PARAM&&H==="rmt"){ue.debug("Received save changed event on key: ".concat(P));const U=localStorage.getItem(Ks.PARAM);if(!U)return;await w(U)}};return Hs.addEventListener("message",C),()=>Hs.removeEventListener("message",C)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Ts,{children:[e.jsx(zs,{as:ne,size:"sm",variant:"ghost",icon:e.jsx(Vs,{})}),e.jsxs(Rs,{children:[e.jsx(pe,{icon:e.jsx(Yt,{}),onClick:S,children:a("header.open.new")}),e.jsx("input",{id:"upload_project",ref:f,type:"file",accept:".json",hidden:!0,onChange:y,"data-testid":"file-upload"}),e.jsx(pe,{icon:e.jsx(Vs,{}),onClick:()=>{var C;return(C=f==null?void 0:f.current)==null?void 0:C.click()},children:a("header.open.config")}),e.jsx(pe,{icon:e.jsx(Kt,{}),onClick:()=>d(!0),children:a("header.open.projectRMG")}),e.jsxs(pe,{icon:e.jsx(L,{}),onClick:()=>h(!0),children:[a("header.open.gallery"),e.jsx(te,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(pe,{icon:e.jsx(Zt,{}),onClick:_,children:a("header.open.tutorial")})]}),e.jsx(pr,{isOpen:x,onClose:()=>d(!1)}),e.jsx(mr,{isOpen:u,onClose:()=>h(!1)})]}),e.jsx(bt,{isOpen:i,onClose:r,onConfirm:b})]})}const jr=s=>new Promise(a=>{const i=new FileReader;i.onloadend=()=>a(i.result),i.readAsText(s)}),br=()=>{const[s,a]=j.useState(!1),{t:i}=$(),t=F(),r=j.useRef(window.graph),o=Ns(),{width:n,height:p}=Is(o),[c,g]=j.useState([]);j.useEffect(()=>{s&&g(r.current.nodes().filter(x=>x.startsWith("stn")).map(x=>{const d=r.current.getNodeAttributes(x),u=d.type,h=d[u].names.join("/");return{id:x,value:h}}))},[s]);const f=x=>{t(en(new Set([x])));const d=Math.max(0,Math.min(400,-.132*p+117.772)),{x:u,y:h}=sn((n-300)/2,p/2,d,{x:-r.current.getNodeAttribute(x,"x"),y:-r.current.getNodeAttribute(x,"y")});t(Ie(d)),t(He({x:-u,y:-h}))};return e.jsxs(it,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(ot,{children:e.jsx(ne,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Xt,{}),onClick:()=>a(!s)})}),e.jsx(at,{children:e.jsx(lt,{children:e.jsx(qt,{label:i("header.search"),children:e.jsx(Qt,{data:c,displayHandler:x=>e.jsx(te,{children:x.value}),filter:(x,d)=>d.value.toLowerCase().includes(x.toLowerCase())||Object.values(d.value).some(u=>u.toLowerCase().includes(x.toLowerCase())),value:"",onChange:x=>f(x.id)})})})})]})},wr=s=>{const{isOpen:a,onClose:i}=s,t=F(),{t:r}=$(),o=j.useRef(window.graph),{theme:n,requestThemeChange:p}=tn(),c=()=>{o.current.filterEdges((g,f,x,d,u,h,l)=>ct.has(f.style)&&JSON.stringify(f[f.style].color)===JSON.stringify(n)).forEach(g=>o.current.dropEdge(g)),t(re(o.current.export())),t(ie()),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(se,{}),e.jsxs(q,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(nn,{theme:n,onClick:p})]}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:c,children:r("remove")})]})]})]})},Sr=s=>{const{isOpen:a,onClose:i}=s,t=F(),{t:r}=$(),o=j.useRef(window.graph),[n,p]=j.useState(1),c=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:n.toString(),variant:"number",onChange:f=>p(Number(f)),minW:"full"}],g=()=>{o.current.forEachNode((f,x)=>{o.current.updateNodeAttribute(f,"x",d=>(d!=null?d:0)*n),o.current.updateNodeAttribute(f,"y",d=>(d!=null?d:0)*n)}),t(re(o.current.export())),t(xe()),t(ie()),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:r("header.settings.procedures.scale.title")}),e.jsx(se,{}),e.jsxs(q,{children:[r("header.settings.procedures.scale.content"),e.jsx(Ne,{fields:c})]}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:g,children:r("apply")})]})]})]})},yr=s=>{const{isOpen:a,onClose:i}=s,t=F(),{t:r}=$(),o=j.useRef(window.graph),[n,p]=j.useState(0),[c,g]=j.useState(0),f=[{type:"input",label:r("header.settings.procedures.translate.x"),value:n.toString(),variant:"number",onChange:d=>p(Number(d)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:c.toString(),variant:"number",onChange:d=>g(Number(d)),minW:"full"}],x=()=>{o.current.forEachNode((d,u)=>{o.current.updateNodeAttribute(d,"x",h=>(h!=null?h:0)+n),o.current.updateNodeAttribute(d,"y",h=>(h!=null?h:0)+c)}),t(re(o.current.export())),t(xe()),t(ie()),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:r("header.settings.procedures.translate.title")}),e.jsx(se,{}),e.jsxs(q,{children:[r("header.settings.procedures.translate.content"),e.jsx(Ne,{fields:f})]}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:r("cancel")}),e.jsx(I,{colorScheme:"red",onClick:x,children:r("apply")})]})]})]})},Cr=s=>{const{isOpen:a,onClose:i}=s,t=F(),{preference:{unlockSimplePathAttempts:r}}=G(c=>c.app),{activeSubscriptions:o}=G(c=>c.account),{t:n}=$(),p=()=>{t(rn(-1))};return e.jsxs(Q,{isOpen:a,onClose:i,size:"5xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:n("header.settings.procedures.unlockSimplePath.title")}),e.jsx(se,{}),e.jsxs(q,{children:[e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(me,{children:e.jsx(ze,{label:n("header.settings.pro"),isOpen:!o.RMP_CLOUD&&r>=0,children:e.jsx(I,{onClick:p,isDisabled:!o.RMP_CLOUD||r<0,children:r>=0?n("header.settings.procedures.unlockSimplePath.check"):n("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},vr=s=>{const{isOpen:a,onClose:i}=s,t=F(),r=Tt(),{t:o}=$(),n=j.useRef(window.graph),[p,c]=j.useState(!1),g=async()=>{c(!0);const f=JSON.stringify(n.current.export());try{const x=await Mr(f);n.current.clear(),n.current.import(x),t(re(n.current.export())),t(xe()),t(ie()),r({title:o("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(x){ue.error("[rmp] Error in updating all colors: ".concat(x)),r({title:o("header.settings.procedures.updateColor.error",{e:x}),status:"error",duration:9e3,isClosable:!0})}c(!1),i()};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:o("header.settings.procedures.updateColor.title")}),e.jsx(se,{}),e.jsx(q,{children:e.jsx(m,{children:o("header.settings.procedures.updateColor.content")})}),e.jsxs(me,{children:[e.jsx(I,{colorScheme:"blue",variant:"outline",mr:"1",onClick:i,children:o("cancel")}),e.jsx(I,{colorScheme:"red",onClick:g,isLoading:p,children:o("apply")})]})]})]})},et=s=>s.length>=4&&s.every(a=>typeof a=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(Es).includes(s[3]),_r=s=>{const a=[],i=(t,r)=>{if(Array.isArray(t)&&et(t)){a.push({path:r||"",value:t});return}for(const o in t){const n=t[o],p=r?"".concat(r,".").concat(o):o;Array.isArray(n)?et(n)?a.push({path:p,value:n}):n.forEach((c,g)=>i(c,"".concat(p,".").concat(g))):n&&typeof n=="object"&&i(n,p)}};return i(s),a},kr=(s,a,i)=>{const t=a.split(".");let r=s;for(let o=0;o<t.length-1;o++)r=r[t[o]];r[t[t.length-1]]=i},Mr=async s=>{const a=JSON.parse(s),i=new Date().getTime(),t=_r(a);ue.debug("[rmp] Found all themes pending for update",t);const r=1e4;let o,n=!1;const p=new Promise((c,g)=>{o=setTimeout(()=>{n=!0,g("Executing time exceeds ".concat(r,"ms"))},r),(async()=>{for(const{path:f,value:x}of t){if(n)throw new Error("Update aborted");const[d,u,h,l,...S]=x,w=await on([d,u,h,l]);kr(a,f,[...w,...S])}})().then(c).catch(g)});try{return await p,ue.debug("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-i)/1e3," sec")),a}finally{clearTimeout(o)}},st=1,Or=()=>{const s=F(),{state:a,token:i}=G(l=>l.account),{count:{stations:t,miscNodes:r,masters:o,lines:n,parallel:p}}=G(l=>l.runtime),{t:c}=$(),[g,f]=j.useState(!1),[x,d]=j.useState(st);j.useEffect(()=>{let l;return g&&x>0?l=window.setTimeout(()=>{d(x-1)},1e3):x===0&&f(!1),()=>clearTimeout(l)},[g,x]);const u=()=>{f(!0),d(st),i&&ln(s,i)},h={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),e.jsxs(E,{mt:"3",children:[e.jsxs(E,{mb:"1",children:[e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.stations")}),e.jsx(m,{children:t})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.miscNodes")}),e.jsx(m,{children:r})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.masters")}),e.jsx(m,{children:o})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.lines")}),e.jsx(m,{children:n})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.parallel")}),e.jsx(m,{children:p})]})]}),e.jsxs(E,{display:"flex",mb:"1",children:[e.jsxs(m,{flex:"1",children:[c("header.settings.status.subscription.content")," ",h[a]]}),e.jsx(ne,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(an,{}),isDisabled:g,onClick:()=>u()})]})]})]})},Ce={width:"100%",justifyContent:"space-between"},he={fontFamily:"-apple-system"},Ar=s=>{const{isOpen:a,onClose:i}=s,{activeSubscriptions:t}=G(A=>A.account),{telemetry:{project:r},preference:{autoParallel:o,randomStationsNames:n,gridLines:p,snapLines:c,predictNextNode:g,autoChangeStationType:f,disableWarning:{changeType:x}}}=G(A=>A.app),{keepLastPath:d,count:{parallel:u}}=G(A=>A.runtime),h=F(),{t:l}=$(),S=tt("primary.500","primary.300"),[w,b]=j.useState(!1),[y,_]=j.useState(!1),[C,k]=j.useState(!1),[M,P]=j.useState(!1),[H,U]=j.useState(!1),[fe,ke]=j.useState(!1),[Ke,Ze]=j.useState(!1),Je=z.isAllowAnalytics(),Le=A=>{h(Cn(A))},Xe=t.RMP_CLOUD?cn:dn,qe=u>=Xe,De=!t.RMP_CLOUD,Pe=A=>{h(yn(A.target.value))};return e.jsxs(Q,{isOpen:a,onClose:i,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(J,{}),e.jsxs(ee,{children:[e.jsx(X,{children:l("header.settings.title")}),e.jsx(se,{}),e.jsx(q,{children:e.jsxs(Re,{divider:e.jsx(It,{borderColor:"gray.200"}),children:[e.jsx(Or,{}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.preference.title")}),e.jsxs(Re,{spacing:"0",mt:"3",align:"stretch",children:[e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.keepLastPath")}),e.jsx(de,{isChecked:d,onChange:({target:{checked:A}})=>h(hn(A))})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{children:l("header.settings.preference.autoParallel")}),e.jsx(te,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ze,{label:l("header.settings.proWithTrial"),children:e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(de,{ml:"1",isDisabled:qe,isChecked:o,onChange:({target:{checked:A}})=>h(pn(A))})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.randomStationNames.title")}),e.jsx(te,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(te,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(zt,{size:"xs",width:"auto",ml:"1",value:n,onChange:Pe,children:[e.jsx("option",{value:"none",children:l("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:es.Shmetro,disabled:De,children:l("header.settings.preference.randomStationNames.".concat(es.Shmetro))}),e.jsx("option",{value:es.Bjsubway,disabled:De,children:l("header.settings.preference.randomStationNames.".concat(es.Bjsubway))})]})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.gridline")}),e.jsx(de,{isChecked:p,onChange:({target:{checked:A}})=>h(un(A))})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.snapline")}),e.jsx(de,{isChecked:c,onChange:({target:{checked:A}})=>h(gn(A))})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.predictNextNode")}),e.jsx(de,{isChecked:g,onChange:({target:{checked:A}})=>h(xn(A))})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.autoChangeStationType")}),e.jsx(de,{isChecked:f,onChange:({target:{checked:A}})=>h(mn(A))})]}),e.jsxs(K,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.disableWarningChangeType")}),e.jsx(de,{isChecked:x,onChange:({target:{checked:A}})=>h(fn(A))})]})]})]}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.procedures.title")}),e.jsxs(E,{mt:"3",children:[e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>b(!0),children:l("header.settings.procedures.translate.title")}),e.jsx(yr,{isOpen:w,onClose:()=>b(!1)}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>_(!0),children:l("header.settings.procedures.scale.title")}),e.jsx(Sr,{isOpen:y,onClose:()=>_(!1)}),e.jsxs(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>k(!0),children:[l("header.settings.procedures.changeType.title"),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx($n,{isOpen:C,onClose:()=>k(!1),isSelect:!1}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>P(!0),children:l("header.settings.procedures.removeLines.title")}),e.jsx(wr,{isOpen:M,onClose:()=>P(!1)}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>U(!0),children:l("header.settings.procedures.updateColor.title")}),e.jsx(vr,{isOpen:H,onClose:()=>U(!1)}),e.jsxs(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>ke(!0),children:[l("header.settings.procedures.unlockSimplePath.title"),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(te,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(Cr,{isOpen:fe,onClose:()=>ke(!1)}),e.jsx(I,{sx:Ce,rightIcon:e.jsx(ye,{}),onClick:()=>Ze(!0),children:l("header.settings.procedures.masterManager.title")}),e.jsx(Gn,{isOpen:Ke,onClose:()=>Ze(!1)})]})]}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.shortcuts.title")}),e.jsx(E,{mt:"3",children:e.jsxs(Rt,{children:[e.jsx(Et,{children:e.jsxs(V,{children:[e.jsx($s,{children:l("header.settings.shortcuts.keys")}),e.jsx($s,{children:l("header.settings.shortcuts.description")})]})}),e.jsxs(Nt,{children:[e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(O,{children:"f"})}),e.jsx(R,{children:l("header.settings.shortcuts.f")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(O,{children:"s"})}),e.jsx(R,{children:l("header.settings.shortcuts.s")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsx(O,{children:"c"})}),e.jsx(R,{children:l("header.settings.shortcuts.c")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(E,{display:"flex",flexDirection:"row",children:[e.jsx(jn,{}),e.jsx(bn,{}),e.jsx(wn,{}),e.jsx(Sn,{})]})}),e.jsx(R,{children:l("header.settings.shortcuts.arrows")})]}),e.jsxs(V,{children:[e.jsx(R,{children:e.jsxs(E,{display:"flex",flexDirection:"row",children:[e.jsx(O,{children:"i"}),e.jsx(O,{children:"j"}),e.jsx(O,{children:"k"}),e.jsx(O,{children:"l"})]})}),e.jsx(R,{children:l("header.settings.shortcuts.ijkl")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsx(O,{sx:he,children:"⇧"}):e.jsx(O,{children:"shift"})}),e.jsx(R,{children:l("header.settings.shortcuts.shift")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsx(O,{sx:he,children:"⌥"}):e.jsx(O,{children:"alt"})}),e.jsx(R,{children:l("header.settings.shortcuts.alt")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsx(O,{sx:he,children:"⌫"}):e.jsx(O,{children:"delete"})}),e.jsx(R,{children:l("header.settings.shortcuts.delete")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"x"})]}),e.jsx(R,{children:l("header.settings.shortcuts.cut")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"c"})]}),e.jsx(R,{children:l("header.settings.shortcuts.copy")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"v"})]}),e.jsx(R,{children:l("header.settings.shortcuts.paste")})]}),e.jsxs(V,{children:[e.jsxs(R,{children:[je?e.jsx(O,{sx:he,children:"⌘"}):e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"z"})]}),e.jsx(R,{children:l("header.settings.shortcuts.undo")})]}),e.jsxs(V,{children:[e.jsx(R,{children:je?e.jsxs(e.Fragment,{children:[e.jsx(O,{sx:he,children:"⇧"})," + ",e.jsx(O,{sx:he,children:"⌘"})," + ",e.jsx(O,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{children:"ctrl"})," + ",e.jsx(O,{children:"y"})]})}),e.jsx(R,{children:l("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(E,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.telemetry.title")}),e.jsxs(E,{mt:"3",children:[e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.info")}),e.jsxs(E,{mt:"3",mb:"1",children:[e.jsxs(E,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.telemetry.essential")}),e.jsx(ze,{label:l("header.settings.telemetry.essentialTooltip"),children:e.jsx(de,{isChecked:Je,isDisabled:!0})})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.essentialInfo")}),e.jsxs(N,{color:S,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[l("header.settings.telemetry.essentialLink")," ",e.jsx(B,{as:L})]})]}),e.jsxs(E,{mt:"1",mb:"1",children:[e.jsxs(E,{display:"flex",children:[e.jsx(m,{flex:"1",children:l("header.settings.telemetry.additional")}),e.jsx(de,{isChecked:r,onChange:({target:{checked:A}})=>Le(A)})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},Tr=()=>{const[s,a]=j.useState(!1),{svgViewBoxZoom:i}=G(o=>o.param),t=F(),r=[{type:"slider",label:"",value:400-i,min:10,max:390,step:1,onChange:o=>t(Ie(400-o)),leftIcon:e.jsx(vn,{}),rightIcon:e.jsx(Zs,{}),minW:160}];return e.jsxs(it,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(ot,{children:e.jsx(ne,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Zs,{}),onClick:()=>a(!s)})}),e.jsx(at,{children:e.jsx(lt,{children:e.jsx(Ne,{fields:r,noLabel:!0})})})]})};function zr(){const{t:s}=$(),a=F(),{past:i,future:t}=G(l=>l.param),r=z.isAllowAnalytics(),[o,n]=j.useState(!1),[p,c]=j.useState(!1),g=Xs(z.getEnv),f=Xs(z.getAppVersion),x=_n();j.useEffect(()=>{r&&g!==us.DEV&&z.event(_e.APP_LOAD,{isStandaloneWindow:z.isStandaloneWindow()})},[g]);const d=l=>{z.getI18nInstance().changeLanguage(l)},u=()=>{a(Nn())},h=()=>{a(In())};return e.jsxs(kn,{children:[e.jsxs(bs,{direction:x==="landscape"?"row":"column",width:"100%",children:[e.jsxs(K,{height:"32px",children:[e.jsx(Te,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(Mn,{environment:g,version:f,popoverHeader:g===us.PRD?void 0:e.jsxs(ys,{i18nKey:"header.popoverHeader",environment:g,children:["You're on ",{environment:g}," environment!"]}),popoverBody:g===us.PRD?void 0:e.jsx(ys,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),e.jsxs(K,{overflowX:"auto",ml:x==="landscape"?"auto":void 0,children:[e.jsx(br,{}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(On,{}),isDisabled:i.length===0,onClick:u}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(An,{}),isDisabled:t.length===0,onClick:h}),e.jsx(Tr,{}),e.jsx(fr,{}),e.jsx(lr,{}),z.isStandaloneWindow()&&e.jsxs(Ts,{children:[e.jsx(zs,{as:ne,icon:e.jsx(Tn,{}),variant:"ghost",size:"sm"}),e.jsx(Rs,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(l=>e.jsx(pe,{onClick:()=>d(l),children:zn[l][l]},l))})]}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Rn,{}),onClick:()=>n(!0)}),e.jsx(ne,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(En,{}),onClick:()=>c(!0)})]})]}),e.jsx(Ar,{isOpen:o,onClose:()=>n(!1)}),e.jsx(Un,{isOpen:p,onClose:()=>c(!1)})]})}function Rr(){const s=F(),a=G(t=>t.runtime.globalAlerts),i=t=>{z.isStandaloneWindow()?window.open("/".concat(t),"_blank"):z.openApp({appId:t})};return e.jsx(e.Fragment,{children:Object.entries(a).map(([t,{message:r,url:o,linkedApp:n}])=>e.jsxs(ns,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(rs,{}),n?e.jsx(N,{onClick:()=>i(n),children:r}):o?e.jsx(N,{href:o,target:"_blank",children:r}):r,e.jsx(rt,{ml:"auto",onClick:()=>s(Ln(t))})]},t))})}function Br(){return e.jsxs(e.Fragment,{children:[e.jsx(zr,{}),e.jsx(Rr,{})]})}export{Br as default};
