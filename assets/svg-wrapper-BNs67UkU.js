import{j as E}from"./chakra-t2DzLzXq.js";import{k as J,l as R,an as Nt,ao as _t,ap as vt,S as It,aq as bt,c as Ct,d as st,ar as q,as as H,at,T as rt,au as At,av as St,aw as F,q as lt,t as ct,n as it,m as jt,o as wt,r as dt,E as ut,v as gt,y as xt,U as Q,ax as Lt,p as Tt,ay as $t,a0 as Kt,a1 as Wt,A as pt,z as Pt,a8 as et,ak as Bt,al as zt}from"./index-Bj_jVfCG.js";import{b as _}from"./react-DmTIgZys.js";import{u as B,e as Ot,i as Rt}from"./clipboard-C6FPR1gM.js";import{s as ft,u as Ft,f as Xt,F as Yt,l as Ut,b as Vt,c as Zt}from"./master-manager-CIBOfsfK.js";import{m as yt}from"./misc-nodes-CJqcj-Kz.js";const Mt=(t,e,u,d,i,o,a)=>{if(!("offsetFrom"in o)||!("offsetTo"in o)||Number.isNaN(o.offsetFrom)||Number.isNaN(o.offsetTo))return;if(o.offsetFrom===o.offsetTo)return Et(t,e,u,d,i)?a<0?{x1:e,y1:u,x2:d,y2:i,offset:o.offsetFrom}:e===d?{x1:e+5*a,y1:u,x2:d+5*a,y2:i,offset:o.offsetFrom}:u===i?{x1:e,y1:u+5*a,x2:d,y2:i+5*a,offset:o.offsetFrom}:{x1:e+5*Math.SQRT1_2*a,y1:u+5*Math.SQRT1_2*a,x2:d+5*Math.SQRT1_2*a,y2:i+5*Math.SQRT1_2*a,offset:o.offsetFrom}:void 0;const[h,n]=[o.offsetFrom,o.offsetTo];for(let p=0;p<Math.PI;p+=Math.PI/8)for(let r=p,x=0;x<2;x++,r+=Math.PI){const[S,v,b,M]=[Math.sin(p)*h,Math.cos(p)*h,Math.sin(r)*n,Math.cos(r)*n];if(Et(t,e+S,u+v,d+b,i+M))return{x1:e+S,y1:u+v,x2:d+b,y2:i+M,offset:0}}},Et=(t,e,u,d,i)=>!!((e===d||u===i)&&[J.Diagonal,J.Perpendicular].includes(t)||Math.abs((i-u)/(d-e))===1&&[J.Diagonal,J.RotatePerpendicular].includes(t)),Qt=(t,e)=>{const u=[],d=[];return Object.values(e).forEach(i=>{var I;if(i.length===1){d.push(...i.map(f=>f.edge));return}const o=t.getEdgeAttribute(i.at(0),"type");if(!i.every(f=>t.getEdgeAttribute(f,"type")===o)){d.push(...i.map(f=>f.edge));return}const a=t.getEdgeAttribute(i.at(0),"style");if(!i.every(f=>t.getEdgeAttribute(f,"style")===a)){d.push(...i.map(f=>f.edge));return}const h={},n=new Set,p=new Set,r=Object.fromEntries(i.map(f=>{var l,P;const[D,c]=t.extremities(f);return h[D]=((l=h[D])!=null?l:0)+1,h[c]=((P=h[c])!=null?P:0)+1,n.add(D),p.add(c),[D,[f.edge,c]]})),x=Array.from(n).filter(f=>h[f]===1),S=Array.from(p).filter(f=>h[f]===1);if(x.length!==1||S.length!==1){d.push(...i.map(f=>f.edge));return}const v=x[0],b=S[0];if(v===b){d.push(...i.map(f=>f.edge));return}const M=[r[v][0]];let j=r[v][1];for(let f=1;f<i.length;f=f+1){const D=(I=r[j])==null?void 0:I.at(1);if(!D){d.push(...i.map(c=>c.edge));return}M.push(r[j][0]),j=D}if(j!==b||M.length!==i.length){d.push(...i.map(f=>f.edge));return}u.push(M)}),{allReconciledLines:u,danglingLines:d}},qt=(t,e)=>{if(!e.every(i=>t.hasEdge(i)))return;const u=e.map(i=>{var v,b,M;const[o,a]=t.extremities(i),h=t.getNodeAttributes(o),n=t.getNodeAttributes(a),{type:p,parallelIndex:r}=t.getEdgeAttributes(i),x=(v=t.getEdgeAttribute(i,p))!=null?v:R[p].defaultAttrs,S=Mt(p,h.x,h.y,n.x,n.y,x,r);if(S){const{x1:j,y1:I,x2:f,y2:D,offset:c}=S;return R[J.Simple].generatePath(j,f,I,D,{offset:c})}return(M=(b=R[p])==null?void 0:b.generatePath(h.x,n.x,h.y,n.y,x))!=null?M:"M ".concat(h.x," ").concat(h.y," L ").concat(n.x," ").concat(n.y)});let d="".concat(u[0]," ");for(let i=1;i<e.length;i=i+1)d+=u[i].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return d},Gt=t=>[...t.nodeEntries()].map(e=>e.node.startsWith("stn")?{id:e.node,type:"station",station:e.attributes}:{id:e.node,type:"misc-node",miscNode:e.attributes}),Ht=t=>{const e={},u=[],d={},i=[];for(const n of t.edgeEntries()){const[p,r,x,S]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y],v=Mt(n.attributes.type,p,r,x,S,n.attributes[n.attributes.type],n.attributes.parallelIndex);if(!v){if(n.attributes.parallelIndex>=0){u.push(n);continue}}if(n.attributes.reconcileId!==""){const b=n.attributes.reconcileId;b in d?d[b].push(n):d[b]=[n];continue}if(v){const b=n.edge,M=n.attributes,{x1:j,y1:I,x2:f,y2:D,offset:c}=v;e[b]={id:b,attr:M,path:R[J.Simple].generatePath(j,f,I,D,{offset:c})};continue}i.push(n)}const o=new Set;for(;u.length;){const n=u.pop();if(o.has(n.edge))continue;const{normal:p,parallel:r}=Nt(t,n);if(!r.length)continue;r.forEach(S=>o.add(S.edge)),i.push(...p);const x=_t(r);for(const S of r){const v=S.edge;e[v]={id:S.edge,attr:S.attributes,path:x[v]}}}const{allReconciledLines:a,danglingLines:h}=Qt(t,d);for(const n of a){const p=qt(t,n);if(!p)continue;const r=n[0];e[r]={id:r,attr:t.getEdgeAttributes(r),path:p}}for(const n of h){const p=t.getEdgeAttributes(n),[r,x]=t.extremities(n),S=t.getNodeAttributes(r),v=t.getNodeAttributes(x);e[n]={id:n,attr:p,path:R[J.Simple].generatePath(S.x,v.x,S.y,v.y,R[J.Simple].defaultAttrs)}}for(const n of i){const p=n.edge,r=n.attributes.type,x=n.attributes,[S,v,b,M]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y];if(!(r in R)){e[p]={id:p,attr:x,path:"M ".concat(S," ").concat(v," L ").concat(b," ").concat(M)};continue}e[p]={id:p,attr:x,path:R[r].generatePath(S,b,v,M,x[r])}}return Object.values(e).map(n=>({id:n.id,type:"line",line:n}))},kt=t=>{const{id:e,x:u,y:d,handlePointerDown:i,handlePointerMove:o,handlePointerUp:a}=t,h=_.useCallback(r=>i(e,r),[e,i]),n=_.useCallback(r=>o(e,r),[e,o]),p=_.useCallback(r=>a(e,r),[e,a]);return E.jsx("g",{id:e,transform:"translate(".concat(u-6.4," ").concat(d-6.4,")scale(0.025)"),onPointerDown:h,onPointerMove:n,onPointerUp:p,style:{cursor:"move"},children:E.jsx("path",{id:"stn_core_".concat(e),fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},Jt=t=>{const{id:e,path:u,handlePointerDown:d}=t,i=_.useCallback(o=>d(e,o),[e,d]);return E.jsx("path",{id:e,d:u,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:i})},te=_.memo(t=>{var n,p,r,x,S,v,b,M,j,I,f,D;const{elements:e,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i,handleEdgePointerDown:o}=t,a=Object.fromEntries(Array.from({length:21},(c,l)=>[l-10,{pre:[],main:[],post:[]}]));for(const c of e)if(c.type==="line"){const l=c.line.attr.type,P=c.line.attr.style,k=c.line.attr[P],m=(n=vt[P])==null?void 0:n.preComponent;m&&a[c.line.attr.zIndex].pre.push(E.jsx(m,{id:c.id,type:l,path:c.line.path,styleAttrs:k,newLine:!1,handlePointerDown:o},"".concat(c.id,".pre")));const A=(r=(p=vt[P])==null?void 0:p.component)!=null?r:Jt;a[c.line.attr.zIndex].main.push(E.jsx(A,{id:c.id,type:l,path:c.line.path,styleAttrs:k,newLine:!1,handlePointerDown:o},c.id));const L=(x=vt[P])==null?void 0:x.postComponent;L&&a[c.line.attr.zIndex].post.push(E.jsx(L,{id:c.id,type:l,path:c.line.path,styleAttrs:k,newLine:!1,handlePointerDown:o},"".concat(c.id,".post")))}else if(c.type==="station"){const l=c.station,P=l.type,k=(S=ft[P])==null?void 0:S.preComponent;k&&a[c.station.zIndex].pre.push(E.jsx(k,{id:c.id,x:l.x,y:l.y,attrs:l,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".pre")));const m=(b=(v=ft[P])==null?void 0:v.component)!=null?b:kt;a[c.station.zIndex].main.push(E.jsx(m,{id:c.id,x:l.x,y:l.y,attrs:l,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},c.id));const A=(M=ft[P])==null?void 0:M.postComponent;A&&a[c.station.zIndex].post.push(E.jsx(A,{id:c.id,x:l.x,y:l.y,attrs:l,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".post")))}else if(c.type==="misc-node"){const l=c.miscNode,P=l.type,k=(j=yt[P])==null?void 0:j.preComponent;k&&a[c.miscNode.zIndex].pre.push(E.jsx(k,{id:c.id,x:l.x,y:l.y,attrs:l[P],handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".pre")));const m=(f=(I=yt[P])==null?void 0:I.component)!=null?f:kt;a[c.miscNode.zIndex].main.push(E.jsx(m,{id:c.id,x:l.x,y:l.y,attrs:l[P],handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},c.id));const A=(D=yt[P])==null?void 0:D.postComponent;A&&a[c.miscNode.zIndex].post.push(E.jsx(A,{id:c.id,x:l.x,y:l.y,attrs:l[P],handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".post")))}return Array.from({length:21},(c,l)=>(l-10).toString()).map(c=>[...a[c].pre,...a[c].main,...a[c].post]).flat()},(t,e)=>t.elements===e.elements),ee=[...Object.values(It),bt.Virtual,bt.Master,bt.LondonArrow],se=()=>{const t=Ct(),e=_.useRef(window.graph),u=()=>{t(lt()),t(ct()),t(gt(e.current.export()))},{telemetry:{project:d},preference:{autoParallel:i}}=st(m=>m.app),{svgViewBoxZoom:o,svgViewBoxMin:a}=st(m=>m.param),{selected:h,refresh:{nodes:n,edges:p},mode:r,active:x,keepLastPath:S,theme:v}=st(m=>m.runtime),[b,M]=_.useState({x:0,y:0}),[j,I]=_.useState({x:0,y:0}),f=B((m,A)=>{A.stopPropagation(),r==="select"&&t(q("free"));const L=A.currentTarget,{x:W,y:K}=H(A);L.setPointerCapture(A.pointerId),M({x:W,y:K}),t(at(m)),A.shiftKey?h.has(m)?t(At(m)):t(St(m)):h.has(m)||t(rt(new Set([m])))}),D=B((m,A)=>{const{x:L,y:W}=H(A);r==="free"&&x===m?(h.forEach(K=>{e.current.hasNode(K)&&e.current.updateNodeAttributes(K,X=>({...X,x:F(X.x-(b.x-L)*o/100,A.altKey?1:5),y:F(X.y-(b.y-W)*o/100,A.altKey?1:5)}))}),t(lt()),t(ct())):r.startsWith("line")&&I({x:(b.x-L)*o/100,y:(b.y-W)*o/100})}),c=B((m,A)=>{if(r.startsWith("line")){S||t(q("free"));const L=e.current.hasNode(x)&&ee.includes(e.current.getNodeAttribute(x,"type"));["stn_core_","virtual_circle_"].forEach(K=>{var nt,ot;const z=(ot=(nt=document.elementsFromPoint(A.clientX,A.clientY)[0].attributes)==null?void 0:nt.getNamedItem("id"))==null?void 0:ot.value,Y=z==null?void 0:z.startsWith(K);if(L&&Y){const $=r.slice(5),U="line_".concat(it(10)),[tt,O]=[x,z.slice(K.length)],V=i?jt(e.current,$,tt,O,"from"):-1;e.current.addDirectedEdgeWithKey(U,tt,O,{visible:!0,zIndex:0,type:$,[$]:structuredClone(R[$].defaultAttrs),style:wt.SingleColor,[wt.SingleColor]:{color:v},reconcileId:"",parallelIndex:V}),d&&dt.event(ut.ADD_LINE,{type:$})}}),t(ct()),t(gt(e.current.export()))}else if(r==="free"&&x){const{x:L,y:W}=H(A);b.x-L===0&&b.y-W===0||t(gt(e.current.export()))}t(at(void 0))}),l=B((m,A)=>{if(A.stopPropagation(),A.shiftKey||t(xt()),A.shiftKey&&h.has(m)?t(At(m)):t(St(m)),r.startsWith("station")||r.startsWith("misc-node-virtual")||r.startsWith("misc-node-master")){const L=A.clientX-document.getElementById("canvas").getBoundingClientRect().left,W=A.clientY-document.getElementById("canvas").getBoundingClientRect().top,K=r.startsWith("station"),X=it(10),z=K?"stn_".concat(X):"misc_node_".concat(X),Y=K?r.slice(8):r.slice(10),{x:nt,y:ot}=Q(L,W,o,a),$=K?structuredClone(ft[Y].defaultAttrs):structuredClone(yt[Y].defaultAttrs);"color"in $&&($.color=v),e.current.addNode(z,{visible:!0,zIndex:0,x:F(nt,5),y:F(ot,5),type:Y,[Y]:$});const U=e.current.getEdgeAttributes(m),{zIndex:tt,type:O,style:V}=U,Z=U[O],ht=U[V],[s,y]=e.current.extremities(m),g=i?0:-1;e.current.addDirectedEdgeWithKey("line_".concat(it(10)),s,z,{visible:!0,zIndex:tt,type:O,[O]:structuredClone(Z),style:V,[V]:structuredClone(ht),reconcileId:"",parallelIndex:g}),e.current.addDirectedEdgeWithKey("line_".concat(it(10)),z,y,{visible:!0,zIndex:tt,type:O,[O]:structuredClone(Z),style:V,[V]:structuredClone(ht),reconcileId:"",parallelIndex:g}),e.current.dropEdge(m),u(),d&&(dt.event(ut.ADD_STATION,{type:Y}),dt.event(ut.ADD_LINE,{type:O})),t(q("free")),t(rt(new Set([z])))}}),P=_.useMemo(()=>[...Ht(e.current),...Gt(e.current)],[p,n]),k=Lt.component;return E.jsxs(E.Fragment,{children:[E.jsx(te,{elements:P,handlePointerDown:f,handlePointerMove:D,handlePointerUp:c,handleEdgePointerDown:l}),r.startsWith("line")&&x&&x!=="background"&&E.jsx(k,{id:"line_create_in_progress___no_use",type:r.slice(5),path:R[r.slice(5)].generatePath(e.current.getNodeAttribute(x,"x"),e.current.getNodeAttribute(x,"x")-j.x,e.current.getNodeAttribute(x,"y"),e.current.getNodeAttribute(x,"y")-j.y,R[r.slice(5)].defaultAttrs),styleAttrs:{color:v},newLine:!0,handlePointerDown:()=>{}})]})},le=()=>{const t=Ct(),e=_.useRef(window.graph),u=()=>{t(lt()),t(ct()),t(gt(e.current.export()))},{activeSubscriptions:d}=st(s=>s.account),{telemetry:{project:i}}=st(s=>s.app),{svgViewBoxZoom:o,svgViewBoxMin:a}=st(s=>s.param),{mode:h,lastTool:n,active:p,selected:r,keepLastPath:x,theme:S,refresh:{nodes:v},masterNodesCount:b,parallelLinesCount:M}=st(s=>s.runtime),j=Ft(),{height:I,width:f}=Tt(j),D=!d.RMP_CLOUD&&b+1>$t,c=!d.RMP_CLOUD&&M+1>Kt;_.useEffect(()=>{const s=Xt(e.current);Object.entries(s).filter(([y,g])=>g&&y in Yt).forEach(([y])=>Ut(y))},[v]);const[l,P]=_.useState({x:0,y:0}),[k,m]=_.useState({x:0,y:0}),[A,L]=_.useState({x:0,y:0}),[W,K]=_.useState({x:0,y:0}),X=B(s=>{const{x:y,y:g}=H(s);if(h.startsWith("station")){t(q("free"));const N=it(10),C="stn_".concat(N),w=h.slice(8),T=structuredClone(ft[w].defaultAttrs);"color"in T&&(T.color=S);const{x:G,y:mt}=Q(y,g,o,a);e.current.addNode(C,{visible:!0,zIndex:0,x:F(G,5),y:F(mt,5),type:w,[w]:T}),u(),i&&dt.event(ut.ADD_STATION,{type:w}),t(rt(new Set([C])))}else if(h.startsWith("misc-node")){t(q("free"));const N=it(10),C="misc_node_".concat(N),w=h.slice(10),{x:T,y:G}=Q(y,g,o,a);e.current.addNode(C,{visible:!0,zIndex:0,x:F(T,5),y:F(G,5),type:w,[w]:structuredClone(yt[w].defaultAttrs)}),u(),i&&dt.event(ut.ADD_STATION,{type:w}),t(rt(new Set([C])))}else h==="free"||h.startsWith("line")?(h.startsWith("line")&&(t(q("free")),x&&t(Wt(!1))),L({x:y,y:g}),K(a),s.shiftKey||(t(at("background")),t(xt()))):h==="select"&&(P(Q(y,g,o,a)),m(Q(y,g,o,a)))}),z=B(s=>{if(h==="select"){if(l.x!=0&&l.y!=0){const{x:y,y:g}=H(s);m(Q(y,g,o,a))}}else if(p==="background"){const{x:y,y:g}=H(s);t(pt({x:W.x+(A.x-y)*o/100,y:W.y+(A.y-g)*o/100}))}}),Y=B(s=>{if(h==="select"){const{x:y,y:g}=H(s),{x:N,y:C}=Q(y,g,o,a),w=Vt(e.current,l.x,l.y,N,C),T=Zt(e.current,new Set(w));t(rt(new Set([...s.shiftKey?r:[],...w,...T]))),t(q("free")),P({x:0,y:0}),m({x:0,y:0})}p==="background"&&!s.shiftKey&&t(at(void 0))}),nt=B(s=>{let y=o;s.deltaY>0&&o+10<400?y=o+10:s.deltaY<0&&o-10>0&&(y=o-10),t(Pt(y));const{x:g,y:N}=H(s),C=s.currentTarget.getBoundingClientRect(),[w,T]=[g/C.width,N/C.height];t(pt({x:a.x+g*o/100-f*y/100*w,y:a.y+N*o/100-I*y/100*T}))}),ot=B(async s=>{if(et?s.key==="Backspace":s.key==="Delete")r.size>0&&(r.forEach(y=>{e.current.hasNode(y)?e.current.dropNode(y):e.current.hasEdge(y)&&e.current.dropEdge(y)}),t(xt()),u());else if(s.key.startsWith("Arrow")){const g=s.key.endsWith("Left")?-1:s.key.endsWith("Right")?1:0,N=s.key.endsWith("Up")?-1:s.key.endsWith("Down")?1:0;t(pt(Q(100*g,100*N,o,a)))}else if(s.key==="i"||s.key==="j"||s.key==="k"||s.key==="l"){const g=(s.key==="j"?-1:s.key==="l"?1:0)*10,N=(s.key==="i"?-1:s.key==="k"?1:0)*10;r.size>0&&r.forEach(C=>{e.current.hasNode(C)&&(e.current.updateNodeAttribute(C,"x",w=>(w!=null?w:0)+g),e.current.updateNodeAttribute(C,"y",w=>(w!=null?w:0)+N),u())})}else if(s.key==="f"&&n)t(q(n));else if(s.key==="z"&&(et?s.metaKey&&!s.shiftKey:s.ctrlKey))et&&s.preventDefault(),t(Bt()),t(lt()),t(ct());else if(s.key==="s")t(q("select"));else if((s.key==="c"||s.key==="x")&&(et?s.metaKey&&!s.shiftKey:s.ctrlKey)){const y=Ot(e.current,r);navigator.clipboard.writeText(y),s.key==="x"&&(t(xt()),r.forEach(g=>{e.current.hasNode(g)?e.current.dropNode(g):e.current.hasEdge(g)&&e.current.dropEdge(g)}),u())}else if(s.key==="v"&&(et?s.metaKey&&!s.shiftKey:s.ctrlKey)){const y=await navigator.clipboard.readText(),{x:g,y:N}=Q(f/2,I/2,o,a),{nodes:C,edges:w}=Rt(y,e.current,D,c,F(g,5),F(N,5));u();const T=structuredClone(C);w.forEach(G=>T.add(G)),t(rt(T))}else(et&&s.key==="z"&&s.metaKey&&s.shiftKey||!et&&s.key==="y"&&s.ctrlKey)&&(t(zt()),t(lt()),t(ct()))}),[$,U]=_.useState(0),tt=B(s=>{if(s.touches.length===2){t(at(void 0));const[y,g]=[s.touches[0].clientX-s.touches[1].clientX,s.touches[0].clientY-s.touches[1].clientY];U(y*y+g*g)}}),O=B(s=>{if($!==0&&s.touches.length===2){const[y,g]=[s.touches[0].clientX-s.touches[1].clientX,s.touches[0].clientY-s.touches[1].clientY],N=y*y+g*g;let C=o;N-$<0&&o+10<=390?C=o+10:N-$>0&&o-10>=10&&(C=o-10),t(Pt(C)),U(N);const w=s.currentTarget.getBoundingClientRect(),[T,G]=[(s.touches[0].clientX+s.touches[1].clientX)/2-w.left,(s.touches[0].clientY+s.touches[1].clientY)/2-w.top],[mt,Dt]=[T/w.width,G/w.height];t(pt({x:a.x+T*o/100-f*C/100*mt,y:a.y+G*o/100-I*C/100*Dt}))}}),V=B(s=>{$!==0&&U(0)}),[Z,ht]=_.useState({sx:0,sy:0,ex:0,ey:0});return _.useEffect(()=>{ht({sx:l.x<=k.x?l.x:k.x,ex:l.x>k.x?l.x:k.x,sy:l.y<=k.y?l.y:k.y,ey:l.y>k.y?l.y:k.y})},[k.x,k.y]),E.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:I,width:f,viewBox:"".concat(a.x," ").concat(a.y," ").concat(f*o/100," ").concat(I*o/100),onPointerDown:X,onPointerMove:z,onPointerUp:Y,onTouchStart:tt,onTouchMove:O,onTouchEnd:V,onWheel:nt,tabIndex:0,onKeyDown:ot,children:[E.jsx(se,{}),h==="select"&&l.x!=0&&l.y!=0&&E.jsx("rect",{x:Z.sx,y:Z.sy,width:Z.ex-Z.sx,height:Z.ey-Z.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),E.jsx("defs",{children:E.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[E.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),E.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})};export{le as default};
