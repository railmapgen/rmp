import{j as e,a8 as ds,Q as Ut,a9 as zt,aa as kt,G as ae,ab as Ot,ac as le,k as qe,$ as K,M as Y,a0 as Z,p as q,s as v,q as Q,r as X,I as it,h as H,t as je,ad as hs,ae as us,g as ye,w as k,a7 as E,v as Vt,af as Et,ag as ps,F as _t,_ as Tt,B as G,ah as we,a1 as Te,ai as ue,aj as pe,ak as fe,c as fs,i as ms,e as gs,f as xs,al as Jt,am as js,O as at,an as bs,ao as ys,ap as se,aq as Mt,ar as vs,as as B,at as _,au as ws,av as ie,x as Ss,y as Cs}from"./chakra-e455e76b.js";import{g as zs,r as D,b as j}from"./react-beb26faf.js";import{w as ks,g as Os,a as lt,b as Kt,I as As,u as Es,r as F,n as Ht,S as T,L as ct,l as _s,c as de,R as Yt,d as V,e as ee,s as ge,f as xe,h as he,i as Zt,j as gt,M as Nt,k as Ts,m as Ms,o as O,p as qt,q as Hs,t as Je,C as Ns,v as Qt,x as Rt,y as Xt,z as re,A as Rs,B as Is,D as Bs,E as Ce,F as xt,G as Ps,H as Ls,J as It,K as Gs,T as Ds,N as Ws,O as $s,P as $e,Q as Fs,U as Us,V as Vs,W as Js,X as Ks,Y as dt,Z as Ys,_ as Zs,$ as qs,a0 as Qs,a1 as Xs,a2 as en,a3 as tn,a4 as sn,a5 as nn,a6 as rn}from"./index-4ffa93a6.js";import{s as Ke}from"./stations-3e448860.js";import{c as Bt,f as on,F as Pt,g as an,i as Ee}from"./helpers-bb2b958a.js";import{c as ln}from"./change-types-bea7dba8.js";var cn={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const dn=zs(cn);var hn=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function Lt(t){var r={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},s=t.match(/<\/?([^\s]+?)[/\s>]/);if(s&&(r.name=s[1],(dn[s[1]]||t.charAt(t.length-2)==="/")&&(r.voidElement=!0),r.name.startsWith("!--"))){var n=t.indexOf("-->");return{type:"comment",comment:n!==-1?t.slice(4,n):""}}for(var i=new RegExp(hn),o=null;(o=i.exec(t))!==null;)if(o[0].trim())if(o[1]){var a=o[1].trim(),l=[a,""];a.indexOf("=")>-1&&(l=a.split("=")),r.attrs[l[0]]=l[1],i.lastIndex--}else o[2]&&(r.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return r}var un=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,pn=/^\s*$/,fn=Object.create(null);function es(t,r){switch(r.type){case"text":return t+r.content;case"tag":return t+="<"+r.name+(r.attrs?function(s){var n=[];for(var i in s)n.push(i+'="'+s[i]+'"');return n.length?" "+n.join(" "):""}(r.attrs):"")+(r.voidElement?"/>":">"),r.voidElement?t:t+r.children.reduce(es,"")+"</"+r.name+">";case"comment":return t+"<!--"+r.comment+"-->"}}var mn={parse:function(t,r){r||(r={}),r.components||(r.components=fn);var s,n=[],i=[],o=-1,a=!1;if(t.indexOf("<")!==0){var l=t.indexOf("<");n.push({type:"text",content:l===-1?t:t.substring(0,l)})}return t.replace(un,function(d,p){if(a){if(d!=="</"+s.name+">")return;a=!1}var h,m=d.charAt(1)!=="/",c=d.startsWith("<!--"),u=p+d.length,f=t.charAt(u);if(c){var g=Lt(d);return o<0?(n.push(g),n):((h=i[o]).children.push(g),n)}if(m&&(o++,(s=Lt(d)).type==="tag"&&r.components[s.name]&&(s.type="component",a=!0),s.voidElement||a||!f||f==="<"||s.children.push({type:"text",content:t.slice(u,t.indexOf("<",u))}),o===0&&n.push(s),(h=i[o-1])&&h.children.push(s),i[o]=s),(!m||s.voidElement)&&(o>-1&&(s.voidElement||s.name===d.slice(2,-1))&&(o--,s=o===-1?n:i[o]),!a&&f!=="<"&&f)){h=o===-1?n:i[o].children;var w=t.indexOf("<",u),b=t.slice(u,w===-1?void 0:w);pn.test(b)&&(b=" "),(w>-1&&o+h.length>=0||b!==" ")&&h.push({type:"text",content:b})}}),n},stringify:function(t){return t.reduce(function(r,s){return r+es("",s)},"")}};function ht(t,r){if(!t)return!1;const s=t.props?t.props.children:t.children;return r?s.length>0:!!s}function ut(t){return t?t.props?t.props.children:t.children:[]}function gn(t){return Object.prototype.toString.call(t)!=="[object Array]"?!1:t.every(r=>D.isValidElement(r))}function Me(t){return Array.isArray(t)?t:[t]}function xn(t,r){const s={...r};return s.props=Object.assign(t.props,r.props),s}function ts(t,r){if(!t)return"";let s="";const n=Me(t),i=r.transSupportBasicHtmlNodes&&r.transKeepBasicHtmlNodesFor?r.transKeepBasicHtmlNodesFor:[];return n.forEach((o,a)=>{if(typeof o=="string")s+=`${o}`;else if(D.isValidElement(o)){const l=Object.keys(o.props).length,d=i.indexOf(o.type)>-1,p=o.props.children;if(!p&&d&&l===0)s+=`<${o.type}/>`;else if(!p&&(!d||l!==0))s+=`<${a}></${a}>`;else if(o.props.i18nIsDynamicList)s+=`<${a}></${a}>`;else if(d&&l===1&&typeof p=="string")s+=`<${o.type}>${p}</${o.type}>`;else{const h=ts(p,r);s+=`<${a}>${h}</${a}>`}}else if(o===null)lt("Trans: the passed in value is invalid - seems you passed in a null child.");else if(typeof o=="object"){const{format:l,...d}=o,p=Object.keys(d);if(p.length===1){const h=l?`${p[0]}, ${l}`:p[0];s+=`{{${h}}}`}else lt("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",o)}else lt("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",o)}),s}function jn(t,r,s,n,i,o){if(r==="")return[];const a=n.transKeepBasicHtmlNodesFor||[],l=r&&new RegExp(a.join("|")).test(r);if(!t&&!l)return[r];const d={};function p(w){Me(w).forEach(x=>{typeof x!="string"&&(ht(x)?p(ut(x)):typeof x=="object"&&!D.isValidElement(x)&&Object.assign(d,x))})}p(t);const h=mn.parse(`<0>${r}</0>`),m={...d,...i};function c(w,b,x){const C=ut(w),W=f(C,b.children,x);return gn(C)&&W.length===0?C:W}function u(w,b,x,C,W){w.dummy&&(w.children=b),x.push(D.cloneElement(w,{...w.props,key:C},W?void 0:b))}function f(w,b,x){const C=Me(w);return Me(b).reduce((z,y,R)=>{const te=y.children&&y.children[0]&&y.children[0].content&&s.services.interpolator.interpolate(y.children[0].content,m,s.language);if(y.type==="tag"){let M=C[parseInt(y.name,10)];!M&&x.length===1&&x[0][y.name]&&(M=x[0][y.name]),M||(M={});const S=Object.keys(y.attrs).length!==0?xn({props:y.attrs},M):M,oe=D.isValidElement(S),Xe=oe&&ht(y,!0)&&!y.voidElement,et=l&&typeof S=="object"&&S.dummy&&!oe,Ie=typeof t=="object"&&t!==null&&Object.hasOwnProperty.call(t,y.name);if(typeof S=="string"){const I=s.services.interpolator.interpolate(S,m,s.language);z.push(I)}else if(ht(S)||Xe){const I=c(S,y,x);u(S,I,z,R)}else if(et){const I=f(C,y.children,x);z.push(D.cloneElement(S,{...S.props,key:R},I))}else if(Number.isNaN(parseFloat(y.name)))if(Ie){const I=c(S,y,x);u(S,I,z,R,y.voidElement)}else if(n.transSupportBasicHtmlNodes&&a.indexOf(y.name)>-1)if(y.voidElement)z.push(D.createElement(y.name,{key:`${y.name}-${R}`}));else{const I=f(C,y.children,x);z.push(D.createElement(y.name,{key:`${y.name}-${R}`},I))}else if(y.voidElement)z.push(`<${y.name} />`);else{const I=f(C,y.children,x);z.push(`<${y.name}>${I}</${y.name}>`)}else if(typeof S=="object"&&!oe){const I=y.children[0]?te:null;I&&z.push(I)}else y.children.length===1&&te?z.push(D.cloneElement(S,{...S.props,key:R},te)):z.push(D.cloneElement(S,{...S.props,key:R}))}else if(y.type==="text"){const M=n.transWrapTextNodes,S=o?n.unescape(s.services.interpolator.interpolate(y.content,m,s.language)):s.services.interpolator.interpolate(y.content,m,s.language);M?z.push(D.createElement(M,{key:`${y.name}-${R}`},S)):z.push(S)}return z},[])}const g=f([{dummy:!0,children:t||[]}],h,Me(t||[]));return ut(g[0])}function bn(t){let{children:r,count:s,parent:n,i18nKey:i,context:o,tOptions:a={},values:l,defaults:d,components:p,ns:h,i18n:m,t:c,shouldUnescape:u,...f}=t;const g=m||Kt();if(!g)return ks("You will need to pass in an i18next instance by using i18nextReactModule"),r;const w=c||g.t.bind(g)||(oe=>oe);o&&(a.context=o);const b={...Os(),...g.options&&g.options.react};let x=h||w.ns||g.options&&g.options.defaultNS;x=typeof x=="string"?[x]:x||["translation"];const C=d||ts(r,b)||b.transEmptyNodeValue||i,{hashTransKey:W}=b,z=i||(W?W(C):C),y=l?a.interpolation:{interpolation:{...a.interpolation,prefix:"#$?",suffix:"?$#"}},R={...a,count:s,...l,...y,defaultValue:C,ns:x},te=z?w(z,R):C,M=jn(p||r,te,g,b,R,u),S=n!==void 0?n:b.defaultTransParent;return S?D.createElement(S,f,M):M}function Gt(t){let{children:r,count:s,parent:n,i18nKey:i,context:o,tOptions:a={},values:l,defaults:d,components:p,ns:h,i18n:m,t:c,shouldUnescape:u,...f}=t;const{i18n:g,defaultNS:w}=D.useContext(As)||{},b=m||g||Kt(),x=c||b&&b.t.bind(b);return bn({children:r,count:s,parent:n,i18nKey:i,context:o,tOptions:a,values:l,defaults:d,components:p,ns:h||x&&x.ns||w||b&&b.options&&b.options.defaultNS,i18n:b,t:c,shouldUnescape:u,...f})}var Dt=function(t){return Es(F.ready(),t)},yn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}},Re=(t=>(t.left="l",t.right="r",t))(Re||{}),me=(t=>(t.through="through",t.nonThrough="nonthrough",t))(me||{}),Qe=(t=>(t.local="local",t.express="express",t.direct="direct",t))(Qe||{}),ce=(t=>(t.MTR="mtr",t.GZMTR="gzmtr",t.SHMetro="shmetro",t))(ce||{}),At=(t=>(t.sh="sh",t.sh2020="sh2020",t))(At||{});const vn=(t,{info_panel_type:r,line_num:s,stn_list:n,style:i,theme:o})=>{const a=Object.fromEntries(Object.keys(n).filter(l=>!["linestart","lineend"].includes(l)).map(l=>[l,`stn_${Ht(10)}`]));Object.entries(n).filter(([l,d])=>!["linestart","lineend"].includes(l)).forEach(([l,d])=>{const p=t.filterNodes((h,m)=>Object.values(T).includes(m.type)&&m[m.type].names[0]===d.name[0]);p.length!==0&&(a[l]=p[0])}),Object.entries(n).filter(([l,d])=>!["linestart","lineend"].includes(l)).filter(([l,d])=>t.filterNodes((p,h)=>Object.values(T).includes(h.type)&&h[h.type].names[0]===d.name[0]).length===0).forEach(([l,d],p)=>{let h=T.ShmetroBasic;const m=d.transfer.groups,c=m.map(f=>f.lines).flat();i===ce.SHMetro?c.length>0?h=T.ShmetroInt:r===At.sh2020?h=T.ShmetroBasic2020:h=T.ShmetroBasic:i===ce.GZMTR?c.length>0?h=T.GzmtrInt:h=T.GzmtrBasic:i===ce.MTR&&(h=T.MTR);const u={...structuredClone(Ke[h].defaultAttrs),names:d.name};h===T.ShmetroBasic2020?u.color=o:h===T.GzmtrBasic?(u.color=o,u.lineCode=s,u.stationCode=d.num):h===T.GzmtrInt?u.transfer=m.map((f,g)=>{const w=f.lines.map(b=>{var x;return[...(x=b.theme)!=null?x:o,"1","01"]});return g===0?[[...o,s,d.num],...w]:w}):h===T.MTR&&(m[0].lines.length?u.transfer=[[[...o,"",""],...m[0].lines.map(f=>{var g;return[...(g=f.theme)!=null?g:o,"",""]})]]:u.transfer=[[]]),t.addNode(a[l],{visible:!0,zIndex:0,x:100+p*50,y:1e3,type:h,[h]:u})}),Object.entries(n).filter(([l,d])=>!["linestart","lineend"].includes(l)).forEach(([l,d])=>{d.children.filter(p=>!["linestart","lineend"].includes(p)).forEach(p=>{t.addDirectedEdgeWithKey(`line_${Ht(10)}`,a[l],a[p],{visible:!0,zIndex:0,type:ct.Diagonal,[ct.Diagonal]:structuredClone(_s[ct.Diagonal].defaultAttrs),style:de.SingleColor,[de.SingleColor]:{color:o},reconcileId:""})})})},wn="rmg-bridge--",Sn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Cn(t){const{isOpen:r,onClose:s,onImport:n}=t,[i]=D.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:F.getAppName(),parentId:i});return D.useEffect(()=>{const a=new BroadcastChannel(wn+i);return a.onmessage=l=>{const{event:d,data:p}=l.data;console.log("[rmp] Received event from RMG app clip:",d),d==="CLOSE"?s():d==="IMPORT"&&n(p)},()=>{a.close()}},[]),e.jsx(Yt,{isOpen:r,onClose:s,sx:Sn,children:e.jsx("iframe",{src:o,loading:"lazy"})})}const zn="RMP_GALLERY_CHANNEL",kn="OPEN_TEMPLATE",On=new BroadcastChannel(zn),An={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"}};function En(t){const{isOpen:r,onClose:s}=t,n=ds(),{t:i}=V(),o=ee(),a=j.useRef(window.graph),l=j.useCallback(()=>{o(ge()),o(xe()),o(he(a.current.export()))},[o,ge,xe,he,a]),d=async h=>{const{version:m,...c}=JSON.parse(await Zt(JSON.stringify(h)));o(gt()),a.current.clear(),a.current.import(c.graph),l()},p=async h=>{var c;const m=await((c=(await Promise.allSettled([fetch(`/rmp-gallery/resources/real_world/${h}.json`),fetch(`/rmp-gallery/resources/fantasy/${h}.json`)])).filter(u=>u.status==="fulfilled").find(u=>u.value.status===200))==null?void 0:c.value.json());m?(d(m),n({title:i("header.open.importFromRMPGallery",{id:h}),status:"success",duration:9e3,isClosable:!0})):n({title:i("header.open.failToImportFromRMPGallery",{id:h}),status:"error",duration:9e3,isClosable:!0})};return j.useEffect(()=>{const h=window.location.href;if(h.includes("/s/")){history.replaceState({},i("about.rmp"),h.substring(0,h.indexOf("s/")));const m=h.substring(h.lastIndexOf("s/")+2);p(m)}},[]),j.useEffect(()=>{On.onmessage=h=>{const{event:m,data:c}=h.data;m===kn&&(p(c),s())}},[]),e.jsx(e.Fragment,{children:e.jsxs(Yt,{isOpen:r,onClose:s,size:"full",sx:An,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(Ut,{onClick:s,position:"fixed",top:"5px",right:"15px"})]})})}function _n(){const{t}=V(),r=ee(),s=j.useRef(window.graph),n=j.useRef(null),[i,o]=j.useState(!1),[a,l]=j.useState(!1),d=j.useCallback(()=>{r(ge()),r(xe()),r(he(s.current.export()))},[r,ge,xe,he,s]),p=()=>{r(gt()),s.current.clear(),r(qt(100)),r(Hs({x:0,y:0})),d()},h=c=>{try{vn(s.current,c),d()}catch(u){r(Je({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",u)}finally{o(!1)}},m=async c=>{var f;const u=(f=c.target.files)==null?void 0:f[0];if(console.log("OpenActions.handleUpload():: received file",u),(u==null?void 0:u.type)!=="application/json")r(Je({status:"error",message:t("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const g=await Tn(u),{version:w,...b}=JSON.parse(await Zt(g));r(gt()),s.current.clear(),s.current.import(b.graph),d()}catch(g){r(Je({status:"error",message:t("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",g)}c.target.value=""};return e.jsxs(zt,{children:[e.jsx(kt,{as:ae,size:"sm",variant:"ghost",icon:e.jsx(Nt,{})}),e.jsxs(Ot,{children:[e.jsx(le,{icon:e.jsx(Ts,{}),onClick:p,children:t("header.open.new")}),e.jsx("input",{id:"upload_project",ref:n,type:"file",accept:".json",hidden:!0,onChange:m,"data-testid":"file-upload"}),e.jsx(le,{icon:e.jsx(Nt,{}),onClick:()=>{var c;return(c=n==null?void 0:n.current)==null?void 0:c.click()},children:t("header.open.config")}),e.jsx(le,{icon:e.jsx(Ms,{}),onClick:()=>o(!0),children:t("header.open.projectRMG")}),e.jsxs(le,{icon:e.jsx(O,{}),onClick:()=>l(!0),children:[t("header.open.gallery"),e.jsx(qe,{ml:"1",colorScheme:"green",children:"New"})]})]}),e.jsx(Cn,{isOpen:i,onClose:()=>o(!1),onImport:h}),e.jsx(En,{isOpen:a,onClose:()=>l(!1)})]})}const Tn=t=>new Promise(r=>{const s=new FileReader;s.onloadend=()=>r(s.result),s.readAsText(t)});/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Mn(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var n,i,o,a,l=[],d=!0,p=!1;try{if(o=(s=s.call(t)).next,r===0){if(Object(s)!==s)return;d=!1}else for(;!(d=(n=o.call(s)).done)&&(l.push(n.value),l.length!==r);d=!0);}catch(h){p=!0,i=h}finally{try{if(!d&&s.return!=null&&(a=s.return(),Object(a)!==a))return}finally{if(p)throw i}}return l}}function Wt(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),s.push.apply(s,n)}return s}function U(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Wt(Object(s),!0).forEach(function(n){Hn(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Wt(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Hn(t,r,s){return r=Wn(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Nn(t,r){if(t==null)return{};var s={},n=Object.keys(t),i,o;for(o=0;o<n.length;o++)i=n[o],!(r.indexOf(i)>=0)&&(s[i]=t[i]);return s}function Rn(t,r){if(t==null)return{};var s=Nn(t,r),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function $t(t,r){return Bn(t)||Mn(t,r)||ss(t,r)||Gn()}function Fe(t){return In(t)||Pn(t)||ss(t)||Ln()}function In(t){if(Array.isArray(t))return jt(t)}function Bn(t){if(Array.isArray(t))return t}function Pn(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function ss(t,r){if(t){if(typeof t=="string")return jt(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return jt(t,r)}}function jt(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,n=new Array(r);s<r;s++)n[s]=t[s];return n}function Ln(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dn(t,r){if(typeof t!="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,r||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Wn(t){var r=Dn(t,"string");return typeof r=="symbol"?r:String(r)}function Ne(t){var r=t.sizes.shift(),s=Math.max(Math.ceil(r[0]),1),n=Math.max(Math.ceil(r[1]),1),i=[s-1,n-1,1,1],o=Date.now(),a=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,l,d;a?(l=new OffscreenCanvas(1,1),d=new OffscreenCanvas(s,n)):(l=document.createElement("canvas"),l.width=1,l.height=1,d=document.createElement("canvas"),d.width=s,d.height=n);var p=l.getContext("2d"),h=d.getContext("2d");h&&(h.fillRect.apply(h,i),p.drawImage(d,s-1,n-1,1,1,0,0,1,1));var m=p&&p.getImageData(0,0,1,1).data[3]!==0,c=Date.now()-o;return[l,d].forEach(function(u){u.height=0,u.width=0}),a?(postMessage({width:s,height:n,benchmark:c,isTestPass:m}),!m&&t.sizes.length&&Ne(t)):m?t.onSuccess(s,n,c):(t.onError(s,n,c),t.sizes.length&&Ne(t)),m}var pt={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},$n=["onError","onSuccess"],Se={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},_e={};function ft(t){var r=t.width===t.height,s=t.height===1,n=t.width===1,i=[];if(!t.width||!t.height)t.sizes.forEach(function(h){var m=r||s?h:1,c=r||n?h:1;i.push([m,c])});else for(var o=t.min||Se.min,a=t.step||Se.step,l=Math.max(t.width,t.height);l>=o;){var d=r||s?l:1,p=r||n?l:1;i.push([d,p]),l-=a}return i}function Ue(t){var r=window&&"HTMLCanvasElement"in window,s=window&&"OffscreenCanvas"in window,n=Date.now(),i=t.onError,o=t.onSuccess,a=Rn(t,$n),l=null;if(!r)return!1;if(t.useWorker&&s){var d=`
            var canvasTest = `.concat(Ne.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),p=new Blob([d],{type:"application/javascript"}),h=URL.createObjectURL(p);l=new Worker(h),URL.revokeObjectURL(h),l.onmessage=function(m){var c=m.data,u=c.width,f=c.height,g=c.benchmark,w=c.isTestPass;w?(_e[n].onSuccess(u,f,g),delete _e[n]):_e[n].onError(u,f,g)}}if(t.usePromise)return new Promise(function(m,c){var u=U(U({},t),{},{onError:function(b,x,C){var W;if(t.sizes.length===0)W=!0;else{var z=t.sizes.slice(-1),y=$t(z,1),R=$t(y[0],2),te=R[0],M=R[1];W=b===te&&x===M}i(b,x,C),W&&c({width:b,height:x,benchmark:C})},onSuccess:function(b,x,C){o(b,x,C),m({width:b,height:x,benchmark:C})}});if(l){var f=u.onError,g=u.onSuccess;_e[n]={onError:f,onSuccess:g},l.postMessage(a)}else Ne(u)});if(l)_e[n]={onError:i,onSuccess:o},l.postMessage(a);else return Ne(t)}var Fn={maxArea:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=ft({width:r.max,height:r.max,min:r.min,step:r.step,sizes:Fe(pt.area)}),n=U(U(U({},Se),r),{},{sizes:s});return Ue(n)},maxHeight:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=ft({width:1,height:r.max,min:r.min,step:r.step,sizes:Fe(pt.height)}),n=U(U(U({},Se),r),{},{sizes:s});return Ue(n)},maxWidth:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=ft({width:r.max,height:1,min:r.min,step:r.step,sizes:Fe(pt.width)}),n=U(U(U({},Se),r),{},{sizes:s});return Ue(n)},test:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=U(U({},Se),r);return s.sizes=Fe(s.sizes),s.width&&s.height&&(s.sizes=[[s.width,s.height]]),Ue(s)}};const bt=(t,r,s)=>{const n=new Blob([s],{type:r});ns(t,n)},ns=(t,r)=>{const s=window.URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)},ne=new Set,yt=new Set,vt=new Set,wt=new Set,Ye=new Map,J=new Map;let N=[],He=0;const Ze=new Map,mt=new Map,St=new Set,Un={name:["LEFT END","LEFT END"],secondaryName:!1,num:"00",services:[Qe.local],parents:[],children:["lineend"],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:Re.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},Vn={name:["RIGHT END","RIGHT END"],secondaryName:!1,num:"00",services:[Qe.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:Re.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},Jn={},rs={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:ce.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Re.right,platform_num:"1",theme:[Ns.Shanghai,"sh1","#E3002B",Qt.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Jn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:At.sh,notesGZMTR:[],direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1}},Kn={name:["",""],secondaryName:!1,num:"",services:[Qe.local],parents:[],children:[],branch:{left:[],right:[]},transfer:{groups:[{lines:[]}],tick_direc:Re.right,paid_area:!0},facility:"",loop_pivot:!1,one_line:!0,int_padding:355},P=t=>`${t[0]}/${t[1]}=${t[2]}${t[3]}`,os=t=>[de.SingleColor,de.MTRRaceDays].includes(t),Yn=t=>{if([de.SingleColor,de.MTRRaceDays].includes(t.style))return structuredClone(t[t.style].color)},Zn=(t,r)=>{const[s,n]=t.extremities(r),i=t.getEdgeAttributes(r),o=i.style;if(s!=n&&os(o)){const a=Yn(i);wt.has(P(a))||(vt.add(a),wt.add(P(a)),Ye.set(a,s)),J.has(s)?N.push({target:n,next:J.get(s),color:a}):N.push({target:n,next:-1,color:a}),J.set(s,He),He++,J.has(n)?N.push({target:s,next:J.get(n),color:a}):N.push({target:s,next:-1,color:a}),J.set(n,He),He++}},is=(t,r,s)=>{if(ne.has(t))return;ne.add(t);let n=0;const i=new Set;for(let o=J.get(t);o!=-1;o=N[o].next){const a=N[o].target,l=N[o].color;P(l)==P(s)&&(i.has(a)||(i.add(a),n++,a!=r&&is(a,t,s)))}Ze.set(t,n)},Ft=(t,r)=>{const s=t.stn_list.lineend.parents;s.push(r),t.stn_list.lineend.parents=structuredClone(s).reverse(),t.stn_list.lineend.parents.length==2?t.stn_list.lineend.branch.left=[me.through,s[1]]:t.stn_list.lineend.branch.left=[]},qn=(t,r)=>{let s=0;for(let n=J.get(t);n!=-1;n=N[n].next){N[n].target;const i=N[n].color;P(i)==P(r)&&s++}return s},as=(t,r,s)=>{if(St.has(t))return[];St.add(t);const n=[];for(let i=J.get(t);i!=-1;i=N[i].next){const o=N[i].target,a=N[i].color;o!=r&&P(a)==P(s)&&(o.startsWith("stn")?n.push(o):n.push(...as(o,t,s)))}return n},Ct=(t,r,s,n,i,o,a)=>{if(ne.has(t)&&(!t.startsWith("misc_node_")&&a.stn_list[t]==null||t.startsWith("misc_node_")&&!yt.has(t)||a.loop))return[];if(ne.has(t)&&a.stn_list[t]!=null&&qn(t,o)-1>=2){const c=[...a.stn_list[t].parents,r];if(a.stn_list[c[1]]==null){const g=c[0];c[0]=c[1],c[1]=g}a.stn_list[t].parents=structuredClone(c).reverse(),a.stn_list[t].branch.left=[me.through,c[1]];const u=[];for(const g of a.stn_list[t].children)g!=r&&u.push(g);a.stn_list[t].children=structuredClone(u),a.stn_list[t].branch.right=[];const f=[];for(const g of a.stn_list.lineend.parents)g!=t&&f.push(g);return a.stn_list.lineend.parents=structuredClone(f).reverse(),a.stn_list.lineend.parents.length==2?a.stn_list.lineend.branch.left=[me.through,f[1]]:a.stn_list.lineend.branch.left=[],u.length==0&&(a.stn_list[t].children=["lineend"],Ft(a,t)),[t]}ne.add(t);const l=[],d=[],p=[],h=new Set,m=new Set;for(let c=J.get(t);c!=-1;c=N[c].next){const u=N[c].target,f=N[c].color;if(u!=s){if(P(f)==P(o)){if(m.has(u))continue;if(m.add(u),t.startsWith("misc_node_")){const g=Ct(u,r,t,n+1,i,o,a);g.length!=0&&l.push(...g)}else{const g=Ct(u,t,t,n+1,i,o,a);g.length!=0&&l.push(...g)}}if(!h.has(P(f))&&P(f)!=P(o)){h.add(P(f));const g={theme:f,name:[f[1],f[1]]};p.push(g)}}}if(l.length==2){for(let c=0;c<2;c++)l[c]=="lineend"&&l.splice(c,1);if(a.stn_list[l[1]].parents.length>=2){const c=l[0];l[0]=l[1],l[1]=c}}if(ne.has(t)&&a.stn_list[t]!=null){const c=[];for(const u of a.stn_list.lineend.parents)u!=t&&c.push(u);a.stn_list.lineend.parents=structuredClone(c).reverse(),a.stn_list.lineend.parents.length==2?a.stn_list.lineend.branch.left=[me.through,c[1]]:a.stn_list.lineend.branch.left=[],l.length==0&&(St.clear(),d.push(...as(t,r,o)))}if(t.startsWith("misc_node_"))return yt.add(t),l;{const c=i.getNodeAttributes(t).type,u=i.getNodeAttributes(t)[c];if(a.stn_list[t]=structuredClone(Kn),a.stn_list[t].name=[u.names[0],u.names[1]],a.stn_list[t].num=String(n),i.getNodeAttributes(t).type==T.GzmtrBasic){const f=u;a.stn_list[t].num=f.stationCode,a.stn_list[t].secondaryName=f.secondaryNames}if(i.getNodeAttributes(t).type==T.GzmtrInt){const f=u,g=f.transfer[0];for(const w of g)if(P(w)==P(o)){a.stn_list[t].num=String(w[5]);break}a.stn_list[t].secondaryName=f.secondaryNames}return l.length!=0?(a.stn_list[t].children=structuredClone(l).reverse(),l.length==2&&(a.stn_list[t].branch.right=[me.through,l[1]])):(a.stn_list[t].children=["lineend"],Ft(a,t)),d.push(r),a.stn_list[t].parents=structuredClone(d).reverse(),d.length==2&&(a.stn_list[t].branch.left=[me.through,d[1]]),p.length!=0&&(a.stn_list[t].transfer.groups[0].lines=structuredClone(p)),[t]}},Qn=(t,r,s,n)=>{const i=structuredClone(rs);n=="LOOP"&&(i.loop=!0);let o;switch(t.getNodeAttributes(s).type){case T.GzmtrBasic:case T.GzmtrInt:o=ce.GZMTR;break;case T.MTR:o=ce.MTR;break;default:o=ce.SHMetro;break}i.theme=structuredClone(r),i.style=o,i.stn_list.linestart=structuredClone(Un),i.stn_list.lineend=structuredClone(Vn),ne.clear(),yt.clear();const a=Ct(s,"linestart","linestart",1,t,r,i);if(i.current_stn_idx=a[0],i.stn_list.linestart.children=[a[0]],!(Object.keys(i.stn_list).length<=3||i.stn_list.lineend.parents.length>=3))return structuredClone(i)},Xn=t=>{ne.clear(),vt.clear(),wt.clear(),Ye.clear(),J.clear(),N=[],He=0,Ze.clear(),mt.clear(),t.filterEdges(n=>n.startsWith("line")).forEach(n=>{os(t.getEdgeAttributes(n).style)&&Zn(t,n)});let r=0;t.forEachNode(n=>{mt.set(n,++r)}),mt.set("lineend",++r);const s=[];for(const n of vt){ne.clear(),Ze.clear(),is(Ye.get(n),"line_root",n);let i=!0,o="LINE";const a=[];for(const[d,p]of Ze)p==1&&a.push(d),p==3&&(o="BRANCH"),p>3&&(i=!1);if(!i)continue;a.length==0&&(o="LOOP",a.push(Ye.get(n)));const l=[];for(const d of a){const p=Qn(t,n,d,o);p!=null&&l.push([p,p.stn_list[p.current_stn_idx].name[0],p.stn_list[p.current_stn_idx].name[1]])}l.length!=0&&s.push({theme:n,param:structuredClone(l),type:o})}return s},er=t=>t[0]!=""&&t[1]!=""?t[0]+"_"+t[1]:t[0]!=""?t[0]:t[1]!=""?t[1]:`${new Date().valueOf()}`,tr=(t,r,s)=>{t.line_name=r,t.line_num=String(s),console.log(t),bt(`RMG_${er(r)}.json`,"application/json",JSON.stringify(t))},sr={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},nr=t=>{const{isOpen:r,onClose:s}=t,{t:n}=V(),i=j.useRef(window.graph),[o,a]=j.useState(!1),[l,d]=j.useState([[rs,"",""]]),[p,h]=j.useState(["","",""]),[m,c]=j.useState([]);return j.useEffect(()=>{r&&c(Xn(i.current))},[r]),e.jsxs(K,{isOpen:r,onClose:s,size:"2xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:e.jsx(v,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")})}),e.jsx(Q,{}),e.jsxs(X,{children:[e.jsx(v,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info1")}),e.jsx(v,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info2")}),e.jsx("br",{}),m.length===0?e.jsx(v,{fontSize:"md",children:n("header.download.2rmg.noline")}):e.jsx("table",{children:m.map(({theme:u,param:f,type:g})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Rt,{name:u[0]=="other"&&u[1]=="other"?u[2]:u[1],bg:u[2],fg:u[3]})}),e.jsx("td",{children:e.jsx(it,{placeholder:n("header.download.2rmg.placeholder.chinese"),id:"nameCh_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(it,{placeholder:n("header.download.2rmg.placeholder.english"),id:"nameEn_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(it,{placeholder:n("header.download.2rmg.placeholder.lineCode"),id:"lineNum_"+JSON.stringify(u),size:"sm"})}),e.jsx("td",{children:e.jsx(Rt,{name:n(`header.download.2rmg.type.${g.toLowerCase()}`),bg:sr[g],fg:Qt.white})}),e.jsx("td",{children:e.jsx(H,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const w=document.getElementById("nameCh_"+JSON.stringify(u)),b=document.getElementById("nameEn_"+JSON.stringify(u)),x=document.getElementById("lineNum_"+JSON.stringify(u));d(f),h([w.value.trim(),b.value.trim(),x.value.trim()]),a(!0)},size:"sm",children:e.jsx(Xt,{})})})]},JSON.stringify(u)))})]}),e.jsx(je,{children:e.jsx(H,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:n("close")})})]}),e.jsx(rr,{isOpen:o,onClose:()=>a(!1),param:l,nameList:p})]})},rr=t=>{const{isOpen:r,onClose:s,param:n,nameList:i}=t,{t:o}=V(),[a,l]=j.useState("");return j.useEffect(()=>{i[0]!=""&&i[1]!=""?l(i[0]+"/"+i[1]):i[0]!=""?l(i[0]):i[1]!=""&&l(i[1])},[...i]),e.jsxs(K,{isOpen:r,onClose:s,size:"md",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:e.jsxs(v,{as:"b",fontSize:"xl",children:[o("header.download.2rmg.download")," ",a]})}),e.jsx(Q,{}),e.jsx(X,{children:e.jsxs(hs,{children:[e.jsx(v,{fontSize:"sm",mb:"2",lineHeight:"100%",children:o("header.download.2rmg.downloadInfo")}),n.map(([d,p,h])=>e.jsxs(H,{onClick:()=>{tr(d,[i[0],i[1]],i[2])},children:[p,"/",h]},`${p}${h}`))]})}),e.jsx(je,{children:e.jsx(H,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:o("close")})})]})]})},or=t=>{const{isOpen:r,onClose:s}=t,{t:n}=V();return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:n("header.download.termsAndConditions")}),e.jsx(Q,{}),e.jsx(X,{children:e.jsxs(us,{children:[e.jsxs(ye,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(k,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(E,{as:O})]}),", ",e.jsxs(k,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(E,{as:O})]})," or ",e.jsxs(k,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(E,{as:O})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(k,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(E,{as:O})]}),"，",e.jsxs(k,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(E,{as:O})]}),"或",e.jsxs(k,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(E,{as:O})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(E,{as:O})]})," and ",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(E,{as:O})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(E,{as:O})]}),"及",e.jsxs(k,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(E,{as:O})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(ye,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(k,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(E,{as:O})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(k,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(E,{as:O})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(ye,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(k,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(E,{as:O})]})," ","– the open-source emoji and icon project. License:",e.jsxs(k,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(E,{as:O})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(k,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(E,{as:O})]}),"所设计。许可证：",e.jsxs(k,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(E,{as:O})]})]}),e.jsxs(ye,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},ir=or;function ar(){const t=Vt("white","gray.800"),r=ee(),{telemetry:{project:s}}=re(A=>A.app),n=re(A=>A.param),{t:i}=V(),o=j.useRef(window.graph),[a,l]=j.useState("png"),d={png:i("header.download.png"),svg:i("header.download.svg")},[p,h]=j.useState({width:1,height:1,benchmark:.001}),[m,c]=j.useState(100),u=[25,33,50,67,75,80,90,100,110,125,150,175,200,250,300,400,500,750,1e3],f=Object.fromEntries(u.map(A=>[A,`${A}%`])),[g,w]=j.useState([]),[b,x]=j.useState(!1),C=[{type:"select",label:i("header.download.format"),value:a,options:d,onChange:A=>l(A==="png"?"png":"svg")}],W=[{type:"select",label:i("header.download.scale"),value:m,options:f,disabledOptions:g,onChange:A=>c(A)},{type:"switch",label:i("header.download.transparent"),isChecked:b,onChange:x}],[z,y]=j.useState(!1),[R,te]=j.useState(!1),[M,S]=j.useState(!1),[oe,Xe]=j.useState(!1),[et,Ie]=j.useState(!1);j.useEffect(()=>{(async()=>{const be=await Fn.maxArea({usePromise:!0,useWorker:!0});h(be)})()},[]),j.useEffect(()=>{if(z){const{xMin:A,yMin:be,xMax:Be,yMax:Pe}=Bt(o.current),[ze,ke]=[Be-A,Pe-be],L=u.filter(Le=>ze*Le/100>p.width&&ke*Le/100>p.height);w(L)}},[z]);const I=()=>{s&&F.event(xt.DOWNLOAD_PARAM,{"#nodes":o.current.order,"#edges":o.current.size}),bt(`RMP_${new Date().valueOf()}.json`,"application/json",Ps(n))},ls=async()=>{y(!1),s&&F.event(xt.DOWNLOAD_IMAGES,{numberOfNodes:o.current.order,numberOfEdges:o.current.size});const{xMin:A,yMin:be,xMax:Be,yMax:Pe}=Bt(o.current),[ze,ke]=[Be-A,Pe-be],L=document.getElementById("canvas").cloneNode(!0);[...L.children].filter($=>o.current.hasNode($.id)&&o.current.getNodeAttribute($.id,"type")===Ls.Virtual).forEach($=>L.removeChild($)),M||L.appendChild(lr(Be-400,Pe-60)),L.setAttribute("viewBox",`${A} ${be} ${ze} ${ke}`),L.setAttribute("width",ze.toString()),L.setAttribute("height",ke.toString()),Object.entries({".rmp-name__zh":["font-family"],".rmp-name__en":["font-family"],".rmp-name__mtr__zh":["font-family"],".rmp-name__mtr__en":["font-family"],".rmp-name__berlin":["font-family"],".rmp-name-station":["paint-order","stroke","stroke-width"]}).forEach(([$,Oe])=>{const De=document.querySelector($);if(De===null)return;const ot=window.getComputedStyle(De);L.querySelectorAll($).forEach(We=>{Oe.forEach(Ae=>{We.setAttribute(Ae,ot.getPropertyValue(Ae))}),We.classList.remove($)})});const Le=on(o.current);for(const $ in Pt)if(Le[$])try{const{className:Oe,cssFont:De,cssName:ot}=Pt[$],We=await an(L,Oe,De,ot),Ae=document.createElement("style");Ae.textContent=We.join(`
`),L.prepend(Ae)}catch(Oe){alert("Failed to load fonts. Fonts in the exported PNG will be missing."),console.error(Oe)}if(a==="svg"){bt(`RMP_${new Date().valueOf()}.svg`,"image/svg+xml",L.outerHTML);return}document.body.appendChild(L);const cs="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(L.outerHTML)));document.body.removeChild(L);const Ge=document.createElement("canvas"),[tt,st]=[ze*m/100,ke*m/100];Ge.width=tt,Ge.height=st;const nt=Ge.getContext("2d");b||(nt.fillStyle=t,nt.fillRect(0,0,tt,st));const rt=new Image;rt.onload=()=>{nt.drawImage(rt,0,0,tt,st),Ge.toBlob($=>{$||r(Je({status:"error",message:i("header.download.imageTooBig")})),ns(`RMP_${new Date().valueOf()}.png`,$)},"image/png")},rt.src=cs};return e.jsxs(zt,{id:"download",children:[e.jsx(kt,{as:ae,size:"sm",variant:"ghost",icon:e.jsx(Xt,{})}),e.jsxs(Ot,{children:[e.jsx(le,{icon:e.jsx(Rs,{}),onClick:I,children:i("header.download.config")}),e.jsxs(le,{icon:e.jsx(Is,{}),onClick:()=>Ie(!0),children:[i("header.download.2rmg.title"),e.jsx(qe,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(le,{icon:e.jsx(Bs,{}),onClick:()=>y(!0),children:i("header.download.image")})]}),e.jsxs(K,{size:"xl",isOpen:z,onClose:()=>y(!1),children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:i("header.download.image")}),e.jsx(Q,{}),e.jsxs(X,{children:[e.jsx(Ce,{fields:C}),a==="png"&&e.jsx(Ce,{fields:W}),a==="png"&&g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(v,{as:"i",fontSize:"sm",children:i("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(v,{as:"i",fontSize:"sm",children:i("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(k,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(E,{as:O})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(Et,{isChecked:M,onChange:A=>S(A.target.checked),children:e.jsxs(v,{children:[i("header.download.shareInfo1"),e.jsxs(k,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[i("header.about.rmp")," ",e.jsx(E,{as:O})]}),i("header.download.shareInfo2")]})}),e.jsx(Et,{isChecked:oe,onChange:A=>Xe(A.target.checked),children:e.jsxs(v,{children:[i("header.download.termsAndConditionsInfo"),e.jsxs(k,{color:"teal.500",onClick:()=>te(!0),children:[i("header.download.termsAndConditions")," ",e.jsx(E,{as:O})]}),i("header.download.period")]})})]}),e.jsx(je,{children:e.jsx(ps,{children:e.jsx(H,{colorScheme:"teal",variant:"outline",size:"sm",disabled:!oe,onClick:ls,children:i("header.download.confirm")})})}),e.jsx(ir,{isOpen:R,onClose:()=>te(!1)})]})]}),e.jsx(nr,{isOpen:et,onClose:()=>Ie(!1)})]})}const lr=(t,r)=>{const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("transform",`translate(${t}, ${r})scale(2)`);const n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("width","40"),n.setAttribute("height","40"),n.setAttribute("x","-50"),n.setAttribute("y","-20");const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("font-family","Arial, sans-serif"),i.setAttribute("font-size","16"),i.appendChild(document.createTextNode("Rail Map Painter"));const o=document.createElementNS("http://www.w3.org/2000/svg","text");return o.setAttribute("font-family","Arial, sans-serif"),o.setAttribute("font-size","10"),o.setAttribute("y","10"),o.appendChild(document.createTextNode("https://railmapgen.github.io/rmp/")),s.appendChild(n),s.appendChild(i),s.appendChild(o),s},cr="/rmp/assets/github-mark-7a0dd11e.svg",dr="/rmp/assets/slack-mark-19839006.svg",hr=t=>{const{isOpen:r,onClose:s}=t,{t:n}=V(),i=F.getAppVersion(),[o,a]=j.useState(!1);return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:n("header.about.title")}),e.jsx(Q,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(_t,{direction:"row",children:[e.jsx(Tt,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(_t,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(v,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),e.jsx(v,{children:i}),e.jsx(v,{}),e.jsx(v,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(G,{margin:5,children:e.jsx(v,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(we,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(we,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),e.jsxs(Te,{children:[e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(pe,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(v,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(v,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(pe,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(v,{fontSize:"sm",children:n("header.about.langonginc")}),e.jsx(v,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(we,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),e.jsxs(Te,{children:[e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(pe,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(v,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]}),e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/52PD","_blank"),cursor:"pointer",children:[e.jsx(pe,{src:"https://github.com/52PD.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:"52PD"}),e.jsx(v,{fontSize:"sm",mb:1,children:n("header.about.52PD")})]})]})]}),e.jsx(we,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(Te,{children:[e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(pe,{src:cr,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(v,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(pe,{src:dr,size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(v,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(v,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(we,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.linkExchange")}),e.jsxs(Te,{children:[e.jsxs(ue,{size:"lg",w:"85%",onClick:()=>a(!0),cursor:"pointer",children:[e.jsx(pe,{src:"/rmp//images/guidaoTransit.jpg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(fe,{display:"block",width:"100%",children:[e.jsx(v,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.guidaoTransit")}),e.jsx(v,{fontSize:"sm",children:n("header.about.guidaoTransitContent")})]})]}),e.jsxs(K,{size:"6xl",isOpen:o,onClose:()=>a(!1),children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:n("header.about.guidaoTransit")}),e.jsx(Q,{}),e.jsx(X,{paddingBottom:10,children:e.jsx(Tt,{width:"1080",height:"304",src:"/rmp//images/guidaoTransitQRCode.png"})})]})]})]})]})]})]})},ur=hr,pr=()=>{const[t,r]=j.useState(!1),{svgViewBoxZoom:s}=re(o=>o.param),n=ee(),i=[{type:"slider",label:"",value:400-s,min:10,max:390,step:1,onChange:o=>n(qt(400-o)),leftIcon:e.jsx(Gs,{}),rightIcon:e.jsx(It,{}),minW:160}];return e.jsxs(fs,{isOpen:t,onOpen:()=>r(!0),onClose:()=>r(!1),children:[e.jsx(ms,{children:e.jsx(ae,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(It,{}),onClick:()=>r(!t)})}),e.jsx(gs,{children:e.jsx(xs,{children:e.jsx(Ce,{fields:i,noLabel:!0})})})]})},fr=t=>{const{isOpen:r,onClose:s}=t,n=ee(),{t:i}=V(),o=j.useRef(window.graph),[a,l]=j.useState(0),[d,p]=j.useState(0),h=[{type:"input",label:i("header.settings.procedures.translate.x"),value:a.toString(),variant:"number",onChange:c=>l(Number(c)),minW:"full"},{type:"input",label:i("header.settings.procedures.translate.y"),value:d.toString(),variant:"number",onChange:c=>p(Number(c)),minW:"full"}],m=()=>{o.current.forEachNode((c,u)=>{o.current.updateNodeAttribute(c,"x",f=>(f!=null?f:0)+a),o.current.updateNodeAttribute(c,"y",f=>(f!=null?f:0)+d)}),n(ge()),n(xe()),n(he(o.current.export())),s()};return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:i("header.settings.procedures.translate.title")}),e.jsx(Q,{}),e.jsxs(X,{children:[i("header.settings.procedures.translate.content"),e.jsx(Ce,{fields:h})]}),e.jsxs(je,{children:[e.jsx(H,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:i("cancel")}),e.jsx(H,{colorScheme:"red",onClick:m,children:i("apply")})]})]})]})},mr=t=>{const{isOpen:r,onClose:s}=t,n=ee(),{t:i}=V(),o=j.useRef(window.graph),[a,l]=j.useState(1),d=[{type:"input",label:i("header.settings.procedures.scale.factor"),value:a.toString(),variant:"number",onChange:h=>l(Number(h)),minW:"full"}],p=()=>{o.current.forEachNode((h,m)=>{o.current.updateNodeAttribute(h,"x",c=>(c!=null?c:0)*a),o.current.updateNodeAttribute(h,"y",c=>(c!=null?c:0)*a)}),n(ge()),n(xe()),n(he(o.current.export())),s()};return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:i("header.settings.procedures.scale.title")}),e.jsx(Q,{}),e.jsxs(X,{children:[i("header.settings.procedures.scale.content"),e.jsx(Ce,{fields:d})]}),e.jsxs(je,{children:[e.jsx(H,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:i("cancel")}),e.jsx(H,{colorScheme:"red",onClick:p,children:i("apply")})]})]})]})},gr=t=>{const{isOpen:r,onClose:s}=t,n=ee(),{t:i}=V(),o=j.useRef(window.graph),a=Object.fromEntries(Object.entries(Ke).map(([u,f])=>[u,i(f.metadata.displayName).toString()])),[l,d]=j.useState(Object.keys(Ke).at(0)),[p,h]=j.useState(Object.keys(Ke).at(1)),m=[{type:"select",label:i("header.settings.procedures.changeType.changeFrom"),value:l,options:a,disabledOptions:[p],onChange:u=>d(u),minW:"full"},{type:"select",label:i("header.settings.procedures.changeType.changeTo"),value:p,options:a,disabledOptions:[l],onChange:u=>h(u),minW:"full"}],c=()=>{ln(o.current,l,p),n(ge()),n(he(o.current.export())),s()};return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsxs(q,{children:[e.jsx(v,{as:"b",fontSize:"xl",children:i("header.settings.procedures.changeType.title")}),e.jsx(Jt,{label:i("header.settings.pro"),children:e.jsx(qe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(Q,{}),e.jsxs(X,{children:[e.jsx(Ce,{fields:m}),e.jsx(v,{fontSize:"sm",mt:"3",lineHeight:"100%",color:"red.500",children:i("header.settings.procedures.changeType.info")})]}),e.jsxs(je,{children:[e.jsx(H,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:i("cancel")}),e.jsx(H,{colorScheme:"red",onClick:c,children:i("apply")})]})]})]})},xr=t=>{const{isOpen:r,onClose:s}=t,n=ee(),{theme:i}=re(c=>c.runtime),{t:o}=V(),a=j.useRef(window.graph),[l,d]=j.useState(i),[p,h]=j.useState(!1),m=()=>{a.current.filterEdges((c,u,f,g,w,b,x)=>u.style===de.SingleColor&&JSON.stringify(u[de.SingleColor].color)===JSON.stringify(l)).forEach(c=>a.current.dropEdge(c)),n(xe()),n(he(a.current.export())),s()};return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:o("header.settings.procedures.removeLines.title")}),e.jsx(Q,{}),e.jsxs(X,{children:[o("header.settings.procedures.removeLines.content"),e.jsx(Ds,{theme:l,onClick:()=>h(!0)}),e.jsx(Ws,{isOpen:p,defaultTheme:l,onClose:()=>h(!1),onUpdate:c=>d(c)})]}),e.jsxs(je,{children:[e.jsx(H,{colorScheme:"blue",variant:"outline",mr:"1",onClick:s,children:o("cancel")}),e.jsx(H,{colorScheme:"red",onClick:m,children:o("remove")})]})]})]})},Ve={width:"100%",justifyContent:"space-between"},ve={fontFamily:"-apple-system"},jr=t=>{const{isOpen:r,onClose:s}=t,{keepLastPath:n}=re(x=>x.runtime),i=ee(),{t:o}=V(),a=Vt("primary.500","primary.300"),[l,d]=j.useState(!1),[p,h]=j.useState(!1),[m,c]=j.useState(!1),[u,f]=j.useState(!1),g=F.isAllowAnalytics(),{telemetry:{app:w}}=re(x=>x.app),b=x=>i(Ks(x));return e.jsxs(K,{isOpen:r,onClose:s,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(q,{children:o("header.settings.title")}),e.jsx(Q,{}),e.jsx(X,{children:e.jsxs(Te,{divider:e.jsx(js,{borderColor:"gray.200"}),children:[e.jsxs(G,{width:"100%",mb:"3",children:[e.jsx(v,{as:"b",fontSize:"xl",children:o("header.settings.preference.title")}),e.jsx(G,{mt:"3",children:e.jsxs(G,{display:"flex",mb:"1",children:[e.jsx(v,{flex:"1",children:o("header.settings.preference.keepLastPath")}),e.jsx(at,{isChecked:n,onChange:({target:{checked:x}})=>i($s(x))})]})})]}),e.jsxs(G,{width:"100%",mb:"3",children:[e.jsx(v,{as:"b",fontSize:"xl",children:o("header.settings.procedures.title")}),e.jsxs(G,{mt:"3",children:[e.jsx(H,{sx:Ve,rightIcon:e.jsx($e,{}),onClick:()=>d(!0),children:o("header.settings.procedures.translate.title")}),e.jsx(fr,{isOpen:l,onClose:()=>d(!1)}),e.jsx(H,{sx:Ve,rightIcon:e.jsx($e,{}),onClick:()=>h(!0),children:o("header.settings.procedures.scale.title")}),e.jsx(mr,{isOpen:p,onClose:()=>h(!1)}),e.jsx(H,{sx:Ve,rightIcon:e.jsx($e,{}),onClick:()=>c(!0),children:e.jsxs(G,{children:[o("header.settings.procedures.changeType.title"),e.jsx(Jt,{label:o("header.settings.pro"),children:e.jsx(qe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]})}),e.jsx(gr,{isOpen:m,onClose:()=>c(!1)}),e.jsx(H,{sx:Ve,rightIcon:e.jsx($e,{}),onClick:()=>f(!0),children:o("header.settings.procedures.removeLines.title")}),e.jsx(xr,{isOpen:u,onClose:()=>f(!1)})]})]}),e.jsxs(G,{width:"100%",mb:"3",children:[e.jsx(v,{as:"b",fontSize:"xl",children:o("header.settings.shortcuts.title")}),e.jsx(G,{mt:"3",children:e.jsxs(bs,{children:[e.jsx(ys,{children:e.jsxs(se,{children:[e.jsx(Mt,{children:o("header.settings.shortcuts.keys")}),e.jsx(Mt,{children:o("header.settings.shortcuts.description")})]})}),e.jsxs(vs,{children:[e.jsxs(se,{children:[e.jsx(B,{children:e.jsx(_,{children:"f"})}),e.jsx(B,{children:o("header.settings.shortcuts.f")})]}),e.jsxs(se,{children:[e.jsx(B,{children:e.jsxs(G,{display:"flex",flexDirection:"row",children:[e.jsx(Fs,{}),e.jsx(Us,{}),e.jsx(Vs,{}),e.jsx(Js,{})]})}),e.jsx(B,{children:o("header.settings.shortcuts.arrows")})]}),e.jsxs(se,{children:[e.jsx(B,{children:e.jsxs(G,{display:"flex",flexDirection:"row",children:[e.jsx(_,{children:"i"}),e.jsx(_,{children:"j"}),e.jsx(_,{children:"k"}),e.jsx(_,{children:"l"})]})}),e.jsx(B,{children:o("header.settings.shortcuts.ijkl")})]}),e.jsxs(se,{children:[e.jsx(B,{children:Ee?e.jsx(_,{sx:ve,children:"⇧"}):e.jsx(_,{children:"shift"})}),e.jsx(B,{children:o("header.settings.shortcuts.shift")})]}),e.jsxs(se,{children:[e.jsx(B,{children:Ee?e.jsx(_,{sx:ve,children:"⌥"}):e.jsx(_,{children:"alt"})}),e.jsx(B,{children:o("header.settings.shortcuts.alt")})]}),e.jsxs(se,{children:[e.jsx(B,{children:Ee?e.jsx(_,{sx:ve,children:"⌫"}):e.jsx(_,{children:"delete"})}),e.jsx(B,{children:o("header.settings.shortcuts.delete")})]}),e.jsxs(se,{children:[e.jsxs(B,{children:[Ee?e.jsx(_,{sx:ve,children:"⌘"}):e.jsx(_,{children:"ctrl"})," + ",e.jsx(_,{children:"z"})]}),e.jsx(B,{children:o("header.settings.shortcuts.undo")})]}),e.jsxs(se,{children:[e.jsx(B,{children:Ee?e.jsxs(e.Fragment,{children:[e.jsx(_,{sx:ve,children:"⇧"})," + ",e.jsx(_,{sx:ve,children:"⌘"})," + ",e.jsx(_,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{children:"ctrl"})," + ",e.jsx(_,{children:"y"})]})}),e.jsx(B,{children:o("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(G,{width:"100%",mb:"3",children:[e.jsx(v,{as:"b",fontSize:"xl",children:o("header.settings.telemetry.title")}),e.jsxs(G,{mt:"3",children:[e.jsxs(G,{display:"flex",mb:"1",children:[e.jsx(v,{flex:"1",children:o("header.settings.telemetry.essential")}),e.jsx(at,{isChecked:g,isDisabled:!0})]}),e.jsx(v,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.essentialInfo")}),e.jsxs(k,{color:a,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[o("header.settings.telemetry.essentialLink")," ",e.jsx(E,{as:O})]}),e.jsxs(G,{display:"flex",mb:"1",children:[e.jsx(v,{flex:"1",children:o("header.settings.telemetry.additional")}),e.jsx(at,{isChecked:w,onChange:({target:{checked:x}})=>b(x)})]}),e.jsx(v,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.additionalInfo")})]})]})]})})]})]})},br=jr;function yr(){const{t}=V(),r=ee(),{telemetry:{app:s}}=re(c=>c.app),{past:n,future:i}=re(c=>c.param),[o,a]=j.useState(!1),[l,d]=j.useState(!1),p=Dt(F.getEnv),h=Dt(F.getAppVersion);j.useEffect(()=>{s&&p!==dt.DEV&&F.event(xt.APP_LOAD,{isStandaloneWindow:F.isStandaloneWindow()})},[p]);const m=async c=>{F.getI18nInstance().changeLanguage(c)};return e.jsxs(Ys,{children:[e.jsx(we,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:t("header.about.rmp")}),e.jsx(Zs,{environment:p,version:h,popoverHeader:p===dt.PRD?void 0:e.jsxs(Gt,{i18nKey:"header.popoverHeader",environment:p,children:["You're on ",{environment:p}," environment!"]}),popoverBody:p===dt.PRD?void 0:e.jsx(Gt,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(ws,{ml:"auto",children:[e.jsx(ie,{children:e.jsx(ae,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(qs,{}),disabled:n.length===0,onClick:()=>r(Qs())})}),e.jsx(ie,{children:e.jsx(ae,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(Xs,{}),disabled:i.length===0,onClick:()=>r(en())})}),e.jsx(ie,{children:e.jsx(pr,{})}),e.jsx(ie,{children:e.jsx(_n,{})}),e.jsx(ie,{children:e.jsx(ar,{})}),F.isStandaloneWindow()&&e.jsx(ie,{children:e.jsxs(zt,{children:[e.jsx(kt,{as:ae,icon:e.jsx(tn,{}),variant:"ghost",size:"sm"}),e.jsx(Ot,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(c=>e.jsx(le,{onClick:()=>m(c),children:yn[c][c]},c))})]})}),e.jsx(ie,{children:e.jsx(ae,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(sn,{}),onClick:()=>a(!0)})}),e.jsx(ie,{children:e.jsx(ae,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(nn,{}),onClick:()=>d(!0)})})]}),e.jsx(br,{isOpen:o,onClose:()=>a(!1)}),e.jsx(ur,{isOpen:l,onClose:()=>d(!1)})]})}function vr(){const t=ee(),r=re(n=>n.runtime.globalAlerts),s=n=>{F.isStandaloneWindow()?window.open(`/${n}`,"_blank"):F.openApp(n)};return e.jsx(e.Fragment,{children:Object.entries(r).map(([n,{message:i,url:o,linkedApp:a}])=>e.jsxs(Ss,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(Cs,{}),a?e.jsx(k,{onClick:()=>s(a),children:i}):o?e.jsx(k,{href:o,target:"_blank",children:i}):i,e.jsx(Ut,{ml:"auto",onClick:()=>t(rn(n))})]},n))})}function Ar(){return e.jsxs(e.Fragment,{children:[e.jsx(yr,{}),e.jsx(vr,{})]})}export{Ar as default};
