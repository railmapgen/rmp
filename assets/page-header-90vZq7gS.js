import{j as e,ag as se,M as q,ah as te,J as Q,K as ne,L as ee,h as bs,ai as Ot,N as m,B as I,aj as Te,ak as Re,T as ce,al as de,b as he,q as cs,t as D,O as je,am as Mt,an as At,ao as Ae,R as L,ap as G,Q as rt,aq as Ts,ar as zs,a2 as ie,as as Rs,at as ge,x as re,au as ds,av as J,U as ns,V as rs,X as hs,Y as Gs,G as Tt,H as zt,n as it,a8 as ot,e as at,w as lt,m as ct,E as dt,aw as ze,ax as Rt,a7 as pe,a1 as Et,ay as Nt,az as It,aA as Y,aB as $s,aC as Lt,aD as N,aE as A,aF as Dt}from"./chakra-C1zJvDsN.js";import{u as Pt,r as E,C as Bt,M as Es,d as ht,n as ws,S as $,R as Us,a as pt,b as B,c as H,e as U,f as Wt,g as Gt,h as $t,i as Ut,j as Ge,k as Ne,E as ke,s as Vt,l as is,m as Ft,o as Vs,L as ps,p as Ht,q as Fs,t as Yt,v as Ns,w as Is,x as oe,y as fe,z as ae,A as xe,B as ut,D as Kt,F as gt,G as Ss,H as Ie,I as Fe,J as Hs,K as Ys,N as Zt,O as Jt,P as Xt,Q as Ks,T as Zs,U as qt,V as Js,W as Qt,X as en,Y as sn,Z as tn,_ as nn,$ as rn,a0 as on,a1 as an,a2 as ln,a3 as cn,a4 as dn,a5 as hn,a6 as pn,a7 as un,a8 as gn,a9 as es,aa as xn,ab as mn,ac as fn,ad as jn,ae as bn,af as Ce,ag as wn,ah as Sn,ai as yn,aj as Cn,ak as be,al as vn,am as _n,an as Xs,ao as kn,ap as On,aq as us,ar as Mn,as as An,at as Tn,au as zn,av as Rn,aw as En,ax as Nn,ay as In,az as Ln,aA as Dn,aB as Pn}from"./index-Ey44zCPp.js";import{u as V,b as f,T as ys,r as ss}from"./react-BpF4RbzH.js";import{d as Cs,r as Bn,i as qs,m as Wn,a as Gn,s as $n,b as xt,p as vs,M as Un}from"./master-manager-DlozjZmW.js";import{C as Vn}from"./change-type-modal-kYluqLhc.js";import"./change-types-zoUjyNZ6.js";var Qs=function(s){return Pt(E.ready(),s)};const Fn=s=>{const{isOpen:a,onClose:o}=s,{t}=V(),r=E.getAppVersion();return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:t("header.about.title")}),e.jsx(ne,{}),e.jsxs(ee,{paddingBottom:10,children:[e.jsxs(bs,{direction:"row",children:[e.jsx(Ot,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(bs,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(m,{fontSize:"xl",as:"b",children:t("header.about.rmp")}),e.jsx(m,{children:r}),e.jsx(m,{}),e.jsx(m,{fontSize:"sm",children:t("header.about.railmapgen")})]})]}),e.jsx(I,{margin:5,children:e.jsx(m,{fontSize:"xl",children:t("header.about.desc")})}),e.jsx(Te,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contributors")}),e.jsx(Te,{as:"h6",size:"xs",my:2,children:t("header.about.coreContributors")}),e.jsxs(Re,{children:[e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(m,{fontSize:"sm",children:t("header.about.content1")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:t("header.about.content2")})]})]}),e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(m,{fontSize:"sm",children:t("header.about.langonginc")}),e.jsx(m,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(Te,{as:"h6",size:"xs",my:2,children:t("header.about.styleContributors")}),e.jsxs(Re,{children:[e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.203IhzElttil")})]})]}),e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Swiftiecott")})]})]}),e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(m,{fontSize:"sm",mb:1,children:t("header.about.Minwtraft")})]})]})]}),e.jsx(Te,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.about.contactUs")}),e.jsxs(Re,{children:[e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.github")}),e.jsx(m,{fontSize:"sm",children:t("header.about.githubContent")})]})]}),e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.about.slack")}),e.jsx(m,{fontSize:"sm",children:t("header.about.slackContent")}),e.jsx(m,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(Te,{as:"h5",size:"sm",mt:3,mb:2,children:t("header.donation.title")}),e.jsxs(Re,{children:[e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.afdian")}),e.jsx(m,{fontSize:"sm",children:t("header.donation.viaCNY")})]})]}),e.jsxs(ce,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(de,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(he,{display:"block",width:"100%",pb:1,children:[e.jsx(m,{fontSize:"lg",fontWeight:"bold",mb:1,children:t("header.donation.openCollective")}),e.jsx(m,{fontSize:"sm",children:t("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function He(s){const a=s.sizes.shift(),o=Math.max(Math.ceil(a[0]),1),t=Math.max(Math.ceil(a[1]),1),r=[o-1,t-1,1,1],i=performance.now(),n=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let p,c;n?(p=new OffscreenCanvas(1,1),c=new OffscreenCanvas(o,t)):(p=document.createElement("canvas"),p.width=1,p.height=1,c=document.createElement("canvas"),c.width=o,c.height=t);const x=p.getContext("2d"),j=c.getContext("2d");j&&(j.fillRect.apply(j,r),x.drawImage(c,o-1,t-1,1,1,0,0,1,1));const g=x&&x.getImageData(0,0,1,1).data[3]!==0,d=parseInt(performance.now()-i);return[p,c].forEach((u=>{u.height=0,u.width=0})),n?(postMessage({width:o,height:t,testTime:d,isTestPass:g}),!g&&s.sizes.length&&setTimeout((()=>{He(s)}),0)):g?s.onSuccess({width:o,height:t,testTime:d}):(s.onError({width:o,height:t,testTime:d}),s.sizes.length&&setTimeout((()=>{He(s)}),0)),g}const gs={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Ee={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},$e={};function xs(s){const a=s.width===s.height,o=s.height===1,t=s.width===1,r=[];if(!s.width||!s.height)s.sizes.forEach((i=>{const n=a||o?i:1,p=a||t?i:1;r.push([n,p])}));else{const i=s.min||Ee.min,n=s.step||Ee.step;let p=Math.max(s.width,s.height);for(;p>=i;){const c=a||o?p:1,x=a||t?p:1;r.push([c,x]),p-=n}}return r}function ts(s){const a=typeof window<"u",o=a&&"Promise"in window,t=a&&"HTMLCanvasElement"in window,r=a&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),n=performance.now(),{onError:p,onSuccess:c,...x}=s,j=()=>parseInt(performance.now()-n);let g=null;if(!t)return!1;if(s.useWorker&&r){const d="\n            var canvasTest = ".concat(He.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),u=new Blob([d],{type:"application/javascript"}),h=URL.createObjectURL(u);g=new Worker(h),URL.revokeObjectURL(h),g.onmessage=function(l){const{width:w,height:b,testTime:S,isTestPass:_}=l.data,y={width:w,height:b,testTime:S,totalTime:j()};_?($e[i].onSuccess(y),delete $e[i]):$e[i].onError(y)}}if(o)return new Promise((d=>{const u={...s,onError(h){let{width:l,height:w,testTime:b}=h;const S={width:l,height:w,testTime:b,totalTime:j()};let _;if(s.sizes.length===0)_=!0;else{const[[y,v]]=s.sizes.slice(-1);_=l===y&&w===v}p(S),_&&d({...S,success:!1})},onSuccess(h){let{width:l,height:w,testTime:b}=h;const S={width:l,height:w,testTime:b,totalTime:j()};c(S),d({...S,success:!0})}};if(g){const{onError:h,onSuccess:l}=u;$e[i]={onError:h,onSuccess:l},g.postMessage(x)}else He(u)}));if(g)$e[i]={onError:p,onSuccess:c},g.postMessage(x);else return He(s)}const Hn={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=xs({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...gs.area]}),o={...Ee,...s,sizes:a};return ts(o)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=xs({width:1,height:s.max,min:s.min,step:s.step,sizes:[...gs.height]}),o={...Ee,...s,sizes:a};return ts(o)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=xs({width:s.max,height:1,min:s.min,step:s.step,sizes:[...gs.width]}),o={...Ee,...s,sizes:a};return ts(o)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={...Ee,...s};return a.sizes=[...a.sizes],a.width&&a.height&&(a.sizes=[[a.width,a.height]]),ts(a)}};var Ye=(s=>(s.left="l",s.right="r",s))(Ye||{}),_e=(s=>(s.through="through",s.nonThrough="nonthrough",s))(_e||{}),os=(s=>(s.local="local",s.express="express",s.direct="direct",s))(os||{}),we=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(we||{}),Ls=(s=>(s.sh="sh",s.sh2020="sh2020",s))(Ls||{});const me=new Set,_s=new Set,ks=new Set,Os=new Set,mt=new Map,Se=new Map,ms=new Set,fs=new Map,X=new Map;let W=[],Ue=0;const Ve=new Map,js=new Map,Ms=new Set,Yn={localisedName:{en:"LEFT END"},num:"00",services:[os.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Kn={localisedName:{en:"RIGHT END"},num:"00",services:[os.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Zn={},ft={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:we.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Ye.right,platform_num:"1",theme:[Bt.Shanghai,"sh1","#E3002B",Es.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:Zn,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:Ls.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Jn={localisedName:{},num:"",services:[os.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Ye.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},R=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),Ds=s=>ht.has(s),Xn=s=>{if(Ds(s.style))return structuredClone(s[s.style].color)},qn=(s,a)=>{const[o,t]=s.extremities(a),r=s.getEdgeAttributes(a),i=r.style;if(o!=t&&Ds(i)){const n=Xn(r);Os.has(R(n))||(ks.add(n),Os.add(R(n)),mt.set(n,o),Se.set(R(n),new Set)),Se.get(R(n)).add(o),Se.get(R(n)).add(t),X.has(o)?W.push({target:t,next:X.get(o),color:n}):W.push({target:t,next:-1,color:n}),X.set(o,Ue),Ue++,X.has(t)?W.push({target:o,next:X.get(t),color:n}):W.push({target:o,next:-1,color:n}),X.set(t,Ue),Ue++}},jt=(s,a,o)=>{if(Se.get(R(o)).has(s)){Se.get(R(o)).delete(s);for(let t=X.get(s);t!=-1;t=W[t].next){const r=W[t].target,i=W[t].color;R(i)==R(o)&&jt(r,s,o)}}},bt=(s,a,o)=>{if(me.has(s))return;me.add(s);let t=0;const r=new Set;for(let i=X.get(s);i!=-1;i=W[i].next){const n=W[i].target,p=W[i].color;R(p)==R(o)&&(r.has(n)||(r.add(n),t++,n!=a&&bt(n,s,o)))}Ve.set(s,t)},et=(s,a)=>{const o=s.stn_list.lineend.parents;o.push(a),s.stn_list.lineend.parents=structuredClone(o).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[_e.through,o[1]]:void 0}},Qn=(s,a)=>{let o=0;for(let t=X.get(s);t!=-1;t=W[t].next){W[t].target;const r=W[t].color;R(r)==R(a)&&o++}return o},wt=(s,a,o)=>{if(Ms.has(s))return[];Ms.add(s);const t=[];for(let r=X.get(s);r!=-1;r=W[r].next){const i=W[r].target,n=W[r].color;i!=a&&R(n)==R(o)&&(i.startsWith("stn")?t.push(i):t.push(...wt(i,s,o)))}return t},As=(s,a,o,t,r,i,n)=>{var d;if(me.has(s)&&(!s.startsWith("misc_node_")&&n.stn_list[s]==null||s.startsWith("misc_node_")&&!_s.has(s)||n.loop))return[];if(me.has(s)&&n.stn_list[s]!=null&&Qn(s,i)-1>=2){const u=[...n.stn_list[s].parents,a];if(n.stn_list[u[1]]==null){const w=u[0];u[0]=u[1],u[1]=w}n.stn_list[s].parents=structuredClone(u).reverse(),n.stn_list[s].branch={...n.stn_list[s].branch,left:[_e.through,u[1]]};const h=[];for(const w of n.stn_list[s].children)w!=a&&h.push(w);n.stn_list[s].children=structuredClone(h),(d=n.stn_list[s].branch)==null||delete d.right;const l=[];for(const w of n.stn_list.lineend.parents)w!=s&&l.push(w);return n.stn_list.lineend.parents=structuredClone(l).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[_e.through,l[1]]:void 0},h.length==0&&(n.stn_list[s].children=["lineend"],et(n,s)),[s]}me.add(s);const p=[],c=[],x=[],j=new Set,g=new Set;for(let u=X.get(s);u!=-1;u=W[u].next){const h=W[u].target,l=W[u].color;if(h!=o){if(R(l)==R(i)){if(g.has(h))continue;if(g.add(h),s.startsWith("misc_node_")){const w=As(h,a,s,t+1,r,i,n);w.length!=0&&p.push(...w)}else{const w=As(h,s,s,t+1,r,i,n);w.length!=0&&p.push(...w)}}if(!j.has(R(l))&&R(l)!=R(i)){j.add(R(l));const w={theme:l,name:["ch_".concat(R(l)),"en_".concat(R(l))]};x.push(w)}}}if(p.length==2){for(let u=0;u<2;u++)p[u]=="lineend"&&p.splice(u,1);if(n.stn_list[p[1]].parents.length>=2){const u=p[0];p[0]=p[1],p[1]=u}}if(me.has(s)&&n.stn_list[s]!=null){const u=[];for(const h of n.stn_list.lineend.parents)h!=s&&u.push(h);n.stn_list.lineend.parents=structuredClone(u).reverse(),n.stn_list.lineend.branch={...n.stn_list.lineend.branch,left:n.stn_list.lineend.parents.length==2?[_e.through,u[1]]:void 0},p.length==0&&(Ms.clear(),c.push(...wt(s,a,i)))}if(s.startsWith("misc_node_"))return _s.add(s),p;{const u=r.getNodeAttributes(s).type,h=r.getNodeAttributes(s)[u];if(n.stn_list[s]=structuredClone(Jn),n.stn_list[s].localisedName={zh:h.names[0],en:h.names[1]},n.stn_list[s].num=String(t),r.getNodeAttributes(s).type==$.GzmtrBasic){const l=h;n.stn_list[s].num=l.stationCode,(l.secondaryNames[0]!==""||l.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:l.secondaryNames[0],en:l.secondaryNames[1]})}if(r.getNodeAttributes(s).type==$.GzmtrInt){const l=h,w=l.transfer[0];for(const b of w)if(R(b)==R(i)){n.stn_list[s].num=String(b[5]);break}(l.secondaryNames[0]!==""||l.secondaryNames[1]!=="")&&(n.stn_list[s].localisedSecondaryName={zh:l.secondaryNames[0],en:l.secondaryNames[1]})}return p.length!=0?(n.stn_list[s].children=structuredClone(p).reverse(),p.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,right:[_e.through,p[1]]})):(n.stn_list[s].children=["lineend"],et(n,s)),c.push(a),n.stn_list[s].parents=structuredClone(c).reverse(),c.length==2&&(n.stn_list[s].branch={...n.stn_list[s].branch,left:[_e.through,c[1]]}),x.length!=0&&(n.stn_list[s].transfer.groups[0].lines=structuredClone(x)),[s]}},er=(s,a,o,t)=>{const r=structuredClone(ft);t=="LOOP"&&(r.loop=!0);let i;switch(s.getNodeAttributes(o).type){case $.GzmtrBasic:case $.GzmtrInt:i=we.GZMTR;break;case $.MTR:i=we.MTR;break;default:i=we.SHMetro;break}r.theme=structuredClone(a),r.style=i,r.stn_list.linestart=structuredClone(Yn),r.stn_list.lineend=structuredClone(Kn),me.clear(),_s.clear();const n=As(o,"linestart","linestart",1,s,a,r);if(r.current_stn_idx=n[0],r.stn_list.linestart.children=[n[0]],!(Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3))return structuredClone(r)},sr=s=>{var t,r;me.clear(),ks.clear(),Os.clear(),mt.clear(),Se.clear(),ms.clear(),fs.clear(),X.clear(),W=[],Ue=0,Ve.clear(),js.clear(),s.filterEdges(i=>i.startsWith("line")).forEach(i=>{Ds(s.getEdgeAttributes(i).style)&&qn(s,i)});let a=0;s.forEachNode(i=>{js.set(i,++a)}),js.set("lineend",++a);const o=[];for(const i of ks){let n=0;for(;Se.get(R(i)).size!=0;){let p="line_root";Se.get(R(i)).forEach(x=>{p=="line_root"&&(p=x)}),jt(p,"line_root",i);const c={theme:i,index:++n};ms.add(c),fs.set(c,p)}}for(const i of ms){const{theme:n}=i;me.clear(),Ve.clear(),bt(fs.get(i),"line_root",n);let p=!0,c="LINE";const x=[];for(const[g,d]of Ve)d==1&&x.push(g),d==3&&(c="BRANCH"),d>3&&(p=!1);if(!p)continue;x.length==0&&(c="LOOP",Ve.forEach((g,d)=>{x.push(d)}));const j=[];for(const g of x){const d=er(s,n,g,c);d!=null&&j.push([d,(t=d.stn_list[d.current_stn_idx].localisedName.zh)!=null?t:"",(r=d.stn_list[d.current_stn_idx].localisedName.en)!=null?r:""])}j.length!=0&&o.push({id:ws(10),theme:n,param:structuredClone(j),type:c})}return o},tr=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),nr=(s,a)=>{let o=s;return a.forEach((t,r)=>{const i=new RegExp("ch_".concat(r),"g"),n=new RegExp("en_".concat(r),"g");o=o.replace(i,t[0]),o=o.replace(n,t[1])}),o},rr=(s,a,o,t)=>{s.line_name=a,s.line_num=String(o),Cs("RMG_".concat(tr(a),".json"),"application/json",nr(JSON.stringify(s),t))},ir={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},or=s=>{const{isOpen:a,onClose:o}=s,{t}=V(),r=f.useRef(window.graph),[i,n]=f.useState(!1),[p,c]=f.useState([[ft,"",""]]),[x,j]=f.useState(["","",""]),[g,d]=f.useState(new Map),[u,h]=f.useState(new Map),[l,w]=f.useState([]);f.useEffect(()=>{if(a){const S=sr(r.current),_=new Map;S.forEach(({id:y,theme:v})=>{_.set(R(v),y)}),w(S),d(_)}},[a]);const b=(S,_)=>document.getElementById("2RMG_"+_+"_"+S).value.trim();return e.jsxs(se,{isOpen:a,onClose:o,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:e.jsx(m,{as:"b",fontSize:"xl",children:t("header.download.2rmg.title")})}),e.jsx(ne,{}),e.jsxs(ee,{children:[e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info1")}),e.jsx(m,{fontSize:"sm",mt:"3",lineHeight:"100%",children:t("header.download.2rmg.info2")}),e.jsx("br",{}),l.length===0?e.jsx(m,{fontSize:"md",children:t("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:l.map(({id:S,theme:_,param:y,type:v})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Us,{name:_[0]=="other"&&_[1]=="other"?_[2]:_[1],bg:_[2],fg:_[3]})}),e.jsx("td",{children:e.jsx(cs,{placeholder:t("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(cs,{placeholder:t("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(cs,{placeholder:t("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(Us,{name:t("header.download.2rmg.type.".concat(v.toLowerCase())),bg:ir[v],fg:Es.white})}),e.jsx("td",{children:e.jsx(D,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const M=b(S,"nameCh"),C=b(S,"nameEn"),T=b(S,"lineNum"),O=new Map;g.forEach((P,F)=>{O.set(F,[b(P,"nameCh"),b(P,"nameEn")])}),c(y),j([M,C,T]),h(O),n(!0)},size:"sm",children:e.jsx(pt,{})})})]},S))})})]}),e.jsx(je,{children:e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:t("close")})})]}),e.jsx(ar,{isOpen:i,onClose:()=>n(!1),param:p,nameList:x,interchangeName:u})]})},ar=s=>{const{isOpen:a,onClose:o,param:t,nameList:r,interchangeName:i}=s,{t:n}=V(),[p,c]=f.useState("");return f.useEffect(()=>{r[0]!=""&&r[1]!=""?c(r[0]+"/"+r[1]):r[0]!=""?c(r[0]):r[1]!=""?c(r[1]):c("")},[...r]),e.jsxs(se,{isOpen:a,onClose:o,size:"md",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:e.jsxs(m,{as:"b",fontSize:"xl",children:[n("header.download.2rmg.download")," ",p]})}),e.jsx(ne,{}),e.jsx(ee,{children:e.jsxs(Mt,{children:[e.jsx(m,{fontSize:"sm",mb:"2",lineHeight:"100%",children:n("header.download.2rmg.downloadInfo")}),t.map(([x,j,g])=>e.jsxs(D,{onClick:()=>{rr(x,[r[0],r[1]],r[2],i)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[j.replaceAll("\n","⏎"),"/",g.replaceAll("\n","⏎")]},"".concat(j).concat(g)))]})}),e.jsx(je,{children:e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:n("close")})})]})]})},lr=s=>{const{isOpen:a,onClose:o}=s,{t}=V();return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:t("header.download.termsAndConditions")}),e.jsx(ne,{}),e.jsx(ee,{children:e.jsxs(At,{children:[e.jsxs(Ae,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(L,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(G,{as:B})]}),", ",e.jsxs(L,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(G,{as:B})]})," or ",e.jsxs(L,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(G,{as:B})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(L,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(G,{as:B})]}),"，",e.jsxs(L,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(G,{as:B})]}),"或",e.jsxs(L,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(G,{as:B})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(Ae,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(L,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(G,{as:B})]})," and ",e.jsxs(L,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(G,{as:B})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(L,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(G,{as:B})]}),"及",e.jsxs(L,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(G,{as:B})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(Ae,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(L,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(G,{as:B})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(L,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(G,{as:B})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(Ae,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(Ae,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(L,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(G,{as:B})]})," ","– the open-source emoji and icon project. License:",e.jsxs(L,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(G,{as:B})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(L,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(G,{as:B})]}),"所设计。许可证：",e.jsxs(L,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(G,{as:B})]})]}),e.jsxs(Ae,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})},cr=()=>{const s="https://ghfast.top/https://github.com/railmapgen/railmapgen.github.io/releases/download",a=new Date,o="".concat(a.getFullYear()).concat(String(a.getMonth()+1).padStart(2,"0"),"01"),t="".concat(String(a.getFullYear()).slice(-2),".").concat(a.getMonth()+1,".1"),r=navigator.platform,i=r.includes("Linux")?"amd64.AppImage":r.includes("Mac")?"aarch64.dmg":"x64-setup.exe";return s+"/tauri-".concat(o,"/Rail.Map.Toolkit_").concat(t,"_").concat(i)};function dr(){const s=rt("white","var(--chakra-colors-gray-800)"),a=H(),{activeSubscriptions:{RMP_EXPORT:o}}=U(k=>k.account),{telemetry:{project:t}}=U(k=>k.app),{languages:r}=U(k=>k.fonts),i=U(k=>k.param),{existsNodeTypes:n}=U(k=>k.runtime),p=E.isAllowAnalytics(),{t:c}=V(),x=f.useRef(window.graph),[j,g]=f.useState("png"),d={png:c("header.download.png"),svg:c("header.download.svg")},[u,h]=f.useState(2),[l,w]=f.useState({width:1,height:1,benchmark:.001}),[b,S]=f.useState(200),_=[25,50,100,150,200,250,300,400,500,750,1e3,1500,2e3],y=Object.fromEntries(_.map(k=>[k,"".concat(k,"%")])),[v,M]=f.useState([]),[C,T]=f.useState(!1),O=[{type:"select",label:c("header.download.format"),value:j,options:d,onChange:k=>g(k==="png"?"png":"svg")}],P=[{type:"select",label:c("header.download.svgVersion"),value:u,options:{1.1:c("header.download.svg1.1"),2:c("header.download.svg2")},onChange:k=>{h(k),k===1.1&&Xe(!0)}}],F=[{type:"select",label:c("header.download.scale"),value:b,options:y,onChange:k=>S(k)},{type:"switch",label:c("header.download.transparent"),isChecked:C,onChange:T}],[K,Ke]=f.useState(!1),[Ze,Je]=f.useState(!1),[Le,Xe]=f.useState(!1),[qe,De]=f.useState(!1),[Pe,z]=f.useState(!1),[Ps,yt]=f.useState(!1),[Ct,Qe]=f.useState(!1),[vt,Bs]=f.useState(!1);f.useEffect(()=>{(async()=>{const ye=await Hn.maxArea({usePromise:!0,useWorker:!0});w(ye)})()},[]),f.useEffect(()=>{if(K){const{xMin:k,yMin:ye,xMax:Be,yMax:Z}=Wt(x.current),[Oe,le]=[Be-k,Z-ye],We=_.filter(Me=>Oe*Me/100>l.width&&le*Me/100>l.height);M(We),Bn(n)?(De(!1),z(!0)):z(!1)}},[K]);const _t=async()=>{p&&E.event(ke.DOWNLOAD_PARAM,t?{"#nodes":x.current.order,"#edges":x.current.size}:{});const k=[];for(const Be of x.current.filterNodes((Z,Oe)=>{var le;return Z.startsWith("misc_node")&&Oe.type==="image"&&((le=Oe.image)==null?void 0:le.href)!==void 0})){const Z=x.current.getNodeAttributes(Be).image;Z.href&&Z.href.startsWith("img-l")&&await qs.has(Z.href)&&k.push({id:Z.href,base64:await qs.get(Z.href)})}const ye={...i,images:k};Cs("RMP_".concat(new Date().valueOf(),".json"),"application/json",Vt(ye))},kt=async()=>{Qe(!0),p&&E.event(ke.DOWNLOAD_IMAGES,t?{numberOfNodes:x.current.order,numberOfEdges:x.current.size}:{});const{elem:k,width:ye,height:Be}=await Wn(x.current,qe,Le,r,n,u),Z=k.outerHTML.replace(/&nbsp;/g," ").replace(new RegExp("\\p{Cc}","gu"),"");if(j==="svg"){Cs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Z),Qe(!1);return}if(Ge){window.parent.__TAURI__.core.invoke("render_image",{svgString:Z,scale:b,isTransparent:C,isSystemFontsOnly:Le}).then(()=>Qe(!1));return}document.body.appendChild(k);const Oe="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Z)));document.body.removeChild(k),k.remove();const le=document.createElement("canvas"),[We,Me]=[ye*b/100,Be*b/100];le.width=We,le.height=Me;const as=le.getContext("2d");C||(as.fillStyle=s,as.fillRect(0,0,We,Me));const ls=new Image;ls.onload=()=>{setTimeout(()=>{as.drawImage(ls,0,0,We,Me),le.toBlob(Ws=>{if(Qe(!1),!Ws){a(is({status:"error",message:c("header.download.imageTooBig")}));return}Gn("RMP_".concat(new Date().valueOf(),".png"),Ws)},"image/png")},Ft()?2e3:0)},ls.src=Oe};return e.jsxs(Ts,{id:"download",children:[e.jsx(zs,{as:ie,size:"sm",variant:"ghost",icon:e.jsx(pt,{})}),e.jsxs(Rs,{children:[e.jsx(ge,{icon:e.jsx(Gt,{}),onClick:()=>_t(),children:c("header.download.config")}),e.jsxs(ge,{icon:e.jsx($t,{}),onClick:()=>Bs(!0),children:[c("header.download.2rmg.title"),e.jsx(re,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ge,{icon:e.jsx(Ut,{}),onClick:()=>Ke(!0),children:c("header.download.image")})]}),e.jsxs(se,{size:"2xl",isOpen:K,onClose:()=>Ke(!1),children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:c("header.download.image")}),e.jsx(ne,{}),e.jsxs(ee,{children:[e.jsx(Ne,{fields:O}),j==="svg"&&e.jsx(Ne,{fields:P}),j==="png"&&e.jsx(Ne,{fields:F}),e.jsx("br",{}),e.jsx(ds,{isChecked:Le,isDisabled:j==="svg"&&u===1.1,onChange:k=>Xe(k.target.checked),children:e.jsx(m,{children:c("header.download.isSystemFontsOnly")})}),e.jsxs(J,{children:[e.jsx(ds,{id:"share_info",isChecked:qe,isDisabled:Pe&&!o,onChange:k=>De(k.target.checked),children:e.jsxs(m,{children:[c("header.download.shareInfo1"),e.jsxs(L,{color:"teal.500",href:"https://railmapgen.org/rmp",children:[c("header.about.rmp")," ",e.jsx(G,{as:B})]}),c("header.download.shareInfo2")]})}),Pe&&e.jsx(re,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})]}),e.jsx(ds,{id:"agree_terms",isChecked:Ps,onChange:k=>yt(k.target.checked),children:e.jsxs(m,{children:[c("header.download.termsAndConditionsInfo"),e.jsxs(L,{color:"teal.500",onClick:()=>Je(!0),children:[c("header.download.termsAndConditions")," ",e.jsx(G,{as:B})]}),c("header.download.period")]})}),Pe&&e.jsxs(ns,{status:"error",mt:"4",children:[e.jsx(rs,{}),e.jsx(I,{children:e.jsx(hs,{children:c("header.download.rmpInfoSpecificNodeExists")})})]}),j==="png"&&v.includes(b)&&!Ge&&e.jsxs(ns,{status:"error",mt:"4",children:[e.jsx(rs,{}),e.jsxs(I,{children:[e.jsx(hs,{children:c("header.download.disabledScaleOptions")}),e.jsx(Gs,{children:e.jsx(ys,{i18nKey:"header.download.disabledScaleOptionsSolution",components:{link1:e.jsx(L,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:"https://afdian.com/item/9c8b220c614311efab2d52540025c377",target:"_blank"}),link2:e.jsx(L,{color:"teal.500",textDecoration:"underline",cursor:"pointer",href:cr()})}})})]})]}),j==="png"&&v.includes(b)&&Ge&&!o&&e.jsxs(ns,{status:"error",mt:"4",children:[e.jsx(rs,{}),e.jsxs(I,{children:[e.jsx(hs,{children:c("header.download.disabledScaleOptions")}),e.jsx(Gs,{children:c("header.settings.pro")})]})]})]}),e.jsx(je,{children:e.jsx(J,{children:e.jsx(D,{id:"download_button",colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Ps||j==="png"&&v.includes(b)&&!Ge||j==="png"&&v.includes(b)&&Ge&&!o,isLoading:Ct,onClick:kt,children:c("header.download.confirm")})})}),e.jsx(lr,{isOpen:Ze,onClose:()=>Je(!1)})]})]}),e.jsx(or,{isOpen:vt,onClose:()=>Bs(!1)})]})}function St(s){const{isOpen:a,onClose:o,onConfirm:t,saveVersion:r}=s,{t:i}=V(),n=f.useRef(null),p=r>Vs;return e.jsx(Tt,{isOpen:a,leastDestructiveRef:n,onClose:o,children:e.jsx(q,{children:e.jsxs(zt,{children:[e.jsx(Q,{fontSize:"lg",fontWeight:"bold",children:i("header.open.confirmOverwrite.title")}),e.jsxs(ee,{children:[i("header.open.confirmOverwrite.body"),p&&e.jsx(m,{mt:4,color:"orange.500",fontWeight:"semibold",children:i("header.open.confirmOverwrite.newerVersion",{saveVersion:r,currentVersion:Vs})})]}),e.jsxs(je,{children:[e.jsx(D,{ref:n,onClick:o,children:i("cancel")}),e.jsx(D,{id:"confirm_overwrite",colorScheme:"red",onClick:t,ml:3,children:i("header.open.confirmOverwrite.overwrite")})]})]})})})}const hr=(s,{info_panel_type:a,line_num:o,stn_list:t,style:r,theme:i},n,p,c)=>{const x=Object.fromEntries(Object.keys(t).filter(d=>!["linestart","lineend"].includes(d)).map(d=>[d,"stn_".concat(ws(10))]));Object.entries(t).filter(([d,u])=>!["linestart","lineend"].includes(d)).forEach(([d,u])=>{const h=s.filterNodes((l,w)=>Object.values($).includes(w.type)&&w[w.type].names[0]===u.localisedName.zh);h.length!==0&&(x[d]=h[0])});const j=[["linestart",-1,0]],g={};for(;j.length;){const[d,u,h]=j.shift();t[d].children.filter(w=>w!="lineend").forEach((w,b)=>{const S=Math.max(b,h+b);g[w]={x:u*150,y:S*75},j.push([w,u+1,S])})}Object.entries(t).filter(([d,u])=>!["linestart","lineend"].includes(d)).filter(([d,u])=>s.filterNodes((h,l)=>Object.values($).includes(l.type)&&l[l.type].names[0]===u.localisedName.zh).length===0).map(([d,u])=>{var S,_,y;let h=$.ShmetroBasic;const l=u.transfer.groups,w=l.map(v=>{var M;return(M=v.lines)!=null?M:[]}).flat();r===we.SHMetro?w.length>0?h=$.ShmetroInt:a===Ls.sh2020?h=$.ShmetroBasic2020:h=$.ShmetroBasic:r===we.GZMTR?w.length>0?h=$.GzmtrInt:h=$.GzmtrBasic:r===we.MTR&&(h=$.MTR);const b={...structuredClone($n[h].defaultAttrs),names:[(S=u.localisedName.zh)!=null?S:"",(_=u.localisedName.en)!=null?_:""]};return h===$.ShmetroBasic2020?b.color=i:h===$.GzmtrBasic?(b.color=i,b.lineCode=o,b.stationCode=u.num):h===$.GzmtrInt?b.transfer=l.map((v,M)=>{var T,O;const C=(O=(T=v.lines)==null?void 0:T.map(P=>{var F;return[...(F=P.theme)!=null?F:i,"1","01"]}))!=null?O:[];return M===0?[[...i,o,u.num],...C]:C}):h===$.MTR&&((y=l[0].lines)!=null&&y.length?b.transfer=[[[...i,"",""],...l[0].lines.map(v=>{var M;return[...(M=v.theme)!=null?M:i,"",""]})]]:b.transfer=[[]]),{node:x[d],attr:{visible:!0,zIndex:0,x:n+g[d].x,y:p+g[d].y,type:h,[h]:b}}}).forEach(({node:d,attr:u})=>s.addNode(d,u)),Object.entries(t).filter(([d,u])=>!["linestart","lineend"].includes(d)).forEach(([d,u])=>{u.children.filter(h=>!["linestart","lineend"].includes(h)).forEach(h=>{const l=ps.Diagonal,[w,b]=[x[d],x[h]],S=c?Ht(s,l,w,b,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(ws(10)),w,b,{visible:!0,zIndex:0,type:l,[ps.Diagonal]:structuredClone(Yt[ps.Diagonal].defaultAttrs),style:Fs.SingleColor,[Fs.SingleColor]:{color:i},reconcileId:"",parallelIndex:S})})})},pr="rmg-bridge--",ur={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function gr(s){const{isOpen:a,onClose:o}=s,{t}=V(),{preference:{autoParallel:r}}=U(b=>b.app),{svgViewBoxZoom:i,svgViewBoxMin:n}=U(b=>b.param),p=H(),c=E.isAllowAnalytics(),x=Ns(),{height:j,width:g}=Is(x),d=ss.useRef(window.graph),[u]=ss.useState(crypto.randomUUID()),h="/rmg/#/import?"+new URLSearchParams({parentComponent:E.getAppName(),parentId:u}),l=ss.useCallback(()=>{p(oe(d.current.export())),p(fe()),p(ae())},[p,fe,ae,oe,d]),w=b=>{try{c&&E.event(ke.IMPORT_RMG_PARAM,{});const S=n.x+g*i/100/3,_=n.y+j*i/100/3;hr(d.current,b,S,_,r),l()}catch(S){p(is({status:"error",message:t("header.open.unknownError")})),xe.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",S)}finally{o()}};return ss.useEffect(()=>{const b=new BroadcastChannel(pr+u);return b.onmessage=S=>{const{event:_,data:y}=S.data;xe.debug("[rmp] Received event from RMG app clip:",_),_==="CLOSE"?o():_==="IMPORT"&&w(y)},()=>b.close()},[n.x,n.y,i,j,g,r]),e.jsx(ut,{isOpen:a,onClose:o,sx:ur,children:e.jsx("iframe",{src:h,loading:"lazy"})})}const xr="RMP_GALLERY_CHANNEL",mr="OPEN_TEMPLATE",st=new BroadcastChannel(xr),fr={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function jr(s){const{isOpen:a,onClose:o}=s,{t}=V(),r=H(),{isOpen:i,onOpen:n,onClose:p}=it(),[c,x]=f.useState(null),[j,g]=f.useState(0),{telemetry:{project:d}}=U(y=>y.app),u=E.isAllowAnalytics(),h=f.useRef(window.graph),l=f.useCallback(()=>{r(oe(h.current.export())),r(fe()),r(ae())},[r,fe,ae,oe,h]),w=async y=>{const{version:v,images:M,...C}=JSON.parse(await gt(JSON.stringify(y)));r(Ss()),h.current.clear(),h.current.import(C.graph),Array.isArray(M)&&M.length>0&&await xt(h.current,M),r(vs()),l();const{svgViewBoxZoom:T,svgViewBoxMin:O}=C;typeof T=="number"&&r(Ie(T)),typeof O.x=="number"&&typeof O.y=="number"&&r(Fe(O))},b=async()=>{c&&await w(c),p(),x(null)},S=async(y,v)=>{var T;const M=v?"https://".concat(v):"",C=await((T=(await Promise.allSettled([fetch("".concat(M,"/rmp-gallery/resources/real_world/").concat(y,".json")),fetch("".concat(M,"/rmp-gallery/resources/fantasy/").concat(y,".json"))])).filter(O=>O.status==="fulfilled").find(O=>O.value.status===200))==null?void 0:T.value.json());if(C){if(x(C),g(C.version),n(),u){const O={id:y};d&&v&&(O.host=v),E.event(ke.IMPORT_WORK_FROM_GALLERY,O)}E.sendNotification({title:t("header.open.importOK",{id:y}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}else E.sendNotification({title:t("header.open.importFail",{id:y}),message:t("header.open.importFailContent"),type:"error",duration:9e3})},_=async y=>{try{const v=await fetch("".concat(Kt,"/").concat(y));if(v.status!==200)throw new Error(t("header.open.importFailContent"));const M=await v.json();x(M),g(M.version),n(),u&&E.event(ke.IMPORT_WORK_FROM_SHARE,{share:y}),E.sendNotification({title:t("header.open.importOK",{id:y}),message:t("header.open.importOKContent"),type:"success",duration:9e3})}catch(v){E.sendNotification({title:t("header.open.importFail",{id:y}),message:v.message,type:"error",duration:9e3})}};return f.useEffect(()=>{const v=new URL(window.location.href).searchParams;if(v.size>0){const M=v.keys().next().value,C=M.indexOf("."),T=M.substring(0,C===-1?void 0:C);let O;C!==-1&&(O=M.substring(C+1)),O==="org"?_(T):S(T,O),E.updateAppMetadata({search:""})}},[]),f.useEffect(()=>(st.onmessage=y=>{const{event:v,data:M}=y.data;v===mr&&(S(M),o())},()=>st.close()),[]),e.jsxs(e.Fragment,{children:[e.jsxs(ut,{isOpen:a,onClose:o,size:"full",sx:fr,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(ot,{onClick:o,position:"fixed",top:"5px",right:"15px"})]}),e.jsx(St,{isOpen:i,onClose:p,onConfirm:b,saveVersion:j})]})}function br(){const s=H(),{t:a}=V(),{isOpen:o,onOpen:t,onClose:r}=it(),[i,n]=f.useState(null),[p,c]=f.useState(0),x=Ns(),{height:j}=Is(x),g=f.useRef(window.graph),d=f.useRef(null),[u,h]=f.useState(!1),[l,w]=f.useState(!1),b=f.useCallback(()=>{s(oe(g.current.export())),s(fe()),s(ae())},[s,fe,ae,oe,g]),S=()=>{s(Ss()),g.current.clear(),s(Ie(100)),s(Fe({x:0,y:0})),b()},_=async C=>{const{version:T,images:O,...P}=JSON.parse(await gt(C));s(Ss()),g.current.clear(),g.current.import(P.graph),Array.isArray(O)&&O.length>0&&await xt(g.current,O),s(vs()),b();const{svgViewBoxZoom:F,svgViewBoxMin:K}=P;typeof F=="number"&&s(Ie(F)),typeof K.x=="number"&&typeof K.y=="number"&&s(Fe(K))},y=async()=>{if(i){await _(i);const C=await Ks();if(i.length===C.length){s(Fe({x:-10,y:-13}));const T=Math.max(0,Math.min(400,-.132*j+117.772));s(Ie(T)),await s(vs()),E.event(ke.LOAD_TUTORIAL,{})}}r(),n(null)},v=async C=>{var O;const T=(O=C.target.files)==null?void 0:O[0];if(xe.debug("OpenActions.handleUpload():: received file",T),(T==null?void 0:T.type)!=="application/json")s(is({status:"error",message:a("header.open.invalidType")})),xe.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const P=await wr(T);n(P);const F=Zs(P);c(F),t()}catch(P){s(is({status:"error",message:a("header.open.unknownError")})),xe.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",P)}C.target.value=""},M=async()=>{const C=await Ks();n(C),c(Zs(C)),t()};return f.useEffect(()=>{const C=async T=>{const{type:O,key:P,from:F}=T.data;if(O===qt.SAVE_CHANGED&&P===Js.PARAM&&F==="rmt"){xe.debug("Received save changed event on key: ".concat(P));const K=localStorage.getItem(Js.PARAM);if(!K)return;await _(K)}};return Hs.addEventListener("message",C),()=>Hs.removeEventListener("message",C)},[]),e.jsxs(e.Fragment,{children:[e.jsxs(Ts,{children:[e.jsx(zs,{as:ie,size:"sm",variant:"ghost",icon:e.jsx(Ys,{})}),e.jsxs(Rs,{children:[e.jsx(ge,{icon:e.jsx(Zt,{}),onClick:S,children:a("header.open.new")}),e.jsx("input",{id:"upload_project",ref:d,type:"file",accept:".json",hidden:!0,onChange:v,"data-testid":"file-upload"}),e.jsx(ge,{icon:e.jsx(Ys,{}),onClick:()=>{var C;return(C=d==null?void 0:d.current)==null?void 0:C.click()},children:a("header.open.config")}),e.jsx(ge,{icon:e.jsx(Jt,{}),onClick:()=>h(!0),children:a("header.open.projectRMG")}),e.jsxs(ge,{icon:e.jsx(B,{}),onClick:()=>w(!0),children:[a("header.open.gallery"),e.jsx(re,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(ge,{icon:e.jsx(Xt,{}),onClick:M,children:a("header.open.tutorial")})]}),e.jsx(gr,{isOpen:u,onClose:()=>h(!1)}),e.jsx(jr,{isOpen:l,onClose:()=>w(!1)})]}),e.jsx(St,{isOpen:o,onClose:r,onConfirm:y,saveVersion:p})]})}const wr=s=>new Promise(a=>{const o=new FileReader;o.onloadend=()=>a(o.result),o.readAsText(s)}),Sr=()=>{const[s,a]=f.useState(!1),{t:o}=V(),t=H(),r=f.useRef(window.graph),i=Ns(),{width:n,height:p}=Is(i),[c,x]=f.useState([]);f.useEffect(()=>{s&&x(r.current.nodes().filter(g=>g.startsWith("stn")).map(g=>{const d=r.current.getNodeAttributes(g),u=d.type,h=d[u].names.join("/");return{id:g,value:h}}))},[s]);const j=g=>{t(tn(new Set([g])));const d=Math.max(0,Math.min(400,-.132*p+117.772)),{x:u,y:h}=nn((n-300)/2,p/2,d,{x:-r.current.getNodeAttribute(g,"x"),y:-r.current.getNodeAttribute(g,"y")});t(Ie(d)),t(Fe({x:-u,y:-h}))};return e.jsxs(at,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(lt,{children:e.jsx(ie,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Qt,{}),onClick:()=>a(!s)})}),e.jsx(ct,{children:e.jsx(dt,{children:e.jsx(en,{label:o("header.search"),children:e.jsx(sn,{data:c,displayHandler:g=>e.jsx(re,{children:g.value}),filter:(g,d)=>d.value.toLowerCase().includes(g.toLowerCase())||Object.values(d.value).some(u=>u.toLowerCase().includes(g.toLowerCase())),value:"",onChange:g=>j(g.id)})})})})]})},yr=s=>{const{isOpen:a,onClose:o}=s,t=H(),{t:r}=V(),i=f.useRef(window.graph),{theme:n,requestThemeChange:p}=rn(),c=()=>{i.current.filterEdges((x,j,g,d,u,h,l)=>ht.has(j.style)&&JSON.stringify(j[j.style].color)===JSON.stringify(n)).forEach(x=>i.current.dropEdge(x)),t(oe(i.current.export())),t(ae()),o()};return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:r("header.settings.procedures.removeLines.title")}),e.jsx(ne,{}),e.jsxs(ee,{children:[r("header.settings.procedures.removeLines.content"),e.jsx(on,{theme:n,onClick:p})]}),e.jsxs(je,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:r("cancel")}),e.jsx(D,{colorScheme:"red",onClick:c,children:r("remove")})]})]})]})},Cr=s=>{const{isOpen:a,onClose:o}=s,t=H(),{t:r}=V(),i=f.useRef(window.graph),[n,p]=f.useState(1),c=[{type:"input",label:r("header.settings.procedures.scale.factor"),value:n.toString(),variant:"number",onChange:j=>p(Number(j)),minW:"full"}],x=()=>{i.current.forEachNode((j,g)=>{i.current.updateNodeAttribute(j,"x",d=>(d!=null?d:0)*n),i.current.updateNodeAttribute(j,"y",d=>(d!=null?d:0)*n)}),t(oe(i.current.export())),t(fe()),t(ae()),o()};return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:r("header.settings.procedures.scale.title")}),e.jsx(ne,{}),e.jsxs(ee,{children:[r("header.settings.procedures.scale.content"),e.jsx(Ne,{fields:c})]}),e.jsxs(je,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:r("cancel")}),e.jsx(D,{colorScheme:"red",onClick:x,children:r("apply")})]})]})]})},vr=s=>{const{isOpen:a,onClose:o}=s,t=H(),{t:r}=V(),i=f.useRef(window.graph),[n,p]=f.useState(0),[c,x]=f.useState(0),j=[{type:"input",label:r("header.settings.procedures.translate.x"),value:n.toString(),variant:"number",onChange:d=>p(Number(d)),minW:"full"},{type:"input",label:r("header.settings.procedures.translate.y"),value:c.toString(),variant:"number",onChange:d=>x(Number(d)),minW:"full"}],g=()=>{i.current.forEachNode((d,u)=>{i.current.updateNodeAttribute(d,"x",h=>(h!=null?h:0)+n),i.current.updateNodeAttribute(d,"y",h=>(h!=null?h:0)+c)}),t(oe(i.current.export())),t(fe()),t(ae()),o()};return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:r("header.settings.procedures.translate.title")}),e.jsx(ne,{}),e.jsxs(ee,{children:[r("header.settings.procedures.translate.content"),e.jsx(Ne,{fields:j})]}),e.jsxs(je,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:r("cancel")}),e.jsx(D,{colorScheme:"red",onClick:g,children:r("apply")})]})]})]})},_r=s=>{const{isOpen:a,onClose:o}=s,t=H(),{preference:{unlockSimplePathAttempts:r}}=U(c=>c.app),{activeSubscriptions:i}=U(c=>c.account),{t:n}=V(),p=()=>{t(an(-1))};return e.jsxs(se,{isOpen:a,onClose:o,size:"5xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:n("header.settings.procedures.unlockSimplePath.title")}),e.jsx(ne,{}),e.jsxs(ee,{children:[e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(m,{mb:"2",children:n("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(je,{children:e.jsx(ze,{label:n("header.settings.pro"),isOpen:!i.RMP_CLOUD&&r>=0,children:e.jsx(D,{onClick:p,isDisabled:!i.RMP_CLOUD||r<0,children:r>=0?n("header.settings.procedures.unlockSimplePath.check"):n("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},kr=s=>{const{isOpen:a,onClose:o}=s,t=H(),r=Rt(),{t:i}=V(),n=f.useRef(window.graph),[p,c]=f.useState(!1),x=async()=>{c(!0);const j=JSON.stringify(n.current.export());try{const g=await Ar(j);n.current.clear(),n.current.import(g),t(oe(n.current.export())),t(fe()),t(ae()),r({title:i("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(g){xe.error("[rmp] Error in updating all colors: ".concat(g)),r({title:i("header.settings.procedures.updateColor.error",{e:g}),status:"error",duration:9e3,isClosable:!0})}c(!1),o()};return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:i("header.settings.procedures.updateColor.title")}),e.jsx(ne,{}),e.jsx(ee,{children:e.jsx(m,{children:i("header.settings.procedures.updateColor.content")})}),e.jsxs(je,{children:[e.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:i("cancel")}),e.jsx(D,{colorScheme:"red",onClick:x,isLoading:p,children:i("apply")})]})]})]})},tt=s=>s.length>=4&&s.every(a=>typeof a=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(Es).includes(s[3]),Or=s=>{const a=[],o=(t,r)=>{if(Array.isArray(t)&&tt(t)){a.push({path:r||"",value:t});return}for(const i in t){const n=t[i],p=r?"".concat(r,".").concat(i):i;Array.isArray(n)?tt(n)?a.push({path:p,value:n}):n.forEach((c,x)=>o(c,"".concat(p,".").concat(x))):n&&typeof n=="object"&&o(n,p)}};return o(s),a},Mr=(s,a,o)=>{const t=a.split(".");let r=s;for(let i=0;i<t.length-1;i++)r=r[t[i]];r[t[t.length-1]]=o},Ar=async s=>{const a=JSON.parse(s),o=new Date().getTime(),t=Or(a);xe.debug("[rmp] Found all themes pending for update",t);const r=1e4;let i,n=!1;const p=new Promise((c,x)=>{i=setTimeout(()=>{n=!0,x("Executing time exceeds ".concat(r,"ms"))},r),(async()=>{for(const{path:j,value:g}of t){if(n)throw new Error("Update aborted");const[d,u,h,l,...w]=g,b=await ln([d,u,h,l]);Mr(a,j,[...b,...w])}})().then(c).catch(x)});try{return await p,xe.debug("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-o)/1e3," sec")),a}finally{clearTimeout(i)}},nt=1,Tr=()=>{const s=H(),{state:a,token:o}=U(l=>l.account),{count:{stations:t,miscNodes:r,masters:i,lines:n,parallel:p}}=U(l=>l.runtime),{t:c}=V(),[x,j]=f.useState(!1),[g,d]=f.useState(nt);f.useEffect(()=>{let l;return x&&g>0?l=window.setTimeout(()=>{d(g-1)},1e3):g===0&&j(!1),()=>clearTimeout(l)},[x,g]);const u=()=>{j(!0),d(nt),o&&dn(s,o)},h={"logged-out":c("header.settings.status.subscription.logged-out"),free:c("header.settings.status.subscription.free"),subscriber:c("header.settings.status.subscription.subscriber"),expired:c("header.settings.status.subscription.expired")};return e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:c("header.settings.status.title")}),e.jsxs(I,{mt:"3",children:[e.jsxs(I,{mb:"1",children:[e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.stations")}),e.jsx(m,{children:t})]}),e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.miscNodes")}),e.jsx(m,{children:r})]}),e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.masters")}),e.jsx(m,{children:i})]}),e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.lines")}),e.jsx(m,{children:n})]}),e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:c("header.settings.status.count.parallel")}),e.jsx(m,{children:p})]})]}),e.jsxs(I,{display:"flex",mb:"1",children:[e.jsxs(m,{flex:"1",children:[c("header.settings.status.subscription.content")," ",h[a]]}),e.jsx(ie,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(cn,{}),isDisabled:x,onClick:()=>u()})]})]})]})},ve={width:"100%",justifyContent:"space-between"},ue={fontFamily:"-apple-system"},zr=s=>{const{isOpen:a,onClose:o}=s,{activeSubscriptions:t}=U(z=>z.account),{telemetry:{project:r},preference:{autoParallel:i,randomStationsNames:n,gridLines:p,snapLines:c,predictNextNode:x,autoChangeStationType:j,disableWarning:{changeType:g}}}=U(z=>z.app),{keepLastPath:d,count:{parallel:u}}=U(z=>z.runtime),h=H(),{t:l}=V(),w=rt("primary.500","primary.300"),[b,S]=f.useState(!1),[_,y]=f.useState(!1),[v,M]=f.useState(!1),[C,T]=f.useState(!1),[O,P]=f.useState(!1),[F,K]=f.useState(!1),[Ke,Ze]=f.useState(!1),Je=E.isAllowAnalytics(),Le=z=>{h(_n(z))},Xe=t.RMP_CLOUD?hn:pn,qe=u>=Xe,De=!t.RMP_CLOUD,Pe=z=>{h(vn(z.target.value))};return e.jsxs(se,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(q,{}),e.jsxs(te,{children:[e.jsx(Q,{children:l("header.settings.title")}),e.jsx(ne,{}),e.jsx(ee,{children:e.jsxs(Re,{divider:e.jsx(Dt,{borderColor:"gray.200"}),children:[e.jsx(Tr,{}),e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.preference.title")}),e.jsxs(Re,{spacing:"0",mt:"3",align:"stretch",children:[e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.keepLastPath")}),e.jsx(pe,{isChecked:d,onChange:({target:{checked:z}})=>h(un(z))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{children:l("header.settings.preference.autoParallel")}),e.jsx(re,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ze,{label:l("header.settings.proWithTrial"),children:e.jsx(re,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(pe,{ml:"1",isDisabled:qe,isChecked:i,onChange:({target:{checked:z}})=>h(gn(z))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.randomStationNames.title")}),e.jsx(re,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(re,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(Et,{size:"xs",width:"auto",ml:"1",value:n,onChange:Pe,children:[e.jsx("option",{value:"none",children:l("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:es.Shmetro,disabled:De,children:l("header.settings.preference.randomStationNames.".concat(es.Shmetro))}),e.jsx("option",{value:es.Bjsubway,disabled:De,children:l("header.settings.preference.randomStationNames.".concat(es.Bjsubway))})]})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.gridline")}),e.jsx(pe,{isChecked:p,onChange:({target:{checked:z}})=>h(xn(z))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.snapline")}),e.jsx(pe,{isChecked:c,onChange:({target:{checked:z}})=>h(mn(z))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.predictNextNode")}),e.jsx(pe,{isChecked:x,onChange:({target:{checked:z}})=>h(fn(z))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.autoChangeStationType")}),e.jsx(pe,{isChecked:j,onChange:({target:{checked:z}})=>h(jn(z))})]}),e.jsxs(J,{mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.preference.disableWarningChangeType")}),e.jsx(pe,{isChecked:g,onChange:({target:{checked:z}})=>h(bn(z))})]})]})]}),e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.procedures.title")}),e.jsxs(I,{mt:"3",children:[e.jsx(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>S(!0),children:l("header.settings.procedures.translate.title")}),e.jsx(vr,{isOpen:b,onClose:()=>S(!1)}),e.jsx(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>y(!0),children:l("header.settings.procedures.scale.title")}),e.jsx(Cr,{isOpen:_,onClose:()=>y(!1)}),e.jsxs(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>M(!0),children:[l("header.settings.procedures.changeType.title"),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(re,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(Vn,{isOpen:v,onClose:()=>M(!1),isSelect:!1}),e.jsx(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>T(!0),children:l("header.settings.procedures.removeLines.title")}),e.jsx(yr,{isOpen:C,onClose:()=>T(!1)}),e.jsx(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>P(!0),children:l("header.settings.procedures.updateColor.title")}),e.jsx(kr,{isOpen:O,onClose:()=>P(!1)}),e.jsxs(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>K(!0),children:[l("header.settings.procedures.unlockSimplePath.title"),e.jsx(ze,{label:l("header.settings.pro"),children:e.jsx(re,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(_r,{isOpen:F,onClose:()=>K(!1)}),e.jsx(D,{sx:ve,rightIcon:e.jsx(Ce,{}),onClick:()=>Ze(!0),children:l("header.settings.procedures.masterManager.title")}),e.jsx(Un,{isOpen:Ke,onClose:()=>Ze(!1)})]})]}),e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.shortcuts.title")}),e.jsx(I,{mt:"3",children:e.jsxs(Nt,{children:[e.jsx(It,{children:e.jsxs(Y,{children:[e.jsx($s,{children:l("header.settings.shortcuts.keys")}),e.jsx($s,{children:l("header.settings.shortcuts.description")})]})}),e.jsxs(Lt,{children:[e.jsxs(Y,{children:[e.jsx(N,{children:e.jsx(A,{children:"f"})}),e.jsx(N,{children:l("header.settings.shortcuts.f")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:e.jsx(A,{children:"s"})}),e.jsx(N,{children:l("header.settings.shortcuts.s")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:e.jsx(A,{children:"c"})}),e.jsx(N,{children:l("header.settings.shortcuts.c")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:e.jsxs(I,{display:"flex",flexDirection:"row",children:[e.jsx(wn,{}),e.jsx(Sn,{}),e.jsx(yn,{}),e.jsx(Cn,{})]})}),e.jsx(N,{children:l("header.settings.shortcuts.arrows")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:e.jsxs(I,{display:"flex",flexDirection:"row",children:[e.jsx(A,{children:"i"}),e.jsx(A,{children:"j"}),e.jsx(A,{children:"k"}),e.jsx(A,{children:"l"})]})}),e.jsx(N,{children:l("header.settings.shortcuts.ijkl")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:be?e.jsx(A,{sx:ue,children:"⇧"}):e.jsx(A,{children:"shift"})}),e.jsx(N,{children:l("header.settings.shortcuts.shift")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:be?e.jsx(A,{sx:ue,children:"⌥"}):e.jsx(A,{children:"alt"})}),e.jsx(N,{children:l("header.settings.shortcuts.alt")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:be?e.jsx(A,{sx:ue,children:"⌫"}):e.jsx(A,{children:"delete"})}),e.jsx(N,{children:l("header.settings.shortcuts.delete")})]}),e.jsxs(Y,{children:[e.jsxs(N,{children:[be?e.jsx(A,{sx:ue,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"x"})]}),e.jsx(N,{children:l("header.settings.shortcuts.cut")})]}),e.jsxs(Y,{children:[e.jsxs(N,{children:[be?e.jsx(A,{sx:ue,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"c"})]}),e.jsx(N,{children:l("header.settings.shortcuts.copy")})]}),e.jsxs(Y,{children:[e.jsxs(N,{children:[be?e.jsx(A,{sx:ue,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"v"})]}),e.jsx(N,{children:l("header.settings.shortcuts.paste")})]}),e.jsxs(Y,{children:[e.jsxs(N,{children:[be?e.jsx(A,{sx:ue,children:"⌘"}):e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"z"})]}),e.jsx(N,{children:l("header.settings.shortcuts.undo")})]}),e.jsxs(Y,{children:[e.jsx(N,{children:be?e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:ue,children:"⇧"})," + ",e.jsx(A,{sx:ue,children:"⌘"})," + ",e.jsx(A,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{children:"ctrl"})," + ",e.jsx(A,{children:"y"})]})}),e.jsx(N,{children:l("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(I,{width:"100%",mb:"3",children:[e.jsx(m,{as:"b",fontSize:"xl",children:l("header.settings.telemetry.title")}),e.jsxs(I,{mt:"3",children:[e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.info")}),e.jsxs(I,{mt:"3",mb:"1",children:[e.jsxs(I,{display:"flex",mb:"1",children:[e.jsx(m,{flex:"1",children:l("header.settings.telemetry.essential")}),e.jsx(ze,{label:l("header.settings.telemetry.essentialTooltip"),children:e.jsx(pe,{isChecked:Je,isDisabled:!0})})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.essentialInfo")}),e.jsxs(L,{color:w,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[l("header.settings.telemetry.essentialLink")," ",e.jsx(G,{as:B})]})]}),e.jsxs(I,{mt:"1",mb:"1",children:[e.jsxs(I,{display:"flex",children:[e.jsx(m,{flex:"1",children:l("header.settings.telemetry.additional")}),e.jsx(pe,{isChecked:r,onChange:({target:{checked:z}})=>Le(z)})]}),e.jsx(m,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:l("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},Rr=()=>{const[s,a]=f.useState(!1),{svgViewBoxZoom:o}=U(i=>i.param),t=H(),r=[{type:"slider",label:"",value:400-o,min:10,max:390,step:1,onChange:i=>t(Ie(400-i)),leftIcon:e.jsx(kn,{}),rightIcon:e.jsx(Xs,{}),minW:160}];return e.jsxs(at,{isOpen:s,onOpen:()=>a(!0),onClose:()=>a(!1),children:[e.jsx(lt,{children:e.jsx(ie,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Xs,{}),onClick:()=>a(!s)})}),e.jsx(ct,{children:e.jsx(dt,{children:e.jsx(Ne,{fields:r,noLabel:!0})})})]})};function Er(){const{t:s}=V(),a=H(),{past:o,future:t}=U(l=>l.param),r=E.isAllowAnalytics(),[i,n]=f.useState(!1),[p,c]=f.useState(!1),x=Qs(E.getEnv),j=Qs(E.getAppVersion),g=On();f.useEffect(()=>{r&&x!==us.DEV&&E.event(ke.APP_LOAD,{isStandaloneWindow:E.isStandaloneWindow()})},[x]);const d=l=>{E.getI18nInstance().changeLanguage(l)},u=()=>{a(Ln())},h=()=>{a(Dn())};return e.jsxs(Mn,{children:[e.jsxs(bs,{direction:g==="landscape"?"row":"column",width:"100%",children:[e.jsxs(J,{height:"32px",children:[e.jsx(Te,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(An,{environment:x,version:j,popoverHeader:x===us.PRD?void 0:e.jsxs(ys,{i18nKey:"header.popoverHeader",environment:x,children:["You're on ",{environment:x}," environment!"]}),popoverBody:x===us.PRD?void 0:e.jsx(ys,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})})]}),e.jsxs(J,{overflowX:"auto",ml:g==="landscape"?"auto":void 0,children:[e.jsx(Sr,{}),e.jsx(ie,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(Tn,{}),isDisabled:o.length===0,onClick:u}),e.jsx(ie,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(zn,{}),isDisabled:t.length===0,onClick:h}),e.jsx(Rr,{}),e.jsx(br,{}),e.jsx(dr,{}),E.isStandaloneWindow()&&e.jsxs(Ts,{children:[e.jsx(zs,{as:ie,icon:e.jsx(Rn,{}),variant:"ghost",size:"sm"}),e.jsx(Rs,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(l=>e.jsx(ge,{onClick:()=>d(l),children:En[l][l]},l))})]}),e.jsx(ie,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(Nn,{}),onClick:()=>n(!0)}),e.jsx(ie,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(In,{}),onClick:()=>c(!0)})]})]}),e.jsx(zr,{isOpen:i,onClose:()=>n(!1)}),e.jsx(Fn,{isOpen:p,onClose:()=>c(!1)})]})}function Nr(){const s=H(),a=U(t=>t.runtime.globalAlerts),o=t=>{E.isStandaloneWindow()?window.open("/".concat(t),"_blank"):E.openApp({appId:t})};return e.jsx(e.Fragment,{children:Object.entries(a).map(([t,{message:r,url:i,linkedApp:n}])=>e.jsxs(ns,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(rs,{}),n?e.jsx(L,{onClick:()=>o(n),children:r}):i?e.jsx(L,{href:i,target:"_blank",children:r}):r,e.jsx(ot,{ml:"auto",onClick:()=>s(Pn(t))})]},t))})}function Gr(){return e.jsxs(e.Fragment,{children:[e.jsx(Er,{}),e.jsx(Nr,{})]})}export{Gr as default};
