import{j as s,ag as oe,M as le,ah as re,J as ce,N as z,K as de,L as he,aG as pe,aH as ue,aI as ye,B as ge,aJ as Se,aK as me,O as fe,t as D,aw as Te}from"./chakra-C1zJvDsN.js";import{c as Ce,e as I,w as H,x as G,y as J,q as xe,aQ as be,C as Le,M as je,S as we,p as Oe,L as ve,Z as Ie,W as Pe,R as Be,_ as Me,k as Ne}from"./index-zUETaabu.js";import{u as Re,b as a}from"./react-BpF4RbzH.js";import{e as ke,f as We,g as Ae,h as Ee,i as Fe,j as Ze}from"./change-types-ba6z8Zo1.js";import{s as _e,g as ze}from"./master-manager-BCCbxl8w.js";const Ue=K=>{const{isOpen:y,onClose:g,isSelect:r,filter:n}=K,{t}=Re(),p=Ce(),{selected:d}=I(e=>e.runtime),{preference:{autoParallel:U}}=I(e=>e.app),{activeSubscriptions:P}=I(e=>e.account),q=a.useCallback(()=>{p(H(o.current.export())),p(G()),p(J())},[p,G,J,H]),o=a.useRef(window.graph),B={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(xe).map(([e,i])=>[e,t(i.metadata.displayName).toString()]))},M={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(be).map(([e,i])=>[e,t(i.metadata.displayName).toString()]))},N={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(_e).map(([e,i])=>[e,t(i.metadata.displayName).toString()]))},S={id:"any",theme:[Le.Other,"other","#ffffff",je.black],value:t("header.settings.procedures.changeType.any")},[m,R]=a.useState(!1),[k,W]=a.useState(0),[f,A]=a.useState(!1),[T,Q]=a.useState("any"),[C,V]=a.useState(we.ShmetroBasic),[x,E]=a.useState(!1),[b,X]=a.useState("any"),[L,Y]=a.useState(Oe.SingleColor),[j,F]=a.useState(!1),[w,$]=a.useState("any"),[O,ee]=a.useState(ve.Diagonal),[v,Z]=a.useState(!1),[h,_]=a.useState(S),{theme:u,requestThemeChange:te}=Ie(),[se,ne]=a.useState([]),ae=[{id:"changeZIndex",title:t("header.settings.procedures.changeZIndex"),onClose:()=>R(!m),field:[{type:"select",label:t("panel.details.info.zIndex"),value:k,options:Object.fromEntries(Array.from({length:11},(e,i)=>[i-5,(i-5).toString()])),onChange:e=>W(Number(e))}]},{id:"changeStationType",title:t("header.settings.procedures.changeStationType.title"),onClose:()=>A(!f),field:[{type:"select",label:t("header.settings.procedures.changeStationType.changeFrom"),options:N,value:T,disabledOptions:[C],onChange:e=>Q(e)},{type:"select",label:t("header.settings.procedures.changeStationType.changeTo"),options:N,value:C,disabledOptions:["any",T],onChange:e=>V(e)}]},{id:"changeLineStyleType",title:t("header.settings.procedures.changeLineStyleType.title"),onClose:()=>E(!x),field:[{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeFrom"),options:M,value:b,disabledOptions:[L],onChange:e=>X(e)},{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeTo"),options:M,value:L,disabledOptions:["any",b],onChange:e=>Y(e)}]},{id:"changeLinePathType",title:t("header.settings.procedures.changeLinePathType.title"),onClose:()=>F(!j),field:[{type:"select",label:t("header.settings.procedures.changeLinePathType.changeFrom"),options:B,value:w,disabledOptions:[O],onChange:e=>$(e)},{type:"select",label:t("header.settings.procedures.changeLinePathType.changeTo"),options:B,value:O,disabledOptions:["any","simple",w],onChange:e=>ee(e)}]},{id:"changeColor",title:t("header.settings.procedures.changeColor.title"),onClose:()=>Z(!v),field:[{type:"custom",label:t("header.settings.procedures.changeColor.changeFrom"),component:s.jsx(Pe,{data:se,displayHandler:e=>s.jsx(Be,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,i)=>i.id.toLowerCase().includes(e.toLowerCase())||Object.values(i.id).some(c=>c.toLowerCase().includes(e.toLowerCase())),value:h.value,onChange:e=>_(e)})},{type:"custom",label:t("header.settings.procedures.changeColor.changeTo"),component:s.jsx(Me,{theme:u,onClick:te})}]}];a.useEffect(()=>{y&&(R(!1),A(!1),E(!1),F(!1),Z(!1),W(0),ne([S,...ze(o.current,r?[...d].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):o.current.nodes(),r?[...d].filter(e=>e.startsWith("line")):o.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),_(S))},[y]);const ie=()=>{const e=n!=null&&n.includes("station")?[...d].filter(l=>l.startsWith("stn")):r?[]:o.current.filterNodes(l=>l.startsWith("stn")),i=n!=null&&n.includes("misc-node")?[...d].filter(l=>l.startsWith("misc_node")):r?[]:o.current.filterNodes(l=>l.startsWith("misc_node")),c=r?[...d].filter(l=>l.startsWith("line")):o.current.edges();(!n||n.includes("station"))&&f&&ke(o.current,T,C,e),(!n||n.includes("line"))&&x&&We(o.current,b,L,u,c),(!n||n.includes("line"))&&j&&Ae(o.current,w,O,c,U),v&&((!n||n.includes("line"))&&Ee(o.current,h.id==="any"?"any":h.theme,u,c),(!n||n.includes("misc-node")||n.includes("station"))&&Fe(o.current,h.id==="any"?"any":h.theme,u,e,i)),m&&Ze(o.current,e,i,c,k),q(),g()};return s.jsxs(oe,{isOpen:y,onClose:g,size:"md",scrollBehavior:"inside",children:[s.jsx(le,{}),s.jsxs(re,{children:[s.jsxs(ce,{children:[s.jsx(z,{as:"b",fontSize:"xl",children:t(r?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),s.jsx(de,{})]}),s.jsx(he,{children:s.jsx(pe,{allowMultiple:!0,children:ae.map(e=>s.jsxs(ue,{children:[s.jsxs(ye,{onClick:e.onClose,children:[s.jsx(ge,{as:"span",flex:"1",textAlign:"left",children:s.jsx(z,{as:"b",fontSize:"md",children:e.title})}),s.jsx(Se,{})]}),s.jsx(me,{pb:4,children:s.jsx(Ne,{fields:e.field,minW:270})})]},e.id))})}),s.jsxs(fe,{children:[s.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:g,children:t("cancel")}),s.jsx(Te,{label:t("header.settings.pro"),isOpen:!P.RMP_CLOUD,children:s.jsx(D,{colorScheme:"red",mr:"1",onClick:ie,isDisabled:!P.RMP_CLOUD||!m&&!f&&!x&&!j&&!v,children:t("apply")})})]})]})]})};export{Ue as C};
