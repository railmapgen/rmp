import{j as e,ag as J,M as Y,ah as Z,J as K,K as q,L as X,h as As,ai as dt,N as f,B as z,aj as ze,ak as Ie,T as re,al as oe,b as ie,q as ns,t as E,O as me,am as ht,an as pt,ao as ye,R as A,ap as N,Q as $s,aq as ws,ar as Ss,a2 as Q,as as ys,at as de,x as ce,au as rs,av as ut,aw as Fs,a8 as Vs,e as Js,w as Ys,m as Zs,E as Ks,ax as ve,a7 as Ce,a1 as xt,ay as gt,az as mt,aA as W,aB as Ts,aC as ft,aD as _,aE as C,aF as jt,k as bt,W as ae,U as wt,V as St}from"./chakra-CHkbW1Nc.js";import{u as yt,r as T,C as Ct,M as Cs,L as qs,n as ps,S as H,R as Os,a as Xs,b as R,c as B,d as D,i as Rs,e as zt,f as vt,g as kt,h as _t,j as _e,E as Ae,s as Mt,k as Ke,l as os,m as At,o as Es,p as Tt,q as zs,t as vs,v as V,w as F,x as ee,y as Qs,z as et,A as us,B as Me,D as Pe,F as Ns,G as Is,H as Ot,I as Rt,J as Et,K as Nt,N as It,O as Hs,P as Ht,Q as Lt,T as Pt,U as Dt,V as Bt,W as Gt,X as Wt,Y as Ut,Z as $t,_ as Ft,$ as Vt,a0 as Jt,a1 as Yt,a2 as Zt,a3 as Kt,a4 as qt,a5 as Je,a6 as Xt,a7 as Qt,a8 as fe,a9 as en,aa as sn,ab as tn,ac as nn,ad as ue,ae as rn,af as on,ag as Ls,ah as an,ai as is,aj as ln,ak as cn,al as dn,am as hn,an as pn,ao as un,ap as xn,aq as gn,ar as mn,as as fn}from"./index-CnYwl7mk.js";import{u as P,b,a as Ye,T as Ps}from"./react-3Z_4zUxA.js";import{d as xs,m as jn,a as bn,i as wn,s as Sn,M as yn}from"./master-manager-CfT9vCcR.js";import{C as Cn}from"./change-type-modal-zfEZ9wPy.js";var Ds=function(s){return yt(T.ready(),s)},zn={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ja:"中国語",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const vn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=P(),i=T.getAppVersion();return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:n("header.about.title")}),e.jsx(q,{}),e.jsxs(X,{paddingBottom:10,children:[e.jsxs(As,{direction:"row",children:[e.jsx(dt,{boxSize:"128px",src:"/rmp//logo192.png"}),e.jsxs(As,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[e.jsx(f,{fontSize:"xl",as:"b",children:n("header.about.rmp")}),e.jsx(f,{children:i}),e.jsx(f,{}),e.jsx(f,{fontSize:"sm",children:n("header.about.railmapgen")})]})]}),e.jsx(z,{margin:5,children:e.jsx(f,{fontSize:"xl",children:n("header.about.desc")})}),e.jsx(ze,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contributors")}),e.jsx(ze,{as:"h6",size:"xs",my:2,children:n("header.about.coreContributors")}),e.jsxs(Ie,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),e.jsx(f,{fontSize:"sm",children:n("header.about.content1")}),e.jsx(f,{fontSize:"sm",align:"right",mb:1,children:n("header.about.content2")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),e.jsx(f,{fontSize:"sm",children:n("header.about.langonginc")}),e.jsx(f,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),e.jsx(ze,{as:"h6",size:"xs",my:2,children:n("header.about.styleContributors")}),e.jsxs(Ie,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),e.jsx(f,{fontSize:"sm",mb:1,children:n("header.about.203IhzElttil")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),e.jsx(f,{fontSize:"sm",mb:1,children:n("header.about.Swiftiecott")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Minwtraft","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"https://github.com/Minwtraft.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Minwtraft"}),e.jsx(f,{fontSize:"sm",mb:1,children:n("header.about.Minwtraft")})]})]})]}),e.jsx(ze,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.about.contactUs")}),e.jsxs(Ie,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"images/github-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.github")}),e.jsx(f,{fontSize:"sm",children:n("header.about.githubContent")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"images/slack-mark.svg",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.about.slack")}),e.jsx(f,{fontSize:"sm",children:n("header.about.slackContent")}),e.jsx(f,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]}),e.jsx(ze,{as:"h5",size:"sm",mt:3,mb:2,children:n("header.donation.title")}),e.jsxs(Ie,{children:[e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"images/afdian.png",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",pb:1,children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.afdian")}),e.jsx(f,{fontSize:"sm",children:n("header.donation.viaCNY")})]})]}),e.jsxs(re,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[e.jsx(oe,{src:"images/opencollective-icon.webp",size:"lg",my:2,ml:-1,mr:2}),e.jsxs(ie,{display:"block",width:"100%",pb:1,children:[e.jsx(f,{fontSize:"lg",fontWeight:"bold",mb:1,children:n("header.donation.openCollective")}),e.jsx(f,{fontSize:"sm",children:n("header.donation.viaUSD")})]})]})]})]})]})]})};/*!
 * canvas-size
 * v2.0.0
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function De(s){const l=s.sizes.shift(),a=Math.max(Math.ceil(l[0]),1),n=Math.max(Math.ceil(l[1]),1),i=[a-1,n-1,1,1],t=performance.now(),r=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;let d,u;r?(d=new OffscreenCanvas(1,1),u=new OffscreenCanvas(a,n)):(d=document.createElement("canvas"),d.width=1,d.height=1,u=document.createElement("canvas"),u.width=a,u.height=n);const m=d.getContext("2d"),w=u.getContext("2d");w&&(w.fillRect.apply(w,i),m.drawImage(u,a-1,n-1,1,1,0,0,1,1));const x=m&&m.getImageData(0,0,1,1).data[3]!==0,o=parseInt(performance.now()-t);return[d,u].forEach(h=>{h.height=0,h.width=0}),r?(postMessage({width:a,height:n,testTime:o,isTestPass:x}),!x&&s.sizes.length&&setTimeout(()=>{De(s)},0)):x?s.onSuccess({width:a,height:n,testTime:o}):(s.onError({width:a,height:n,testTime:o}),s.sizes.length&&setTimeout(()=>{De(s)},0)),x}const as={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},ke={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Ne={};function ls(s){const l=s.width===s.height,a=s.height===1,n=s.width===1,i=[];if(!s.width||!s.height)s.sizes.forEach(t=>{const r=l||a?t:1,d=l||n?t:1;i.push([r,d])});else{const t=s.min||ke.min,r=s.step||ke.step;let d=Math.max(s.width,s.height);for(;d>=t;){const u=l||a?d:1,m=l||n?d:1;i.push([u,m]),d-=r}}return i}function Ze(s){const l=typeof window<"u",a=l&&"Promise"in window,n=l&&"HTMLCanvasElement"in window,i=l&&"OffscreenCanvas"in window,t=URL.createObjectURL(new Blob([])).slice(-36),r=performance.now(),{onError:d,onSuccess:u,...m}=s,w=()=>parseInt(performance.now()-r);let x=null;if(!n)return!1;if(s.useWorker&&i){const o="\n            var canvasTest = ".concat(De.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),h=new Blob([o],{type:"application/javascript"}),c=URL.createObjectURL(h);x=new Worker(c),URL.revokeObjectURL(c),x.onmessage=function(p){const{width:g,height:j,testTime:S,isTestPass:y}=p.data,M={width:g,height:j,testTime:S,totalTime:w()};y?(Ne[t].onSuccess(M),delete Ne[t]):Ne[t].onError(M)}}if(a)return new Promise(o=>{const h={...s,onError(c){let{width:p,height:g,testTime:j}=c;const S={width:p,height:g,testTime:j,totalTime:w()};let y;if(s.sizes.length===0)y=!0;else{const[[M,L]]=s.sizes.slice(-1);y=p===M&&g===L}d(S),y&&o({...S,success:!1})},onSuccess(c){let{width:p,height:g,testTime:j}=c;const S={width:p,height:g,testTime:j,totalTime:w()};u(S),o({...S,success:!0})}};if(x){const{onError:c,onSuccess:p}=h;Ne[t]={onError:c,onSuccess:p},x.postMessage(m)}else De(h)});if(x)Ne[t]={onError:d,onSuccess:u},x.postMessage(m);else return De(s)}const kn={maxArea(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=ls({width:s.max,height:s.max,min:s.min,step:s.step,sizes:[...as.area]}),a={...ke,...s,sizes:l};return Ze(a)},maxHeight(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=ls({width:1,height:s.max,min:s.min,step:s.step,sizes:[...as.height]}),a={...ke,...s,sizes:l};return Ze(a)},maxWidth(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=ls({width:s.max,height:1,min:s.min,step:s.step,sizes:[...as.width]}),a={...ke,...s,sizes:l};return Ze(a)},test(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l={...ke,...s};return l.sizes=[...l.sizes],l.width&&l.height&&(l.sizes=[[l.width,l.height]]),Ze(l)}};var Be=(s=>(s.left="l",s.right="r",s))(Be||{}),be=(s=>(s.through="through",s.nonThrough="nonthrough",s))(be||{}),qe=(s=>(s.local="local",s.express="express",s.direct="direct",s))(qe||{}),xe=(s=>(s.MTR="mtr",s.GZMTR="gzmtr",s.SHMetro="shmetro",s))(xe||{}),ks=(s=>(s.sh="sh",s.sh2020="sh2020",s))(ks||{});const he=new Set,gs=new Set,ms=new Set,fs=new Set,st=new Map,ge=new Map,cs=new Set,ds=new Map,$=new Map;let I=[],He=0;const Le=new Map,hs=new Map,js=new Set,_n={localisedName:{en:"LEFT END"},num:"00",services:[qe.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:Be.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},Mn={localisedName:{en:"RIGHT END"},num:"00",services:[qe.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Be.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},An={},tt={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:xe.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:Be.right,platform_num:"1",theme:[Ct.Shanghai,"sh1","#E3002B",Cs.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:An,namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:ks.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1},coachNum:"1"},Tn={localisedName:{},num:"",services:[qe.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:Be.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355,character_spacing:0},v=s=>"".concat(s[0],"/").concat(s[1],"=").concat(s[2]).concat(s[3]),_s=s=>qs.has(s),On=s=>{if(_s(s.style))return structuredClone(s[s.style].color)},Rn=(s,l)=>{const[a,n]=s.extremities(l),i=s.getEdgeAttributes(l),t=i.style;if(a!=n&&_s(t)){const r=On(i);fs.has(v(r))||(ms.add(r),fs.add(v(r)),st.set(r,a),ge.set(v(r),new Set)),ge.get(v(r)).add(a),ge.get(v(r)).add(n),$.has(a)?I.push({target:n,next:$.get(a),color:r}):I.push({target:n,next:-1,color:r}),$.set(a,He),He++,$.has(n)?I.push({target:a,next:$.get(n),color:r}):I.push({target:a,next:-1,color:r}),$.set(n,He),He++}},nt=(s,l,a)=>{if(ge.get(v(a)).has(s)){ge.get(v(a)).delete(s);for(let n=$.get(s);n!=-1;n=I[n].next){const i=I[n].target,t=I[n].color;v(t)==v(a)&&nt(i,s,a)}}},rt=(s,l,a)=>{if(he.has(s))return;he.add(s);let n=0;const i=new Set;for(let t=$.get(s);t!=-1;t=I[t].next){const r=I[t].target,d=I[t].color;v(d)==v(a)&&(i.has(r)||(i.add(r),n++,r!=l&&rt(r,s,a)))}Le.set(s,n)},Bs=(s,l)=>{const a=s.stn_list.lineend.parents;a.push(l),s.stn_list.lineend.parents=structuredClone(a).reverse(),s.stn_list.lineend.branch={...s.stn_list.lineend.branch,left:s.stn_list.lineend.parents.length==2?[be.through,a[1]]:void 0}},En=(s,l)=>{let a=0;for(let n=$.get(s);n!=-1;n=I[n].next){I[n].target;const i=I[n].color;v(i)==v(l)&&a++}return a},ot=(s,l,a)=>{if(js.has(s))return[];js.add(s);const n=[];for(let i=$.get(s);i!=-1;i=I[i].next){const t=I[i].target,r=I[i].color;t!=l&&v(r)==v(a)&&(t.startsWith("stn")?n.push(t):n.push(...ot(t,s,a)))}return n},bs=(s,l,a,n,i,t,r)=>{var o;if(he.has(s)&&(!s.startsWith("misc_node_")&&r.stn_list[s]==null||s.startsWith("misc_node_")&&!gs.has(s)||r.loop))return[];if(he.has(s)&&r.stn_list[s]!=null&&En(s,t)-1>=2){const h=[...r.stn_list[s].parents,l];if(r.stn_list[h[1]]==null){const g=h[0];h[0]=h[1],h[1]=g}r.stn_list[s].parents=structuredClone(h).reverse(),r.stn_list[s].branch={...r.stn_list[s].branch,left:[be.through,h[1]]};const c=[];for(const g of r.stn_list[s].children)g!=l&&c.push(g);r.stn_list[s].children=structuredClone(c),(o=r.stn_list[s].branch)==null||delete o.right;const p=[];for(const g of r.stn_list.lineend.parents)g!=s&&p.push(g);return r.stn_list.lineend.parents=structuredClone(p).reverse(),r.stn_list.lineend.branch={...r.stn_list.lineend.branch,left:r.stn_list.lineend.parents.length==2?[be.through,p[1]]:void 0},c.length==0&&(r.stn_list[s].children=["lineend"],Bs(r,s)),[s]}he.add(s);const d=[],u=[],m=[],w=new Set,x=new Set;for(let h=$.get(s);h!=-1;h=I[h].next){const c=I[h].target,p=I[h].color;if(c!=a){if(v(p)==v(t)){if(x.has(c))continue;if(x.add(c),s.startsWith("misc_node_")){const g=bs(c,l,s,n+1,i,t,r);g.length!=0&&d.push(...g)}else{const g=bs(c,s,s,n+1,i,t,r);g.length!=0&&d.push(...g)}}if(!w.has(v(p))&&v(p)!=v(t)){w.add(v(p));const g={theme:p,name:["ch_".concat(v(p)),"en_".concat(v(p))]};m.push(g)}}}if(d.length==2){for(let h=0;h<2;h++)d[h]=="lineend"&&d.splice(h,1);if(r.stn_list[d[1]].parents.length>=2){const h=d[0];d[0]=d[1],d[1]=h}}if(he.has(s)&&r.stn_list[s]!=null){const h=[];for(const c of r.stn_list.lineend.parents)c!=s&&h.push(c);r.stn_list.lineend.parents=structuredClone(h).reverse(),r.stn_list.lineend.branch={...r.stn_list.lineend.branch,left:r.stn_list.lineend.parents.length==2?[be.through,h[1]]:void 0},d.length==0&&(js.clear(),u.push(...ot(s,l,t)))}if(s.startsWith("misc_node_"))return gs.add(s),d;{const h=i.getNodeAttributes(s).type,c=i.getNodeAttributes(s)[h];if(r.stn_list[s]=structuredClone(Tn),r.stn_list[s].localisedName={zh:c.names[0],en:c.names[1]},r.stn_list[s].num=String(n),i.getNodeAttributes(s).type==H.GzmtrBasic){const p=c;r.stn_list[s].num=p.stationCode,(p.secondaryNames[0]!==""||p.secondaryNames[1]!=="")&&(r.stn_list[s].localisedSecondaryName={zh:p.secondaryNames[0],en:p.secondaryNames[1]})}if(i.getNodeAttributes(s).type==H.GzmtrInt){const p=c,g=p.transfer[0];for(const j of g)if(v(j)==v(t)){r.stn_list[s].num=String(j[5]);break}(p.secondaryNames[0]!==""||p.secondaryNames[1]!=="")&&(r.stn_list[s].localisedSecondaryName={zh:p.secondaryNames[0],en:p.secondaryNames[1]})}return d.length!=0?(r.stn_list[s].children=structuredClone(d).reverse(),d.length==2&&(r.stn_list[s].branch={...r.stn_list[s].branch,right:[be.through,d[1]]})):(r.stn_list[s].children=["lineend"],Bs(r,s)),u.push(l),r.stn_list[s].parents=structuredClone(u).reverse(),u.length==2&&(r.stn_list[s].branch={...r.stn_list[s].branch,left:[be.through,u[1]]}),m.length!=0&&(r.stn_list[s].transfer.groups[0].lines=structuredClone(m)),[s]}},Nn=(s,l,a,n)=>{const i=structuredClone(tt);n=="LOOP"&&(i.loop=!0);let t;switch(s.getNodeAttributes(a).type){case H.GzmtrBasic:case H.GzmtrInt:t=xe.GZMTR;break;case H.MTR:t=xe.MTR;break;default:t=xe.SHMetro;break}i.theme=structuredClone(l),i.style=t,i.stn_list.linestart=structuredClone(_n),i.stn_list.lineend=structuredClone(Mn),he.clear(),gs.clear();const r=bs(a,"linestart","linestart",1,s,l,i);if(i.current_stn_idx=r[0],i.stn_list.linestart.children=[r[0]],!(Object.keys(i.stn_list).length<=3||i.stn_list.lineend.parents.length>=3))return structuredClone(i)},In=s=>{var n,i;he.clear(),ms.clear(),fs.clear(),st.clear(),ge.clear(),cs.clear(),ds.clear(),$.clear(),I=[],He=0,Le.clear(),hs.clear(),s.filterEdges(t=>t.startsWith("line")).forEach(t=>{_s(s.getEdgeAttributes(t).style)&&Rn(s,t)});let l=0;s.forEachNode(t=>{hs.set(t,++l)}),hs.set("lineend",++l);const a=[];for(const t of ms){let r=0;for(;ge.get(v(t)).size!=0;){let d="line_root";ge.get(v(t)).forEach(m=>{d=="line_root"&&(d=m)}),nt(d,"line_root",t);const u={theme:t,index:++r};cs.add(u),ds.set(u,d)}}for(const t of cs){const{theme:r}=t;he.clear(),Le.clear(),rt(ds.get(t),"line_root",r);let d=!0,u="LINE";const m=[];for(const[x,o]of Le)o==1&&m.push(x),o==3&&(u="BRANCH"),o>3&&(d=!1);if(!d)continue;m.length==0&&(u="LOOP",Le.forEach((x,o)=>{m.push(o)}));const w=[];for(const x of m){const o=Nn(s,r,x,u);o!=null&&w.push([o,(n=o.stn_list[o.current_stn_idx].localisedName.zh)!=null?n:"",(i=o.stn_list[o.current_stn_idx].localisedName.en)!=null?i:""])}w.length!=0&&a.push({id:ps(10),theme:r,param:structuredClone(w),type:u})}return a},Hn=s=>s[0]!=""&&s[1]!=""?s[0]+"_"+s[1]:s[0]!=""?s[0]:s[1]!=""?s[1]:"".concat(new Date().valueOf()),Ln=(s,l)=>{let a=s;return l.forEach((n,i)=>{const t=new RegExp("ch_".concat(i),"g"),r=new RegExp("en_".concat(i),"g");a=a.replace(t,n[0]),a=a.replace(r,n[1])}),a},Pn=(s,l,a,n)=>{s.line_name=l,s.line_num=String(a),xs("RMG_".concat(Hn(l),".json"),"application/json",Ln(JSON.stringify(s),n))},Dn={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Bn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=P(),i=b.useRef(window.graph),[t,r]=b.useState(!1),[d,u]=b.useState([[tt,"",""]]),[m,w]=b.useState(["","",""]),[x,o]=b.useState(new Map),[h,c]=b.useState(new Map),[p,g]=b.useState([]);b.useEffect(()=>{if(l){const S=In(i.current),y=new Map;S.forEach(({id:M,theme:L})=>{y.set(v(L),M)}),g(S),o(y)}},[l]);const j=(S,y)=>document.getElementById("2RMG_"+y+"_"+S).value.trim();return e.jsxs(J,{isOpen:l,onClose:a,size:"2xl",scrollBehavior:"inside",blockScrollOnMount:!1,children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:e.jsx(f,{as:"b",fontSize:"xl",children:n("header.download.2rmg.title")})}),e.jsx(q,{}),e.jsxs(X,{children:[e.jsx(f,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info1")}),e.jsx(f,{fontSize:"sm",mt:"3",lineHeight:"100%",children:n("header.download.2rmg.info2")}),e.jsx("br",{}),p.length===0?e.jsx(f,{fontSize:"md",children:n("header.download.2rmg.noline")}):e.jsx("table",{children:e.jsx("tbody",{children:p.map(({id:S,theme:y,param:M,type:L})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(Os,{name:y[0]=="other"&&y[1]=="other"?y[2]:y[1],bg:y[2],fg:y[3]})}),e.jsx("td",{children:e.jsx(ns,{placeholder:n("header.download.2rmg.placeholder.chinese"),id:"2RMG_nameCh_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(ns,{placeholder:n("header.download.2rmg.placeholder.english"),id:"2RMG_nameEn_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(ns,{placeholder:n("header.download.2rmg.placeholder.lineCode"),id:"2RMG_lineNum_".concat(S),size:"sm"})}),e.jsx("td",{children:e.jsx(Os,{name:n("header.download.2rmg.type.".concat(L.toLowerCase())),bg:Dn[L],fg:Cs.white})}),e.jsx("td",{children:e.jsx(E,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const G=j(S,"nameCh"),se=j(S,"nameEn"),pe=j(S,"lineNum"),U=new Map;x.forEach((te,ne)=>{U.set(ne,[j(te,"nameCh"),j(te,"nameEn")])}),u(M),w([G,se,pe]),c(U),r(!0)},size:"sm",children:e.jsx(Xs,{})})})]},S))})})]}),e.jsx(me,{children:e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:n("close")})})]}),e.jsx(Gn,{isOpen:t,onClose:()=>r(!1),param:d,nameList:m,interchangeName:h})]})},Gn=s=>{const{isOpen:l,onClose:a,param:n,nameList:i,interchangeName:t}=s,{t:r}=P(),[d,u]=b.useState("");return b.useEffect(()=>{i[0]!=""&&i[1]!=""?u(i[0]+"/"+i[1]):i[0]!=""?u(i[0]):i[1]!=""?u(i[1]):u("")},[...i]),e.jsxs(J,{isOpen:l,onClose:a,size:"md",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:e.jsxs(f,{as:"b",fontSize:"xl",children:[r("header.download.2rmg.download")," ",d]})}),e.jsx(q,{}),e.jsx(X,{children:e.jsxs(ht,{children:[e.jsx(f,{fontSize:"sm",mb:"2",lineHeight:"100%",children:r("header.download.2rmg.downloadInfo")}),n.map(([m,w,x])=>e.jsxs(E,{onClick:()=>{Pn(m,[i[0],i[1]],i[2],t)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[w.replaceAll("\n","⏎"),"/",x.replaceAll("\n","⏎")]},"".concat(w).concat(x)))]})}),e.jsx(me,{children:e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:r("close")})})]})]})},Wn=s=>{const{isOpen:l,onClose:a}=s,{t:n}=P();return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:n("header.download.termsAndConditions")}),e.jsx(q,{}),e.jsx(X,{children:e.jsxs(pt,{children:[e.jsxs(ye,{children:["The layout of the elements on the signage or rail map, is designed by"," ",e.jsxs(A,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",e.jsx(N,{as:R})]}),", ",e.jsxs(A,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",e.jsx(N,{as:R})]})," or ",e.jsxs(A,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",e.jsx(N,{as:R})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",e.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",e.jsxs(A,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",e.jsx(N,{as:R})]}),"，",e.jsxs(A,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",e.jsx(N,{as:R})]}),"或",e.jsxs(A,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",e.jsx(N,{as:R})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The elements including shapes and lines on the image are drawn by"," ",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(N,{as:R})]})," and ",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(N,{as:R})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",e.jsx("br",{}),"图像的元素，包括图形及线条，均由",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",e.jsx(N,{as:R})]}),"及",e.jsxs(A,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",e.jsx(N,{as:R})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),e.jsxs(ye,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",e.jsxs(A,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",e.jsx(N,{as:R})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",e.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",e.jsxs(A,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",e.jsx(N,{as:R})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),e.jsxs(ye,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",e.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),e.jsxs(ye,{children:["All flag emojis shown on Windows platforms are designed by"," ",e.jsxs(A,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(N,{as:R})]})," ","– the open-source emoji and icon project. License:",e.jsxs(A,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(N,{as:R})]}),e.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",e.jsxs(A,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",e.jsx(N,{as:R})]}),"所设计。许可证：",e.jsxs(A,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",e.jsx(N,{as:R})]})]}),e.jsxs(ye,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",e.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Un(){const s=$s("white","var(--chakra-colors-gray-800)"),l=B(),{telemetry:{project:a}}=D(k=>k.app),n=D(k=>k.param),i=T.isAllowAnalytics(),{t}=P(),r=b.useRef(window.graph),[d,u]=b.useState("png"),m={png:t("header.download.png"),svg:t("header.download.svg")},[w,x]=b.useState(2),[o,h]=b.useState({width:1,height:1,benchmark:.001}),[c,p]=b.useState(200),g=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],j=Object.fromEntries(g.map(k=>[k,"".concat(k,"%")])),[S,y]=b.useState([]),[M,L]=b.useState(!1),G=[{type:"select",label:t("header.download.format"),value:d,options:m,onChange:k=>u(k==="png"?"png":"svg")}],se=[{type:"select",label:t("header.download.svgVersion"),value:w,options:{1.1:t("header.download.svg1.1"),2:t("header.download.svg2")},onChange:k=>{x(k),k===1.1&&We(!0)}}],pe=[{type:"select",label:t("header.download.scale"),value:c,options:j,disabledOptions:S,onChange:k=>p(k)},{type:"switch",label:t("header.download.transparent"),isChecked:M,onChange:L}],[U,te]=b.useState(!1),[ne,Ge]=b.useState(!1),[Te,We]=b.useState(!1),[Ue,$e]=b.useState(!1),[Fe,O]=b.useState(!1),[it,Ve]=b.useState(!1),[at,Ms]=b.useState(!1);b.useEffect(()=>{(async()=>{const Oe=await kn.maxArea({usePromise:!0,useWorker:!0});h(Oe)})()},[]),b.useEffect(()=>{if(U&&!Rs){const{xMin:k,yMin:Oe,xMax:Xe,yMax:Re}=zt(r.current),[Qe,we]=[Xe-k,Re-Oe],Ee=g.filter(Se=>Qe*Se/100>o.width&&we*Se/100>o.height);y(Ee)}},[U]);const lt=()=>{i&&T.event(Ae.DOWNLOAD_PARAM,a?{"#nodes":r.current.order,"#edges":r.current.size}:{}),xs("RMP_".concat(new Date().valueOf(),".json"),"application/json",Mt(n))},ct=async()=>{Ve(!0),i&&T.event(Ae.DOWNLOAD_IMAGES,a?{numberOfNodes:r.current.order,numberOfEdges:r.current.size}:{});const{elem:k,width:Oe,height:Xe}=await jn(r.current,Ue,Te,w),Re=k.outerHTML.replace(/&nbsp;/g," ");if(d==="svg"){xs("RMP_".concat(new Date().valueOf(),".svg"),"image/svg+xml",Re),Ve(!1);return}if(Rs){window.parent.__TAURI__.core.invoke("render_image",{svgString:Re,scale:c,isTransparent:M,isSystemFontsUsed:Te}).then(ts=>Ve(!1));return}document.body.appendChild(k);const Qe="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(Re)));document.body.removeChild(k),k.remove();const we=document.createElement("canvas"),[Ee,Se]=[Oe*c/100,Xe*c/100];we.width=Ee,we.height=Se;const es=we.getContext("2d");M||(es.fillStyle=s,es.fillRect(0,0,Ee,Se));const ss=new Image;ss.onload=()=>{setTimeout(()=>{es.drawImage(ss,0,0,Ee,Se),we.toBlob(ts=>{if(Ve(!1),!ts){l(Ke({status:"error",message:t("header.download.imageTooBig")}));return}bn("RMP_".concat(new Date().valueOf(),".png"),ts)},"image/png")},wn()?2e3:0)},ss.src=Qe};return e.jsxs(ws,{id:"download",children:[e.jsx(Ss,{as:Q,size:"sm",variant:"ghost",icon:e.jsx(Xs,{})}),e.jsxs(ys,{children:[e.jsx(de,{icon:e.jsx(vt,{}),onClick:lt,children:t("header.download.config")}),e.jsxs(de,{icon:e.jsx(kt,{}),onClick:()=>Ms(!0),children:[t("header.download.2rmg.title"),e.jsx(ce,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(de,{icon:e.jsx(_t,{}),onClick:()=>te(!0),children:t("header.download.image")})]}),e.jsxs(J,{size:"xl",isOpen:U,onClose:()=>te(!1),children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:t("header.download.image")}),e.jsx(q,{}),e.jsxs(X,{children:[e.jsx(_e,{fields:G}),d==="svg"&&e.jsx(_e,{fields:se}),d==="png"&&e.jsx(_e,{fields:pe}),d==="png"&&S.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(f,{as:"i",fontSize:"sm",children:t("header.download.disabledScaleOptions")}),e.jsx("br",{}),e.jsx(f,{as:"i",fontSize:"sm",children:t("header.download.disabledScaleOptionsWorkarounds")}),e.jsxs(A,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",e.jsx(N,{as:R})]}),e.jsx("br",{})]}),e.jsx("br",{}),e.jsx(rs,{isChecked:Te,isDisabled:d==="svg"&&w===1.1,onChange:k=>We(k.target.checked),children:e.jsx(f,{children:t("header.download.useSystemFonts")})}),e.jsx(rs,{isChecked:Ue,onChange:k=>$e(k.target.checked),children:e.jsxs(f,{children:[t("header.download.shareInfo1"),e.jsxs(A,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[t("header.about.rmp")," ",e.jsx(N,{as:R})]}),t("header.download.shareInfo2")]})}),e.jsx(rs,{isChecked:Fe,onChange:k=>O(k.target.checked),children:e.jsxs(f,{children:[t("header.download.termsAndConditionsInfo"),e.jsxs(A,{color:"teal.500",onClick:()=>Ge(!0),children:[t("header.download.termsAndConditions")," ",e.jsx(N,{as:R})]}),t("header.download.period")]})})]}),e.jsx(me,{children:e.jsx(ut,{children:e.jsx(E,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!Fe||d==="png"&&S.includes(c),isLoading:it,onClick:ct,children:t("header.download.confirm")})})}),e.jsx(Wn,{isOpen:ne,onClose:()=>Ge(!1)})]})]}),e.jsx(Bn,{isOpen:at,onClose:()=>Ms(!1)})]})}const $n=(s,{info_panel_type:l,line_num:a,stn_list:n,style:i,theme:t},r,d,u)=>{const m=Object.fromEntries(Object.keys(n).filter(o=>!["linestart","lineend"].includes(o)).map(o=>[o,"stn_".concat(ps(10))]));Object.entries(n).filter(([o,h])=>!["linestart","lineend"].includes(o)).forEach(([o,h])=>{const c=s.filterNodes((p,g)=>Object.values(H).includes(g.type)&&g[g.type].names[0]===h.localisedName.zh);c.length!==0&&(m[o]=c[0])});const w=[["linestart",-1,0]],x={};for(;w.length;){const[o,h,c]=w.shift();n[o].children.filter(g=>g!="lineend").forEach((g,j)=>{const S=Math.max(j,c+j);x[g]={x:h*150,y:S*75},w.push([g,h+1,S])})}Object.entries(n).filter(([o,h])=>!["linestart","lineend"].includes(o)).filter(([o,h])=>s.filterNodes((c,p)=>Object.values(H).includes(p.type)&&p[p.type].names[0]===h.localisedName.zh).length===0).map(([o,h])=>{var S,y,M;let c=H.ShmetroBasic;const p=h.transfer.groups,g=p.map(L=>{var G;return(G=L.lines)!=null?G:[]}).flat();i===xe.SHMetro?g.length>0?c=H.ShmetroInt:l===ks.sh2020?c=H.ShmetroBasic2020:c=H.ShmetroBasic:i===xe.GZMTR?g.length>0?c=H.GzmtrInt:c=H.GzmtrBasic:i===xe.MTR&&(c=H.MTR);const j={...structuredClone(Sn[c].defaultAttrs),names:[(S=h.localisedName.zh)!=null?S:"",(y=h.localisedName.en)!=null?y:""]};return c===H.ShmetroBasic2020?j.color=t:c===H.GzmtrBasic?(j.color=t,j.lineCode=a,j.stationCode=h.num):c===H.GzmtrInt?j.transfer=p.map((L,G)=>{var pe,U;const se=(U=(pe=L.lines)==null?void 0:pe.map(te=>{var ne;return[...(ne=te.theme)!=null?ne:t,"1","01"]}))!=null?U:[];return G===0?[[...t,a,h.num],...se]:se}):c===H.MTR&&((M=p[0].lines)!=null&&M.length?j.transfer=[[[...t,"",""],...p[0].lines.map(L=>{var G;return[...(G=L.theme)!=null?G:t,"",""]})]]:j.transfer=[[]]),{node:m[o],attr:{visible:!0,zIndex:0,x:r+x[o].x,y:d+x[o].y,type:c,[c]:j}}}).forEach(({node:o,attr:h})=>s.addNode(o,h)),Object.entries(n).filter(([o,h])=>!["linestart","lineend"].includes(o)).forEach(([o,h])=>{h.children.filter(c=>!["linestart","lineend"].includes(c)).forEach(c=>{const p=os.Diagonal,[g,j]=[m[o],m[c]],S=u?At(s,p,g,j,"from"):-1;s.addDirectedEdgeWithKey("line_".concat(ps(10)),g,j,{visible:!0,zIndex:0,type:p,[os.Diagonal]:structuredClone(Tt[os.Diagonal].defaultAttrs),style:Es.SingleColor,[Es.SingleColor]:{color:t},reconcileId:"",parallelIndex:S})})})},Fn="rmg-bridge--",Vn={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Jn(s){const{isOpen:l,onClose:a}=s,{t:n}=P(),{preference:{autoParallel:i}}=D(j=>j.app),{svgViewBoxZoom:t,svgViewBoxMin:r}=D(j=>j.param),d=B(),u=T.isAllowAnalytics(),m=zs(),{height:w,width:x}=vs(m),o=Ye.useRef(window.graph),[h]=Ye.useState(crypto.randomUUID()),c="/rmg/#/import?"+new URLSearchParams({parentComponent:T.getAppName(),parentId:h}),p=Ye.useCallback(()=>{d(V()),d(F()),d(ee(o.current.export()))},[d,V,F,ee,o]),g=j=>{try{u&&T.event(Ae.IMPORT_RMG_PARAM,{});const S=r.x+x*t/100/3,y=r.y+w*t/100/3;$n(o.current,j,S,y,i),p()}catch(S){d(Ke({status:"error",message:n("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",S)}finally{a()}};return Ye.useEffect(()=>{const j=new BroadcastChannel(Fn+h);return j.onmessage=S=>{const{event:y,data:M}=S.data;console.log("[rmp] Received event from RMG app clip:",y),y==="CLOSE"?a():y==="IMPORT"&&g(M)},()=>j.close()},[r.x,r.y,t,w,x,i]),e.jsx(Qs,{isOpen:l,onClose:a,sx:Vn,children:e.jsx("iframe",{src:c,loading:"lazy"})})}const Yn="RMP_GALLERY_CHANNEL",Zn="OPEN_TEMPLATE",Gs=new BroadcastChannel(Yn),Kn={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function qn(s){const{isOpen:l,onClose:a}=s,n=Fs(),{t:i}=P(),t=B(),{telemetry:{project:r}}=D(o=>o.app),d=T.isAllowAnalytics(),u=b.useRef(window.graph),m=b.useCallback(()=>{t(V()),t(F()),t(ee(u.current.export()))},[t,V,F,ee,u]),w=async o=>{const{version:h,...c}=JSON.parse(await et(JSON.stringify(o)));t(us()),u.current.clear(),u.current.import(c.graph),m();const{svgViewBoxZoom:p,svgViewBoxMin:g}=c;typeof p=="number"&&t(Me(p)),typeof g.x=="number"&&typeof g.y=="number"&&t(Pe(g))},x=async(o,h)=>{var g;const c=h?"https://".concat(h):"",p=await((g=(await Promise.allSettled([fetch("".concat(c,"/rmp-gallery/resources/real_world/").concat(o,".json")),fetch("".concat(c,"/rmp-gallery/resources/fantasy/").concat(o,".json"))])).filter(j=>j.status==="fulfilled").find(j=>j.value.status===200))==null?void 0:g.value.json());if(p){if(d){const j={id:o};r&&h&&(j.host=h),T.event(Ae.IMPORT_WORK_FROM_GALLERY,j)}w(p),n({title:i("header.open.importFromRMPGallery",{id:o}),status:"success",duration:9e3,isClosable:!0})}else n({title:i("header.open.failToImportFromRMPGallery",{id:o}),status:"error",duration:9e3,isClosable:!0});T.updateAppMetadata({hash:""})};return b.useEffect(()=>{const h=new URL(window.location.href).searchParams;if(h.size>0){const c=h.keys().next().value,p=c.indexOf("."),g=c.substring(0,p===-1?void 0:p);let j;p!==-1&&(j=c.substring(p+1)),x(g,j)}},[]),b.useEffect(()=>(Gs.onmessage=o=>{const{event:h,data:c}=o.data;h===Zn&&(x(c),a())},()=>Gs.close()),[]),e.jsxs(Qs,{isOpen:l,onClose:a,size:"full",sx:Kn,children:[e.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),e.jsx(Vs,{onClick:a,position:"fixed",top:"5px",right:"15px"})]})}function Xn(){const s=B(),{t:l}=P(),a=zs(),{height:n}=vs(a),i=b.useRef(window.graph),t=b.useRef(null),[r,d]=b.useState(!1),[u,m]=b.useState(!1),w=b.useCallback(()=>{s(V()),s(F()),s(ee(i.current.export()))},[s,V,F,ee,i]),x=()=>{s(us()),i.current.clear(),s(Me(100)),s(Pe({x:0,y:0})),w()},o=async p=>{const{version:g,...j}=JSON.parse(await et(p));s(us()),i.current.clear(),i.current.import(j.graph),w();const{svgViewBoxZoom:S,svgViewBoxMin:y}=j;typeof S=="number"&&s(Me(S)),typeof y.x=="number"&&typeof y.y=="number"&&s(Pe(y))},h=async p=>{var j;const g=(j=p.target.files)==null?void 0:j[0];if(console.log("OpenActions.handleUpload():: received file",g),(g==null?void 0:g.type)!=="application/json")s(Ke({status:"error",message:l("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const S=await Qn(g);await o(S)}catch(S){s(Ke({status:"error",message:l("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",S)}p.target.value=""},c=async()=>{await o(await Nt()),s(Pe({x:-10,y:-13}));const p=Math.max(0,Math.min(400,-.132*n+117.772));s(Me(p)),T.event(Ae.LOAD_TUTORIAL,{})};return b.useEffect(()=>{const p=async g=>{const{type:j,key:S,from:y}=g.data;if(j===It.SAVE_CHANGED&&S===Hs.PARAM&&y==="rmt"){Ht.debug("Received save changed event on key: ".concat(S));const M=localStorage.getItem(Hs.PARAM);if(!M)return;await o(M)}};return Ns.addEventListener("message",p),()=>Ns.removeEventListener("message",p)},[]),e.jsxs(ws,{children:[e.jsx(Ss,{as:Q,size:"sm",variant:"ghost",icon:e.jsx(Is,{})}),e.jsxs(ys,{children:[e.jsx(de,{icon:e.jsx(Ot,{}),onClick:x,children:l("header.open.new")}),e.jsx("input",{id:"upload_project",ref:t,type:"file",accept:".json",hidden:!0,onChange:h,"data-testid":"file-upload"}),e.jsx(de,{icon:e.jsx(Is,{}),onClick:()=>{var p;return(p=t==null?void 0:t.current)==null?void 0:p.click()},children:l("header.open.config")}),e.jsx(de,{icon:e.jsx(Rt,{}),onClick:()=>d(!0),children:l("header.open.projectRMG")}),e.jsxs(de,{icon:e.jsx(R,{}),onClick:()=>m(!0),children:[l("header.open.gallery"),e.jsx(ce,{ml:"1",colorScheme:"green",children:"New"})]}),e.jsx(de,{icon:e.jsx(Et,{}),onClick:c,children:l("header.open.tutorial")})]}),e.jsx(Jn,{isOpen:r,onClose:()=>d(!1)}),e.jsx(qn,{isOpen:u,onClose:()=>m(!1)})]})}const Qn=s=>new Promise(l=>{const a=new FileReader;a.onloadend=()=>l(a.result),a.readAsText(s)}),er=()=>{const[s,l]=b.useState(!1),{t:a}=P(),n=B(),i=b.useRef(window.graph),t=zs(),{width:r,height:d}=vs(t),[u,m]=b.useState([]);b.useEffect(()=>{s&&m(i.current.nodes().filter(x=>x.startsWith("stn")).map(x=>{const o=i.current.getNodeAttributes(x),h=o.type,c=o[h].names.join("/");return{id:x,value:c}}))},[s]);const w=x=>{n(Bt(new Set([x])));const o=Math.max(0,Math.min(400,-.132*d+117.772)),{x:h,y:c}=Gt((r-300)/2,d/2,o,{x:-i.current.getNodeAttribute(x,"x"),y:-i.current.getNodeAttribute(x,"y")});n(Me(o)),n(Pe({x:-h,y:-c}))};return e.jsxs(Js,{isOpen:s,onOpen:()=>l(!0),onClose:()=>l(!1),children:[e.jsx(Ys,{children:e.jsx(Q,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Lt,{}),onClick:()=>l(!s)})}),e.jsx(Zs,{children:e.jsx(Ks,{children:e.jsx(Pt,{label:a("header.search"),children:e.jsx(Dt,{data:u,displayHandler:x=>e.jsx(ce,{children:x.value}),filter:(x,o)=>o.value.toLowerCase().includes(x.toLowerCase())||Object.values(o.value).some(h=>h.toLowerCase().includes(x.toLowerCase())),value:"",onChange:x=>w(x.id)})})})})]})},sr=s=>{const{isOpen:l,onClose:a}=s,n=B(),{t:i}=P(),t=b.useRef(window.graph),{theme:r,requestThemeChange:d}=Wt(),u=()=>{t.current.filterEdges((m,w,x,o,h,c,p)=>qs.has(w.style)&&JSON.stringify(w[w.style].color)===JSON.stringify(r)).forEach(m=>t.current.dropEdge(m)),n(F()),n(ee(t.current.export())),a()};return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:i("header.settings.procedures.removeLines.title")}),e.jsx(q,{}),e.jsxs(X,{children:[i("header.settings.procedures.removeLines.content"),e.jsx(Ut,{theme:r,onClick:d})]}),e.jsxs(me,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:i("cancel")}),e.jsx(E,{colorScheme:"red",onClick:u,children:i("remove")})]})]})]})},tr=s=>{const{isOpen:l,onClose:a}=s,n=B(),{t:i}=P(),t=b.useRef(window.graph),[r,d]=b.useState(1),u=[{type:"input",label:i("header.settings.procedures.scale.factor"),value:r.toString(),variant:"number",onChange:w=>d(Number(w)),minW:"full"}],m=()=>{t.current.forEachNode((w,x)=>{t.current.updateNodeAttribute(w,"x",o=>(o!=null?o:0)*r),t.current.updateNodeAttribute(w,"y",o=>(o!=null?o:0)*r)}),n(V()),n(F()),n(ee(t.current.export())),a()};return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:i("header.settings.procedures.scale.title")}),e.jsx(q,{}),e.jsxs(X,{children:[i("header.settings.procedures.scale.content"),e.jsx(_e,{fields:u})]}),e.jsxs(me,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:i("cancel")}),e.jsx(E,{colorScheme:"red",onClick:m,children:i("apply")})]})]})]})},nr=s=>{const{isOpen:l,onClose:a}=s,n=B(),{t:i}=P(),t=b.useRef(window.graph),[r,d]=b.useState(0),[u,m]=b.useState(0),w=[{type:"input",label:i("header.settings.procedures.translate.x"),value:r.toString(),variant:"number",onChange:o=>d(Number(o)),minW:"full"},{type:"input",label:i("header.settings.procedures.translate.y"),value:u.toString(),variant:"number",onChange:o=>m(Number(o)),minW:"full"}],x=()=>{t.current.forEachNode((o,h)=>{t.current.updateNodeAttribute(o,"x",c=>(c!=null?c:0)+r),t.current.updateNodeAttribute(o,"y",c=>(c!=null?c:0)+u)}),n(V()),n(F()),n(ee(t.current.export())),a()};return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:i("header.settings.procedures.translate.title")}),e.jsx(q,{}),e.jsxs(X,{children:[i("header.settings.procedures.translate.content"),e.jsx(_e,{fields:w})]}),e.jsxs(me,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:i("cancel")}),e.jsx(E,{colorScheme:"red",onClick:x,children:i("apply")})]})]})]})},rr=s=>{const{isOpen:l,onClose:a}=s,n=B(),{preference:{unlockSimplePathAttempts:i}}=D(u=>u.app),{activeSubscriptions:t}=D(u=>u.account),{t:r}=P(),d=()=>{n($t(-1))};return e.jsxs(J,{isOpen:l,onClose:a,size:"5xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:r("header.settings.procedures.unlockSimplePath.title")}),e.jsx(q,{}),e.jsxs(X,{children:[e.jsx(f,{mb:"2",children:r("header.settings.procedures.unlockSimplePath.content1")}),e.jsx(f,{mb:"2",children:r("header.settings.procedures.unlockSimplePath.content2")}),e.jsx(f,{mb:"2",children:r("header.settings.procedures.unlockSimplePath.content3")})]}),e.jsx(me,{children:e.jsx(ve,{label:r("header.settings.pro"),isOpen:!t.RMP_CLOUD&&i>=0,children:e.jsx(E,{onClick:d,isDisabled:!t.RMP_CLOUD||i<0,children:i>=0?r("header.settings.procedures.unlockSimplePath.check"):r("header.settings.procedures.unlockSimplePath.unlocked")})})})]})]})},or=s=>{const{isOpen:l,onClose:a}=s,n=B(),i=Fs(),{t}=P(),r=b.useRef(window.graph),[d,u]=b.useState(!1),m=async()=>{u(!0);const w=JSON.stringify(r.current.export());try{const x=await lr(w);r.current.clear(),r.current.import(x),n(V()),n(F()),n(ee(r.current.export())),i({title:t("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(x){console.error("[rmp] Error in updating all colors: ".concat(x)),i({title:t("header.settings.procedures.updateColor.error",{e:x}),status:"error",duration:9e3,isClosable:!0})}u(!1),a()};return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:t("header.settings.procedures.updateColor.title")}),e.jsx(q,{}),e.jsx(X,{children:e.jsx(f,{children:t("header.settings.procedures.updateColor.content")})}),e.jsxs(me,{children:[e.jsx(E,{colorScheme:"blue",variant:"outline",mr:"1",onClick:a,children:t("cancel")}),e.jsx(E,{colorScheme:"red",onClick:m,isLoading:d,children:t("apply")})]})]})]})},Ws=s=>s.length>=4&&s.every(l=>typeof l=="string")&&!!s[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(Cs).includes(s[3]),ir=s=>{const l=[],a=(n,i)=>{if(Array.isArray(n)&&Ws(n)){l.push({path:i||"",value:n});return}for(const t in n){const r=n[t],d=i?"".concat(i,".").concat(t):t;Array.isArray(r)?Ws(r)?l.push({path:d,value:r}):r.forEach((u,m)=>a(u,"".concat(d,".").concat(m))):r&&typeof r=="object"&&a(r,d)}};return a(s),l},ar=(s,l,a)=>{const n=l.split(".");let i=s;for(let t=0;t<n.length-1;t++)i=i[n[t]];i[n[n.length-1]]=a},lr=async s=>{const l=JSON.parse(s),a=new Date().getTime(),n=ir(l);console.log("[rmp] Found all themes pending for update",n);const i=1e4;let t,r=!1;const d=new Promise((u,m)=>{t=setTimeout(()=>{r=!0,m("Executing time exceeds ".concat(i,"ms"))},i),(async()=>{for(const{path:w,value:x}of n){if(r)throw new Error("Update aborted");const[o,h,c,p,...g]=x,j=await Ft([o,h,c,p]);ar(l,w,[...j,...g])}})().then(u).catch(m)});try{return await d,console.log("[rmp] Themes update completed, elapsed time ".concat((new Date().getTime()-a)/1e3," sec")),l}finally{clearTimeout(t)}},Us=1,cr=()=>{const s=B(),{state:l,token:a}=D(p=>p.account),{count:{stations:n,miscNodes:i,masters:t,lines:r,parallel:d}}=D(p=>p.runtime),{t:u}=P(),[m,w]=b.useState(!1),[x,o]=b.useState(Us);b.useEffect(()=>{let p;return m&&x>0?p=window.setTimeout(()=>{o(x-1)},1e3):x===0&&w(!1),()=>clearTimeout(p)},[m,x]);const h=()=>{w(!0),o(Us),a&&Jt(s,a)},c={"logged-out":u("header.settings.status.subscription.logged-out"),free:u("header.settings.status.subscription.free"),subscriber:u("header.settings.status.subscription.subscriber"),expired:u("header.settings.status.subscription.expired")};return e.jsxs(z,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:u("header.settings.status.title")}),e.jsxs(z,{mt:"3",children:[e.jsxs(z,{mb:"1",children:[e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.stations")}),e.jsx(f,{children:n})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.miscNodes")}),e.jsx(f,{children:i})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.masters")}),e.jsx(f,{children:t})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.lines")}),e.jsx(f,{children:r})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:u("header.settings.status.count.parallel")}),e.jsx(f,{children:d})]})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsxs(f,{flex:"1",children:[u("header.settings.status.subscription.content")," ",c[l]]}),e.jsx(Q,{"aria-label":"refresh",variant:"ghost",size:"sm",icon:e.jsx(Vt,{}),isDisabled:m,onClick:()=>h()})]})]})]})},je={width:"100%",justifyContent:"space-between"},le={fontFamily:"-apple-system"},dr=s=>{const{isOpen:l,onClose:a}=s,{activeSubscriptions:n}=D(O=>O.account),{telemetry:{project:i},preference:{autoParallel:t,randomStationsNames:r,gridLines:d,snapLines:u}}=D(O=>O.app),{keepLastPath:m,count:{parallel:w}}=D(O=>O.runtime),x=B(),{t:o}=P(),h=$s("primary.500","primary.300"),[c,p]=b.useState(!1),[g,j]=b.useState(!1),[S,y]=b.useState(!1),[M,L]=b.useState(!1),[G,se]=b.useState(!1),[pe,U]=b.useState(!1),[te,ne]=b.useState(!1),Ge=T.isAllowAnalytics(),Te=O=>{x(on(O))},We=n.RMP_CLOUD?Yt:Zt,Ue=w>=We,$e=!n.RMP_CLOUD,Fe=O=>{x(rn(O.target.value))};return e.jsxs(J,{isOpen:l,onClose:a,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[e.jsx(Y,{}),e.jsxs(Z,{children:[e.jsx(K,{children:o("header.settings.title")}),e.jsx(q,{}),e.jsx(X,{children:e.jsxs(Ie,{divider:e.jsx(jt,{borderColor:"gray.200"}),children:[e.jsx(cr,{}),e.jsxs(z,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:o("header.settings.preference.title")}),e.jsxs(z,{mt:"3",children:[e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:o("header.settings.preference.keepLastPath")}),e.jsx(Ce,{isChecked:m,onChange:({target:{checked:O}})=>x(Kt(O))})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{children:o("header.settings.preference.autoParallel")}),e.jsx(ce,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ve,{label:o("header.settings.proWithTrial"),children:e.jsx(ce,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsx(Ce,{ml:"1",isDisabled:Ue,isChecked:t,onChange:({target:{checked:O}})=>x(qt(O))})]}),e.jsxs(z,{mb:"1",display:"flex",children:[e.jsx(f,{flex:"1",children:o("header.settings.preference.randomStationNames.title")}),e.jsx(ce,{ml:"auto",colorScheme:"green",children:"New"}),e.jsx(ve,{label:o("header.settings.pro"),children:e.jsx(ce,{color:"gray.50",ml:"1",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})}),e.jsxs(xt,{size:"xs",width:"auto",ml:"1",value:r,onChange:Fe,children:[e.jsx("option",{value:"none",children:o("header.settings.preference.randomStationNames.none")}),e.jsx("option",{value:Je.Shmetro,disabled:$e,children:o("header.settings.preference.randomStationNames.".concat(Je.Shmetro))}),e.jsx("option",{value:Je.Bjsubway,disabled:$e,children:o("header.settings.preference.randomStationNames.".concat(Je.Bjsubway))})]})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:o("header.settings.preference.gridline")}),e.jsx(Ce,{isChecked:d,onChange:({target:{checked:O}})=>x(Xt(O))})]}),e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:o("header.settings.preference.snapline")}),e.jsx(Ce,{isChecked:u,onChange:({target:{checked:O}})=>x(Qt(O))})]})]})]}),e.jsxs(z,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:o("header.settings.procedures.title")}),e.jsxs(z,{mt:"3",children:[e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>p(!0),children:o("header.settings.procedures.translate.title")}),e.jsx(nr,{isOpen:c,onClose:()=>p(!1)}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>j(!0),children:o("header.settings.procedures.scale.title")}),e.jsx(tr,{isOpen:g,onClose:()=>j(!1)}),e.jsxs(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>y(!0),children:[o("header.settings.procedures.changeType.title"),e.jsx(ve,{label:o("header.settings.pro"),children:e.jsx(ce,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(Cn,{isOpen:S,onClose:()=>y(!1),isSelect:!1}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>L(!0),children:o("header.settings.procedures.removeLines.title")}),e.jsx(sr,{isOpen:M,onClose:()=>L(!1)}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>se(!0),children:o("header.settings.procedures.updateColor.title")}),e.jsx(or,{isOpen:G,onClose:()=>se(!1)}),e.jsxs(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>U(!0),children:[o("header.settings.procedures.unlockSimplePath.title"),e.jsx(ve,{label:o("header.settings.pro"),children:e.jsx(ce,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),e.jsx(rr,{isOpen:pe,onClose:()=>U(!1)}),e.jsx(E,{sx:je,rightIcon:e.jsx(fe,{}),onClick:()=>ne(!0),children:o("header.settings.procedures.masterManager.title")}),e.jsx(yn,{isOpen:te,onClose:()=>ne(!1)})]})]}),e.jsxs(z,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:o("header.settings.shortcuts.title")}),e.jsx(z,{mt:"3",children:e.jsxs(gt,{children:[e.jsx(mt,{children:e.jsxs(W,{children:[e.jsx(Ts,{children:o("header.settings.shortcuts.keys")}),e.jsx(Ts,{children:o("header.settings.shortcuts.description")})]})}),e.jsxs(ft,{children:[e.jsxs(W,{children:[e.jsx(_,{children:e.jsx(C,{children:"f"})}),e.jsx(_,{children:o("header.settings.shortcuts.f")})]}),e.jsxs(W,{children:[e.jsx(_,{children:e.jsx(C,{children:"s"})}),e.jsx(_,{children:o("header.settings.shortcuts.s")})]}),e.jsxs(W,{children:[e.jsx(_,{children:e.jsxs(z,{display:"flex",flexDirection:"row",children:[e.jsx(en,{}),e.jsx(sn,{}),e.jsx(tn,{}),e.jsx(nn,{})]})}),e.jsx(_,{children:o("header.settings.shortcuts.arrows")})]}),e.jsxs(W,{children:[e.jsx(_,{children:e.jsxs(z,{display:"flex",flexDirection:"row",children:[e.jsx(C,{children:"i"}),e.jsx(C,{children:"j"}),e.jsx(C,{children:"k"}),e.jsx(C,{children:"l"})]})}),e.jsx(_,{children:o("header.settings.shortcuts.ijkl")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsx(C,{sx:le,children:"⇧"}):e.jsx(C,{children:"shift"})}),e.jsx(_,{children:o("header.settings.shortcuts.shift")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsx(C,{sx:le,children:"⌥"}):e.jsx(C,{children:"alt"})}),e.jsx(_,{children:o("header.settings.shortcuts.alt")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsx(C,{sx:le,children:"⌫"}):e.jsx(C,{children:"delete"})}),e.jsx(_,{children:o("header.settings.shortcuts.delete")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(C,{sx:le,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"x"})]}),e.jsx(_,{children:o("header.settings.shortcuts.cut")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(C,{sx:le,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"c"})]}),e.jsx(_,{children:o("header.settings.shortcuts.copy")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(C,{sx:le,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"v"})]}),e.jsx(_,{children:o("header.settings.shortcuts.paste")})]}),e.jsxs(W,{children:[e.jsxs(_,{children:[ue?e.jsx(C,{sx:le,children:"⌘"}):e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"z"})]}),e.jsx(_,{children:o("header.settings.shortcuts.undo")})]}),e.jsxs(W,{children:[e.jsx(_,{children:ue?e.jsxs(e.Fragment,{children:[e.jsx(C,{sx:le,children:"⇧"})," + ",e.jsx(C,{sx:le,children:"⌘"})," + ",e.jsx(C,{children:"z"})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{children:"ctrl"})," + ",e.jsx(C,{children:"y"})]})}),e.jsx(_,{children:o("header.settings.shortcuts.redo")})]})]})]})})]}),e.jsxs(z,{width:"100%",mb:"3",children:[e.jsx(f,{as:"b",fontSize:"xl",children:o("header.settings.telemetry.title")}),e.jsxs(z,{mt:"3",children:[e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.info")}),e.jsxs(z,{mt:"3",mb:"1",children:[e.jsxs(z,{display:"flex",mb:"1",children:[e.jsx(f,{flex:"1",children:o("header.settings.telemetry.essential")}),e.jsx(ve,{label:o("header.settings.telemetry.essentialTooltip"),children:e.jsx(Ce,{isChecked:Ge,isDisabled:!0})})]}),e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.essentialInfo")}),e.jsxs(A,{color:h,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[o("header.settings.telemetry.essentialLink")," ",e.jsx(N,{as:R})]})]}),e.jsxs(z,{mt:"1",mb:"1",children:[e.jsxs(z,{display:"flex",children:[e.jsx(f,{flex:"1",children:o("header.settings.telemetry.additional")}),e.jsx(Ce,{isChecked:i,onChange:({target:{checked:O}})=>Te(O)})]}),e.jsx(f,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:o("header.settings.telemetry.additionalInfo")})]})]})]})]})})]})]})},hr=()=>{const[s,l]=b.useState(!1),{svgViewBoxZoom:a}=D(t=>t.param),n=B(),i=[{type:"slider",label:"",value:400-a,min:10,max:390,step:1,onChange:t=>n(Me(400-t)),leftIcon:e.jsx(an,{}),rightIcon:e.jsx(Ls,{}),minW:160}];return e.jsxs(Js,{isOpen:s,onOpen:()=>l(!0),onClose:()=>l(!1),children:[e.jsx(Ys,{children:e.jsx(Q,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:e.jsx(Ls,{}),onClick:()=>l(!s)})}),e.jsx(Zs,{children:e.jsx(Ks,{children:e.jsx(_e,{fields:i,noLabel:!0})})})]})};function pr(){const{t:s}=P(),l=B(),{past:a,future:n}=D(c=>c.param),i=T.isAllowAnalytics(),[t,r]=b.useState(!1),[d,u]=b.useState(!1),m=Ds(T.getEnv),w=Ds(T.getAppVersion);b.useEffect(()=>{i&&m!==is.DEV&&T.event(Ae.APP_LOAD,{isStandaloneWindow:T.isStandaloneWindow()})},[m]);const x=c=>{T.getI18nInstance().changeLanguage(c)},o=()=>{l(gn()),l(V()),l(F())},h=()=>{l(mn()),l(V()),l(F())};return e.jsxs(ln,{children:[e.jsx(ze,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:s("header.about.rmp")}),e.jsx(cn,{environment:m,version:w,popoverHeader:m===is.PRD?void 0:e.jsxs(Ps,{i18nKey:"header.popoverHeader",environment:m,children:["You're on ",{environment:m}," environment!"]}),popoverBody:m===is.PRD?void 0:e.jsx(Ps,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),e.jsxs(bt,{ml:"auto",children:[e.jsx(ae,{children:e.jsx(er,{})}),e.jsx(ae,{children:e.jsx(Q,{size:"sm",variant:"ghost","aria-label":"Undo",icon:e.jsx(dn,{}),isDisabled:a.length===0,onClick:o})}),e.jsx(ae,{children:e.jsx(Q,{size:"sm",variant:"ghost","aria-label":"Redo",icon:e.jsx(hn,{}),isDisabled:n.length===0,onClick:h})}),e.jsx(ae,{children:e.jsx(hr,{})}),e.jsx(ae,{children:e.jsx(Xn,{})}),e.jsx(ae,{children:e.jsx(Un,{})}),T.isStandaloneWindow()&&e.jsx(ae,{children:e.jsxs(ws,{children:[e.jsx(Ss,{as:Q,icon:e.jsx(pn,{}),variant:"ghost",size:"sm"}),e.jsx(ys,{children:["en","zh-Hans","zh-Hant","ja","ko"].map(c=>e.jsx(de,{onClick:()=>x(c),children:zn[c][c]},c))})]})}),e.jsx(ae,{children:e.jsx(Q,{size:"sm",variant:"ghost","aria-label":"Settings",icon:e.jsx(un,{}),onClick:()=>r(!0)})}),e.jsx(ae,{children:e.jsx(Q,{size:"sm",variant:"ghost","aria-label":"Help",icon:e.jsx(xn,{}),onClick:()=>u(!0)})})]}),e.jsx(dr,{isOpen:t,onClose:()=>r(!1)}),e.jsx(vn,{isOpen:d,onClose:()=>u(!1)})]})}function ur(){const s=B(),l=D(n=>n.runtime.globalAlerts),a=n=>{T.isStandaloneWindow()?window.open("/".concat(n),"_blank"):T.openApp({appId:n})};return e.jsx(e.Fragment,{children:Object.entries(l).map(([n,{message:i,url:t,linkedApp:r}])=>e.jsxs(wt,{status:n,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[e.jsx(St,{}),r?e.jsx(A,{onClick:()=>a(r),children:i}):t?e.jsx(A,{href:t,target:"_blank",children:i}):i,e.jsx(Vs,{ml:"auto",onClick:()=>s(fn(n))})]},n))})}function br(){return e.jsxs(e.Fragment,{children:[e.jsx(pr,{}),e.jsx(ur,{})]})}export{br as default};
