import{a as pe,j as h,P as xe,B as ee,D as Yt,ad as me,a2 as be}from"./chakra-BxerOT8W.js";import{c as It,e as st,a7 as Wt,z as ne,ay as Rt,az as Se,aA as se,a4 as oe,w as _t,x as wt,y as Pt,F as Et,Y as xt,aB as K,X as At,aC as Ot,p as Lt,aD as Xt,aE as re,L as at,aF as St,aG as gt,aH as Ft,n as Ct,aI as ve,d as ie,r as jt,E as Dt,q as it,aJ as Nt,aK as we,aL as Pe,aM as Ae,aN as Bt,t as ae,v as ce,aO as vt,aP as Vt,aQ as Kt,o as le,aR as ke,S as Me,aS as Ce,aT as _e,aU as Ee,aV as je,ag as Mt,H as Tt,av as De,aw as Ne,a9 as ze,G as Ut,a5 as Le}from"./index-DT9yq7pX.js";import{s as mt,f as de,g as Ie,c as Te,e as $e,h as Be,j as We,k as Re,l as Oe}from"./master-manager-SbCIt9X7.js";import{d as L,k as ue,u as Xe}from"./react-ZsH9lcJo.js";import{u as R,e as Ht,i as he}from"./clipboard-CBGTgr8t.js";import{v as Fe,m as zt}from"./misc-nodes-By164nF1.js";const He={[Wt.Shmetro]:[{"zh-Hans":"安徽南路",en:"South Anhui Road"},{"zh-Hans":"广西西路",en:"West Guangxi Road"},{"zh-Hans":"西藏东路",en:"East Xizang Road"},{"zh-Hans":"湖北北路",en:"North Hubei Road"},{"zh-Hans":"吉林中路",en:"Central Jilin Road"},{"zh-Hans":"乌镇大道",en:"Wuzhen Avenue"},{"zh-Hans":"龙溪公路",en:"Longxi Highway"},{"zh-Hans":"抚顺公园",en:"Fushun Park"},{"zh-Hans":"七星新城",en:"Qixing New Town"},{"zh-Hans":"千灯机场",en:"Qiandeng Airport"},{"zh-Hans":"震泽",en:"Zhengze"},{"zh-Hans":"沧浪高科园区",en:"Canglang High-Tech Park"},{"zh-Hans":"黎里",en:"Lili"},{"zh-Hans":"娄塘新村",en:"Loutang Xincun"},{"zh-Hans":"建设新村",en:"Jianshe Xincun"}],[Wt.Bjsubway]:[{"zh-Hans":"青松路",en:"Qingsonglu"},{"zh-Hans":"星海广场",en:"Xinghai Guangchang"},{"zh-Hans":"科技新城",en:"Keji Xincheng"},{"zh-Hans":"东湖桥",en:"Donghuqiao"},{"zh-Hans":"金融中心南",en:"Jinrongzhongxinnan"},{"zh-Hans":"玉泉东路",en:"Yuquan Donglu"},{"zh-Hans":"西山北街",en:"Xishan Beijie"},{"zh-Hans":"天光西门",en:"Tianguangximen"},{"zh-Hans":"翠竹园",en:"Cuizhuyuan"},{"zh-Hans":"明月港",en:"Mingyuegang"},{"zh-Hans":"春华街",en:"Chunhuajie"},{"zh-Hans":"锦绣大道",en:"Jinxiu Dadao"}]},Ye=t=>{const e=He[t];return e.at(Math.floor(Math.random()*e.length))},Zt=ue("runtime/getStationNames",async({cityName:t},{getState:e,dispatch:c,rejectWithValue:d})=>{const{token:i}=e().account;if(!i){c(Rt({cityName:t,names:[]}));return}const o=await fetch("".concat(Se,"/").concat(t),{headers:{accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(i)}});if(!o.ok)return ne.warn("Failed to fetch random station names",o.statusText),d(o.statusText);const y=await o.json();c(Rt({cityName:t,names:y}))}),qt=ue("runtime/getOneStationName",async(t,{getState:e,dispatch:c})=>{var g;const{stationNames:d}=e().runtime,i=d[t];if(((g=i==null?void 0:i.length)!=null?g:0)==0)return ne.debug("No random station names in cache, using fallback"),c(Zt({cityName:t})),Object.values(Ye(t));const o=structuredClone(i),y=o.shift();return c(Rt({cityName:t,names:o})),o.length<3&&c(Zt({cityName:t})),Object.values(y)}),fe=()=>{const t=It(),{activeSubscriptions:e}=st(i=>i.account),{preference:{randomStationsNames:c}}=st(i=>i.app),d=!e.RMP_CLOUD||c==="none";return L.useCallback(async i=>{const o=mt[i].defaultAttrs.names;if(!d){const y=await t(qt(Wt.Shmetro));if(qt.fulfilled.match(y)){const g=y.payload;return o.length>g.length?g.push(...Array(o.length-g.length).fill(g.at(-1))):o.length<g.length&&g.splice(o.length),g}}return structuredClone(o)},[t,d])},Ve=({isOpen:t,position:e,onClose:c})=>{const{t:d}=Xe(),i=It(),o=L.useRef(window.graph),{selected:y,count:{masters:g,lines:x}}=st(w=>w.runtime),{svgViewBoxZoom:n,svgViewBoxMin:s}=st(w=>w.param),{activeSubscriptions:l}=st(w=>w.account),u=!l.RMP_CLOUD&&g+1>se,m=!l.RMP_CLOUD&&x+1>oe,a=y.size>0,E=L.useRef(null);pe({ref:E,handler:c,enabled:t});const b=L.useCallback(()=>{i(_t(o.current.export())),i(wt()),i(Pt())},[i]),P=R(()=>{if(y.size>0){const w=Ht(o.current,y);navigator.clipboard.writeText(w)}}),p=R(()=>{if(y.size>0){const w=Ht(o.current,y);navigator.clipboard.writeText(w),i(Et()),y.forEach(C=>{o.current.hasNode(C)?o.current.dropNode(C):o.current.hasEdge(C)&&o.current.dropEdge(C)}),b()}}),A=R(async()=>{try{const w=await navigator.clipboard.readText(),{x:C,y:J}=xt(e.x,e.y,n,s),{nodes:O,edges:ct}=he(w,o.current,u,m,K(C,5),K(J,5));b();const D=structuredClone(O);ct.forEach($=>D.add($)),i(At(D))}catch(w){console.warn("Failed to read clipboard:",w)}}),f=R(()=>{y.size>0&&(i(Et()),y.forEach(w=>{o.current.hasNode(w)?o.current.dropNode(w):o.current.hasEdge(w)&&o.current.dropEdge(w)}),b())}),v=R(()=>{i(wt()),i(Pt())}),_=R(w=>{if(y.size>0){const C=Math.min(Math.max(w,-10),10);y.forEach(J=>{o.current.hasNode(J)&&o.current.setNodeAttribute(J,"zIndex",C),o.current.hasEdge(J)&&o.current.setEdgeAttribute(J,"zIndex",C)}),b()}}),Y=R(()=>{if(y.size>0){const[w]=y,C=o.current.hasNode(w)?o.current.getNodeAttribute(w,"zIndex"):o.current.hasEdge(w)?o.current.getEdgeAttribute(w,"zIndex"):0;_(C+1)}}),Q=R(()=>{if(y.size>0){const[w]=y,C=o.current.hasNode(w)?o.current.getNodeAttribute(w,"zIndex"):o.current.hasEdge(w)?o.current.getEdgeAttribute(w,"zIndex"):0;_(C-1)}});return t?h.jsx(xe,{children:h.jsxs(ee,{ref:E,position:"fixed",left:e.x,top:e.y,zIndex:1e3,bg:"white",border:"1px solid",borderColor:"gray.200",borderRadius:"md",boxShadow:"lg",py:1,minW:"150px",_dark:{bg:"gray.700",borderColor:"gray.600"},children:[h.jsx(yt,{onClick:()=>{v(),c()},children:d("contextMenu.refresh")}),h.jsx(Yt,{}),h.jsx(yt,{onClick:()=>{P(),c()},isDisabled:!a,children:d("contextMenu.copy")}),h.jsx(yt,{onClick:()=>{p(),c()},isDisabled:!a,children:d("contextMenu.cut")}),h.jsx(yt,{onClick:()=>{A(),c()},children:d("contextMenu.paste")}),h.jsx(yt,{onClick:()=>{f(),c()},isDisabled:!a,children:d("contextMenu.delete")}),h.jsx(Yt,{}),h.jsx(yt,{onClick:()=>{_(10),c()},isDisabled:!a,children:d("contextMenu.placeTop")}),h.jsx(yt,{onClick:()=>{_(-10),c()},isDisabled:!a,children:d("contextMenu.placeBottom")}),h.jsx(yt,{onClick:()=>{_(0),c()},isDisabled:!a,children:d("contextMenu.placeDefault")}),h.jsx(yt,{onClick:()=>{Y(),c()},isDisabled:!a,children:d("contextMenu.placeUp")}),h.jsx(yt,{onClick:()=>{Q(),c()},isDisabled:!a,children:d("contextMenu.placeDown")})]})}):null},yt=({children:t,onClick:e,isDisabled:c=!1})=>h.jsx(ee,{px:3,py:2,cursor:c?"not-allowed":"pointer",opacity:c?.5:1,_hover:c?{}:{bg:"gray.100",_dark:{bg:"gray.600"}},onClick:c?void 0:e,fontSize:"sm",children:t}),Ke=L.memo(t=>{const{svgViewBoxMin:e,svgViewBoxZoom:c,svgWidth:d,svgHeight:i}=t,{preference:{toolsPanel:{expand:o}}}=st(P=>P.app),g=me().colorMode==="light"?"#666464":"#D3D3D4",x=Ot(e,c,d,i),n=o?410*c/100:0,s=c>30?c>120?50:25:5,l=c/200,u={startX:K(x.xMin+n-s,s),endX:K(x.xMax+n+s,s),startY:K(x.yMin-s,s),endY:K(x.yMax+s,s)},m=Array.from({length:(u.endX-u.startX)/s+1},(P,p)=>{const A=u.startX+p*s,f=A%(s*5)===0?2*l:l;return h.jsx("line",{x1:A,y1:u.startY,x2:A,y2:u.endY,strokeWidth:f,stroke:g,opacity:"0.5"},"grid_vl_".concat(A))}),a=Array.from({length:(u.endY-u.startY)/s+1},(P,p)=>{const A=u.startY+p*s,f=A%(s*5)===0?2*l:l;return h.jsx("line",{x1:u.startX,y1:A,x2:u.endX,y2:A,strokeWidth:f,stroke:g,opacity:"0.5"},"grid_hl_".concat(A))}),E=Array.from({length:(u.endX-u.startX)/s/5+1},(P,p)=>{const A=K(u.startX,5*s)+p*5*s;return h.jsx("text",{x:A,y:x.yMin+c/5,fontSize:l*25,fill:g,textAnchor:"middle",opacity:"0.5",children:A},"grid_vc_".concat(A))}),b=Array.from({length:(u.endY-u.startY)/s/5+1},(P,p)=>{const A=K(u.startY,5*s)+p*5*s;return h.jsx("text",{x:x.xMin+c/8+n,y:A,fontSize:l*25,fill:g,textAnchor:"start",opacity:"0.5",children:A},"grid_hc_".concat(A))});return h.jsxs("g",{id:"grid-lines",className:"removeMe",children:[m,a,E,b]})},(t,e)=>t.svgViewBoxMin.x===e.svgViewBoxMin.x&&t.svgViewBoxMin.y===e.svgViewBoxMin.y&&t.svgViewBoxZoom===e.svgViewBoxZoom&&t.svgWidth===e.svgWidth&&t.svgHeight===e.svgHeight),Ue=Fe.component,Gt=Xt.generatePath,Qt=re.component,$t=10,Ze=()=>{var ct;const t=It(),e=()=>{t(_t(window.graph.export())),t(wt()),t(Pt())},{telemetry:{project:c},preference:{autoParallel:d}}=st(D=>D.app),{selected:i,theme:o,count:{mostFrequentStationType:y}}=st(D=>D.runtime),g=fe(),x=i.keys().next().value;if(!x.startsWith("stn")&&!x.startsWith("misc_node")||!window.graph.hasNode(x))return;const n=window.graph.neighbors(x);if(n.length===0)return;const s=window.graph.getNodeAttributes(x),l=n.reduce((D,$)=>{const ot=window.graph.getNodeAttributes($);return{x:D.x+ot.x,y:D.y+ot.y}},{x:0,y:0}),u={x:l.x/n.length,y:l.y/n.length},m={x:s.x-u.x,y:s.y-u.y},a={x:s.x+m.x,y:s.y+m.y},E=Math.sign(m.x)===Math.sign(m.y),b={x:a.x-$t,y:a.y+$t*(E?1:-1)},P={x:a.x+$t,y:a.y+$t*(E?-1:1)},p=x.startsWith("stn_")?window.graph.getNodeAttribute(x,"type"):y,A=mt[p].component,f={visible:!0,zIndex:0,x:P.x,y:P.y,type:p,[p]:mt[p].defaultAttrs},v=window.graph.reduceEdges(x,(D,$)=>{const ot=window.graph.getEdgeAttributes($),{style:bt}=ot;if(bt===Lt.SingleColor){const dt=JSON.stringify(ot[bt].color);dt in D?D[dt]+=1:D[dt]=1}return D},{}),_=(ct=Object.entries(v).filter(([D,$])=>$%2!==0).reduce((D,[$,ot])=>ot>D.count?{color:JSON.parse($),count:ot}:D,{color:null,count:0}).color)!=null?ct:o,Y=m.x>0?!(m.x>Math.abs(m.y)):-m.x>Math.abs(m.y),Q=Y?"from":"to",w=Gt(s.x,b.x,s.y,b.y,{...Xt.defaultAttrs,startFrom:Q}),C=Y?"to":"from",J=Gt(s.x,P.x,s.y,P.y,{...Xt.defaultAttrs,startFrom:C}),O=async(D,$)=>{$.stopPropagation();const{x:ot,y:bt}=gt($);t(Ft({x:ot,y:bt}));const dt=Ct(10),pt=ve.has(D),k=pt?"stn_".concat(dt):"misc_node_".concat(dt),z=structuredClone({...mt,...zt}[D].defaultAttrs);ie.has(D)&&(z.color=o),pt&&(z.names=await g(D)),window.graph.addNode(k,{visible:!0,zIndex:0,x:pt?P.x:b.x,y:pt?P.y:b.y,type:D,[D]:z}),c&&jt.event(Dt.ADD_STATION,{type:D});const U=at.Diagonal,rt="line_".concat(Ct(10)),[tt,Z]=[x,k],V=d?0:-1,X=pt?C:Q;window.graph.addDirectedEdgeWithKey(rt,tt,Z,{visible:!0,zIndex:0,type:U,[U]:{...structuredClone(it[U].defaultAttrs),startFrom:X},style:Lt.SingleColor,[Lt.SingleColor]:{color:_},reconcileId:"",parallelIndex:V}),c&&jt.event(Dt.ADD_LINE,{type:U}),e(),t(Nt(k)),t(At(new Set([k])))};return h.jsxs("g",{id:"prediction",opacity:"0.5",className:"removeMe",children:[h.jsx(Qt,{id:"line_prediction_1",type:at.Diagonal,path:w,styleAttrs:{color:_},newLine:!0,handlePointerDown:()=>{}}),h.jsx(Qt,{id:"line_prediction_2",type:at.Diagonal,path:J,styleAttrs:{color:_},newLine:!0,handlePointerDown:()=>{}}),h.jsx(Ue,{id:"misc_node_virtual_prediction_1",attrs:{},x:b.x,y:b.y,handlePointerDown:(D,$)=>{O(St.Virtual,$)},handlePointerMove:()=>{},handlePointerUp:()=>{}}),h.jsx(A,{id:"stn_virtual_prediction_2",attrs:f,x:P.x,y:P.y,handlePointerDown:(D,$)=>{O(y,$)},handlePointerMove:()=>{},handlePointerUp:()=>{}})]})},ye=(t,e,c,d,i,o)=>{if(!("offsetFrom"in o)||!("offsetTo"in o)||Number.isNaN(o.offsetFrom)||Number.isNaN(o.offsetTo))return;if(o.offsetFrom===o.offsetTo)return Jt(t,e,c,d,i)?{x1:e,y1:c,x2:d,y2:i,offset:o.offsetFrom}:void 0;const[y,g]=[o.offsetFrom,o.offsetTo];for(let x=0;x<Math.PI;x+=Math.PI/8)for(let n=x,s=0;s<2;s++,n+=Math.PI){const[l,u,m,a]=[Math.sin(x)*y,Math.cos(x)*y,Math.sin(n)*g,Math.cos(n)*g];if(Jt(t,e+l,c+u,d+m,i+a))return{x1:e+l,y1:c+u,x2:d+m,y2:i+a,offset:0}}},qe=(t,e,c,d,i,o)=>t===c?{x1:t+5*o,y1:e,x2:c+5*o,y2:d,offset:i}:e===d?{x1:t,y1:e+5*o,x2:c,y2:d+5*o,offset:i}:{x1:t+5*Math.SQRT1_2*o,y1:e+5*Math.SQRT1_2*o,x2:c+5*Math.SQRT1_2*o,y2:d+5*Math.SQRT1_2*o,offset:i},Jt=(t,e,c,d,i)=>!!((e===d||c===i)&&[at.Diagonal,at.Perpendicular].includes(t)||Math.abs((i-c)/(d-e))===1&&[at.Diagonal,at.RotatePerpendicular].includes(t)),Ge=(t,e)=>{const c=[],d=[];return Object.values(e).forEach(i=>{var P;if(i.length===1){d.push(...i.map(p=>p.edge));return}const o=t.getEdgeAttribute(i.at(0),"type");if(!i.every(p=>t.getEdgeAttribute(p,"type")===o)){d.push(...i.map(p=>p.edge));return}const y=t.getEdgeAttribute(i.at(0),"style");if(!i.every(p=>t.getEdgeAttribute(p,"style")===y)){d.push(...i.map(p=>p.edge));return}const g={},x=new Set,n=new Set,s=Object.fromEntries(i.map(p=>{var v,_;const[A,f]=t.extremities(p);return g[A]=((v=g[A])!=null?v:0)+1,g[f]=((_=g[f])!=null?_:0)+1,x.add(A),n.add(f),[A,[p.edge,f]]})),l=Array.from(x).filter(p=>g[p]===1),u=Array.from(n).filter(p=>g[p]===1);if(l.length!==1||u.length!==1){d.push(...i.map(p=>p.edge));return}const m=l[0],a=u[0];if(m===a){d.push(...i.map(p=>p.edge));return}const E=[s[m][0]];let b=s[m][1];for(let p=1;p<i.length;p=p+1){const A=(P=s[b])==null?void 0:P.at(1);if(!A){d.push(...i.map(f=>f.edge));return}E.push(s[b][0]),b=A}if(b!==a||E.length!==i.length){d.push(...i.map(p=>p.edge));return}c.push(E)}),{allReconciledLines:c,danglingLines:d}},Qe=(t,e)=>{if(!e.every(i=>t.hasEdge(i)))return;const c=e.map(i=>{var u,m,a;const[o,y]=t.extremities(i),g=t.getNodeAttributes(o),x=t.getNodeAttributes(y),{type:n}=t.getEdgeAttributes(i),s=(u=t.getEdgeAttribute(i,n))!=null?u:it[n].defaultAttrs,l=ye(n,g.x,g.y,x.x,x.y,s);if(l){const{x1:E,y1:b,x2:P,y2:p,offset:A}=l;return it[at.Simple].generatePath(E,P,b,p,{offset:A})}return(a=(m=it[n])==null?void 0:m.generatePath(g.x,x.x,g.y,x.y,s))!=null?a:"M ".concat(g.x," ").concat(g.y," L ").concat(x.x," ").concat(x.y)});let d="".concat(c[0]," ");for(let i=1;i<e.length;i=i+1)d+=c[i].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return d},Je=t=>[...t.nodeEntries()].map(e=>e.node.startsWith("stn")?{id:e.node,type:"station",station:e.attributes}:{id:e.node,type:"misc-node",miscNode:e.attributes}),tn=t=>{const e={},c={},d=[],i={},o=[];for(const n of t.edgeEntries()){const[s,l,u,m]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y],a=n.attributes[n.attributes.type],E=ye(n.attributes.type,s,l,u,m,a);c[n.edge]=E}for(const n of t.edgeEntries()){let s=c[n.edge];const{parallelIndex:l}=n.attributes;if(l>=0){const u=we(t,n.attributes.type,n.edge),m=c[u];if(!m){d.push(n);continue}if(l>0){const{x1:a,y1:E,x2:b,y2:P,offset:p}=m;s=qe(a,E,b,P,p,l)}}if(n.attributes.reconcileId!==""){const u=n.attributes.reconcileId;u in i?i[u].push(n):i[u]=[n];continue}if(s){const u=n.edge,m=n.attributes,{x1:a,y1:E,x2:b,y2:P,offset:p}=s;e[u]={attr:m,path:it[at.Simple].generatePath(a,b,E,P,{offset:p})};continue}o.push(n)}const y=new Set;for(;d.length;){const n=d.pop();if(y.has(n.edge))continue;const{parallel:s}=Pe(t,n);if(!s.length)continue;s.forEach(u=>y.add(u.edge));const l=Ae(s);for(const u of s){const m=u.edge;e[m]={attr:u.attributes,path:l[m]}}}const{allReconciledLines:g,danglingLines:x}=Ge(t,i);for(const n of g){const s=Qe(t,n);if(!s)continue;const l=n[0];e[l]={attr:t.getEdgeAttributes(l),path:s}}for(const n of x){const s=t.getEdgeAttributes(n),[l,u]=t.extremities(n),m=t.getNodeAttributes(l),a=t.getNodeAttributes(u);e[n]={attr:s,path:it[at.Simple].generatePath(m.x,a.x,m.y,a.y,it[at.Simple].defaultAttrs)}}for(const n of o){const s=n.edge,l=n.attributes.type,u=n.attributes,[m,a,E,b]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y];if(!(l in it)){e[s]={attr:u,path:"M ".concat(m," ").concat(a," L ").concat(E," ").concat(b)};continue}e[s]={attr:u,path:it[l].generatePath(m,E,a,b,u[l])}}return Object.entries(e).map(([n,s])=>({id:n,type:"line",line:s}))},en=t=>{const{activeSnapPoint:e}=t,{svgViewBoxZoom:c}=st(u=>u.param),d=u=>{const a=[{x:u.x,y:u.y},...u.originalNodesPos].sort((b,P)=>b.x===P.x?b.y-P.y:b.x-P.x),E=(a[1].y-a[0].y)/(a[1].x-a[0].x);if(Math.abs(E)<=.01)return{original:a,offset:a.map(b=>({x:b.x,y:b.y+10})),rotate:0};if(Math.abs(E)>=1e10)return{original:a,offset:a.map(b=>({x:b.x+10,y:b.y})),rotate:90};{const P=-1/E,p=10/Math.sqrt(P*P+1),A=10*P/Math.sqrt(P*P+1);return{original:a,offset:a.map(f=>({x:f.x+p,y:f.y+A})),rotate:-Math.atan(P)*(180/Math.PI)}}},{original:i,offset:o,rotate:y}=d(e),g=u=>{const m=Math.sqrt(3)/2*u,a="0,0",E="".concat(-u/2,",").concat(m),b="".concat(u/2,",").concat(m);return"".concat(a," ").concat(E," ").concat(b)},x=c/75,n=8*x,s="#FC8181",l="".concat(x*5," ").concat(x*2);return h.jsxs(h.Fragment,{children:[h.jsx("line",{x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y,stroke:s,strokeWidth:x,strokeDasharray:l}),h.jsx("line",{x1:o[1].x,y1:o[1].y,x2:o[2].x,y2:o[2].y,stroke:s,strokeWidth:x,strokeDasharray:l}),h.jsx("line",{x1:i[0].x,y1:i[0].y,x2:o[0].x,y2:o[0].y,stroke:s,strokeWidth:x,strokeDasharray:l}),h.jsx("line",{x1:i[1].x,y1:i[1].y,x2:o[1].x,y2:o[1].y,stroke:s,strokeWidth:x,strokeDasharray:l}),h.jsx("line",{x1:i[2].x,y1:i[2].y,x2:o[2].x,y2:o[2].y,stroke:s,strokeWidth:x,strokeDasharray:l}),h.jsx("polygon",{points:g(n),transform:"translate(".concat(o[0].x,",").concat(o[0].y,") rotate(").concat((y+270)%360,")"),fill:s}),h.jsx("polygon",{points:g(n),transform:"translate(".concat(o[1].x,",").concat(o[1].y,") rotate(").concat((y+270)%360,")"),fill:s}),h.jsx("polygon",{points:g(n),transform:"translate(".concat(o[1].x,",").concat(o[1].y,") rotate(").concat((y+90)%360,")"),fill:s}),h.jsx("polygon",{points:g(n),transform:"translate(".concat(o[2].x,",").concat(o[2].y,") rotate(").concat((y+90)%360,")"),fill:s})]})},te=t=>{const{id:e,x:c,y:d,handlePointerDown:i,handlePointerMove:o,handlePointerUp:y}=t,g=L.useCallback(s=>i(e,s),[e,i]),x=L.useCallback(s=>o(e,s),[e,o]),n=L.useCallback(s=>y(e,s),[e,y]);return h.jsx("g",{id:e,transform:"translate(".concat(c-6.4," ").concat(d-6.4,")scale(0.025)"),onPointerDown:g,onPointerMove:x,onPointerUp:n,style:{cursor:"move"},children:h.jsx("path",{id:"stn_core_".concat(e),fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},nn=t=>{const{id:e,path:c,handlePointerDown:d}=t,i=L.useCallback(o=>d(e,o),[e,d]);return h.jsx("path",{id:e,d:c,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:i})},sn=L.memo(t=>{var x,n,s,l,u,m,a,E,b,P,p,A;const{elements:e,handlePointerDown:c,handlePointerMove:d,handlePointerUp:i,handleEdgePointerDown:o}=t,y=Object.fromEntries(Array.from({length:21},(f,v)=>[v-10,{pre:[],main:[],post:[]}]));for(const f of e)if(f.type==="line"){const v=f.line.attr.type,_=f.line.attr.style,Y=f.line.attr[_],Q=(x=Bt[_])==null?void 0:x.preComponent;Q&&y[f.line.attr.zIndex].pre.push(h.jsx(Q,{id:f.id,type:v,path:f.line.path,styleAttrs:Y,newLine:!1,handlePointerDown:o},"".concat(f.id,".pre")));const w=(s=(n=Bt[_])==null?void 0:n.component)!=null?s:nn;y[f.line.attr.zIndex].main.push(h.jsx(w,{id:f.id,type:v,path:f.line.path,styleAttrs:Y,newLine:!1,handlePointerDown:o},f.id));const C=(l=Bt[_])==null?void 0:l.postComponent;C&&y[f.line.attr.zIndex].post.push(h.jsx(C,{id:f.id,type:v,path:f.line.path,styleAttrs:Y,newLine:!1,handlePointerDown:o},"".concat(f.id,".post")))}else if(f.type==="station"){const v=f.station,_=v.type,Y=(u=mt[_])==null?void 0:u.preComponent;Y&&y[f.station.zIndex].pre.push(h.jsx(Y,{id:f.id,x:v.x,y:v.y,attrs:v,handlePointerDown:c,handlePointerMove:d,handlePointerUp:i},"".concat(f.id,".pre")));const Q=(a=(m=mt[_])==null?void 0:m.component)!=null?a:te;y[f.station.zIndex].main.push(h.jsx(Q,{id:f.id,x:v.x,y:v.y,attrs:v,handlePointerDown:c,handlePointerMove:d,handlePointerUp:i},f.id));const w=(E=mt[_])==null?void 0:E.postComponent;w&&y[f.station.zIndex].post.push(h.jsx(w,{id:f.id,x:v.x,y:v.y,attrs:v,handlePointerDown:c,handlePointerMove:d,handlePointerUp:i},"".concat(f.id,".post")))}else if(f.type==="misc-node"){const v=f.miscNode,_=v.type,Y=(b=zt[_])==null?void 0:b.preComponent;Y&&y[f.miscNode.zIndex].pre.push(h.jsx(Y,{id:f.id,x:v.x,y:v.y,attrs:v[_],handlePointerDown:c,handlePointerMove:d,handlePointerUp:i},"".concat(f.id,".pre")));const Q=(p=(P=zt[_])==null?void 0:P.component)!=null?p:te;y[f.miscNode.zIndex].main.push(h.jsx(Q,{id:f.id,x:v.x,y:v.y,attrs:v[_],handlePointerDown:c,handlePointerMove:d,handlePointerUp:i},f.id));const w=(A=zt[_])==null?void 0:A.postComponent;w&&y[f.miscNode.zIndex].post.push(h.jsx(w,{id:f.id,x:v.x,y:v.y,attrs:v[_],handlePointerDown:c,handlePointerMove:d,handlePointerUp:i},"".concat(f.id,".post")))}return Array.from({length:21},(f,v)=>(v-10).toString()).map(f=>[...y[f].pre,...y[f].main,...y[f].post]).flat()},(t,e)=>t.elements===e.elements),on=[...Object.values(Me),St.Virtual,St.Master,St.LondonArrow,St.ChongqingRTNumLineBadge2021,St.ChongqingRTTextLineBadge2021,St.ChengduRTLineBadge,St.GzmtrLineBadge],rn=()=>{const t=It(),e=L.useRef(window.graph),c=()=>{t(_t(e.current.export())),t(wt()),t(Pt())},{telemetry:{project:d},preference:{autoParallel:i,gridLines:o,snapLines:y}}=st(k=>k.app),{svgViewBoxZoom:g,svgViewBoxMin:x}=st(k=>k.param),{selected:n,pointerPosition:s,active:l,refresh:{nodes:u,edges:m},mode:a,keepLastPath:E,theme:b}=st(k=>k.runtime),P=ae(),{height:p,width:A}=ce(P),[f,v]=L.useState({dx:0,dy:0}),[_,Y]=L.useState([]),[Q,w]=L.useState([]),[C,J]=L.useState([]);L.useEffect(()=>{if(!s||!y)return;const k=Ot(x,g,A,p),z=de(e.current,...Object.values(k));w(z),Y(Ie(e.current,z))},[x,g,A,p,s]);const[O,ct]=L.useState(void 0),D=R((k,z)=>{z.stopPropagation(),z.currentTarget.setPointerCapture(z.pointerId);const{x:U,y:rt}=gt(z);a==="select"&&t(vt("free")),J([]),ct(void 0),t(Ft({x:U,y:rt})),t(Nt(k)),z.shiftKey?n.has(k)?t(Vt(k)):t(Kt(k)):n.has(k)||t(At(new Set([k])))}),$=R((k,z)=>{const{x:U,y:rt}=gt(z);if(z.currentTarget.setPointerCapture(z.pointerId),a==="free"&&l===k){if(!z.altKey&&y){const tt=e.current.getNodeAttribute(k,"x"),Z=e.current.getNodeAttribute(k,"y"),V=tt-(s.x-U)*g/100,X=Z-(s.y-rt)*g/100;let et=V,q=X;if(Te(k,e.current)){let N=C,I=O;if(N.length!==0&&(N=N.filter(j=>$e(j,V,X)<=6)),I&&(N.length===0||Math.hypot(V-I.x,X-I.y)>6)&&(I=void 0),!I&&N.length===1){const j=N[0],{snapPoint:G,distance:H}=Be(e.current,Q.filter(ut=>!n.has(ut)),V,X,j);H<=3&&(I=G)}if(N.length===1&&!I||N.length===0){const{l:j,d:G}=We(V,X,_,Q.filter(ut=>!n.has(ut)&&!N.some(r=>r.node===ut))),H=N.length===0||!N.some(ut=>ut.a===j.a&&ut.b===j.b);G<3&&N.length<2&&H&&N.push(j)}if(N.length===1)if(I)et=I.x,q=I.y;else{const j=N[0];if(j.a==0)q=-j.c/j.b;else if(j.b==0)et=-j.c/j.a;else{const G=-j.a/j.b,H=-j.c/j.b;q=G*et+H}}else if(N.length===2){const j=N[0],G=N[1],H=j.a*G.b-G.a*j.b;H!==0&&(et=-(j.c*G.b-G.c*j.b)/H,q=-(j.a*G.c-G.a*j.c)/H)}J(N),ct(I)}const F=et-tt,lt=q-Z;n.forEach(N=>{e.current.hasNode(N)&&e.current.updateNodeAttributes(N,I=>({...I,x:K(I.x+F,.01),y:K(I.y+lt,.01)}))})}else J([]),ct(void 0),n.forEach(tt=>{e.current.hasNode(tt)&&e.current.updateNodeAttributes(tt,Z=>({...Z,x:K(Z.x-(s.x-U)*g/100,z.altKey?.01:5),y:K(Z.y-(s.y-rt)*g/100,z.altKey?.01:5)}))});t(wt()),t(Pt())}else a.startsWith("line")&&l&&v({dx:(s.x-U)*g/100,dy:(s.y-rt)*g/100})}),ot=R((k,z)=>{var U,rt,tt;if(z.currentTarget.releasePointerCapture(z.pointerId),a.startsWith("line")){E||t(vt("free"));const Z=e.current.hasNode(l)&&on.includes(e.current.getNodeAttribute(l,"type")),V=["stn_core_","virtual_circle_","misc_node_connectable_"],et=(tt=(rt=(U=document.elementsFromPoint(z.clientX,z.clientY).at(0))==null?void 0:U.attributes)==null?void 0:rt.getNamedItem("id"))==null?void 0:tt.value,q=V.find(F=>et==null?void 0:et.startsWith(F));if(Z&&q){const F=a.slice(5),lt="line_".concat(Ct(10)),[N,I]=[l,et.slice(q.length)];if(N!==I){const j=i?le(e.current,F,N,I,"from"):-1;e.current.addDirectedEdgeWithKey(lt,N,I,{visible:!0,zIndex:0,type:F,[F]:structuredClone(it[F].defaultAttrs),style:Lt.SingleColor,[Lt.SingleColor]:{color:b},reconcileId:"",parallelIndex:j}),t(At(new Set([lt]))),d&&jt.event(Dt.ADD_LINE,{type:F}),t(_t(e.current.export())),t(Pt())}}}else if(a==="free"&&l){const{x:Z,y:V}=gt(z);s.x-Z===0&&s.y-V===0||(t(_t(e.current.export())),t(wt()))}J([]),ct(void 0),Ft(void 0),t(Nt(void 0))}),bt=R((k,z)=>{if(z.stopPropagation(),z.shiftKey||t(Et()),z.shiftKey&&n.has(k)?t(Vt(k)):t(Kt(k)),a.startsWith("station")||a.startsWith("misc-node-virtual")||a.startsWith("misc-node-master")){const U=z.clientX-document.getElementById("canvas").getBoundingClientRect().left,rt=z.clientY-document.getElementById("canvas").getBoundingClientRect().top,tt=a.startsWith("station"),Z=Ct(10),V=tt?"stn_".concat(Z):"misc_node_".concat(Z),X=tt?a.slice(8):a.slice(10),{x:et,y:q}=xt(U,rt,g,x),F=tt?structuredClone(mt[X].defaultAttrs):structuredClone(zt[X].defaultAttrs);"color"in F&&(F.color=b),e.current.addNode(V,{visible:!0,zIndex:0,x:K(et,5),y:K(q,5),type:X,[X]:F});const lt=e.current.getEdgeAttributes(k),{zIndex:N,type:I,style:j}=lt,G=lt[I],H=lt[j],[ut,r]=e.current.extremities(k),S=i?0:-1;e.current.addDirectedEdgeWithKey("line_".concat(Ct(10)),ut,V,{visible:!0,zIndex:N,type:I,[I]:structuredClone(G),style:j,[j]:structuredClone(H),reconcileId:"",parallelIndex:S}),e.current.addDirectedEdgeWithKey("line_".concat(Ct(10)),V,r,{visible:!0,zIndex:N,type:I,[I]:structuredClone(G),style:j,[j]:structuredClone(H),reconcileId:"",parallelIndex:S}),e.current.dropEdge(k),c(),d&&(jt.event(Dt.ADD_STATION,{type:X}),jt.event(Dt.ADD_LINE,{type:I})),t(vt("free")),t(At(new Set([V])))}}),dt=L.useMemo(()=>[...tn(e.current),...Je(e.current)],[m,u]),pt=re.component;return h.jsxs(h.Fragment,{children:[h.jsx(sn,{elements:dt,handlePointerDown:D,handlePointerMove:$,handlePointerUp:ot,handleEdgePointerDown:bt}),a.startsWith("line")&&l&&l!=="background"&&h.jsx(pt,{id:"line_create_in_progress___no_use",type:a.slice(5),path:it[a.slice(5)].generatePath(e.current.getNodeAttribute(l,"x"),e.current.getNodeAttribute(l,"x")-f.dx,e.current.getNodeAttribute(l,"y"),e.current.getNodeAttribute(l,"y")-f.dy,it[a.slice(5)].defaultAttrs),styleAttrs:{color:b},newLine:!0,handlePointerDown:()=>{}}),C.length!==0&&C.map(k=>h.jsx("path",{d:it[at.Simple].generatePath(...ke(k,Ot(x,g,A,p)),it[at.Simple].defaultAttrs),stroke:"cyan",strokeWidth:g/75},"snap_line_".concat(k.a,"_").concat(k.b,"_").concat(k.c,"_").concat(k.node))),O&&h.jsx(en,{activeSnapPoint:O})]})},fn=()=>{const t=It(),e=L.useRef(window.graph),c=L.useCallback(()=>{t(_t(e.current.export())),t(wt()),t(Pt())},[t]),{activeSubscriptions:d}=st(r=>r.account),{telemetry:{project:i},preference:{gridLines:o,snapLines:y,predictNextNode:g,autoParallel:x}}=st(r=>r.app),{svgViewBoxZoom:n,svgViewBoxMin:s}=st(r=>r.param),{selected:l,active:u,isDetailsOpen:m,mode:a,lastTool:E,keepLastPath:b,theme:P,count:{masters:p,lines:A}}=st(r=>r.runtime),f=ae(),{height:v,width:_}=ce(f),Y=!d.RMP_CLOUD&&p+1>se,Q=!d.RMP_CLOUD&&A+1>oe,w=fe();Ce();const[C,J]=L.useState({x:0,y:0}),[O,ct]=L.useState({x:0,y:0}),[D,$]=L.useState({isOpen:!1,position:{x:0,y:0}}),[ot,bt]=L.useState({x:0,y:0}),[dt,pt]=L.useState({x:0,y:0}),k=R(async r=>{D.isOpen&&$({isOpen:!1,position:{x:0,y:0}});const{x:S,y:M}=gt(r);if(a.startsWith("station")||a.startsWith("misc-node")){t(vt("free"));const T=Ct(10),{x:B,y:W}=xt(S,M,n,s),nt=a.startsWith("station"),ht=nt?"stn_".concat(T):"misc_node_".concat(T),ft=nt?a.slice(8):a.slice(10),kt=structuredClone({...mt,...zt}[ft].defaultAttrs);ie.has(ft)&&(kt.color=P),nt&&(kt.names=await w(ft)),e.current.addNode(ht,{visible:!0,zIndex:0,x:K(B,5),y:K(W,5),type:ft,[ft]:kt}),i&&jt.event(Dt.ADD_STATION,{type:ft}),c(),t(At(new Set([ht])))}else a==="free"||a.startsWith("line")?(a.startsWith("line")&&(t(vt("free")),b&&t(Le(!1))),bt({x:S,y:M}),pt(s),r.shiftKey||(t(Nt("background")),t(Et()))):a==="select"&&(J(xt(S,M,n,s)),ct(xt(S,M,n,s)))}),z=R(r=>{if(a==="select"){if(C.x!=0&&C.y!=0){const{x:S,y:M}=gt(r);ct(xt(S,M,n,s))}}else if(u==="background"){const{x:S,y:M}=gt(r);t(Tt({x:dt.x+(ot.x-S)*n/100,y:dt.y+(ot.y-M)*n/100}))}}),U=R(r=>{if(a==="select"){const{x:S,y:M}=gt(r),{x:T,y:B}=xt(S,M,n,s),W=de(e.current,C.x,C.y,T,B),nt=Oe(e.current,new Set(W));t(At(new Set([...r.shiftKey?l:[],...W,...nt]))),t(vt("free")),J({x:0,y:0}),ct({x:0,y:0})}u==="background"&&!r.shiftKey&&t(Nt(void 0))}),rt=R(r=>{let S=n;r.deltaY>0&&n+10<400?S=n+10:r.deltaY<0&&n-10>0&&(S=n-10),t(Ut(S));const{x:M,y:T}=gt(r),B=r.currentTarget.getBoundingClientRect(),[W,nt]=[M/B.width,T/B.height];t(Tt({x:s.x+M*n/100-_*S/100*W,y:s.y+T*n/100-v*S/100*nt}))}),tt=R(r=>{r.preventDefault(),gt(r),$({isOpen:!0,position:{x:r.clientX,y:r.clientY}})}),Z=R(()=>{$({isOpen:!1,position:{x:0,y:0}});const r=document.getElementById("canvas");r&&r.focus()}),V=R(async r=>{if(Mt?r.key==="Backspace":r.key==="Delete")l.size>0&&(l.forEach(S=>{e.current.hasNode(S)?e.current.dropNode(S):e.current.hasEdge(S)&&e.current.dropEdge(S)}),t(Et()),c());else if(r.key.startsWith("Arrow")){const M=r.key.endsWith("Left")?-1:r.key.endsWith("Right")?1:0,T=r.key.endsWith("Up")?-1:r.key.endsWith("Down")?1:0;t(Tt(xt(100*M,100*T,n,s)))}else if(r.key==="i"||r.key==="j"||r.key==="k"||r.key==="l"){const M=(r.key==="j"?-1:r.key==="l"?1:0)*10,T=(r.key==="i"?-1:r.key==="k"?1:0)*10;l.size>0&&l.forEach(B=>{e.current.hasNode(B)&&(e.current.updateNodeAttribute(B,"x",W=>(W!=null?W:0)+M),e.current.updateNodeAttribute(B,"y",W=>(W!=null?W:0)+T),c())})}else if(r.key==="f"&&E)t(vt(E));else if(r.key==="z"&&(Mt?r.metaKey&&!r.shiftKey:r.ctrlKey))Mt&&r.preventDefault(),t(De()),t(wt()),t(Pt());else if(r.key==="s")t(vt("select"));else if((r.key==="c"||r.key==="x")&&(Mt?r.metaKey&&!r.shiftKey:r.ctrlKey)){const S=Ht(e.current,l);navigator.clipboard.writeText(S),r.key==="x"&&(t(Et()),l.forEach(M=>{e.current.hasNode(M)?e.current.dropNode(M):e.current.hasEdge(M)&&e.current.dropEdge(M)}),c())}else if(r.key==="v"&&(Mt?r.metaKey&&!r.shiftKey:r.ctrlKey)){const S=await navigator.clipboard.readText(),{x:M,y:T}=xt(_/2,v/2,n,s),{nodes:B,edges:W}=he(S,e.current,Y,Q,K(M,5),K(T,5));c();const nt=structuredClone(B);W.forEach(ht=>nt.add(ht)),t(At(nt))}else if(Mt&&r.key==="z"&&r.metaKey&&r.shiftKey||!Mt&&r.key==="y"&&r.ctrlKey)t(Ne());else if(r.key==="c")t(ze(!y));else if(r.key==="e"){const[S]=l;if(l.size===1&&e.current.hasEdge(S)){const M=e.current.getEdgeAttributes(S),{type:T}=M;if(T!==at.Simple&&M[T]){const B=M[T],nt=(B.startFrom||"from")==="from"?"to":"from";let ht=M.parallelIndex;if(x){const[kt,ge]=e.current.extremities(S);ht=le(e.current,T,kt,ge,nt)}const ft={...B,startFrom:nt};e.current.mergeEdgeAttributes(S,{[T]:ft,parallelIndex:ht}),c()}}}}),[X,et]=L.useState(0),[q,F]=L.useState(null),[lt,N]=L.useState(null),I=R(r=>{if(r.touches.length===1){const S=r.touches[0];N({x:S.clientX,y:S.clientY});const M=setTimeout(()=>{$({isOpen:!0,position:{x:S.clientX,y:S.clientY}}),F(null)},500);F(M)}else if(r.touches.length===2){t(Nt(void 0));const[S,M]=[r.touches[0].clientX-r.touches[1].clientX,r.touches[0].clientY-r.touches[1].clientY];et(S*S+M*M),q&&(clearTimeout(q),F(null)),N(null)}}),j=R(r=>{if(r.touches.length===1&&lt&&q){const S=r.touches[0],M=S.clientX-lt.x,T=S.clientY-lt.y;Math.sqrt(M*M+T*T)>10&&(clearTimeout(q),F(null),N(null))}else if(X!==0&&r.touches.length===2){const[S,M]=[r.touches[0].clientX-r.touches[1].clientX,r.touches[0].clientY-r.touches[1].clientY],T=S*S+M*M;let B=n;T-X<0&&n+10<=390?B=n+10:T-X>0&&n-10>=10&&(B=n-10),t(Ut(B)),et(T);const W=r.currentTarget.getBoundingClientRect(),[nt,ht]=[(r.touches[0].clientX+r.touches[1].clientX)/2-W.left,(r.touches[0].clientY+r.touches[1].clientY)/2-W.top],[ft,kt]=[nt/W.width,ht/W.height];t(Tt({x:s.x+nt*n/100-_*B/100*ft,y:s.y+ht*n/100-v*B/100*kt}))}}),G=R(r=>{q&&(clearTimeout(q),F(null)),N(null),X!==0&&et(0)}),[H,ut]=L.useState({sx:0,sy:0,ex:0,ey:0});return L.useEffect(()=>{ut({sx:C.x<=O.x?C.x:O.x,ex:C.x>O.x?C.x:O.x,sy:C.y<=O.y?C.y:O.y,ey:C.y>O.y?C.y:O.y})},[O.x,O.y]),h.jsxs(h.Fragment,{children:[h.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:v,width:_,viewBox:"".concat(s.x," ").concat(s.y," ").concat(_*n/100," ").concat(v*n/100),onPointerDown:k,onPointerMove:z,onPointerUp:U,onTouchStart:I,onTouchMove:j,onTouchEnd:G,onWheel:rt,onContextMenu:tt,tabIndex:0,onKeyDown:V,children:[h.jsx("defs",{children:h.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[h.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),h.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})}),o&&h.jsx(Ke,{svgViewBoxMin:s,svgViewBoxZoom:n,svgWidth:_,svgHeight:v}),g&&l.size===1&&a==="free"&&h.jsx(Ze,{}),h.jsx(Re.SvgAssetsContextProvider,{children:h.jsx(rn,{})}),a==="select"&&C.x!=0&&C.y!=0&&h.jsx("rect",{x:H.sx,y:H.sy,width:H.ex-H.sx,height:H.ey-H.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"})]}),h.jsx(Ve,{isOpen:D.isOpen,position:D.position,onClose:Z}),_e()&&m==="hide"&&h.jsx(be,{"aria-label":"open details panel",icon:h.jsx(je,{style:{transform:"rotate(180deg)"}}),onClick:()=>t(Ee()),style:{position:"fixed",bottom:20,right:0,borderTopRightRadius:0,borderBottomRightRadius:0},colorScheme:"blue",size:"lg",isRound:!0})]})};export{fn as default};
