import{j as C}from"./chakra-Dqj68bqe.js";import{l as J,o as Y,an as Dt,ao as Mt,ap as xt,e as Et,a as st,aq as V,ar as H,as as ct,U as ot,at as mt,au as vt,av as X,t as at,v as it,S as Nt,aw as bt,n as rt,m as _t,p as St,r as dt,E as lt,w as ht,y as pt,V as U,ax as It,D as jt,ay as Tt,a0 as Lt,A as yt,z as At,a7 as et,ak as $t,al as Kt}from"./index-DftZk_0v.js";import{b as _}from"./react-DV6nCJb6.js";import{u as B,e as Wt,i as Bt}from"./clipboard-B13rkWIi.js";import{s as ut,u as zt,f as Ot,F as Rt,l as Yt,b as Ft,c as Xt}from"./master-manager-CLe-svd_.js";import{m as ft}from"./misc-nodes-BeMXACPx.js";const kt=(t,e,u,d,i,o,a)=>{if(!("offsetFrom"in o)||!("offsetTo"in o)||Number.isNaN(o.offsetFrom)||Number.isNaN(o.offsetTo))return;if(o.offsetFrom===o.offsetTo)return wt(t,e,u,d,i)?a<0?{x1:e,y1:u,x2:d,y2:i,offset:o.offsetFrom}:e===d?{x1:e+5*a,y1:u,x2:d+5*a,y2:i,offset:o.offsetFrom}:u===i?{x1:e,y1:u+5*a,x2:d,y2:i+5*a,offset:o.offsetFrom}:{x1:e+5*Math.SQRT1_2*a,y1:u+5*Math.SQRT1_2*a,x2:d+5*Math.SQRT1_2*a,y2:i+5*Math.SQRT1_2*a,offset:o.offsetFrom}:void 0;const[y,n]=[o.offsetFrom,o.offsetTo];for(let h=0;h<Math.PI;h+=Math.PI/8)for(let r=h,g=0;g<2;g++,r+=Math.PI){const[w,m,S,D]=[Math.sin(h)*y,Math.cos(h)*y,Math.sin(r)*n,Math.cos(r)*n];if(wt(t,e+w,u+m,d+S,i+D))return{x1:e+w,y1:u+m,x2:d+S,y2:i+D,offset:0}}},wt=(t,e,u,d,i)=>!!((e===d||u===i)&&[J.Diagonal,J.Perpendicular].includes(t)||Math.abs((i-u)/(d-e))===1&&[J.Diagonal,J.RotatePerpendicular].includes(t)),Ut=(t,e)=>{const u=[],d=[];return Object.values(e).forEach(i=>{var I;if(i.length===1){d.push(...i.map(p=>p.edge));return}const o=t.getEdgeAttribute(i.at(0),"type");if(!i.every(p=>t.getEdgeAttribute(p,"type")===o)){d.push(...i.map(p=>p.edge));return}const a=t.getEdgeAttribute(i.at(0),"style");if(!i.every(p=>t.getEdgeAttribute(p,"style")===a)){d.push(...i.map(p=>p.edge));return}const y={},n=new Set,h=new Set,r=Object.fromEntries(i.map(p=>{var l,k;const[v,c]=t.extremities(p);return y[v]=((l=y[v])!=null?l:0)+1,y[c]=((k=y[c])!=null?k:0)+1,n.add(v),h.add(c),[v,[p.edge,c]]})),g=Array.from(n).filter(p=>y[p]===1),w=Array.from(h).filter(p=>y[p]===1);if(g.length!==1||w.length!==1){d.push(...i.map(p=>p.edge));return}const m=g[0],S=w[0];if(m===S){d.push(...i.map(p=>p.edge));return}const D=[r[m][0]];let M=r[m][1];for(let p=1;p<i.length;p=p+1){const v=(I=r[M])==null?void 0:I.at(1);if(!v){d.push(...i.map(c=>c.edge));return}D.push(r[M][0]),M=v}if(M!==S||D.length!==i.length){d.push(...i.map(p=>p.edge));return}u.push(D)}),{allReconciledLines:u,danglingLines:d}},Vt=(t,e)=>{if(!e.every(i=>t.hasEdge(i)))return;const u=e.map(i=>{var m,S,D;const[o,a]=t.extremities(i),y=t.getNodeAttributes(o),n=t.getNodeAttributes(a),{type:h,parallelIndex:r}=t.getEdgeAttributes(i),g=(m=t.getEdgeAttribute(i,h))!=null?m:Y[h].defaultAttrs,w=kt(h,y.x,y.y,n.x,n.y,g,r);if(w){const{x1:M,y1:I,x2:p,y2:v,offset:c}=w;return Y[J.Simple].generatePath(M,p,I,v,{offset:c})}return(D=(S=Y[h])==null?void 0:S.generatePath(y.x,n.x,y.y,n.y,g))!=null?D:"M ".concat(y.x," ").concat(y.y," L ").concat(n.x," ").concat(n.y)});let d="".concat(u[0]," ");for(let i=1;i<e.length;i=i+1)d+=u[i].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return d},Zt=t=>[...t.nodeEntries()].map(e=>e.node.startsWith("stn")?{id:e.node,type:"station",station:e.attributes}:{id:e.node,type:"misc-node",miscNode:e.attributes}),Qt=t=>{const e={},u=[],d={},i=[];for(const n of t.edgeEntries()){const[h,r,g,w]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y],m=kt(n.attributes.type,h,r,g,w,n.attributes[n.attributes.type],n.attributes.parallelIndex);if(!m){if(n.attributes.parallelIndex>=0){u.push(n);continue}}if(n.attributes.reconcileId!==""){const S=n.attributes.reconcileId;S in d?d[S].push(n):d[S]=[n];continue}if(m){const S=n.edge,D=n.attributes,{x1:M,y1:I,x2:p,y2:v,offset:c}=m;e[S]={id:S,attr:D,path:Y[J.Simple].generatePath(M,p,I,v,{offset:c})};continue}i.push(n)}const o=new Set;for(;u.length;){const n=u.pop();if(o.has(n.edge))continue;const{normal:h,parallel:r}=Dt(t,n);if(!r.length)continue;r.forEach(w=>o.add(w.edge)),i.push(...h);const g=Mt(r);for(const w of r){const m=w.edge;e[m]={id:w.edge,attr:w.attributes,path:g[m]}}}const{allReconciledLines:a,danglingLines:y}=Ut(t,d);for(const n of a){const h=Vt(t,n);if(!h)continue;const r=n[0];e[r]={id:r,attr:t.getEdgeAttributes(r),path:h}}for(const n of y){const h=t.getEdgeAttributes(n),[r,g]=t.extremities(n),w=t.getNodeAttributes(r),m=t.getNodeAttributes(g);e[n]={id:n,attr:h,path:Y[J.Simple].generatePath(w.x,m.x,w.y,m.y,Y[J.Simple].defaultAttrs)}}for(const n of i){const h=n.edge,r=n.attributes.type,g=n.attributes,[w,m,S,D]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y];if(!(r in Y)){e[h]={id:h,attr:g,path:"M ".concat(w," ").concat(m," L ").concat(S," ").concat(D)};continue}e[h]={id:h,attr:g,path:Y[r].generatePath(w,S,m,D,g[r])}}return Object.values(e).map(n=>({id:n.id,type:"line",line:n}))},Pt=t=>{const{id:e,x:u,y:d,handlePointerDown:i,handlePointerMove:o,handlePointerUp:a}=t,y=_.useCallback(r=>i(e,r),[e,i]),n=_.useCallback(r=>o(e,r),[e,o]),h=_.useCallback(r=>a(e,r),[e,a]);return C.jsx("g",{id:e,transform:"translate(".concat(u-6.4," ").concat(d-6.4,")scale(0.025)"),onPointerDown:y,onPointerMove:n,onPointerUp:h,style:{cursor:"move"},children:C.jsx("path",{id:"stn_core_".concat(e),fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},Gt=t=>{const{id:e,path:u,handlePointerDown:d}=t,i=_.useCallback(o=>d(e,o),[e,d]);return C.jsx("path",{id:e,d:u,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:i})},qt=_.memo(t=>{var n,h,r,g,w,m,S,D,M,I,p,v;const{elements:e,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i,handleEdgePointerDown:o}=t,a=Object.fromEntries(Array.from({length:21},(c,l)=>[l-10,{pre:[],main:[],post:[]}]));for(const c of e)if(c.type==="line"){const l=c.line.attr.type,k=c.line.attr.style,$=c.line.attr[k],b=(n=xt[k])==null?void 0:n.preComponent;b&&a[c.line.attr.zIndex].pre.push(C.jsx(b,{id:c.id,type:l,path:c.line.path,styleAttrs:$,newLine:!1,handlePointerDown:o},"".concat(c.id,".pre")));const A=(r=(h=xt[k])==null?void 0:h.component)!=null?r:Gt;a[c.line.attr.zIndex].main.push(C.jsx(A,{id:c.id,type:l,path:c.line.path,styleAttrs:$,newLine:!1,handlePointerDown:o},c.id));const T=(g=xt[k])==null?void 0:g.postComponent;T&&a[c.line.attr.zIndex].post.push(C.jsx(T,{id:c.id,type:l,path:c.line.path,styleAttrs:$,newLine:!1,handlePointerDown:o},"".concat(c.id,".post")))}else if(c.type==="station"){const l=c.station,k=l.type,$=(w=ut[k])==null?void 0:w.preComponent;$&&a[c.station.zIndex].pre.push(C.jsx($,{id:c.id,x:l.x,y:l.y,attrs:l,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".pre")));const b=(S=(m=ut[k])==null?void 0:m.component)!=null?S:Pt;a[c.station.zIndex].main.push(C.jsx(b,{id:c.id,x:l.x,y:l.y,attrs:l,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},c.id));const A=(D=ut[k])==null?void 0:D.postComponent;A&&a[c.station.zIndex].post.push(C.jsx(A,{id:c.id,x:l.x,y:l.y,attrs:l,handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".post")))}else if(c.type==="misc-node"){const l=c.miscNode,k=l.type,$=(M=ft[k])==null?void 0:M.preComponent;$&&a[c.miscNode.zIndex].pre.push(C.jsx($,{id:c.id,x:l.x,y:l.y,attrs:l[k],handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".pre")));const b=(p=(I=ft[k])==null?void 0:I.component)!=null?p:Pt;a[c.miscNode.zIndex].main.push(C.jsx(b,{id:c.id,x:l.x,y:l.y,attrs:l[k],handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},c.id));const A=(v=ft[k])==null?void 0:v.postComponent;A&&a[c.miscNode.zIndex].post.push(C.jsx(A,{id:c.id,x:l.x,y:l.y,attrs:l[k],handlePointerDown:u,handlePointerMove:d,handlePointerUp:i},"".concat(c.id,".post")))}return Array.from({length:21},(c,l)=>(l-10).toString()).map(c=>[...a[c].pre,...a[c].main,...a[c].post]).flat()},(t,e)=>t.elements===e.elements),Ht=()=>{const t=Et(),e=_.useRef(window.graph),u=()=>{t(at()),t(it()),t(ht(e.current.export()))},{telemetry:{project:d},preference:{autoParallel:i}}=st(b=>b.app),{svgViewBoxZoom:o,svgViewBoxMin:a}=st(b=>b.param),{selected:y,refresh:{nodes:n,edges:h},mode:r,active:g,keepLastPath:w,theme:m}=st(b=>b.runtime),[S,D]=_.useState({x:0,y:0}),[M,I]=_.useState({x:0,y:0}),p=B((b,A)=>{A.stopPropagation(),r==="select"&&t(V("free"));const T=A.currentTarget,{x:K,y:z}=H(A);T.setPointerCapture(A.pointerId),D({x:K,y:z}),t(ct(b)),A.shiftKey?y.has(b)?t(mt(b)):t(vt(b)):y.has(b)||t(ot(new Set([b])))}),v=B((b,A)=>{const{x:T,y:K}=H(A);r==="free"&&g===b?(y.forEach(z=>{e.current.hasNode(z)&&e.current.updateNodeAttributes(z,O=>({...O,x:X(O.x-(S.x-T)*o/100,A.altKey?1:5),y:X(O.y-(S.y-K)*o/100,A.altKey?1:5)}))}),t(at()),t(it())):r.startsWith("line")&&I({x:(S.x-T)*o/100,y:(S.y-K)*o/100})}),c=B((b,A)=>{if(r.startsWith("line")){w||t(V("free"));const T=[...Object.values(Nt),bt.Virtual,bt.Master],K=e.current.hasNode(g)&&T.includes(e.current.getNodeAttribute(g,"type"));["stn_core_","virtual_circle_"].forEach(O=>{var Q,G;const W=(G=(Q=document.elementsFromPoint(A.clientX,A.clientY)[0].attributes)==null?void 0:Q.getNamedItem("id"))==null?void 0:G.value,Z=W==null?void 0:W.startsWith(O);if(K&&Z){const R=r.slice(5),nt="line_".concat(rt(10)),[j,F]=[g,W.slice(O.length)],s=i?_t(e.current,R,j,F,"from"):-1;e.current.addDirectedEdgeWithKey(nt,j,F,{visible:!0,zIndex:0,type:R,[R]:structuredClone(Y[R].defaultAttrs),style:St.SingleColor,[St.SingleColor]:{color:m},reconcileId:"",parallelIndex:s}),d&&dt.event(lt.ADD_LINE,{type:R})}}),t(it()),t(ht(e.current.export()))}else if(r==="free"&&g){const{x:T,y:K}=H(A);S.x-T===0&&S.y-K===0||t(ht(e.current.export()))}t(ct(void 0))}),l=B((b,A)=>{if(A.stopPropagation(),A.shiftKey||t(pt()),A.shiftKey&&y.has(b)?t(mt(b)):t(vt(b)),r.startsWith("station")||r.startsWith("misc-node-virtual")||r.startsWith("misc-node-master")){const T=A.clientX-document.getElementById("canvas").getBoundingClientRect().left,K=A.clientY-document.getElementById("canvas").getBoundingClientRect().top,z=r.startsWith("station"),O=rt(10),tt=z?"stn_".concat(O):"misc_node_".concat(O),W=z?r.slice(8):r.slice(10),{x:Z,y:Q}=U(T,K,o,a),G=z?structuredClone(ut[W].defaultAttrs):structuredClone(ft[W].defaultAttrs);"color"in G&&(G.color=m),e.current.addNode(tt,{visible:!0,zIndex:0,x:X(Z,5),y:X(Q,5),type:W,[W]:G});const R=e.current.getEdgeAttributes(b),{zIndex:nt,type:j,style:F}=R,s=R[j],f=R[F],[x,N]=e.current.extremities(b),E=i?0:-1;e.current.addDirectedEdgeWithKey("line_".concat(rt(10)),x,tt,{visible:!0,zIndex:nt,type:j,[j]:structuredClone(s),style:F,[F]:structuredClone(f),reconcileId:"",parallelIndex:E}),e.current.addDirectedEdgeWithKey("line_".concat(rt(10)),tt,N,{visible:!0,zIndex:nt,type:j,[j]:structuredClone(s),style:F,[F]:structuredClone(f),reconcileId:"",parallelIndex:E}),e.current.dropEdge(b),u(),d&&(dt.event(lt.ADD_STATION,{type:W}),dt.event(lt.ADD_LINE,{type:j})),t(V("free")),t(ot(new Set([tt])))}}),k=_.useMemo(()=>[...Qt(e.current),...Zt(e.current)],[h,n]),$=It.component;return C.jsxs(C.Fragment,{children:[C.jsx(qt,{elements:k,handlePointerDown:p,handlePointerMove:v,handlePointerUp:c,handleEdgePointerDown:l}),r.startsWith("line")&&g&&g!=="background"&&C.jsx($,{id:"line_create_in_progress___no_use",type:r.slice(5),path:Y[r.slice(5)].generatePath(e.current.getNodeAttribute(g,"x"),e.current.getNodeAttribute(g,"x")-M.x,e.current.getNodeAttribute(g,"y"),e.current.getNodeAttribute(g,"y")-M.y,Y[r.slice(5)].defaultAttrs),styleAttrs:{color:m},newLine:!0,handlePointerDown:()=>{}})]})},re=()=>{const t=Et(),e=_.useRef(window.graph),u=()=>{t(at()),t(it()),t(ht(e.current.export()))},{activeSubscriptions:d}=st(s=>s.account),{telemetry:{project:i}}=st(s=>s.app),{svgViewBoxZoom:o,svgViewBoxMin:a}=st(s=>s.param),{mode:y,lastTool:n,active:h,selected:r,keepLastPath:g,theme:w,refresh:{nodes:m},masterNodesCount:S}=st(s=>s.runtime),D=zt(),{height:M,width:I}=jt(D),p=!d.RMP_CLOUD&&S+1>Tt;_.useEffect(()=>{const s=Ot(e.current);Object.entries(s).filter(([f,x])=>x&&f in Rt).forEach(([f])=>Yt(f))},[m]);const[v,c]=_.useState({x:0,y:0}),[l,k]=_.useState({x:0,y:0}),[$,b]=_.useState({x:0,y:0}),[A,T]=_.useState({x:0,y:0}),K=B(s=>{const{x:f,y:x}=H(s);if(y.startsWith("station")){t(V("free"));const N=rt(10),E="stn_".concat(N),P=y.slice(8),L=structuredClone(ut[P].defaultAttrs);"color"in L&&(L.color=w);const{x:q,y:gt}=U(f,x,o,a);e.current.addNode(E,{visible:!0,zIndex:0,x:X(q,5),y:X(gt,5),type:P,[P]:L}),u(),i&&dt.event(lt.ADD_STATION,{type:P}),t(ot(new Set([E])))}else if(y.startsWith("misc-node")){t(V("free"));const N=rt(10),E="misc_node_".concat(N),P=y.slice(10),{x:L,y:q}=U(f,x,o,a);e.current.addNode(E,{visible:!0,zIndex:0,x:X(L,5),y:X(q,5),type:P,[P]:structuredClone(ft[P].defaultAttrs)}),u(),i&&dt.event(lt.ADD_STATION,{type:P}),t(ot(new Set([E])))}else y==="free"||y.startsWith("line")?(y.startsWith("line")&&(t(V("free")),g&&t(Lt(!1))),b({x:f,y:x}),T(a),s.shiftKey||(t(ct("background")),t(pt()))):y==="select"&&(c(U(f,x,o,a)),k(U(f,x,o,a)))}),z=B(s=>{if(y==="select"){if(v.x!=0&&v.y!=0){const{x:f,y:x}=H(s);k(U(f,x,o,a))}}else if(h==="background"){const{x:f,y:x}=H(s);t(yt({x:A.x+($.x-f)*o/100,y:A.y+($.y-x)*o/100}))}}),O=B(s=>{if(y==="select"){const{x:f,y:x}=H(s),{x:N,y:E}=U(f,x,o,a),P=Ft(e.current,v.x,v.y,N,E),L=Xt(e.current,new Set(P));t(ot(new Set([...s.shiftKey?r:[],...P,...L]))),t(V("free")),c({x:0,y:0}),k({x:0,y:0})}h==="background"&&!s.shiftKey&&t(ct(void 0))}),tt=B(s=>{let f=o;s.deltaY>0&&o+10<400?f=o+10:s.deltaY<0&&o-10>0&&(f=o-10),t(At(f));const{x,y:N}=H(s),E=s.currentTarget.getBoundingClientRect(),[P,L]=[x/E.width,N/E.height];t(yt({x:a.x+x*o/100-I*f/100*P,y:a.y+N*o/100-M*f/100*L}))}),W=B(async s=>{if(et?s.key==="Backspace":s.key==="Delete")r.size>0&&(r.forEach(f=>{e.current.hasNode(f)?e.current.dropNode(f):e.current.hasEdge(f)&&e.current.dropEdge(f)}),t(pt()),u());else if(s.key.startsWith("Arrow")){const x=s.key.endsWith("Left")?-1:s.key.endsWith("Right")?1:0,N=s.key.endsWith("Up")?-1:s.key.endsWith("Down")?1:0;t(yt(U(100*x,100*N,o,a)))}else if(s.key==="i"||s.key==="j"||s.key==="k"||s.key==="l"){const x=(s.key==="j"?-1:s.key==="l"?1:0)*10,N=(s.key==="i"?-1:s.key==="k"?1:0)*10;r.size>0&&r.forEach(E=>{e.current.hasNode(E)&&(e.current.updateNodeAttribute(E,"x",P=>(P!=null?P:0)+x),e.current.updateNodeAttribute(E,"y",P=>(P!=null?P:0)+N),u())})}else if(s.key==="f"&&n)t(V(n));else if(s.key==="z"&&(et?s.metaKey&&!s.shiftKey:s.ctrlKey))et&&s.preventDefault(),t($t()),t(at()),t(it());else if(s.key==="s")t(V("select"));else if((s.key==="c"||s.key==="x")&&(et?s.metaKey&&!s.shiftKey:s.ctrlKey)){const f=Wt(e.current,r);navigator.clipboard.writeText(f),s.key==="x"&&(t(pt()),r.forEach(x=>{e.current.hasNode(x)?e.current.dropNode(x):e.current.hasEdge(x)&&e.current.dropEdge(x)}),u())}else if(s.key==="v"&&(et?s.metaKey&&!s.shiftKey:s.ctrlKey)){const f=await navigator.clipboard.readText(),{x,y:N}=U(I/2,M/2,o,a),{nodes:E,edges:P}=Bt(f,e.current,p,X(x,5),X(N,5));u();const L=structuredClone(E);P.forEach(q=>L.add(q)),t(ot(L))}else(et&&s.key==="z"&&s.metaKey&&s.shiftKey||!et&&s.key==="y"&&s.ctrlKey)&&(t(Kt()),t(at()),t(it()))}),[Z,Q]=_.useState(0),G=B(s=>{if(s.touches.length===2){t(ct(void 0));const[f,x]=[s.touches[0].clientX-s.touches[1].clientX,s.touches[0].clientY-s.touches[1].clientY];Q(f*f+x*x)}}),R=B(s=>{if(Z!==0&&s.touches.length===2){const[f,x]=[s.touches[0].clientX-s.touches[1].clientX,s.touches[0].clientY-s.touches[1].clientY],N=f*f+x*x;let E=o;N-Z<0&&o+10<=390?E=o+10:N-Z>0&&o-10>=10&&(E=o-10),t(At(E)),Q(N);const P=s.currentTarget.getBoundingClientRect(),[L,q]=[(s.touches[0].clientX+s.touches[1].clientX)/2-P.left,(s.touches[0].clientY+s.touches[1].clientY)/2-P.top],[gt,Ct]=[L/P.width,q/P.height];t(yt({x:a.x+L*o/100-I*E/100*gt,y:a.y+q*o/100-M*E/100*Ct}))}}),nt=B(s=>{Z!==0&&Q(0)}),[j,F]=_.useState({sx:0,sy:0,ex:0,ey:0});return _.useEffect(()=>{F({sx:v.x<=l.x?v.x:l.x,ex:v.x>l.x?v.x:l.x,sy:v.y<=l.y?v.y:l.y,ey:v.y>l.y?v.y:l.y})},[l.x,l.y]),C.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:M,width:I,viewBox:"".concat(a.x," ").concat(a.y," ").concat(I*o/100," ").concat(M*o/100),onPointerDown:K,onPointerMove:z,onPointerUp:O,onTouchStart:G,onTouchMove:R,onTouchEnd:nt,onWheel:tt,tabIndex:0,onKeyDown:W,children:[C.jsx(Ht,{}),y==="select"&&v.x!=0&&v.y!=0&&C.jsx("rect",{x:j.sx,y:j.sy,width:j.ex-j.sx,height:j.ey-j.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),C.jsx("defs",{children:C.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[C.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),C.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})};export{re as default};
