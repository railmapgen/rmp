import{j as e,B as I,ak as O,al as fe,aw as _,v as T,az as xe,y as be,D as ye,H as se,M as ae,J as ie,K as re,N as le,av as oe,Q as ce,O as U}from"./chakra-BZH9ddpD.js";import{c as L,e as C,bi as Se,a0 as je,bj as we,b0 as Ce,w as A,y as P,q as z,aK as W,L as de,t as Ae,_ as B,bk as F,ag as ue,x as k,S as Ne,a7 as Ee,a8 as Te,k as H,F as pe,z as D,b1 as Z,aG as ve,bl as Pe,bm as ke,bn as Le,bo as Re,p as We,bf as Oe,bp as ze,n as Y,aP as Ie}from"./index-CZRk4mXI.js";import{u as R,b as c}from"./react-CLIJjNOF.js";import{f as De,g as Me,h as _e,b as Ue,e as ee}from"./change-types-R8n9NpRc.js";import{s as V,b as Be}from"./misc-nodes-D84wBzJL.js";import{C as Fe}from"./change-type-modal-DFqiSWZd.js";import{b as He}from"./localized-order-DpH-IUvh.js";import{u as te}from"./useEvent-D-PagYbH.js";function Ve(){const{t:n}=R(),s=L(),{selected:o}=C(t=>t.runtime),p=c.useRef(window.graph),d=t=>{if(p.current.hasNode(t)){const l=p.current.getNodeAttributes(t),x=l.type;return t.startsWith("stn")?l[x].names.join("/"):x}else if(p.current.hasEdge(t)){const[l,x]=p.current.extremities(t),u=p.current.getSourceAttributes(t),f=p.current.getTargetAttributes(t),w=u.type,g=f.type;return(l.startsWith("stn")?u[w].names[0]:w)+" - "+(x.startsWith("stn")?f[g].names[0]:g)}},[r,a]=c.useState([]);c.useEffect(()=>{a(["station","misc-node","line"])},[o]);const[i,S]=c.useState(!1);return e.jsxs(I,{children:[e.jsxs(O,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(fe,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(O,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(Se,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:r,multiSelect:!0,onChange:t=>a(t)})]}),r.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{width:"100%",size:"sm",onClick:()=>S(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(xe,{label:n("header.settings.pro"),children:e.jsx(be,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(ye,{})]}),[...o].filter(t=>r.includes("station")||!t.startsWith("stn")).filter(t=>r.includes("misc-node")||!t.startsWith("misc")).filter(t=>r.includes("line")||!t.startsWith("line")).map(t=>{var l;return e.jsxs(_,{width:"100%",children:[e.jsx(T,{width:"100%",size:"sm",variant:"solid",onClick:()=>s(je(new Set([t]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=d(t))==null?void 0:l.replaceAll("\n","âŽ")}),e.jsx(T,{size:"sm",onClick:()=>s(Ce(t)),children:e.jsx(we,{})})]},t)})]}),e.jsx(Fe,{isOpen:i,onClose:()=>S(!1),isSelect:!0,filter:r})]})}function Ge(){var J,Q;const{i18n:n,t:s}=R(),o=L(),p=c.useCallback(()=>{o(A(l.current.export())),o(P())},[o,P,A]),{activeSubscriptions:d}=C(h=>h.account),{preference:{autoParallel:r,disableWarning:a}}=C(h=>h.app),{selected:i,theme:S}=C(h=>h.runtime),[t]=i,l=c.useRef(window.graph),[x,u]=c.useState(!1),f=c.useRef(null),[w,g]=c.useState(!1),m=Object.fromEntries(Object.entries(z).map(([h,me])=>[h,s(me.metadata.displayName).toString()])),[j,y]=c.useState(l.current.getEdgeAttribute(t,"type")),[N,E]=c.useState(void 0),b=Object.fromEntries((Q=(J=He[n.language])==null?void 0:J.map(h=>[h,s(W[h].metadata.displayName).toString()]))!=null?Q:[]),[v,G]=c.useState(l.current.getEdgeAttribute(t,"style")),[X,K]=c.useState(void 0);c.useEffect(()=>{y(l.current.getEdgeAttribute(t,"type")),G(l.current.getEdgeAttribute(t,"style"))},[t]);const he=Object.values(de).filter(h=>!W[v].metadata.supportLinePathType.includes(h)||z[h].isPro&&!d.RMP_CLOUD),ge=Object.values(Ae).filter(h=>!W[h].metadata.supportLinePathType.includes(j)||W[h].isPro&&!d.RMP_CLOUD),$=h=>{h&&(De(l.current,t,h,r),y(l.current.getEdgeAttribute(t,"type")),p())},q=h=>{h&&(Me(l.current,t,h,S),G(l.current.getEdgeAttribute(t,"style")),p())},M=h=>{h&&(N?($(N),E(void 0)):X&&(q(X),K(void 0)),w&&o(ue(!0))),g(!1),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(F,{options:m,disabledOptions:he,defaultValue:j,value:j,onChange:({target:{value:h}})=>{a.changeType?$(h):(E(h),u(!0))}})}),e.jsx(B,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(F,{options:b,disabledOptions:ge,defaultValue:v,value:v,onChange:({target:{value:h}})=>{a.changeType?q(h):(K(h),u(!0))}})}),e.jsx(se,{isOpen:x,leastDestructiveRef:f,onClose:()=>M(!1),children:e.jsx(ae,{children:e.jsxs(ie,{children:[e.jsx(re,{children:s("warning")}),e.jsxs(le,{children:[s("panel.details.changeLineTypeContent"),e.jsx(oe,{mt:4,isChecked:w,onChange:h=>g(h.target.checked),width:"100%",children:s("noShowAgain")})]}),e.jsxs(ce,{children:[e.jsx(T,{ref:f,onClick:()=>M(!1),children:s("cancel")}),e.jsx(T,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:s("panel.details.changeType")})]})]})})})]})}function Xe(){const{t:n}=R(),s=L(),o=c.useCallback(()=>{s(A(S.current.export())),s(k())},[s,k,A]),{selected:p,refresh:{nodes:d}}=C(b=>b.runtime),{preference:{autoChangeStationType:r,disableWarning:a}}=C(b=>b.app),[i]=p,S=c.useRef(window.graph),[t,l]=c.useState(!1),x=c.useRef(null),[u,f]=c.useState(void 0),[w,g]=c.useState(!1),[m,j]=c.useState(Ne.ShmetroBasic);c.useEffect(()=>{if(i!=null&&i.startsWith("stn")){const b=S.current.getNodeAttribute(i,"type");j(b)}},[d,p]);const y=Object.fromEntries(Object.entries(V).map(([b,v])=>[b,n(v.metadata.displayName).toString()])),N=b=>{b&&(_e(S.current,i,b),r&&i.startsWith("stn")&&Ue(S.current,i),o())},E=b=>{b&&u&&(N(u),w&&s(ue(!0))),f(void 0),g(!1),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(F,{options:y,disabledOptions:[m],value:m,onChange:({target:{value:b}})=>{a.changeType?N(b):(f(b),l(!0))}})}),e.jsx(se,{isOpen:t,leastDestructiveRef:x,onClose:()=>E(!1),children:e.jsx(ae,{children:e.jsxs(ie,{children:[e.jsx(re,{children:n("warning")}),e.jsxs(le,{children:[n("panel.details.changeStationTypeContent"),e.jsx(oe,{mt:4,isChecked:w,onChange:b=>g(b.target.checked),width:"100%",children:n("noShowAgain")})]}),e.jsxs(ce,{children:[e.jsx(T,{ref:x,onClick:()=>E(!1),children:n("cancel")}),e.jsx(T,{ml:"2",colorScheme:"red",onClick:()=>E(!0),children:n("panel.details.changeType")})]})]})})})]})}function Ke(){const{t:n}=R(),s=L(),o=c.useCallback(()=>{s(A(i.current.export())),s(k()),s(P())},[s,k,P,A]),{activeSubscriptions:p}=C(u=>u.account),{selected:d,count:{parallel:r}}=C(u=>u.runtime),[a]=d,i=c.useRef(window.graph),S=u=>{const f=Math.min(Math.max(u,-10),10);i.current.hasNode(a)&&i.current.setNodeAttribute(a,"zIndex",f),i.current.hasEdge(a)&&i.current.setEdgeAttribute(a,"zIndex",f),o()},t=(u,f)=>{let w=-1;if(u){const g=i.current.getEdgeAttributes(a),[m,j]=i.current.extremities(a);w=pe(i.current,g.type,m,j,f)}l(w)},l=u=>{i.current.setEdgeAttribute(a,"parallelIndex",u),s(A(i.current.export())),s(P())},x=[];if(d.size!==0)if(d.size===1){if(x.push({type:"input",label:n("panel.details.info.id"),value:a,minW:276}),x.push({type:"select",label:n("panel.details.info.zIndex"),value:a?i.current.hasNode(a)?i.current.getNodeAttribute(a,"zIndex"):i.current.hasEdge(a)?i.current.getEdgeAttribute(a,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(u,f)=>[f-10,(f-10).toString()])),onChange:u=>S(Number(u))}),i.current.hasEdge(a)){const u=i.current.getEdgeAttributes(a),{parallelIndex:f,type:w}=u,g=p.RMP_CLOUD?Ee:Te,m=r>g&&f<0||w===de.Simple,j=r>g&&f>=0;x.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:m,isChecked:f>=0,onChange:y=>t(y,u[u.type].startFrom),oneLine:!0,minW:276}),f>=0&&x.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:j,value:u.parallelIndex.toString(),onChange:y=>l(Number(y)),minW:276})}}else d.size>1&&x.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(I,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(H,{fields:x,minW:130}),d.size===1&&a.startsWith("stn")&&i.current.hasNode(a)&&i.current.getNodeAttribute(a,"type")in V&&e.jsx(Xe,{}),d.size===1&&a.startsWith("line")&&i.current.hasEdge(a)&&i.current.getEdgeAttribute(a,"type")in z&&i.current.getEdgeAttribute(a,"style")in W&&e.jsx(Ge,{}),d.size>1&&e.jsx(Ve,{})]})}function $e(){const{t:n}=R(),s=L(),{selected:o}=C(m=>m.runtime),[p]=o,d=c.useRef(window.graph),[r,a]=c.useState("undefined"),[i,S]=c.useState("undefined"),[t,l]=c.useState("undefined"),[x,u]=c.useState("undefined");c.useEffect(()=>{var m,j,y,N;if(p!=null&&p.startsWith("line")){const[E,b]=d.current.extremities(p);if(a(E),S(b),E.startsWith("stn")){const v=d.current.getNodeAttribute(E,"type");l((j=(m=d.current.getNodeAttribute(E,v))==null?void 0:m.names.at(0))!=null?j:"undefined")}if(b.startsWith("stn")){const v=d.current.getNodeAttribute(b,"type");u((N=(y=d.current.getNodeAttribute(b,v))==null?void 0:y.names.at(0))!=null?N:"undefined")}}},[o]);const f=te(()=>{s(D()),s(Z(r))}),w=te(()=>{s(D()),s(Z(i))}),g=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(T,{ml:"auto",size:"sm",variant:"link",onClick:f,children:r}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:t,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(T,{ml:"auto",size:"sm",variant:"link",onClick:w,children:i}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:x,minW:"full"}];return e.jsxs(I,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(H,{fields:g,minW:130})]})}function qe(){const{t:n}=R(),s=L(),o=c.useCallback(()=>{s(A(a.current.export())),s(k()),s(P())},[s,k,P,A]),{selected:p,refresh:{nodes:d}}=C(l=>l.runtime),[r]=p,a=c.useRef(window.graph),[i,S]=c.useState({x:0,y:0});c.useEffect(()=>{if(r!=null&&r.startsWith("stn")||r!=null&&r.startsWith("misc_node_")){const l=a.current.getNodeAttribute(r,"x"),x=a.current.getNodeAttribute(r,"y");S({x:l,y:x})}},[d,p]);const t=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:i.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{a.current.mergeNodeAttributes(r,{x:Number(l)}),o()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:i.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{a.current.mergeNodeAttributes(r,{y:Number(l)}),o()}}];return e.jsxs(I,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(H,{fields:t,minW:130})]})}const ne={...V,...Be},Je=()=>{var S;const n=L(),{selected:s}=C(t=>t.runtime),{t:o}=R(),[p]=s,d=window.graph.getNodeAttribute(p,"type"),r=d in ne&&ne[d].attrsComponent,a=(S=window.graph.getNodeAttribute(p,d))!=null?S:{},i=(t,l)=>{const x=window.graph.getNodeAttribute(t,"type");window.graph.mergeNodeAttributes(t,{[x]:l}),n(A(window.graph.export())),n(k())};return r?e.jsx(r,{id:p,attrs:a,handleAttrsUpdate:i}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Qe=()=>{var m,j;const n=L(),{preference:{autoParallel:s}}=C(y=>y.app),{selected:o}=C(y=>y.runtime),{t:p}=R(),[d]=o,{type:r,style:a,parallelIndex:i,reconcileId:S}=window.graph.getEdgeAttributes(d),t=(m=window.graph.getEdgeAttribute(d,r))!=null?m:{},l=r in z&&z[r].attrsComponent,x=(j=window.graph.getEdgeAttribute(d,a))!=null?j:{},u=a in W&&W[a].attrsComponent,f=(y,N)=>{let E=-1;if(s){const[b,v]=window.graph.extremities(y);E=pe(window.graph,r,b,v,N)}window.graph.setEdgeAttribute(y,"parallelIndex",E)},w=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[r]:N}),n(A(window.graph.export())),n(P())},g=(y,N)=>{window.graph.mergeEdgeAttributes(y,{[a]:N}),n(A(window.graph.export())),n(P())};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:d,attrs:t,recalculateParallelIndex:f,handleAttrsUpdate:w,parallelIndex:i}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:p("panel.details.unknown.error",{category:p("panel.details.unknown.linePath")})}),u?e.jsx(u,{id:d,attrs:x,handleAttrsUpdate:g,reconcileId:S}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:p("panel.details.unknown.error",{category:p("panel.details.unknown.lineStyle")})})]})},rt=()=>{const{t:n}=R(),s=L(),o=c.useRef(window.graph),p=c.useCallback(()=>{s(A(o.current.export())),s(k()),s(P())},[s,k,P,A]),{activeSubscriptions:d}=C(g=>g.account),{selected:r,isDetailsOpen:a,count:{masters:i}}=C(g=>g.runtime),{preference:{autoChangeStationType:S}}=C(g=>g.app),[t]=r,l=!d.RMP_CLOUD&&i+1>ve,x=()=>{Oe()?s(ze()):s(D())},u=g=>{const m=structuredClone(o.current.getNodeAttributes(g));m.x+=50,m.y+=50;const j=g.startsWith("stn")?"stn_".concat(Y(10)):"misc_node_".concat(Y(10));o.current.addNode(j,m),s(A(o.current.export())),s(k())},f=g=>{const m=Ie(o.current,g);navigator.clipboard.writeText(m)},w=g=>{s(D()),g.forEach(m=>{if(o.current.hasNode(m))o.current.dropNode(m);else if(o.current.hasEdge(m)){const[j,y]=o.current.extremities(m);o.current.dropEdge(m),S&&j.startsWith("stn")&&ee(o.current,j),S&&y.startsWith("stn")&&ee(o.current,y)}}),p()};return e.jsxs(Pe,{isOpen:a==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ke,{onClose:x,children:n("panel.details.header")}),e.jsxs(Le,{children:[e.jsx(Ke,{}),r.size===1&&o.current.hasNode(t)&&e.jsx(qe,{}),r.size===1&&o.current.hasEdge(t)&&e.jsx($e,{}),r.size===1&&e.jsxs(I,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(t)&&e.jsx(Je,{}),window.graph.hasEdge(t)&&e.jsx(Qe,{})]})]}),e.jsx(Re,{children:e.jsxs(_,{children:[r.size===1&&o.current.hasNode(t)&&e.jsx(T,{size:"sm",variant:"outline",onClick:()=>u(t),isDisabled:o.current.getNodeAttributes(t).type===We.Master&&l,children:n("panel.details.footer.duplicate")}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>f(r),children:n("panel.details.footer.copy")}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>w(r),children:n("panel.details.footer.remove")})]})})]})};export{rt as default};
