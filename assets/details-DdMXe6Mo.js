import{j as e,B as z,aj as W,ak as de,av as _,t as N,aw as ue,x as pe,D as he,G as K,M as Y,H as ee,J as te,L as ne,O as se,N as B}from"./chakra-C1zJvDsN.js";import{c as P,e as w,b9 as ge,X as me,ba as fe,aS as xe,w as C,y as T,q as I,aQ as O,L as ae,p as ye,V as F,bb as U,x as v,S as be,a3 as Se,a4 as je,k as H,o as re,F as D,aT as $,aB as we,bc as Ce,bd as Ae,be as Ne,bf as Ee,aI as Te,b4 as ve,bg as Le,n as q,aC as Pe}from"./index-QvbTiJd3.js";import{u as R,b as d}from"./react-BpF4RbzH.js";import{a as Re,b as ke,d as Oe,e as We,c as J}from"./change-types-BeKJ5qpu.js";import{s as V}from"./master-manager-CUyvBcT7.js";import{C as ze}from"./change-type-modal-DgA8zi9L.js";import{l as Ie,L as De}from"./tools-B_PAOhfw.js";import{u as Q}from"./useEvent-LzhclC4A.js";import{m as Me}from"./misc-nodes-F7uih2Lq.js";function _e(){const{t:s}=R(),r=P(),{selected:l}=w(a=>a.runtime),u=d.useRef(window.graph),p=a=>{if(u.current.hasNode(a)){const o=u.current.getNodeAttributes(a),y=o.type;return a.startsWith("stn")?o[y].names.join("/"):y}else if(u.current.hasEdge(a)){const[o,y]=u.current.extremities(a),h=u.current.getSourceAttributes(a),f=u.current.getTargetAttributes(a),S=h.type,g=f.type;return(o.startsWith("stn")?h[S].names[0]:S)+" - "+(y.startsWith("stn")?f[g].names[0]:g)}},[i,t]=d.useState([]);d.useEffect(()=>{t(["station","misc-node","line"])},[l]);const[n,m]=d.useState(!1);return e.jsxs(z,{children:[e.jsxs(W,{as:"h5",size:"sm",children:[s("panel.details.multipleSelection.selected")," ",l.size]}),e.jsxs(de,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(W,{as:"h5",size:"xs",w:"100%",children:s("panel.details.multipleSelection.show")}),e.jsx(ge,{selections:[{label:s("panel.details.multipleSelection.station"),value:"station"},{label:s("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:s("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:i,multiSelect:!0,onChange:a=>t(a)})]}),i.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(N,{width:"100%",size:"sm",onClick:()=>m(!0),children:[s("panel.details.multipleSelection.change"),e.jsx(ue,{label:s("header.settings.pro"),children:e.jsx(pe,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(he,{})]}),[...l].filter(a=>i.includes("station")||!a.startsWith("stn")).filter(a=>i.includes("misc-node")||!a.startsWith("misc")).filter(a=>i.includes("line")||!a.startsWith("line")).map(a=>{var o;return e.jsxs(_,{width:"100%",children:[e.jsx(N,{width:"100%",size:"sm",variant:"solid",onClick:()=>r(me(new Set([a]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(o=p(a))==null?void 0:o.replaceAll("\n","âŽ")}),e.jsx(N,{size:"sm",onClick:()=>r(xe(a)),children:e.jsx(fe,{})})]},a)})]}),e.jsx(ze,{isOpen:n,onClose:()=>m(!1),isSelect:!0,filter:i})]})}function Be(){var X,G;const{i18n:s,t:r}=R(),l=P(),u=d.useCallback(()=>{l(C(m.current.export())),l(T())},[l,T,C]),{preference:{autoParallel:p}}=w(j=>j.app),{selected:i,theme:t}=w(j=>j.runtime),[n]=i,m=d.useRef(window.graph),[a,o]=d.useState(!1),y=d.useRef(null),h=Object.fromEntries(Object.entries(I).map(([j,ce])=>[j,r(ce.metadata.displayName).toString()])),[f,S]=d.useState(m.current.getEdgeAttribute(n,"type")),[g,x]=d.useState(void 0),b=Object.fromEntries((G=(X=Ie[s.language])==null?void 0:X.map(j=>[j,r(O[j].metadata.displayName).toString()]))!=null?G:[]),[c,A]=d.useState(m.current.getEdgeAttribute(n,"style")),[E,L]=d.useState(void 0);d.useEffect(()=>{S(m.current.getEdgeAttribute(n,"type")),A(m.current.getEdgeAttribute(n,"style"))},[n]);const k=Object.values(ae).filter(j=>!O[c].metadata.supportLinePathType.includes(j)),ie=Object.values(ye).filter(j=>!O[j].metadata.supportLinePathType.includes(f)),le=()=>{g&&(Re(m.current,n,g,p),S(m.current.getEdgeAttribute(n,"type")),u())},oe=()=>{E&&(ke(m.current,n,E,t),A(m.current.getEdgeAttribute(n,"style")),u())},M=j=>{j&&(g?(le(),x(void 0)):E&&(oe(),L(void 0))),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:r("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:h,disabledOptions:k,defaultValue:f,value:f,onChange:({target:{value:j}})=>{x(j),o(!0)}})}),e.jsx(F,{label:r("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:b,disabledOptions:ie,defaultValue:c,value:c,onChange:({target:{value:j}})=>{L(j),o(!0)}})}),e.jsx(De,{type:"line",expand:!0}),e.jsx(K,{isOpen:a,leastDestructiveRef:y,onClose:()=>M(!1),children:e.jsx(Y,{children:e.jsxs(ee,{children:[e.jsx(te,{children:r("warning")}),e.jsx(ne,{children:r("panel.details.changeLineTypeContent")}),e.jsxs(se,{children:[e.jsx(N,{ref:y,onClick:()=>M(!1),children:r("cancel")}),e.jsx(N,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:r("panel.details.changeType")})]})]})})})]})}function Fe(){const{t:s}=R(),r=P(),l=d.useCallback(()=>{r(C(n.current.export())),r(v())},[r,v,C]),{selected:u,refresh:{nodes:p}}=w(c=>c.runtime),{preference:{autoChangeStationType:i}}=w(c=>c.app),[t]=u,n=d.useRef(window.graph),[m,a]=d.useState(!1),o=d.useRef(null),[y,h]=d.useState(void 0),[f,S]=d.useState(be.ShmetroBasic);d.useEffect(()=>{if(t!=null&&t.startsWith("stn")){const c=n.current.getNodeAttribute(t,"type");S(c)}},[p,u]);const g=Object.fromEntries(Object.entries(V).map(([c,A])=>[c,s(A.metadata.displayName).toString()])),x=()=>{y&&(Oe(n.current,t,y),i&&t.startsWith("stn")&&We(n.current,t),l())},b=c=>{c&&x(),h(void 0),a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:g,disabledOptions:[f],value:f,onChange:({target:{value:c}})=>{h(c),a(!0)}})}),e.jsx(K,{isOpen:m,leastDestructiveRef:o,onClose:()=>b(!1),children:e.jsx(Y,{children:e.jsxs(ee,{children:[e.jsx(te,{children:s("warning")}),e.jsx(ne,{children:s("panel.details.changeStationTypeContent")}),e.jsxs(se,{children:[e.jsx(N,{ref:o,onClick:()=>b(!1),children:s("cancel")}),e.jsx(N,{ml:"2",colorScheme:"red",onClick:()=>b(!0),children:s("panel.details.changeType")})]})]})})})]})}function Ue(){const{t:s}=R(),r=P(),l=d.useCallback(()=>{r(C(n.current.export())),r(v()),r(T())},[r,v,T,C]),{activeSubscriptions:u}=w(h=>h.account),{selected:p,count:{parallel:i}}=w(h=>h.runtime),[t]=p,n=d.useRef(window.graph),m=h=>{const f=Math.min(Math.max(h,-10),10);n.current.hasNode(t)&&n.current.setNodeAttribute(t,"zIndex",f),n.current.hasEdge(t)&&n.current.setEdgeAttribute(t,"zIndex",f),l()},a=(h,f)=>{let S=-1;if(h){const g=n.current.getEdgeAttributes(t),[x,b]=n.current.extremities(t);S=re(n.current,g.type,x,b,f)}o(S)},o=h=>{n.current.setEdgeAttribute(t,"parallelIndex",h),r(C(n.current.export())),r(T())},y=[];if(p.size!==0)if(p.size===1){if(y.push({type:"input",label:s("panel.details.info.id"),value:t,minW:276}),y.push({type:"select",label:s("panel.details.info.zIndex"),value:t?n.current.hasNode(t)?n.current.getNodeAttribute(t,"zIndex"):n.current.hasEdge(t)?n.current.getEdgeAttribute(t,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(h,f)=>[f-10,(f-10).toString()])),onChange:h=>m(Number(h))}),n.current.hasEdge(t)){const h=n.current.getEdgeAttributes(t),{parallelIndex:f,type:S}=h,g=u.RMP_CLOUD?Se:je,x=i>g&&f<0||S===ae.Simple,b=i>g&&f>=0;y.push({type:"switch",label:s("panel.details.info.parallel"),isDisabled:x,isChecked:f>=0,onChange:c=>a(c,h[h.type].startFrom),oneLine:!0,minW:276}),f>=0&&y.push({type:"input",label:s("panel.details.info.parallelIndex"),variant:"number",isDisabled:b,value:h.parallelIndex.toString(),onChange:c=>o(Number(c)),minW:276})}}else p.size>1&&y.push({type:"input",label:s("panel.details.info.type"),value:s("panel.details.multipleSelection.title"),minW:276});return e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.info.title")}),e.jsx(H,{fields:y,minW:130}),p.size===1&&t.startsWith("stn")&&n.current.hasNode(t)&&n.current.getNodeAttribute(t,"type")in V&&e.jsx(Fe,{}),p.size===1&&t.startsWith("line")&&n.current.hasEdge(t)&&n.current.getEdgeAttribute(t,"type")in I&&n.current.getEdgeAttribute(t,"style")in O&&e.jsx(Be,{}),p.size>1&&e.jsx(_e,{})]})}function He(){const{t:s}=R(),r=P(),{selected:l}=w(x=>x.runtime),[u]=l,p=d.useRef(window.graph),[i,t]=d.useState("undefined"),[n,m]=d.useState("undefined"),[a,o]=d.useState("undefined"),[y,h]=d.useState("undefined");d.useEffect(()=>{var x,b,c,A;if(u!=null&&u.startsWith("line")){const[E,L]=p.current.extremities(u);if(t(E),m(L),E.startsWith("stn")){const k=p.current.getNodeAttribute(E,"type");o((b=(x=p.current.getNodeAttribute(E,k))==null?void 0:x.names.at(0))!=null?b:"undefined")}if(L.startsWith("stn")){const k=p.current.getNodeAttribute(L,"type");h((A=(c=p.current.getNodeAttribute(L,k))==null?void 0:c.names.at(0))!=null?A:"undefined")}}},[l]);const f=Q(()=>{r(D()),r($(i))}),S=Q(()=>{r(D()),r($(n))}),g=[{type:"custom",label:s("panel.details.lineExtremities.source"),component:e.jsx(N,{ml:"auto",size:"sm",variant:"link",onClick:f,children:i}),oneLine:!0,minW:"full"},{type:"input",label:s("panel.details.lineExtremities.sourceName"),value:a,minW:"full"},{type:"custom",label:s("panel.details.lineExtremities.target"),component:e.jsx(N,{ml:"auto",size:"sm",variant:"link",onClick:S,children:n}),oneLine:!0,minW:"full"},{type:"input",label:s("panel.details.lineExtremities.targetName"),value:y,minW:"full"}];return e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.lineExtremities.title")}),e.jsx(H,{fields:g,minW:130})]})}function Ve(){const{t:s}=R(),r=P(),l=d.useCallback(()=>{r(C(t.current.export())),r(v()),r(T())},[r,v,T,C]),{selected:u,refresh:{nodes:p}}=w(o=>o.runtime),[i]=u,t=d.useRef(window.graph),[n,m]=d.useState({x:0,y:0});d.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const o=t.current.getNodeAttribute(i,"x"),y=t.current.getNodeAttribute(i,"y");m({x:o,y})}},[p,u]);const a=[{type:"input",label:s("panel.details.nodePosition.pos.x"),value:n.x.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{t.current.mergeNodeAttributes(i,{x:Number(o)}),l()}},{type:"input",label:s("panel.details.nodePosition.pos.y"),value:n.y.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{t.current.mergeNodeAttributes(i,{y:Number(o)}),l()}}];return e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.nodePosition.title")}),e.jsx(H,{fields:a,minW:130})]})}const Z={...V,...Me},Xe=()=>{var m;const s=P(),{selected:r}=w(a=>a.runtime),{t:l}=R(),[u]=r,p=window.graph.getNodeAttribute(u,"type"),i=p in Z&&Z[p].attrsComponent,t=(m=window.graph.getNodeAttribute(u,p))!=null?m:{},n=(a,o)=>{const y=window.graph.getNodeAttribute(a,"type");window.graph.mergeNodeAttributes(a,{[y]:o}),s(C(window.graph.export())),s(v())};return i?e.jsx(i,{id:u,attrs:t,handleAttrsUpdate:n}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:l("panel.details.unknown.error",{category:l("panel.details.unknown.node")})})},Ge=()=>{var x,b;const s=P(),{preference:{autoParallel:r}}=w(c=>c.app),{selected:l}=w(c=>c.runtime),{t:u}=R(),[p]=l,{type:i,style:t,parallelIndex:n,reconcileId:m}=window.graph.getEdgeAttributes(p),a=(x=window.graph.getEdgeAttribute(p,i))!=null?x:{},o=i in I&&I[i].attrsComponent,y=(b=window.graph.getEdgeAttribute(p,t))!=null?b:{},h=t in O&&O[t].attrsComponent,f=(c,A)=>{let E=-1;if(r){const[L,k]=window.graph.extremities(c);E=re(window.graph,i,L,k,A)}window.graph.setEdgeAttribute(c,"parallelIndex",E)},S=(c,A)=>{window.graph.mergeEdgeAttributes(c,{[i]:A}),s(C(window.graph.export())),s(T())},g=(c,A)=>{window.graph.mergeEdgeAttributes(c,{[t]:A}),s(C(window.graph.export())),s(T())};return e.jsxs(e.Fragment,{children:[o?e.jsx(o,{id:p,attrs:a,recalculateParallelIndex:f,handleAttrsUpdate:S,parallelIndex:n}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:u("panel.details.unknown.error",{category:u("panel.details.unknown.linePath")})}),h?e.jsx(h,{id:p,attrs:y,handleAttrsUpdate:g,reconcileId:m}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:u("panel.details.unknown.error",{category:u("panel.details.unknown.lineStyle")})})]})},nt=()=>{const{t:s}=R(),r=P(),l=d.useRef(window.graph),u=d.useCallback(()=>{r(C(l.current.export())),r(v()),r(T())},[r,v,T,C]),{activeSubscriptions:p}=w(g=>g.account),{selected:i,isDetailsOpen:t,count:{masters:n}}=w(g=>g.runtime),{preference:{autoChangeStationType:m}}=w(g=>g.app),[a]=i,o=!p.RMP_CLOUD&&n+1>we,y=()=>{ve()?r(Le()):r(D())},h=g=>{const x=structuredClone(l.current.getNodeAttributes(g));x.x+=50,x.y+=50;const b=g.startsWith("stn")?"stn_".concat(q(10)):"misc_node_".concat(q(10));l.current.addNode(b,x),r(C(l.current.export())),r(v())},f=g=>{const x=Pe(l.current,g);navigator.clipboard.writeText(x)},S=g=>{r(D()),g.forEach(x=>{if(l.current.hasNode(x))l.current.dropNode(x);else if(l.current.hasEdge(x)){const[b,c]=l.current.extremities(x);l.current.dropEdge(x),m&&b.startsWith("stn")&&J(l.current,b),m&&c.startsWith("stn")&&J(l.current,c)}}),u()};return e.jsxs(Ce,{isOpen:t==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(Ae,{onClose:y,children:s("panel.details.header")}),e.jsxs(Ne,{children:[e.jsx(Ue,{}),i.size===1&&l.current.hasNode(a)&&e.jsx(Ve,{}),i.size===1&&l.current.hasEdge(a)&&e.jsx(He,{}),i.size===1&&e.jsxs(z,{p:1,children:[e.jsx(W,{as:"h5",size:"sm",children:s("panel.details.specificAttrsTitle")}),window.graph.hasNode(a)&&e.jsx(Xe,{}),window.graph.hasEdge(a)&&e.jsx(Ge,{})]})]}),e.jsx(Ee,{children:e.jsxs(_,{children:[i.size===1&&l.current.hasNode(a)&&e.jsx(N,{size:"sm",variant:"outline",onClick:()=>h(a),isDisabled:l.current.getNodeAttributes(a).type===Te.Master&&o,children:s("panel.details.footer.duplicate")}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>f(i),children:s("panel.details.footer.copy")}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>S(i),children:s("panel.details.footer.remove")})]})})]})};export{nt as default};
