import{j as s,ag as le,M as ce,ah as re,J as de,N as z,K as he,L as pe,aG as ue,aH as ye,aI as ge,B as Se,aJ as me,aK as fe,O as Te,t as D,aw as Ce}from"./chakra-C1zJvDsN.js";import{c as xe,e as I,w as H,x as G,y as J,q as be,aQ as Le,C as je,M as we,S as Oe,p as ve,L as Ie,Z as Pe,W as Be,R as Me,_ as Ne,k as ke}from"./index-QvbTiJd3.js";import{u as Re,b as a}from"./react-BpF4RbzH.js";import{f as We,c as Ae,g as Ee,h as Fe,i as Ze,j as _e,k as ze}from"./change-types-BeKJ5qpu.js";import{s as De,g as He}from"./master-manager-CUyvBcT7.js";const Qe=K=>{const{isOpen:y,onClose:g,isSelect:c,filter:n}=K,{t}=Re(),p=xe(),{selected:d}=I(e=>e.runtime),{preference:{autoParallel:U,autoChangeStationType:q}}=I(e=>e.app),{activeSubscriptions:P}=I(e=>e.account),Q=a.useCallback(()=>{p(H(i.current.export())),p(G()),p(J())},[p,G,J,H]),i=a.useRef(window.graph),B={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(be).map(([e,o])=>[e,t(o.metadata.displayName).toString()]))},M={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(Le).map(([e,o])=>[e,t(o.metadata.displayName).toString()]))},N={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(De).map(([e,o])=>[e,t(o.metadata.displayName).toString()]))},S={id:"any",theme:[je.Other,"other","#ffffff",we.black],value:t("header.settings.procedures.changeType.any")},[m,k]=a.useState(!1),[R,W]=a.useState(0),[f,A]=a.useState(!1),[T,V]=a.useState("any"),[C,X]=a.useState(Oe.ShmetroBasic),[x,E]=a.useState(!1),[b,Y]=a.useState("any"),[L,$]=a.useState(ve.SingleColor),[j,F]=a.useState(!1),[w,ee]=a.useState("any"),[O,te]=a.useState(Ie.Diagonal),[v,Z]=a.useState(!1),[h,_]=a.useState(S),{theme:u,requestThemeChange:se}=Pe(),[ne,ae]=a.useState([]),ie=[{id:"changeZIndex",title:t("header.settings.procedures.changeZIndex"),onClose:()=>k(!m),field:[{type:"select",label:t("panel.details.info.zIndex"),value:R,options:Object.fromEntries(Array.from({length:21},(e,o)=>[o-10,(o-10).toString()])),onChange:e=>W(Number(e))}]},{id:"changeStationType",title:t("header.settings.procedures.changeStationType.title"),onClose:()=>A(!f),field:[{type:"select",label:t("header.settings.procedures.changeStationType.changeFrom"),options:N,value:T,disabledOptions:[C],onChange:e=>V(e)},{type:"select",label:t("header.settings.procedures.changeStationType.changeTo"),options:N,value:C,disabledOptions:["any",T],onChange:e=>X(e)}]},{id:"changeLineStyleType",title:t("header.settings.procedures.changeLineStyleType.title"),onClose:()=>E(!x),field:[{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeFrom"),options:M,value:b,disabledOptions:[L],onChange:e=>Y(e)},{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeTo"),options:M,value:L,disabledOptions:["any",b],onChange:e=>$(e)}]},{id:"changeLinePathType",title:t("header.settings.procedures.changeLinePathType.title"),onClose:()=>F(!j),field:[{type:"select",label:t("header.settings.procedures.changeLinePathType.changeFrom"),options:B,value:w,disabledOptions:[O],onChange:e=>ee(e)},{type:"select",label:t("header.settings.procedures.changeLinePathType.changeTo"),options:B,value:O,disabledOptions:["any","simple",w],onChange:e=>te(e)}]},{id:"changeColor",title:t("header.settings.procedures.changeColor.title"),onClose:()=>Z(!v),field:[{type:"custom",label:t("header.settings.procedures.changeColor.changeFrom"),component:s.jsx(Be,{data:ne,displayHandler:e=>s.jsx(Me,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,o)=>o.id.toLowerCase().includes(e.toLowerCase())||Object.values(o.id).some(r=>r.toLowerCase().includes(e.toLowerCase())),value:h.value,onChange:e=>_(e)})},{type:"custom",label:t("header.settings.procedures.changeColor.changeTo"),component:s.jsx(Ne,{theme:u,onClick:se})}]}];a.useEffect(()=>{y&&(k(!1),A(!1),E(!1),F(!1),Z(!1),W(0),ae([S,...He(i.current,c?[...d].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):i.current.nodes(),c?[...d].filter(e=>e.startsWith("line")):i.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),_(S))},[y]);const oe=()=>{const e=n!=null&&n.includes("station")?[...d].filter(l=>l.startsWith("stn")):c?[]:i.current.filterNodes(l=>l.startsWith("stn")),o=n!=null&&n.includes("misc-node")?[...d].filter(l=>l.startsWith("misc_node")):c?[]:i.current.filterNodes(l=>l.startsWith("misc_node")),r=c?[...d].filter(l=>l.startsWith("line")):i.current.edges();(!n||n.includes("station"))&&f&&(We(i.current,T,C,e),q&&e.forEach(l=>Ae(i.current,l))),(!n||n.includes("line"))&&x&&Ee(i.current,b,L,u,r),(!n||n.includes("line"))&&j&&Fe(i.current,w,O,r,U),v&&((!n||n.includes("line"))&&Ze(i.current,h.id==="any"?"any":h.theme,u,r),(!n||n.includes("misc-node")||n.includes("station"))&&_e(i.current,h.id==="any"?"any":h.theme,u,e,o)),m&&ze(i.current,e,o,r,R),Q(),g()};return s.jsxs(le,{isOpen:y,onClose:g,size:"md",scrollBehavior:"inside",children:[s.jsx(ce,{}),s.jsxs(re,{children:[s.jsxs(de,{children:[s.jsx(z,{as:"b",fontSize:"xl",children:t(c?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),s.jsx(he,{})]}),s.jsx(pe,{children:s.jsx(ue,{allowMultiple:!0,children:ie.map(e=>s.jsxs(ye,{children:[s.jsxs(ge,{onClick:e.onClose,children:[s.jsx(Se,{as:"span",flex:"1",textAlign:"left",children:s.jsx(z,{as:"b",fontSize:"md",children:e.title})}),s.jsx(me,{})]}),s.jsx(fe,{pb:4,children:s.jsx(ke,{fields:e.field,minW:270})})]},e.id))})}),s.jsxs(Te,{children:[s.jsx(D,{colorScheme:"blue",variant:"outline",mr:"1",onClick:g,children:t("cancel")}),s.jsx(Ce,{label:t("header.settings.pro"),isOpen:!P.RMP_CLOUD,children:s.jsx(D,{colorScheme:"red",mr:"1",onClick:oe,isDisabled:!P.RMP_CLOUD||!m&&!f&&!x&&!j&&!v,children:t("apply")})})]})]})]})};export{Qe as C};
