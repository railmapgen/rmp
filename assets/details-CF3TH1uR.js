import{j as e,B as D,aj as O,ak as fe,av as _,t as T,ax as xe,x as ye,D as be,G as se,M as ae,H as ie,J as re,L as le,au as oe,O as ce,N as U}from"./chakra-B1xyVt4l.js";import{c as k,e as C,ba as Se,Z as je,bb as we,aU as Ce,x as A,z as P,t as z,aS as W,L as de,q as Ae,X as B,bc as F,ad as ue,y as L,S as Ne,a4 as Ee,a5 as Te,k as H,p as pe,G as I,aV as Q,aD as ve,bd as Pe,be as Le,bf as ke,bg as Re,aK as We,b5 as Oe,bh as ze,n as Y,aE as De}from"./index-jqQNyENG.js";import{u as R,b as c}from"./react-BpF4RbzH.js";import{a as Ie,b as Me,d as _e,e as Ue,c as ee}from"./change-types-OYI17Ksc.js";import{s as V}from"./master-manager-BqLL1imx.js";import{C as Be}from"./change-type-modal-DN8cfqhR.js";import{l as Fe,L as He}from"./tools-BpprkpMJ.js";import{u as te}from"./useEvent-LzhclC4A.js";import{m as Ve}from"./misc-nodes-Bhvkuzj6.js";function Ge(){const{t:n}=R(),s=k(),{selected:o}=C(t=>t.runtime),p=c.useRef(window.graph),d=t=>{if(p.current.hasNode(t)){const l=p.current.getNodeAttributes(t),x=l.type;return t.startsWith("stn")?l[x].names.join("/"):x}else if(p.current.hasEdge(t)){const[l,x]=p.current.extremities(t),u=p.current.getSourceAttributes(t),f=p.current.getTargetAttributes(t),w=u.type,g=f.type;return(l.startsWith("stn")?u[w].names[0]:w)+" - "+(x.startsWith("stn")?f[g].names[0]:g)}},[r,a]=c.useState([]);c.useEffect(()=>{a(["station","misc-node","line"])},[o]);const[i,S]=c.useState(!1);return e.jsxs(D,{children:[e.jsxs(O,{as:"h5",size:"sm",children:[n("panel.details.multipleSelection.selected")," ",o.size]}),e.jsxs(fe,{m:"var(--chakra-space-1)",children:[e.jsxs(_,{w:"100%",children:[e.jsx(O,{as:"h5",size:"xs",w:"100%",children:n("panel.details.multipleSelection.show")}),e.jsx(Se,{selections:[{label:n("panel.details.multipleSelection.station"),value:"station"},{label:n("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:n("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:r,multiSelect:!0,onChange:t=>a(t)})]}),r.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{width:"100%",size:"sm",onClick:()=>S(!0),children:[n("panel.details.multipleSelection.change"),e.jsx(xe,{label:n("header.settings.pro"),children:e.jsx(ye,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(be,{})]}),[...o].filter(t=>r.includes("station")||!t.startsWith("stn")).filter(t=>r.includes("misc-node")||!t.startsWith("misc")).filter(t=>r.includes("line")||!t.startsWith("line")).map(t=>{var l;return e.jsxs(_,{width:"100%",children:[e.jsx(T,{width:"100%",size:"sm",variant:"solid",onClick:()=>s(je(new Set([t]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(l=d(t))==null?void 0:l.replaceAll("\n","âŽ")}),e.jsx(T,{size:"sm",onClick:()=>s(Ce(t)),children:e.jsx(we,{})})]},t)})]}),e.jsx(Be,{isOpen:i,onClose:()=>S(!1),isSelect:!0,filter:r})]})}function Xe(){var J,K;const{i18n:n,t:s}=R(),o=k(),p=c.useCallback(()=>{o(A(l.current.export())),o(P())},[o,P,A]),{activeSubscriptions:d}=C(h=>h.account),{preference:{autoParallel:r,disableWarning:a}}=C(h=>h.app),{selected:i,theme:S}=C(h=>h.runtime),[t]=i,l=c.useRef(window.graph),[x,u]=c.useState(!1),f=c.useRef(null),[w,g]=c.useState(!1),m=Object.fromEntries(Object.entries(z).map(([h,me])=>[h,s(me.metadata.displayName).toString()])),[j,b]=c.useState(l.current.getEdgeAttribute(t,"type")),[N,E]=c.useState(void 0),y=Object.fromEntries((K=(J=Fe[n.language])==null?void 0:J.map(h=>[h,s(W[h].metadata.displayName).toString()]))!=null?K:[]),[v,G]=c.useState(l.current.getEdgeAttribute(t,"style")),[X,Z]=c.useState(void 0);c.useEffect(()=>{b(l.current.getEdgeAttribute(t,"type")),G(l.current.getEdgeAttribute(t,"style"))},[t]);const he=Object.values(de).filter(h=>!W[v].metadata.supportLinePathType.includes(h)||z[h].isPro&&!d.RMP_CLOUD),ge=Object.values(Ae).filter(h=>!W[h].metadata.supportLinePathType.includes(j)||W[h].isPro&&!d.RMP_CLOUD),$=h=>{h&&(Ie(l.current,t,h,r),b(l.current.getEdgeAttribute(t,"type")),p())},q=h=>{h&&(Me(l.current,t,h,S),G(l.current.getEdgeAttribute(t,"style")),p())},M=h=>{h&&(N?($(N),E(void 0)):X&&(q(X),Z(void 0)),w&&o(ue(!0))),g(!1),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(F,{options:m,disabledOptions:he,defaultValue:j,value:j,onChange:({target:{value:h}})=>{a.changeType?$(h):(E(h),u(!0))}})}),e.jsx(B,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(F,{options:y,disabledOptions:ge,defaultValue:v,value:v,onChange:({target:{value:h}})=>{a.changeType?q(h):(Z(h),u(!0))}})}),e.jsx(He,{type:"line",expand:!0}),e.jsx(se,{isOpen:x,leastDestructiveRef:f,onClose:()=>M(!1),children:e.jsx(ae,{children:e.jsxs(ie,{children:[e.jsx(re,{children:s("warning")}),e.jsxs(le,{children:[s("panel.details.changeLineTypeContent"),e.jsx(oe,{mt:4,isChecked:w,onChange:h=>g(h.target.checked),width:"100%",children:s("noShowAgain")})]}),e.jsxs(ce,{children:[e.jsx(T,{ref:f,onClick:()=>M(!1),children:s("cancel")}),e.jsx(T,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:s("panel.details.changeType")})]})]})})})]})}function Ze(){const{t:n}=R(),s=k(),o=c.useCallback(()=>{s(A(S.current.export())),s(L())},[s,L,A]),{selected:p,refresh:{nodes:d}}=C(y=>y.runtime),{preference:{autoChangeStationType:r,disableWarning:a}}=C(y=>y.app),[i]=p,S=c.useRef(window.graph),[t,l]=c.useState(!1),x=c.useRef(null),[u,f]=c.useState(void 0),[w,g]=c.useState(!1),[m,j]=c.useState(Ne.ShmetroBasic);c.useEffect(()=>{if(i!=null&&i.startsWith("stn")){const y=S.current.getNodeAttribute(i,"type");j(y)}},[d,p]);const b=Object.fromEntries(Object.entries(V).map(([y,v])=>[y,n(v.metadata.displayName).toString()])),N=y=>{y&&(_e(S.current,i,y),r&&i.startsWith("stn")&&Ue(S.current,i),o())},E=y=>{y&&u&&(N(u),w&&s(ue(!0))),f(void 0),g(!1),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(F,{options:b,disabledOptions:[m],value:m,onChange:({target:{value:y}})=>{a.changeType?N(y):(f(y),l(!0))}})}),e.jsx(se,{isOpen:t,leastDestructiveRef:x,onClose:()=>E(!1),children:e.jsx(ae,{children:e.jsxs(ie,{children:[e.jsx(re,{children:n("warning")}),e.jsxs(le,{children:[n("panel.details.changeStationTypeContent"),e.jsx(oe,{mt:4,isChecked:w,onChange:y=>g(y.target.checked),width:"100%",children:n("noShowAgain")})]}),e.jsxs(ce,{children:[e.jsx(T,{ref:x,onClick:()=>E(!1),children:n("cancel")}),e.jsx(T,{ml:"2",colorScheme:"red",onClick:()=>E(!0),children:n("panel.details.changeType")})]})]})})})]})}function $e(){const{t:n}=R(),s=k(),o=c.useCallback(()=>{s(A(i.current.export())),s(L()),s(P())},[s,L,P,A]),{activeSubscriptions:p}=C(u=>u.account),{selected:d,count:{parallel:r}}=C(u=>u.runtime),[a]=d,i=c.useRef(window.graph),S=u=>{const f=Math.min(Math.max(u,-10),10);i.current.hasNode(a)&&i.current.setNodeAttribute(a,"zIndex",f),i.current.hasEdge(a)&&i.current.setEdgeAttribute(a,"zIndex",f),o()},t=(u,f)=>{let w=-1;if(u){const g=i.current.getEdgeAttributes(a),[m,j]=i.current.extremities(a);w=pe(i.current,g.type,m,j,f)}l(w)},l=u=>{i.current.setEdgeAttribute(a,"parallelIndex",u),s(A(i.current.export())),s(P())},x=[];if(d.size!==0)if(d.size===1){if(x.push({type:"input",label:n("panel.details.info.id"),value:a,minW:276}),x.push({type:"select",label:n("panel.details.info.zIndex"),value:a?i.current.hasNode(a)?i.current.getNodeAttribute(a,"zIndex"):i.current.hasEdge(a)?i.current.getEdgeAttribute(a,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(u,f)=>[f-10,(f-10).toString()])),onChange:u=>S(Number(u))}),i.current.hasEdge(a)){const u=i.current.getEdgeAttributes(a),{parallelIndex:f,type:w}=u,g=p.RMP_CLOUD?Ee:Te,m=r>g&&f<0||w===de.Simple,j=r>g&&f>=0;x.push({type:"switch",label:n("panel.details.info.parallel"),isDisabled:m,isChecked:f>=0,onChange:b=>t(b,u[u.type].startFrom),oneLine:!0,minW:276}),f>=0&&x.push({type:"input",label:n("panel.details.info.parallelIndex"),variant:"number",isDisabled:j,value:u.parallelIndex.toString(),onChange:b=>l(Number(b)),minW:276})}}else d.size>1&&x.push({type:"input",label:n("panel.details.info.type"),value:n("panel.details.multipleSelection.title"),minW:276});return e.jsxs(D,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(H,{fields:x,minW:130}),d.size===1&&a.startsWith("stn")&&i.current.hasNode(a)&&i.current.getNodeAttribute(a,"type")in V&&e.jsx(Ze,{}),d.size===1&&a.startsWith("line")&&i.current.hasEdge(a)&&i.current.getEdgeAttribute(a,"type")in z&&i.current.getEdgeAttribute(a,"style")in W&&e.jsx(Xe,{}),d.size>1&&e.jsx(Ge,{})]})}function qe(){const{t:n}=R(),s=k(),{selected:o}=C(m=>m.runtime),[p]=o,d=c.useRef(window.graph),[r,a]=c.useState("undefined"),[i,S]=c.useState("undefined"),[t,l]=c.useState("undefined"),[x,u]=c.useState("undefined");c.useEffect(()=>{var m,j,b,N;if(p!=null&&p.startsWith("line")){const[E,y]=d.current.extremities(p);if(a(E),S(y),E.startsWith("stn")){const v=d.current.getNodeAttribute(E,"type");l((j=(m=d.current.getNodeAttribute(E,v))==null?void 0:m.names.at(0))!=null?j:"undefined")}if(y.startsWith("stn")){const v=d.current.getNodeAttribute(y,"type");u((N=(b=d.current.getNodeAttribute(y,v))==null?void 0:b.names.at(0))!=null?N:"undefined")}}},[o]);const f=te(()=>{s(I()),s(Q(r))}),w=te(()=>{s(I()),s(Q(i))}),g=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(T,{ml:"auto",size:"sm",variant:"link",onClick:f,children:r}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:t,minW:"full"},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(T,{ml:"auto",size:"sm",variant:"link",onClick:w,children:i}),oneLine:!0,minW:"full"},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:x,minW:"full"}];return e.jsxs(D,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(H,{fields:g,minW:130})]})}function Je(){const{t:n}=R(),s=k(),o=c.useCallback(()=>{s(A(a.current.export())),s(L()),s(P())},[s,L,P,A]),{selected:p,refresh:{nodes:d}}=C(l=>l.runtime),[r]=p,a=c.useRef(window.graph),[i,S]=c.useState({x:0,y:0});c.useEffect(()=>{if(r!=null&&r.startsWith("stn")||r!=null&&r.startsWith("misc_node_")){const l=a.current.getNodeAttribute(r,"x"),x=a.current.getNodeAttribute(r,"y");S({x:l,y:x})}},[d,p]);const t=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:i.x.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{a.current.mergeNodeAttributes(r,{x:Number(l)}),o()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:i.y.toString(),validator:l=>!Number.isNaN(l),onChange:l=>{a.current.mergeNodeAttributes(r,{y:Number(l)}),o()}}];return e.jsxs(D,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(H,{fields:t,minW:130})]})}const ne={...V,...Ve},Ke=()=>{var S;const n=k(),{selected:s}=C(t=>t.runtime),{t:o}=R(),[p]=s,d=window.graph.getNodeAttribute(p,"type"),r=d in ne&&ne[d].attrsComponent,a=(S=window.graph.getNodeAttribute(p,d))!=null?S:{},i=(t,l)=>{const x=window.graph.getNodeAttribute(t,"type");window.graph.mergeNodeAttributes(t,{[x]:l}),n(A(window.graph.export())),n(L())};return r?e.jsx(r,{id:p,attrs:a,handleAttrsUpdate:i}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:o("panel.details.unknown.error",{category:o("panel.details.unknown.node")})})},Qe=()=>{var m,j;const n=k(),{preference:{autoParallel:s}}=C(b=>b.app),{selected:o}=C(b=>b.runtime),{t:p}=R(),[d]=o,{type:r,style:a,parallelIndex:i,reconcileId:S}=window.graph.getEdgeAttributes(d),t=(m=window.graph.getEdgeAttribute(d,r))!=null?m:{},l=r in z&&z[r].attrsComponent,x=(j=window.graph.getEdgeAttribute(d,a))!=null?j:{},u=a in W&&W[a].attrsComponent,f=(b,N)=>{let E=-1;if(s){const[y,v]=window.graph.extremities(b);E=pe(window.graph,r,y,v,N)}window.graph.setEdgeAttribute(b,"parallelIndex",E)},w=(b,N)=>{window.graph.mergeEdgeAttributes(b,{[r]:N}),n(A(window.graph.export())),n(P())},g=(b,N)=>{window.graph.mergeEdgeAttributes(b,{[a]:N}),n(A(window.graph.export())),n(P())};return e.jsxs(e.Fragment,{children:[l?e.jsx(l,{id:d,attrs:t,recalculateParallelIndex:f,handleAttrsUpdate:w,parallelIndex:i}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:p("panel.details.unknown.error",{category:p("panel.details.unknown.linePath")})}),u?e.jsx(u,{id:d,attrs:x,handleAttrsUpdate:g,reconcileId:S}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:p("panel.details.unknown.error",{category:p("panel.details.unknown.lineStyle")})})]})},ot=()=>{const{t:n}=R(),s=k(),o=c.useRef(window.graph),p=c.useCallback(()=>{s(A(o.current.export())),s(L()),s(P())},[s,L,P,A]),{activeSubscriptions:d}=C(g=>g.account),{selected:r,isDetailsOpen:a,count:{masters:i}}=C(g=>g.runtime),{preference:{autoChangeStationType:S}}=C(g=>g.app),[t]=r,l=!d.RMP_CLOUD&&i+1>ve,x=()=>{Oe()?s(ze()):s(I())},u=g=>{const m=structuredClone(o.current.getNodeAttributes(g));m.x+=50,m.y+=50;const j=g.startsWith("stn")?"stn_".concat(Y(10)):"misc_node_".concat(Y(10));o.current.addNode(j,m),s(A(o.current.export())),s(L())},f=g=>{const m=De(o.current,g);navigator.clipboard.writeText(m)},w=g=>{s(I()),g.forEach(m=>{if(o.current.hasNode(m))o.current.dropNode(m);else if(o.current.hasEdge(m)){const[j,b]=o.current.extremities(m);o.current.dropEdge(m),S&&j.startsWith("stn")&&ee(o.current,j),S&&b.startsWith("stn")&&ee(o.current,b)}}),p()};return e.jsxs(Pe,{isOpen:a==="show",width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(Le,{onClose:x,children:n("panel.details.header")}),e.jsxs(ke,{children:[e.jsx($e,{}),r.size===1&&o.current.hasNode(t)&&e.jsx(Je,{}),r.size===1&&o.current.hasEdge(t)&&e.jsx(qe,{}),r.size===1&&e.jsxs(D,{p:1,children:[e.jsx(O,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(t)&&e.jsx(Ke,{}),window.graph.hasEdge(t)&&e.jsx(Qe,{})]})]}),e.jsx(Re,{children:e.jsxs(_,{children:[r.size===1&&o.current.hasNode(t)&&e.jsx(T,{size:"sm",variant:"outline",onClick:()=>u(t),isDisabled:o.current.getNodeAttributes(t).type===We.Master&&l,children:n("panel.details.footer.duplicate")}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>f(r),children:n("panel.details.footer.copy")}),e.jsx(T,{size:"sm",variant:"outline",onClick:()=>w(r),children:n("panel.details.footer.remove")})]})})]})};export{ot as default};
